<!doctype html>
<!-- The DOCTYPE declaration above will set the     -->
<!-- browser's rendering engine into                -->
<!-- "Standards Mode". Replacing this declaration   -->
<!-- with a "Quirks Mode" doctype is not supported. -->

<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Security-Policy" content="connect-src *">

<!--link rel="icon" type="image/png" sizes="32x32" href="https://dl.dropboxusercontent.com/s/r0gjpgxp8byjbzr/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="https://dl.dropboxusercontent.com/s/k0kyp30ale2pkod/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://dl.dropboxusercontent.com/s/0l0w2wk9wfxt4el/favicon-16x16.png"-->

<link rel="icon" type="image/png" sizes="32x32" href="{{url_for('static', filename='arrows-static/favicon-32x32.png')}}">
<link rel="icon" type="image/png" sizes="96x96" href="{{url_for('static', filename='arrows-static/favicon-96x96.png')}}">
<link rel="icon" type="image/png" sizes="16x16" href="{{url_for('static', filename='arrows-static/favicon-16x16.png')}}">



<title>Tiny Arrows</title>

<!-- ************************************ -->
<!-- Location scripts for Tiny Arrows API -->
<!-- ************************************ -->

<!-- *********************** -->
<!-- Alternative/Old scripts -->
<!-- *********************** -->
<!-- Alternative location for ace editor -->
<!-- script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.3.1/ace.js" type="text/javascript" charset="utf-8"></script> -->
<!--script src="https://unpkg.com/ace-builds@1.3.1/src-min-noconflict/ace.js" type="text/javascript" charset="utf-8"></script-->
<!--script src="https://bossanova.uk/jexcel/v3/jexcel.js"></script-->
<!--script src="https://bossanova.uk/jsuites/v2/jsuites.js"></script-->
<!--link rel="stylesheet" href="https://bossanova.uk/jexcel/v3/jexcel.css" type="text/css" /-->
<!--link rel="stylesheet" href="https://bossanova.uk/jsuites/v2/jsuites.css" type="text/css" /-->
<!--script src="{{ url_for('static', filename='jexcel/v3new/jexcel.js')}}"></script-->
<!--script src="{{ url_for('static', filename='jexcel/v3new/jsuites.js')}}"></script-->
<!--link rel="stylesheet" href="{{ url_for('static', filename='jexcel/v3new/jexcel.css')}}" type="text/css" /-->
<!--link rel="stylesheet" href="{{ url_for('static', filename='jexcel/v3new/jsuites.css')}}" type="text/css" /-->
<!-- Location scripts for jsme, jsmol, and ace -->
<!--script type="text/javascript" language="javascript" src="{{ url_for('static', filename='jsme/jsme.nocache.js')}}"></script-->
<!--script type="text/javascript" language="javascript" src="{{ url_for('static', filename='jsmol/JSmol.min.js')}}"></script-->
<!--script src="https://unpkg.com/ace-builds@1.4.1/src-min-noconflict/ace.js" type="text/javascript" charset="utf-8"></script-->
<!--link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='jexcel/v3/materialicons.css')}}" /-->
<!--link rel="stylesheet" href="/static/jexcel/v4/jexcel.theme.css" type="text/css" /-->




<!-- ************************************** -->
<!-- Location scripts for jexcel spreasheet -->
<!-- ************************************** -->
<script src="{{ url_for('static', filename='jexcel/v4/jexcel.js')}}"></script>
<script src="{{ url_for('static', filename='jexcel/v4/jsuites.js')}}"></script>
<link rel="stylesheet" href="{{ url_for('static', filename='jexcel/v4/jexcel.css')}}" type="text/css" />
<link rel="stylesheet" href="{{ url_for('static', filename='jexcel/v4/jsuites.css')}}" type="text/css" />

<!--script src="https://bossanova.uk/jspreadsheet/v4/jexcel.js"></script-->
<!--script src="https://jsuites.net/v4/jsuites.js"></script-->
<!--link rel="stylesheet" href="https://jsuites.net/v4/jsuites.css" type="text/css" /-->
<!--link rel="stylesheet" href="https://bossanova.uk/jspreadsheet/v4/jexcel.css" type="text/css" /-->




<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Material+Icons" />

<!-- ************************************** -->
<!-- Location of scripts for JSmol          -->
<!-- ************************************** -->
<script type="text/javascript" language="javascript" src="{{ url_for('static', filename='jsmol/JSmol.min.js')}}"></script>

<!-- ************************************** -->
<!-- Location of scripts for JSME           -->
<!-- ************************************** -->
<script type="text/javascript" language="javascript" src="{{ url_for('static', filename='jsme/jsme.nocache.js')}}"></script>

<!-- ************************************** -->
<!-- Location of scripts for ACE            -->
<!-- ************************************** -->
<script src="https://unpkg.com/ace-builds@1.4.12/src-min-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
<!--script src="https://unpkg.com/ace-builds@1.4.12/src-min-noconflict/ace.js" type="text/javascript" charset="utf-8"></script-->

<!-- ************************************** -->
<!-- Location of scripts for Jodit editor   -->
<!-- ************************************** -->
<script src="//cdnjs.cloudflare.com/ajax/libs/jodit/3.2.46/jodit.min.js"></script>
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/jodit/3.2.46/jodit.min.css">

<!-- ************************************** -->
<!-- Location of Bylaska util functions     -->
<!-- ************************************** -->
<script type="text/javascript" language="javascript" src="{{ url_for('static',filename='util/sprintf.js')}}"></script>

<!-- ************************************** -->
<!-- Location of Bylaska MD                 -->
<!-- ************************************** -->
<script type="text/javascript" language="javascript" src="{{ url_for('static',filename='arrows-md/bylaska.md.js')}}"></script>



<style>
   blink, .blink {
   animation: blinker 1s linear infinite;
   }
   @keyframes blinker {
   50% { opacity: 0; }
   }
</style>


<style type="text/css" media="screen">
    #editor {
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
    }
   .button2 {width:85px;text-align: left;}
   .button3 {width:106px;text-align: left;}
   .button4 {width:165px;text-align: left;}

/* Style the tab */
.tab {
    //overflow: hidden;
    //border: 2px solid #ccc;
   // background-color: #f1f1f1;
   // margin: auto;

    background-image: linear-gradient(#FEFEFE, #F1F1F1);
    position: relative;
    margin: auto;
    overflow: hidden;
    border-radius: 6px;
    border-color: #DEDEDE;
}

.tabBlock {
  margin: 0 0 2.5rem;
}
/* Style the buttons that are used to open the tab content */
.tab button {
    display: inline-block;
    list-style-type: none;
    background-color: inherit;
    display: block;
    position: relative;
    float: left;
    border: none;
    border-style: solid;
    border-width: 1px;
    border-color: #DEDEDE;
    outline: none;
    //outline: 1px solid #ccc;
    cursor: pointer;
    padding: 14px 16px;
    transition: 0.3s;
    font-size: 15px;
    font-weight: bold;
    font-family: times;
}


/* Change background color of buttons on hover */
.tab button:hover {
    //background-color: #cfc;
    background-color: lightgreen;
}

/* Create an active/current tablink class */
.tab button.active {
    //color: black;
    //background-color: #add;
    color: white;
    background-color: #4286f4;
}

/* Style the tab content */
.tabcontent {
    display: none;
    padding: 6px 12px;
    //border: 1px solid #ccc;
    border-top: none;
    //background-color: #b2b2b2;
    //background-color: #9bcc87;
    //background-color: #d1edc0;
    //background-color: rgba(0, 0, 0.1, .1);
}

}

.tabcontent {
    animation: fadeEffect 1s; /* Fading effect takes 1 second */
}

/* Go from zero to full opacity */
@keyframes fadeEffect {
    from {opacity: 0;}
    to {opacity: 1;}
}

.collapsible {
  background-color: #add;
  //background-color: #cfc;
  //background-color: green;
  color: black;
  cursor: pointer;
  padding: 2px;
  width: 100%;
  text-align: center;
  outline: none;
  font-size: 15px;
  font-weight: bold;
  font-family: times;
  border-style: solid;
  border-width: 1px;
  border-color: white;
}

.active, .collapsible:hover {
  color: white;
  background-color: #4286f4;
}

.content {
  padding: 0 18px;
  display: none;
  overflow: hidden;
  background-color: white;
}

.linkbanner {
  position: relative;
  //display: inline-block;
  padding: 1px;
  // background-color: lightblue;
  //background-image: linear-gradient(blue,#FEFEFE,blue);
  //background-image: linear-gradient(blue,lightgreen,blue);
  background-image: linear-gradient(#4286f4,lightgreen,#4286f4);
  //background-image: linear-gradient(#4286f4,#599a3e,#4286f4);
  //background-image: linear-gradient(#2f61ce,lightgreen,#2f61ce);
  //background-image: linear-gradient(#2f61ce,gold,#2f61ce);
  //background-image: linear-gradient(#4286f4,gold,#4286f4);
  font-size: 18px;
  font-weight: bold;
  font-family: times;
  color: white;
}



/*
body {
  //background-color: #F5F5F5;
  background-color: #E5E5E5;
}
*/


/*
ul, li {
    list-style:none;
    padding:0;
    margin:0;
}
*/
.listWrapper {
    max-height:300px;
    overflow-y:auto;
    border-style: ridge;
}


#overlay {
  position: fixed;
  display: none;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0,0,0,0.5);
  z-index: 2;
  cursor: pointer;
}

#text{
  position: absolute;
  top: 50%;
  left: 50%;
  font-size: 50px;
  color: white;
  transform: translate(-50%,-50%);
  -ms-transform: translate(-50%,-50%);
}

.blink9 {
  animation: blink9 1s linear 9;
}
@keyframes blink9 {
  0% {
    opacity: 1;
  }
  50% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}


</style>



<script type="text/javascript">

   function cacheInput(el)       { /*console.log("cacheInput: el.value=", el.value);*/ localStorage.setItem(":inputcache:"+el.attributes["id"].value,el.value); }
   function cacheInputbool(el,x) { /*console.log("cacheInputbool: x=", x);*/ localStorage.setItem(":inputboolcache:"+el.attributes["id"].value,x); }
   function cacheLoadAll()  {
      for (let i=0; i<localStorage.length; ++i) {
         let key = localStorage.key(i);
         console.log("cacheLoadAll: key=",key);
         if (key.includes(":inputcache:")) {
            let cachedVal = localStorage.getItem(key);
            document.getElementById(key.replace(":inputcache:","")).value = cachedVal;
            console.log("cacheLoadAll: key=",key, "cachedVal=",cachedVal);
         }
         if (key.includes(":inputboolcache:")) {
            let cachedVal = localStorage.getItem(key);
            if (cachedVal.includes("true")) {document.getElementById(key.replace(":inputboolcache:","")).checked = true; }
         }
      }
   }

   function cacheGet() {
      let data = "";
      for (let i=0; i<localStorage.length; ++i) {
         let key = localStorage.key(i);
         let cachedVal = localStorage.getItem(key);
         data += "CacheKey=" + key + "  CacheValue=" + cachedVal + "\n";
         //console.log("cacheWrite: CacheKey=",key, " CacheValue=",cachedVal);
      }
      editor.setValue(data,1);
   }

   function cachePut() {
      let data = editor.getValue();
      let data_list = data.trim().split("\n");

      for (let line of data_list) {
         let key = line.split("CacheKey=")[1].split("Value=")[0].trim();
         let val = line.split("CacheValue=")[1];
         localStorage.setItem(key,val);
      }
   }







   var ThomasChecked = false;
   var finalTranscript = '';

   try {
      window.SpeechRecognition = window.webkitSpeechRecognition || window.SpeechRecognition;
      var recognition = new window.SpeechRecognition();
      recognition.interimResults = true;
      recognition.maxAlternatives = 10;
      recognition.continuous = true;

      recognition.onresult = (event) => {
         //var flist = finalTranscript.split(/[ ,]+/);
         //if (flist.length>20) {
         //   finalTranscript = flist.slice(flist.length-20,flist.length).join(" ");
         //}
         var interimTranscript = '';
         for (var i = event.resultIndex, len = event.results.length; i < len; i++) {
            var transcript = event.results[i][0].transcript;
            if (event.results[i].isFinal) {
                  finalTranscript += transcript;
            } else {
                  interimTranscript += transcript;
            }
         }
         finalTranscript = finalTranscript.replace("plus","+").replace("Plus","+").replace("Arrow","-->").replace("arrow","-->").replace("minus","-").replace("Minus","-");
         if (finalTranscript.includes("return")) {
            finalTranscript = finalTranscript.replace("return","");
            runThomas(finalTranscript);
            finalTranscript = '';
            document.getElementById("speech2textbanner").value = '';
         } else  if (finalTranscript.includes("clear")) {
            finalTranscript = '';
            document.getElementById("speech2textbanner").value = '';
         } else if (finalTranscript.includes("backspace")) {
            var tmp = finalTranscript.split(/[ ,]+/);
            var ntmp = tmp.length;
            tmp = tmp.slice(0,ntmp-2);
            finalTranscript = tmp.join(" ");
            document.getElementById("speech2textbanner").value = finalTranscript;
         } else if (finalTranscript.includes("Thomas")) {
            var tmp = finalTranscript.split("Thomas");
            finalTranscript = tmp[0];
            document.getElementById("speech2textbanner").value = finalTranscript;
            runThomas(tmp[1]);
         } else {
            var you = finalTranscript + interimTranscript;
            //var you = finalTranscript + '<i style="color:#ddd;">' + interimTranscript + '</>';
            if (you.trim()!="") {
               document.getElementById("speech2textbanner").value = you;
            }
         }
      }
   } catch(err) { console.log("speech_recogniction failure:", err); }



   function submit_Thomas() {
     document.getElementById("speech2textbanner").value = editor.getValue();
     resetfinalTranscript();
     if (confirm("submit Thomas - run the Thomas script?")) {
        returnfinalTranscript();
     }
   }


   var queueThomas = [];
   var queueThomas_length = 0;
   var queueThomas_cur = 0;
   var queuerunning = false;

   function run_next_queueThomas() {
      console.log("\n\nrun_next_queueThomas",window.queueThomas_length,window.queueThomas_cur);
      console.log("queueThomas:",queueThomas);
      if ((window.queueThomas_cur < window.queueThomas_length)) {
         window.queueThomas_cur += 1;
         start_Thomas_command(window.queueThomas[window.queueThomas_cur-1]);
      }
   }

   function finish_Thomas_command(finalstr) {
      console.log("finish_Thomas_command:", finalstr);
      //document.getElementById('apirunning').innerHTML= finalstr;
      document.getElementById('apirunning').value= finalstr;
      run_next_queueThomas();
      if (window.queueThomas_cur >= window.queueThomas_length) {
         //document.getElementById('apirunning').innerHTML = "";
         document.getElementById('apirunning').value = "";
         window.queuerunning = false;
      }
   }

   //function finish_Thomas_command(finalstr) {
   //  setTimeout(() => { finish_Thomas_command0(finalstr); }, 1000);
   //}

   function dummy_callback(finalstr) { console.log("dummy_callback:", finalstr); }


   function runThomas0_splice(txt0all) {
      console.log("runThomas0_splice:",txt0all);
      let cur = window.queueThomas_cur;

      if (txt0all.contains("FOR") && txt0all.contains("END FOR LOOP")) {
         var runblock0,runblock,loopblock,x,vv;
         runblock0 = txt0all.split("END FOR LOOP")[0].split("LOOP")[1].trim();
         loopblock = txt0all.split("LOOP")[0].split("FOR")[1].trim();
         x = loopblock.split("=")[0].trim();
         vv = loopblock.split("=")[1].trim().replace("(","").replace(")","").split(",");

         for (var v of vv) {
            runblock = runblock0.split(x).join(v.trim()).split(";");
            for (const rb of runblock) {
               if (rb.trim().length>0) {
                  window.queueThomas.splic(cur,0,rb.trim());
                  window.queueThomas_length += 1;
                  cur += 1;
               }
            }
         }
      } else {

         var txt0list = txt0all.split(";");
         for (var iii=0; iii<txt0list.length; ++iii) {
            if (txt0list[iii].trim().length>0) {
               window.queueThomas.splice(cur,0,txt0list[iii].trim());
               window.queueThomas_length += 1;
               cur += 1;
            }
         }
      }
   }

   function runThomas0(txt0all) {
      console.log("runThomas0:",txt0all);
      //Text2Speech0(txt0);
      if (txt0all.contains("FOR") && txt0all.contains("END FOR LOOP")) {
         var runblock0,runblock,loopblock,x,vv;
         runblock0 = txt0all.split("END FOR LOOP")[0].split("LOOP")[1].trim();
         loopblock = txt0all.split("LOOP")[0].split("FOR")[1].trim();
         x = loopblock.split("=")[0].trim();
         vv = loopblock.split("=")[1].trim().replace("(","").replace(")","").split(",");

         for (var v of vv) {
            runblock = runblock0.split(x).join(v.trim()).split(";");
            for (const rb of runblock) {
               if (rb.trim().length>0) {
                  window.queueThomas.push(rb.trim());
                  window.queueThomas_length += 1;
               }
            }
         }
      } else {

         var txt0list = txt0all.split(";");
         for (var iii=0; iii<txt0list.length; ++iii) {
            if (txt0list[iii].trim().length>0) {
               window.queueThomas.push(txt0list[iii].trim());
               window.queueThomas_length += 1;
            }
         }
      }
   }

   function runThomas(txt0all) {
      console.log("runThomas:",txt0all);
      runThomas0(txt0all);
      console.log("calling first run_next_queueThomas, length=",window.queueThomas_length);
      run_next_queueThomas();
   }


   function start_Thomas_command(txt0) {
      console.log("\nstart_Thomas_command:",txt0.trim());

      if (txt0.includes("comments:") && txt0.includes(":comments")) {
         let comment_txt0 = txt0.split("comments:")[1].split(":comments")[0];
         txt0 = txt0.replace("comments:"+comment_txt0+":comments","");
      }

      var txt = txt0.toLowerCase();
      if (txt.includes("switch") && txt.includes("3d") && txt.includes("builder")) {
          openCity(event, 'Arrows Periodic 3D Builder');
          Text2Speech0("switch to 3d builder");
          finish_Thomas_command("Thomas switch 3d builder");
      }
      else if (txt.includes("switch") && txt.includes("2d") && txt.includes("builder")) {
          openCity(event, 'Arrows Entry - 2D Builder'); 
         Text2Speech0("switch to 2d builder"); 
         finish_Thomas_command("Thomas switch 2d");
      }
      else if (txt.includes("switch") && txt.includes("input") && txt.includes("editor")) {
          openCity(event, 'NWChem Input Editor');
          Text2Speech0("switch to input editor");
          finish_Thomas_command("Thomas switch to input editor");
      }
      else if (txt.includes("switch") && txt.includes("output")) {
         openCity(event, 'Output');
         Text2Speech0("switch to output");
         finish_Thomas_command("Thomas switch output");
      }
      else if (txt.includes("switch") && txt.includes("spreadsheet")) {
         openCity(event, 'SpreadSheet');
         Text2Speech0("switch to spreadsheet");
         finish_Thomas_command("Thomas switch spreadsheet");
      }
      else if (txt.includes("switch") && txt.includes("queue")) {
         openCity(event, 'Queue');
         Text2Speech0("switch to queue");
         finish_Thomas_command("Thomas switch queue");
      }
      else if (txt.includes("switch") && txt.includes("notes")) {
         openCity(event, 'Notes');
         Text2Speech0("switch to notes");
         finish_Thomas_command("Thomas switch notes");
      }
      else if (txt.includes("switch") && txt.includes("instructions")) {
         openCity(event, 'Instructions');
         Text2Speech0("switch to instructions");
         finish_Thomas_command("Thomas switch instructions");
      }
      else if (txt.includes("toggle") && txt.includes("builder")) { 
         openCity(event, 'Arrows Periodic 3D Builder'); 
         SwapDivsWithClick(1,'swapper-first','swapper-crystal','swapper-surface','swapper-symmetry','swapper-other','swapper-other2','swapper-other3'); 
         Text2Speech0("toggle builder");
         finish_Thomas_command("toggle builder"); }
      else if (txt.includes("toggle") && txt.includes("lattice")) { 
         openCity(event, 'Arrows Periodic 3D Builder'); 
         SwapDivsWithClick(2,'swapper-first','swapper-crystal','swapper-surface','swapper-symmetry','swapper-other','swapper-other2','swapper-other3'); 
         Text2Speech0("toggle lattice");
         finish_Thomas_command("toggle lattice"); }
      else if (txt.includes("toggle") && txt.includes("bulk")) { 
         openCity(event, 'Arrows Periodic 3D Builder'); 
         SwapDivsWithClick(3,'swapper-first','swapper-crystal','swapper-surface','swapper-symmetry','swapper-other','swapper-other2','swapper-other3'); 
         Text2Speech0("toggle bulk surface");
         finish_Thomas_command("toggle bulk surface"); }
      else if (txt.includes("toggle") && txt.includes("symmetry")) { 
         openCity(event, 'Arrows Periodic 3D Builder'); 
         SwapDivsWithClick(4,'swapper-first','swapper-crystal','swapper-surface','swapper-symmetry','swapper-other','swapper-other2','swapper-other3'); 
         Text2Speech0("toggle symmetry");
         finish_Thomas_command("toggle symmetry");
      }
      else if (txt.includes("toggle") && txt.includes("polyhedra")) { 
         openCity(event, 'Arrows Periodic 3D Builder'); 
         SwapDivsWithClick(5,'swapper-first','swapper-crystal','swapper-surface','swapper-symmetry','swapper-other','swapper-other2','swapper-other3'); 
         Text2Speech0("toggle polyhedra");
         finish_Thomas_command("toggle polyhedra");
      }
      else if (txt.includes("toggle") && txt.includes("reaction")) { 
         openCity(event, 'Arrows Periodic 3D Builder'); 
         SwapDivsWithClick(6,'swapper-first','swapper-crystal','swapper-surface','swapper-symmetry','swapper-other','swapper-other2','swapper-other3'); 
         Text2Speech0("toggle reaction");
         finish_Thomas_command("toggle reaction");
      }
      else if (txt.includes("toggle") && txt.includes("collective")) { 
         openCity(event, 'Arrows Periodic 3D Builder'); 
         SwapDivsWithClick(7,'swapper-first','swapper-crystal','swapper-surface','swapper-symmetry','swapper-other','swapper-other2','swapper-other3'); 
         Text2Speech0("toggle collective");
         finish_Thomas_command("toggle collective");
      }
      else if (txt.includes("switch") && txt.includes("reaction")) { jmreactionplane(); finish_Thomas_command("Thomas switch reaction");}
      else if (txt.includes("unit cell") && txt.includes("on")) { jmshowcell0(true); Text2Speech0("unit cell is on"); finish_Thomas_command("Thomas turn on unit cell");}
      else if (txt.includes("unit cell") && txt.includes("off")) { jmshowcell0(false); Text2Speech0("unit cell is off"); finish_Thomas_command("Thomas turn off unit cell");}
      else if (txt.includes("unit cell") && txt.includes("center")) { 
         Text2Speech0("unit cell is centered"); 
         jmscentercell0(true); 
         finish_Thomas_command("Thomas center unit cell");
      }
      else if (txt.includes("unit cell") && txt.includes("origin")) { 
         Text2Speech0("unit cell at origin");
         jmscentercell0(false);
         finish_Thomas_command("Thomas origin unit cell");
      }
      else if (txt.includes("fractional") && txt.includes("center")) { 
         Text2Speech0(txt0);
         //setTimeout(() => { document.getElementById('fractionalCoords').value = centercoords(document.getElementById('fractionalCoords').value); jmsupdatefracbox(); }, 100);
         setTimeout(() => { document.getElementById('fractionalCoords').textContent = centercoords(document.getElementById('fractionalCoords').textContent); jmsupdatefracbox(); }, 100);
         //document.getElementById('fractionalCoords').value = centercoords(document.getElementById('fractionalCoords').value); 
         //jmsupdatefracbox();
         finish_Thomas_command("Thomas center fractional");
      }
      else if (txt.includes("reaction") && txt.includes("off")) { 
         Text2Speech0("reaction is off"); 
         jmshowcell0(true); 
         finish_Thomas_command("Thomas reaction off");
      }
      else if (txt.includes("space") && txt.includes("fill")) {  
          Text2Speech0("atoms are space filling"); 
          jms("select *;spacefill 75%"); 
          finish_Thomas_command("Thomas space filling");
      }
      else if (txt.includes("ball") && txt.includes("stick")) {
         Text2Speech0("atoms are ball and stick"); 
         jms("select *; wireframe 0.15; spacefill 23%;"); 
         finish_Thomas_command("Thomas ball and stick");
      }
      else if (txt.includes("stick")) {  jms("select *; wireframe 0.03; spacefill 1%;"); Text2Speech0("atoms are stick"); finish_Thomas_command("Thomas stick");}
      else if (txt.includes("2d") && (txt.includes("add")||txt.includes("append"))) {  
         Text2Speech0("Added molecule into JSME");
         appendMolecule();
         finish_Thomas_command("Thomas 2d add || append");
      }
      else if (txt.includes("3d") && (txt.includes("add")||txt.includes("append"))) {  
         jmasmiles();
         Text2Speech0("Added molecule into JSMol");
         finish_Thomas_command("Thomas 3d add || append");
      }
      else if (txt.includes("editor") && txt.includes("to") && txt.includes("jsmol"))  {  
         if (txt.indexOf("editor")<txt.indexOf("jsmol")) {
            Text2Speech0("Editor to JSMol");
            setTimeout(() => { jmloadxyz(); }, 1000);
            //jmloadxyz(); 
         } else {
            Text2Speech0("JSMol to Editor");
            setTimeout(() => { jmoltoeditor(); }, 1000);
            //jmoltoeditor(); 
         }
         //finish_Thomas_command("Thomas editor to jsmol");
         setTimeout(() => { finish_Thomas_command("Thomas editor to jsmol"); }, 1000);
      }
      else if (txt.includes("run script") || txt.includes("arrows_script"))  {  
         Text2Speech0(txt0);
         let parse_txt = txt0;
         if (txt.includes("run script")) { parse_txt = parse_txt.split("run script")[1]; }

         //let program_args         = parse_txt.trim().split(/\s+/);
         let program_args         = splitargs(parse_txt.trim());

         let program_args_default = [];
         if (program_args.length>0) {
            let prog_name = document.getElementById("arrowsprogramurl").value.trim() + "/"+ program_args[0].trim();
            let prog = loadurldata(prog_name);

            if (prog.includes("comments:") && prog.includes(":comments")) {
               let comment_txt0 = prog.split("comments:")[1].split(":comments")[0];
               prog = prog.replace("comments:"+comment_txt0+":comments","");
            }

            if (prog.includes("default_args:") && prog.includes(":default_args")) {
               let program_args_txt0 = prog.split("default_args:")[1].split(":default_args")[0];
               prog = prog.replace("default_args:"+program_args_txt0+":default_args","");
               program_args_txt0    = program_args[0] + " " + program_args_txt0;
               //program_args_default = program_args_txt0.trim().split(/\s+/);
               program_args_default = splitargs(program_args_txt0.trim());
            }
            //console.log("program_args        :", program_args);
            //console.log("program_args_default:", program_args_default);

            while (prog.includes("$arg")) {
               let ia = parseInt(prog.split("$arg")[1].split(/[ ;]+/)[0].trim());
               console.log("ia=",ia);
               if (ia<program_args.length) {
                  prog = prog.replace("$arg"+ia.toString(), program_args[ia].trim());
               } else if (ia<program_args_default.length) {
                  prog = prog.replace("$arg"+ia.toString(), program_args_default[ia].trim());
               } else {
                  prog = prog.replace("$arg"+ia.toString(), "");
               }
            }
            document.getElementById("speech2textbanner").value = prog;
            runThomas0_splice(prog);
         }
         //finish_Thomas_command("Thomas run script");
         setTimeout(() => { finish_Thomas_command("Thomas run script"); }, 1000);
         setTimeout(() => { document.getElementById("speech2textbanner").value = ''; }, 1000);
      }
      else if (txt.includes("load") && txt.includes("from") && txt.includes("url"))  {  
         loadurltoeditor();
         finish_Thomas_command("Thomas load from url");
      }
      else if (txt.includes("load") && (txt.split(" ")[0] != "set")) {  
         var mol = txt.replace("load","").trim();
         Text2Speech0(mol + " is loaded");
         loadurltojsmol0(mol.split(" + "),false); 
         finish_Thomas_command("Thomas load mol");
      }
      else if (txt.includes("add") && txt0.includes("smiles")) {  
         Text2Speech0(txt0);
         var vvv = txt0.split("smiles")[1].trim();
         jmaddsmiles(vvv,2);
         //finish_Thomas_command("Thomas add smiles");
      }
      else if ((txt.includes("append")) && (txt.includes("frame")) ) {  
         document.getElementById('apirunning').value += "+ running jsmol script\n";
         var ScriptCallback_scpt = 'set echoCallback \"hScriptCallback\";';
         jms0(ScriptCallback_scpt);

         Text2Speech0(txt0);
         var vvv = txt0.split("frame")[1].trim();
         loadframe2jsmol(false,true,parseInt(vvv));
         //finish_Thomas_command("Thomas append frame");
      }
      else if (txt.includes("append")) {  
         var mol = txt.replace("append","").trim();
         Text2Speech0(mol + " is appended");
         loadurltojsmol0(mol.split(" + "),true); 
         finish_Thomas_command("Thomas append");
      }
      else if (txt.includes("add")) {  
         var mol = txt.replace("add","").trim();
         Text2Speech0(mol + " is added");
         loadurltojsmol0(mol.split(" + "),true); 
         finish_Thomas_command("Thomas add mol");
      }
      else if ( txt.includes("charge") && (txt.includes("molecule")) ) {  
         Text2Speech0("The charge of the molecule is " + charge_arrowsdata().toString());
         finish_Thomas_command("Thomas charge molecule");
      }
      else if ( txt.includes("multiplicity") && (txt.includes("molecule")) ) {  
         Text2Speech0("The multiplicity of the molecule is " + mult_arrowsdata().toString());
         finish_Thomas_command("Thomas multe molecule");
      }
      else if (txt.includes("run") && txt.includes("2d") && txt.includes("molecule")) {  
         clearSmiles2();
         appendSmiles();
         Text2Speech0("Running 2D molecule");
         Confirm0(document.form2,document.form2.smi.value);
         finish_Thomas_command("Thomas run 2d molecule");
      }
      else if (txt.includes("2d")) {  
         Text2Speech0("Loaded molecule into JSME");
         readMolecule();
         finish_Thomas_command("Thomas 2d");
      }
      else if (txt.includes("3d")) {  
         Text2Speech0("Loaded molecule into JSMol");
         jmsmiles();
         finish_Thomas_command("Thomas 3d");
      }
      else if (txt.includes("run") && txt.includes("molecule")) {  
         clearSmiles();
         appendXYZ2();
         Text2Speech0("Running 3D molecule");
         Confirm0(document.form,document.form.smi.value);
         finish_Thomas_command("Thomas run molecule");
      }
      else if (txt.includes("execute")) {  
         var mol = txt0.replace("execute","").trim();
         document.form2.smi.value = mol;
         Text2Speech0("Executing " + mol);
         Confirm0(document.form2,mol);
         finish_Thomas_command("Thomas execute");
      }
      else if (txt.includes("supercell")) {  
         document.getElementById('apirunning').value += "+ running jsmol script\n";
         var ScriptCallback_scpt = 'set echoCallback \"hScriptCallback\";';
         jms0(ScriptCallback_scpt);

         Text2Speech0(txt0);
         var vvv = txt.split("supercell")[1].trim(); console.log("vvv=",vvv); 
         jmssupercell(vvv);
         //finish_Thomas_command("Thomas supercell");
      }
      else if (txt.includes("reset") && txt.includes("text")) {  
         Text2Speech0(txt0);
         var vvv = txt0.split("text")[1].trim();
         var xxx = vvv.split(" ")[0];
         var yyy = "";
         document.getElementById(xxx).value = yyy;
         finish_Thomas_command("Thomas reset text");
      }
      else if (txt.includes("set") && txt.includes("text")) {  
         Text2Speech0(txt0);
         var vvv = txt0.split("text")[1].trim();
         var xxx = vvv.split(" ")[0];
         var yyy = vvv.replace(xxx,"").trim();
         document.getElementById(xxx).value = yyy;
         finish_Thomas_command("Thomas set text");
      }
      else if (txt.includes("set") && txt.includes("url")) {  
         var vvv = txt0.split("url")[1].trim();
         var xxx = vvv.split(" ")[0];
         var yyy = vvv.replace(xxx,"").trim();
         //var corh = "https://cors-anywhere.herokuapp.com/";
         var corh = "";
         var url = corh + yyy;
         if (yyy.trim().length>9) {
            var ajax = new XMLHttpRequest();
            ajax.open("GET", url, false); // third parameter is async flag
            ajax.send();
            document.getElementById(xxx).value = ajax.responseText;
            finish_Thomas_command("Thomas set url");
         }
      }
      else if (txt.includes("set") && txt.includes("number")) {  
         Text2Speech0(txt0);
         var vvv = txt0.split("number")[1].trim();
         var xxx = vvv.split(" ")[0];
         var yyy = vvv.replace(xxx,"").trim();
         document.getElementById(xxx).value = parseFloat(yyy);
         finish_Thomas_command("Thomas set number");
      }
      else if (txt.includes("set") && txt.includes("radio")) {  
         Text2Speech0(txt0);
         var vvv = txt0.split("radio")[1].trim();
         var xxx = vvv.split(" ")[0].trim();
         var yyy = vvv.replace(xxx,"").trim();
         if (yyy.includes("true")) {
            document.getElementById(xxx).checked = true;
         } else {
            document.getElementById(xxx).checked = false;
         }
         finish_Thomas_command("Thomas set radio");
      }
      else if (txt.includes("build") && txt.includes("reactants from chemical reaction")) {  
         Text2Speech0(txt0);
         appendreactants2jsmol(document.getElementById('reaction_genhash00').value,2,
                               document.getElementById('check_buildreactants').checked);
      }
      else if (txt.includes("generate") && txt.includes("chemical reaction hash")) {  
         Text2Speech0(txt0);
         gen_rhash2(finish_Thomas_command);
      }
      else if (txt.includes("generate") && txt.includes("reaction hash")) {  
         Text2Speech0(txt0);
         gen_rhash1(finish_Thomas_command);
      }
      else if (txt.includes("generate") && txt.includes("wham model")) {  
         Text2Speech0(txt0);
         gen_wham_model(finish_Thomas_command);
      }
      else if (txt.includes("generate") && txt.includes("solvate") && txt.includes("wham input")) {  
         Text2Speech0(txt0);
         var vvv = txt.split("wham input");
         var xx = -1.0;
         if (vvv.length>1) {
             xx = parseFloat(vvv[1]);
         }
         solvatewhaminput(xx,finish_Thomas_command);
      }
      else if (txt.includes("generate") && txt.includes("bulk") && txt.includes("crystal")) {  
         document.getElementById('apirunning').value += "+ running jsmol script\n";
         var ScriptCallback_scpt = 'set echoCallback \"hScriptCallback\";';
         jms0(ScriptCallback_scpt);

         loadbulktojsmol();
         Text2Speech0(txt0);
         //finish_Thomas_command("Thomas generate bulk crystal");
      }
      else if (txt.includes("generate") && txt.includes("surface")) {  
         Text2Speech0(txt0);
         console.log("INTO CUTSLAB(2)");
         cutslab(2);
         //jmsetcoordboxes();
         //finish_Thomas_command("Thomas generate surface");
      }
      else if (txt.includes("generate") && txt.includes("coordboxes")) {  
         Text2Speech0(txt0);
         jmsetcoordboxes();
         finish_Thomas_command("Thomas set coordboxes");
      }
      else if (txt.includes("define") && txt.includes("surface") &&  txt.includes("cut") ) {  
         Text2Speech0(txt0);
         var vvv = txt0.split("cut")[1].trim();
         document.getElementById("surface_cut").value = vvv;
         defineslab('surface_cut','surface_a','surface_b','surface_c');
         finish_Thomas_command("Thomas define surface cut");
      }
      else if (txt.includes("optimize") && txt.includes("selected")) {  
         Text2Speech0(txt0);
         optimizeselected(finish_Thomas_command);
      }
      else if (txt.includes("search") && txt.includes("reaction constraints using reaction hash")) {  
         Text2Speech0(txt0);
         gen_reactions1(finish_Thomas_command);
      }
      else if (txt.includes("use") && txt.includes("jsme reaction")) {  
         Text2Speech0(txt0);
         loadreaction2dWindow('reaction_genhash00');
         finish_Thomas_command("Thomas use jsme reaction");
      }
      else if (txt.includes("nwchem") && txt.includes("format")) {  
         Text2Speech0(txt0);
         convert2geometry(false);
         finish_Thomas_command("Thomas nwchem format");
      }
      else if (txt.includes("change") && txt.includes("format")) {  
         Text2Speech0(txt0);
         changebandpspw();
         finish_Thomas_command("Thomas change format");
      }
      else if (txt.includes("change") && txt.includes("fractional")) {  
         Text2Speech0(txt0);
         changenwchemfractional();
         finish_Thomas_command("Thomas change fractional");
      }
      else if (txt.includes("change") && txt.includes("optimizer")) {  
         Text2Speech0(txt0);
         changenwchemoptimizer();
         finish_Thomas_command("Thomas change fractional");
      }
      else if (txt.includes("reaction") && txt.includes("job")) {  
         generatereactionjob();
         finish_Thomas_command("Thomas reaction jobs");
      }
      else if (txt.includes("car") && txt.includes("parrinello")) {  
         Text2Speech0(txt0);
         addcpmd(false,'',txt.split("parrinello")[1]);
         finish_Thomas_command("Thomas car parrinello");
      }
      else if (txt.includes("steepest") && txt.includes("descent")) {  
         Text2Speech0(txt0);
         addcpsd(txt.split("descent")[1]);
         finish_Thomas_command("Thomas steepest descent");
      }
      else if (txt.includes("energy")) {  
         addenergy(txt.split("energy")[1]);
         finish_Thomas_command("Thomas energy");
      }
      else if (txt.includes("split") && txt.includes("submit nwchem")) {  
         Text2Speech0(txt0);
         submit_splitnwchemjob2(finish_Thomas_command);
      }
      else if (txt.includes("submit nwchem")) {  
         Text2Speech0(txt0);
         submit_nwchemjob2(finish_Thomas_command);
      }
      else if (txt.includes("resolve") && txt.includes("variables")) {  
         Text2Speech0(txt0);
         console.log("into resolve");
         resolveauxvariables('auxiliary_functions',finish_Thomas_command);
      }
      else if (txt.includes("resolve") && txt.includes("reaction_bondings")) {  
         Text2Speech0(txt0);
         resolveauxvariables('reaction_bondings',finish_Thomas_command);
      }
      else if (txt.includes("delete all models")) {  
         Text2Speech0(txt0);
         deleteframeall();
         finish_Thomas_command("Thomas delete all models");
      }
      else if (txt.includes("delete model")) {  
         Text2Speech0(txt0);
         deleteframe2jsmol();
         finish_Thomas_command("Thomas delete model");
      }
      else if (txt.includes("jmsscript")) {  
         console.log("In jmsscript");
         Text2Speech0(txt0);
         var scpt = txt0.replace("jmsscript","").replace("Jmsscript","").trim().split(":").join(";");
         jms(scpt);
         console.log("In jmsscript, scpt=",scpt);
         sleep(1000);
         finish_Thomas_command("Thomas jmsscript");
      }
      else if ((txt.includes("optimize")) && (txt.includes("md"))) {  
         Text2Speech0("MD optimize molecule");
         myoptimizer();
         finish_Thomas_command("Thomas md optimize");
      }
      else if (txt.includes("optimize")) {  
         Text2Speech0("Optimizing molecule");
         jms('select nonmetal;minimize steps 100; select *; wireframe 0.15; spacefill 23%; boundbox {*}; centerat boundbox; zoom 0; javascript echo(globalVar)');
         finish_Thomas_command("Thomas optimize");
      } 
      else {
         finish_Thomas_command("Thomas no command");
      }
   }

   function splitargs(myString) {
      var myRegexp = /[^\s"]+|"([^"]*)"/gi;
      var myArray = [];

      do {
         //Each call to exec returns the next regex match as an array
         var match = myRegexp.exec(myString);
         if (match != null)
         {
             //Index 1 in the array is the captured group if it exists
             //Index 0 is the matched text, which we use if no captured group exists
             myArray.push(match[1] ? match[1] : match[0]);
         }
      } while (match != null);

      return myArray;
   }



   function clearfinalTranscript() {
      //window.finalTranscript = '';
      finalTranscript = '';
      document.getElementById("speech2textbanner").value = '';
   }
   function returnfinalTranscript() {
      //window.finalTranscript = window.finalTranscript.replace("return","");
      //runThomas(window.finalTranscript);
      //window.finalTranscript = '';

      finalTranscript = finalTranscript.replace("return","");
      runThomas(finalTranscript);
      finalTranscript = '';

      document.getElementById("speech2textbanner").value = '';
   }

   function resetfinalTranscript() {
         //window.finalTranscript = document.getElementById("speech2textbanner").value;
         finalTranscript = document.getElementById("speech2textbanner").value;
         //document.getElementById("speech2textbanner2").innerHTML = window.finalTranscript;
   }

   function Speech2Text() {
      sleep(100.0);
      if (document.getElementById("speech2text_on").checked) {
         window.recognition.start();
      } else { 
         window.recognition.stop();
      }
   }

   function Sleepy0(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
   }


   async function Text2Speech0(txt) {
      var nw = txt.split(/[ ,]+/).length;
      var checked = document.getElementById("speech2text_on").checked && document.getElementById("text2speech_on").checked;
      if (checked) {
         window.recognition.stop(); 
         await Sleepy0(100.0);
      }
      Text2Speech(txt);
      if (checked) {
         await Sleepy0(500.0*nw);
         window.recognition.start();
      }
   }

   //function Speech2Text() {
   //   if (document.getElementById("speech2text_on").checked) {
   //       window.SpeechRecognition = window.webkitSpeechRecognition || window.SpeechRecognition;
   //       let finalTranscript = '';
   //       let recognition = new window.SpeechRecognition();
   //       let ThomasChecked = false;
//
 //         recognition.interimResults = true;
  //        recognition.maxAlternatives = 10;
   //       recognition.continuous = true;
    //      recognition.onresult = (event) => {
     //       let finalTranscript = '';
      //      let interimTranscript = '';
//            for (let i = event.resultIndex, len = event.results.length; i < len; i++) {
 //             let transcript = event.results[i][0].transcript;
  //            if (event.results[i].isFinal) {
   //             finalTranscript += transcript;
    //          } else {
     //           interimTranscript += transcript;
      //        }
       //     }
        //    var you = finalTranscript + '<i style="color:#ddd;">' + interimTranscript + '</>';
 //           if (you.trim()!="") {
  //             document.getElementById("speech2textbanner").innerHTML = you;
   //         }
    //        if (finalTranscript.includes("stop")) {
     //          recognition.stop();
      //         document.getElementById("speech2text_on").checked = false;
       //        Text2Speech("I am no longer listening");
        //    }
         //   if (!document.getElementById("speech2text_on").checked) {
     //          recognition.stop();
      //         Text2Speech("I am no longer listening Eric");
    //        }
     //       if ((ThomasChecked) && (!finalTranscript.includes("Hello"))) {
      //         Text2Speech("Okay. I'll run that");
 //              ThomasChecked = false;
  //          }
   //         if (finalTranscript.includes("Thomas") && !ThomasChecked) {
    //           Text2Speech("Hello.  What can I do for you?"); 
     //          ThomasChecked = true;
      //      }
       //   }
        //  recognition.start();
//       }
 //  }

   // Text to Speech
   function Text2Speech(txt) {

      // list of languages is probably not loaded, wait for it
      if(window.speechSynthesis.getVoices().length == 0) {
         window.speechSynthesis.addEventListener('voiceschanged', function() {
   	    textToSpeech();
      });
      }
      else {
      // languages list available, no need to wait
         document.getElementById("text2speechbanner").innerHTML = txt;
         if (document.getElementById("text2speech_on").checked) {
            textToSpeech(txt)
         }
      }
   
      function textToSpeech(txt) {
         // get all voices that browser offers
         var available_voices = window.speechSynthesis.getVoices();

         console.log("Available Voices ", available_voices);

         // this will hold an english voice
         var english_voice = '';

         // find voice by language locale "en-US"
         // if not then select the first voice
         for(var i=0; i<available_voices.length; i++) {
		if(available_voices[i].lang === 'en-US') {
			english_voice = available_voices[i];
			break;
		}
	 }
         console.log("English voice ", english_voice);
	 if(english_voice === '')
		english_voice = available_voices[0];

	 // new SpeechSynthesisUtterance object
 	 var utter = new SpeechSynthesisUtterance();
 	 //utter.rate = 1;
 	 utter.rate = 0.99;
	 //utter.pitch = 0.5;
	 utter.pitch = 0.95;
	 //utter.text = 'Hello World';
	 utter.text = txt;
	 utter.voice = english_voice;

	 // event after text has been spoken
         // utter.onend = function() {alert('Speech has finished'); }

	// speak
	window.speechSynthesis.speak(utter);
      }
   }
   Text2Speech("speech turned on!");



	//this function will be called after the JavaScriptApplet code has been loaded.
	function jsmeOnLoad() {

		//Instantiate a new JSME: 380px  340px
		//arguments: HTML id, width, height (must be string not number!)
		//jsmeApplet = new JSApplet.JSME("appletContainer", "700px", "467px", {
                //var startingStructure = "13 14 C 15.94 -11.45 C 15.94 -10.05 C 14.72 -9.35 C 13.51 -10.05 C 13.51 -11.45 C 14.72 -12.15 C 17.34 -11.45 C 17.34 -10.05 O 18.33 -9.06 C 18.33 -12.44 C 17.96 -13.79 C 19.68 -12.07 N 21.03 -11.71 1 2 1 2 3 -1 3 4 1 4 5 1 5 6 1 1 6 -1 7 8 1 2 8 1 1 7 1 8 9 2 7 10 -1 10 11 2 10 12 1 12 13 3";
    	

		jsmeApplet = new JSApplet.JSME("appletContainer", "1000px", "667px", {
			//optional parameters
			"options" : "query,hydrogens,canonize,removehs,atommovebutton,fullScreenIcon",
		        //"jme" : startingStructure
		});

		//Alternative method: the size is not specified: the applet will use 100% of the space of its parent container "appletContainer".
		//Be sure that the parent container size > 0, otherwise the applet will not be visible

		/*    	jsmeApplet = new JSApplet.JSME("appletContainer",  {
		 //optional parameters
		 "options" : "query,hydrogens",
		 "jme" : startingStructure
		 });
		 */

		//Opera patch: if some applet elements are not displayed, force repaint
		//jsmeApplet.deferredRepaint(); //the applet will be repainted after the browser event loop returns
		//it is recommended to use it if the JSME is created outside this jsmeOnLoad() function

		//jsmeApplet has the same API as the original Java applet
		//One can mimic the JME Java applet access to simplify the adaptation of HTML and JavaScript code:
		document.JME = jsmeApplet;

		//suggestion 
		//all buttons that access the jsme variable were disabled in the html
		//Now enable all buttons that can access the jsme variable since the applet is ready
		//example:
		//document.getElementById("button").disabled=false;
                jsmeApplet.setMenuScale(1.4);

	}
        function jsmereaction() {
           jsmeApplet.options("query,hydrogens,canonize,removehs,reaction");
           //jsmeApplet.reset();
        }
        function jsmenoreaction() {
           jsmeApplet.options("query,hydrogens,canonize,removehs,noreaction");
           //jsmeApplet.reset();
        }

     delete Jmol._tracker;
     function jmolOnLoad() {
            Info = {
            width: 950,
            height: 700,
            //width: 750,
            //height: 500,
            debug: false,
            //File location for Tiny Arrows API
            j2sPath: "{{ url_for('static', filename='jsmol/j2s')}}",

            //File location for debugging and development
            //j2sPath: "/arrows-static/jsmol/j2s",
            
            //color: "0x3BBC52",
            //color: "0x3BBC52",
            //color: "0xc6ed80",
            color: "0x4286f4",
            //color: "0x2f61ce",
            disableJ2SLoadMonitor: true,
            disableInitialConsole: true,
            addSelectionOptions: true,

            //File location for Tiny Arrows API
            serverURL: "{{ url_for('static', filename='jsmol/jsmol.php')}}",

            //File location for debugging and development
            //serverURL: "/arrows-static/jsmol/jsmol.php",

            use: "HTML5",
            readyFunction: null,
            //script: "load  /arrows-static/jjj.xyz ; set modelKitMode "
            script: "set modelKitMode "
         };
         $("#jsmoldiv").html(Jmol.getAppletHtml("jmolApplet0", Info));
         $("#jsmolbtns").html(Jmol.jmolButton("jmolApplet0","select *;spacefill 75%" ,"Space Fill") + Jmol.jmolButton("jmolApplet0", "select *; wireframe 0.15; spacefill 23%;","Ball and Stick") +  Jmol.jmolButton("jmolApplet0", "select *; wireframe 0.03; spacefill 1%;","Stick") ); 

         //jm_cmdlist_add();
      }

      function jmolsetLoadStruct() {
         console.log("setting HCLEANLOADSTRUCT");
         jms0('set LoadStructCallback \"hcleanloadstruct\";');
      }

      function hcleanloadstruct(xx,yy,zz) {
         console.log("HCLEANDEFAULTLOAD",xx, " yy=",yy, " zz=",zz);
         if (zz.includes(".cif")) {
            console.log("Loaded CIF file");
         }
         var hasunitcell = jmvar("_.keys").includes("someModelsHaveUnitcells");
         if (hasunitcell) {
            var ttt = jmvar("_m.unitCellParams[1][6]");
            document.getElementById("cell_a").value = ttt[0];
            document.getElementById("cell_b").value = ttt[1];
            document.getElementById("cell_c").value = ttt[2];
            document.getElementById("cell_alpha").value = ttt[3];
            document.getElementById("cell_beta").value  = ttt[4];
            document.getElementById("cell_gamma").value = ttt[5];

            // This logic works for now - but need to add the capability to change the unitcell orientation 
            //var lattice = abcabg_to_lattice(ttt[0],ttt[1],ttt[2],ttt[3],ttt[4],ttt[5]);
            var uuu = jmvar("_m.infoUnitCell[7][15]");
            var lattice = [[uuu[0],uuu[1],uuu[2]], [uuu[3],uuu[4],uuu[5]], [uuu[6],uuu[7],uuu[8]] ];
            document.getElementById("lattice_a1").value =  vec3_to_string3(lattice[0]);
            document.getElementById("lattice_a2").value =  vec3_to_string3(lattice[1]);
            document.getElementById("lattice_a3").value =  vec3_to_string3(lattice[2]);

            // TO DO - need to add the capability to change the unitcell orientation 
            //jmsetfcoordboxes();
            jmsetcoordboxes();

         } else {
            jmsetcoordboxes();
         } 
         
      }

        function convertMOL2XYZ(str) {
           var i,n,x,data;
           var lines = str.split("\n");
           if (str.includes("V2000")) {
              data = lines[3].trim().split(" ")[0];
              n = eval(data);
              data += "\n\n";
              n += 4;
              for (i=4; i<n; i++) {
                 x = lines[i].trim().split(/[ ,]+/);
                 data += x[3] + " "; 
                 data += x[0] + " ";
                 data += x[1] + " ";
                 data += x[2] + "\n";
              }
           } 
           else { 
              data=str;
           }
           return data;
        } 

        function gennum(v) {
           var x;
           if (v=='') {
               x = 1.0;
           } else {
              var vv = v.split('/');
              x = parseFloat(vv[0]);
              if (vv.length>1) {
                 x = x/parseFloat(vv[1]);
              }
           }
           return x;
        }

        function opmatrix(xyzstr) {
           var xs,pp,pm,pi,sgn,i,ii,v;
           var op = [0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0];
           for (var ijk=0; ijk<3; ++ijk) {
              xs = xyzstr.split(',')[ijk]
              pp = xs.split('+');
              pm = [];
              for (i=0; i<pp.length; ++i) {
                 pm.push(pp[i].split('-'));
              }
              for (i=0; i<pm.length; ++i) {
                 pi = pm[i];
                 sgn = +1;
                 for (ii=0; ii<pi.length; ++ii) {
                    if (pi[ii].indexOf('x')!=-1) {
                       v = pi[ii].split('x')[0];
                       op[ijk] += sgn*gennum(v);
                    } else if (pi[ii].indexOf('y')!=-1) {
                       v = pi[ii].split('y')[0];
                       op[ijk+3] += sgn*gennum(v);
                    } else if (pi[ii].indexOf('z')!=-1) {
                       v = pi[ii].split('z')[0];
                       op[ijk+6] += sgn*gennum(v);
                    } else {
                       v = pi[ii];
                       if (v!='') {
                          op[ijk+9] += sgn*gennum(v);
                       }
                    }
                    sgn = -1;
                 }
              }
           }
           return op;
        }

        function compare_ops(ops1,ops2) {
           var i1,i2,m1,m2,j,msame;
           var same=false;
           if (ops1.length==ops2.length) {
              for (i1=0; i1<ops1.length; ++i1) {
                 m1 = opmatrix(ops1[i1]);
                 same = false;
                 for (i2=0; i2<ops2.length; ++i2) {
                    m2 = opmatrix(ops2[i2]);
                    msame = true;
                    for (j=0; j<12; ++j) {
                       msame = msame && (Math.abs(m1[j]-m2[j])<1.0e-6);
                    }
                    same = same || msame;
                 }
                 if (!same) { break; }
              }
           }
           return same;
        }

        function symmetry_genfracgeom(symops,symb,x,y,z) {
           var fracgeom2 = [];
           var op,x2,y2,z2;
           for (var i=0; i<symops.length; ++i) {
              op = opmatrix(symops[i]);
              x2 = op[0]*x + op[3]*y + op[6]*z + op[9];
              y2 = op[1]*x + op[4]*y + op[7]*z + op[10];
              z2 = op[2]*x + op[5]*y + op[8]*z + op[11];
              fracgeom2.push([symb,x2,y2,z2]);
           }
           for (var j=0; j<fracgeom2.length; ++j) {
              fracgeom2[j][1] = fracgeom2[j][1] - Math.round(fracgeom2[j][1]);
              fracgeom2[j][2] = fracgeom2[j][2] - Math.round(fracgeom2[j][2]);
              fracgeom2[j][3] = fracgeom2[j][3] - Math.round(fracgeom2[j][3]);
           }
           return fracgeom2;
        }

        function jsUcfirst(string) 
        {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }
        function isLetter(str) {
           return str.length === 1 && str.match(/[a-z]/i);
        }


        // ****************************
        // *                          *
        // *    loadinput2editor      *
        // *                          *
        // ****************************
        var inputframes_ntotal = 1;
        var inputframes_cur = 0;
        var inputframes = [];
        function loadinput2editor(addmodel) {
           var data  = editor.getValue(); // or session.getValue
           if (addmodel) {
              window.inputframes_ntotal += 1;
              window.inputframes.push(data);
           }

           var nframes = window.inputframes.length;
           if (nframes<window.inputframes_ntotal) {
              window.inputframes.push(data);
              window.inputframes_cur = (window.inputframes_cur + 1) % window.inputframes_ntotal;
           } else {
                 window.inputframes[window.inputframes_cur] = data;
                 window.inputframes_cur = (window.inputframes_cur + 1) % window.inputframes_ntotal;
                 data = window.inputframes[window.inputframes_cur];
           }
           var i = window.inputframes_cur + 1;
           document.getElementById("input_label").innerHTML = "Input " + i + " out of " + window.inputframes_ntotal;
           Text2Speech0("Text Input " + i + " out of " + window.inputframes_ntotal);
           editor.setValue(data,1); 

           setQueueLabel();
        }

        function previnput2editor() {
           if (window.inputframes_ntotal>1) {
              var data  = editor.getValue(); // or session.getValue
              window.inputframes[window.inputframes_cur] = data;
              window.inputframes_cur = (window.inputframes_cur - 1 + window.inputframes_ntotal) % window.inputframes_ntotal;
              data = window.inputframes[window.inputframes_cur];
              var i = window.inputframes_cur + 1;
              document.getElementById("input_label").innerHTML = "Input " + i + " out of " + window.inputframes_ntotal;
              Text2Speech0("Text Input " + i + " out of " + window.inputframes_ntotal);
              editor.setValue(data,1); 
           }
        }

        function switchinput2editor(newcur) {
           if (window.inputframes_ntotal>1) {
              var data  = editor.getValue(); // or session.getValue
              window.inputframes[window.inputframes_cur] = data;
              window.inputframes_cur = newcur;
              data = window.inputframes[window.inputframes_cur];
              var i = window.inputframes_cur + 1;
              document.getElementById("input_label").innerHTML = "Input " + i + " out of " + window.inputframes_ntotal;
              Text2Speech0("Text Input " + i + " out of " + window.inputframes_ntotal);
              editor.setValue(data,1); 
              alert("newcur="+newcur.toString() + " FIRSTLINE="+data.split("\n")[1]);

              setQueueLabel();
           }
        }
        function deleteinput2editor() {
           if (window.inputframes_ntotal>1) {
              window.inputframes_ntotal -= 1;
              for (var i=window.inputframes_cur; i<window.inputframes_ntotal; ++i) {
                 window.inputframes[i] = window.inputframes[i+1];
              }
              if (window.inputframes_cur>=(window.inputframes_ntotal-1)) {
                 window.inputframes_cur = window.inputframes_ntotal-1;
              }
              console.log("inputframes_cur=",window.inputframes_cur, "  inputframes_ntotal=",window.inputframes_ntotal);
              data = window.inputframes[window.inputframes_cur];
              var i = window.inputframes_cur + 1;
              document.getElementById("input_label").innerHTML = "Input " + i + " out of " + window.inputframes_ntotal;
              Text2Speech0("Text Input " + i + " out of " + window.inputframes_ntotal);
              editor.setValue(data,1); 

              setQueueLabel();
           }
        }


        // ****************************
        // *                          *
        // *       nwinputsplit       *
        // *                          *
        // ****************************
        function nwinputsplit() {
           var i;
           var data  = editor.getValue(); // or session.getValue
           console.log("DATA=",data);

           // CIF file splitting
           if (data.includes("data_nwchem_pspw")) {
              var nwcifs = data.split("data_nwchem_pspw");
              var nwlen = nwcifs.length;
              nwcifs = nwcifs.slice(1,nwlen)
              nwlen  = nwcifs.length;
              console.log("nwlen=",nwlen);
              if (nwlen>1) {
                 editor.setValue("data_nwchem_pspw\n\n" + nwcifs[0].trim(),1); // or session.getValue

                 for (i=window.inputframes_cur; i<(window.inputframes_cur+nwlen); ++i) {
                    if (i>window.inputframes_cur) {
                       nwcifs[i] = "data_nwchem_pspw\n\n" + nwcifs[i].trim();
                    }
                    if (i>=window.inputframes_ntotal) {
                       window.inputframes_ntotal += 1;
                       window.inputframes.push(nwcifs[i]);
                    } else {
                       window.inputframes[i] = nwcifs[i];
                    }
                 }
                 var i = window.inputframes_cur + 1;
                 document.getElementById("input_label").innerHTML = "Input " + i + " out of " + window.inputframes_ntotal;
                 Text2Speech0("Text Input " + i + " out of " + window.inputframes_ntotal);
              }

           // NWChem input deck splitting
           } else if (data.includes("### restart here ###")) {
              var nwinputs = data.split("### restart here ###");
              var nwlen = nwinputs.length;
              console.log("nwlen=",nwlen);
              console.log("NWINPUTs=",nwinputs);
              if (nwlen>1) {
                 editor.setValue(nwinputs[0],1); // or session.getValue
                 var header = nwinputs[0].split("title")[0];
                 header += "\n";
                 header += "title" + nwinputs[0].split("title")[1].split("\n")[0] + "\n\n"; 
                 header += "echo\n\n";
                 header += "restart " + nwinputs[0].split("start ")[1].split("\n")[0] + "\n\n";
                 header += "memory "  + nwinputs[0].split("memory ")[1].split("\n")[0] + "\n\n";

                 var nwin0 = nwinputs[0].split("nwchem_input")[1].split("\n")[0].trim();
                 if (!nwin0.includes(".rs.")) {
                    var nwin1 = nwin0.replace(".nw",".rs.nw");
                    header = header.replace(nwin0,nwin1);
                 }
                 //header = header.replace(nwin0,nwin1);

                 var nwoutput = nwinputs[0].split("nwchem_output")[1].split("\n")[0].trim();
                 var numtag = nwoutput.split("out")[1];
                 var num = parseInt(nwoutput.split("out")[1]);
           
                 for (i=window.inputframes_cur; i<(window.inputframes_cur+nwlen); ++i) {
                    if (i>window.inputframes_cur) {
                       num += 1;
                       //nwinputs[i] = header.replace("00",("00"+num.toString()).slice(-2)) + nwinputs[i];
                       nwinputs[i] = header.replace(numtag,(numtag+num.toString()).slice(-2)) + nwinputs[i];
                    }
                    if (i>=window.inputframes_ntotal) {
                       window.inputframes_ntotal += 1;
                    }
                    if (i>=window.inputframes.length) {
                       window.inputframes.push(nwinputs[i]);
                    } else {
                       window.inputframes[i] = nwinputs[i];
                    }
                 }
                 var j = window.inputframes_cur + 1;
                 document.getElementById("input_label").innerHTML = "Input " + j + " out of " + window.inputframes_ntotal;
                 Text2Speech0("Text Input " + i + " out of " + window.inputframes_ntotal);
              }


           // XYZ  and ion_motion splitting
           } else {
              var dataln = data.split("\n");
              var nargs  = dataln[0].trim().split(/[ ,]+/).length;
              var nln    = dataln.length;
              var nion,nstride;
       

              if ((nargs==1) || (nargs==12)) {
                 if (nargs==1) {
                    nion   = parseInt(dataln[0].trim());
                    nstride = nion+2;
                 }
                 if (nargs==12) {
                    var nion  = parseInt(dataln[0].trim().split(/[ ,]+/)[1]);
                    var nstride = 0;
                    i = 1;
                    while ((i<nln) && (nstride==0)) {
                       var nargsl  = dataln[i].trim().split(/[ ,]+/).length;
                       if (nargsl==12) {nstride = i;}
                       i += 1;
                    }
                 }
                 var nxyz = nln/nstride;
                 var ns = 0;
                 var ne = nstride;

                 if (nxyz>1) {
                    editor.setValue(dataln.slice(ns,ne).join("\n"),1); // or session.getValue

                    for (i=window.inputframes_cur; i<(window.inputframes_cur+nxyz); ++i) {
                       if (i>=window.inputframes_ntotal) {
                          window.inputframes_ntotal += 1;
                          window.inputframes.push(dataln.slice(ns,ne).join("\n"));
                       } else {
                          window.inputframes[i] = dataln.slice(ns,ne).join("\n");
                       }
                       ns += nstride; ne += nstride;
                    }
                    var i = window.inputframes_cur + 1;
                    document.getElementById("input_label").innerHTML = "Input " + i + " out of " + window.inputframes_ntotal;
                    Text2Speech0("Text Input " + i + " out of " + window.inputframes_ntotal);
                 }
              }
           }
        }



        // ****************************
        // *                          *
        // *        parse_cif         *
        // *                          *
        // ****************************
        function parse_cif(data) {
           var a = parseFloat(data.split("_cell_length_a")[1].split("\n")[0].trim().split("(")[0]);
           var b = parseFloat(data.split("_cell_length_b")[1].split("\n")[0].trim().split("(")[0]);
           var c = parseFloat(data.split("_cell_length_c")[1].split("\n")[0].trim().split("(")[0]);
           var alpha = parseFloat(data.split("_cell_angle_alpha")[1].split("\n")[0].trim().split("(")[0]);
           var beta  = parseFloat(data.split("_cell_angle_beta")[1].split("\n")[0].trim().split("(")[0]);
           var gamma = parseFloat(data.split("_cell_angle_gamma")[1].split("\n")[0].trim().split("(")[0]);

           console.log("alpha=",alpha);
           console.log("beta=",beta);
           console.log("gamma=",gamma);

           // symmetry here
           var symops,nops,j,groupfound,setting,gname,cname,groupname,groupnumber;

           groupname = "P1";
           if (data.includes("_symmetry_space_group_name_H-M")) {
              groupname = data.split("_symmetry_space_group_name_H-M")[1].split("\n")[0].trim();
           }
           groupnumber = 1;
           if (data.includes("_space_group_IT_number")) {
              groupnumber = data.split("_space_group_IT_number")[1].split("\n")[0].trim();
           }
           cname = "Triclinic"
           if (data.includes("_symmetry_cell_setting")) {
              cname = jsUcfirst(data.split("_symmetry_cell_setting")[1].split("\n")[0].trim());
           }
           symops = ["x,y,z"];
           if (data.includes("_symmetry_equiv_pos_as_xyz") || data.includes("_space_group_symop_operation_xyz")) {
              if (data.includes("_symmetry_equiv_pos_as_xyz")) {
                 symops = data.split("_symmetry_equiv_pos_as_xyz")[1].split("loop_")[0].trim().replace(/'/g,"").replace(/ /g, "").split("\n");
              } else {
                 symops = data.split("_space_group_symop_operation_xyz")[1].split("loop_")[0].trim().replace(/'/g,"").replace(/ /g, "").split("\n");
              }
              nops   = symops.length-1;
           }

           // geometry here 
           var loops = data.split("loop_")
           j=0;
           var geomfound = false;
           while ((!geomfound) && (j<loops.length)) {
              geomfound = loops[j].includes("_atom_site_type_symbol");
              geomfound = geomfound || loops[j].includes("_atom_site_label");
              j += 1;
           }
           var looplines = loops[j-1].trim().split("\n");
           var isym,ix,iy,iz,istart,ss,symb;
           isym = -1; ix = -1; iy = -1; iz = -1; istart = -1;
           for (j=0; j<looplines.length; ++j) {
              if (looplines[j].includes("_atom_site_type_symbol")) {
                 isym = j;
              }
              if ((looplines[j].includes("_atom_site_label")) && (isym<0)) {
                 isym = j;
              }
              if (looplines[j].includes("_atom_site_fract_x")) {
                 ix = j;
              }
              if (looplines[j].includes("_atom_site_fract_y")) {
                 iy = j;
              }
              if (looplines[j].includes("_atom_site_fract_z")) {
                 iz = j;
              }
              if (looplines[j].includes("_")) {istart = j;}
           }
            console.log(isym);
            console.log(ix); console.log(iy); console.log(iz);
            istart += 1;
            var fracgeom2;
            var fracgeom = [] ;
            for (j=istart; j<looplines.length; ++j) {
               ss = looplines[j].trim().split(/[ ,]+/);
               if (ss[isym].length>1) {
                  symb = ss[isym].charAt(0);
                  if (isLetter(ss[isym].charAt(1))) { symb += ss[isym].charAt(1); }
               } else {
                  symb = ss[isym].charAt(0);
               }
               x = parseFloat(ss[ix].split("(")[0]);
               y = parseFloat(ss[iy].split("(")[0]);
               z = parseFloat(ss[iz].split("(")[0]);

               fracgeom2 = symmetry_genfracgeom(symops,symb,x,y,z);
               for (n=0; n<fracgeom2.length; ++n) {
                  m = 0;
                  geomfound = false;
                  while ((!geomfound) && (m<fracgeom.length)) {
                     geomfound = (fracgeom2[n][0]==fracgeom[m][0]);
                     geomfound = geomfound && (Math.abs(fracgeom2[n][1]-fracgeom[m][1])<1.0e-6);
                     geomfound = geomfound && (Math.abs(fracgeom2[n][2]-fracgeom[m][2])<1.0e-6);
                     geomfound = geomfound && (Math.abs(fracgeom2[n][3]-fracgeom[m][3])<1.0e-6);
                     m += 1;
                  }
                  if (!geomfound) {
                     fracgeom.push(fracgeom2[n]);
                  }
               }
            }

           var lattice = abcabg_to_lattice(a,b,c,alpha,beta,gamma);
           var symmetry = [groupnumber,groupname,symops,cname];
           return [fracgeom,lattice,symmetry];
        }



        // ****************************
        // *                          *
        // *     editor_fetchXYZ      *
        // *                          *
        // ****************************
        // fetches the xyz data from the editor
        function editor_fetchXYZ() {
           var i,n,m,x,y,z,nion;
           var data = editor.getValue(); // or session.getValue
           var lines = data.split("\n");
           var ucell = "";
           if (data.includes("V2000")) {
              data = lines[3].trim().split(" ")[0];
              n = eval(data);
              data += "\n\n";
              n += 4;
              for (i=4; i<n; i++) {
                 x = lines[i].trim().split(/[ ,]+/);
                 data += x[3] + " "; 
                 data += x[0] + " ";
                 data += x[1] + " ";
                 data += x[2] + "\n";
              }
           } 

           if (data.includes("geometry") && data.includes("end")) {
              n = lines.length;
              m = 0;
              x = false;
              data = "";
              for (i=0; i<n; i++) {
                 if (lines[i].includes("geometry")) {
                    x = true;
                 } else if (lines[i].includes("end")) {
                    x = false;
                 } else if (x) {
                    data += lines[i] + "\n";
                    m += 1;
                 }
              }
              data = m.toString() + "\n\n" + data;
           }
           if (data.includes("_cell_length_a")) {
              var a = parseFloat(data.split("_cell_length_a")[1].split("\n")[0].trim().split("(")[0]);
              var b = parseFloat(data.split("_cell_length_b")[1].split("\n")[0].trim().split("(")[0]);
              var c = parseFloat(data.split("_cell_length_c")[1].split("\n")[0].trim().split("(")[0]);
              var alpha = parseFloat(data.split("_cell_angle_alpha")[1].split("\n")[0].trim().split("(")[0]);
              var beta  = parseFloat(data.split("_cell_angle_beta")[1].split("\n")[0].trim().split("(")[0]);
              var gamma = parseFloat(data.split("_cell_angle_gamma")[1].split("\n")[0].trim().split("(")[0]);
              document.getElementById("cell_a").value = a;
              document.getElementById("cell_b").value = b;
              document.getElementById("cell_c").value = c;
              document.getElementById("cell_alpha").value = alpha;
              document.getElementById("cell_beta").value  = beta;
              document.getElementById("cell_gamma").value = gamma;
              document.getElementById("showcell0").value = "Unit cell off";
              document.getElementById("showcell").value = "Unit cell off";
              document.getElementById("showcell1").value = "Unit cell off";
              document.getElementById("centercell").value = "Origin";
              document.getElementById("centercell0").value = "Origin";
              document.getElementById("centercell1").value = "Origin";
              console.log("alpha=",alpha);
              console.log("beta=",beta);
              console.log("gamma=",gamma);
              jsmcellchange(true,false);



              var symall= [[1, 1, '        P1', 'Triclinic', '+x,+y,+z'], [2, 1, '       P-1', 'Triclinic', '+x,+y,+z', '-x,-y,-z'], [3, 1, '        P2', 'Monoclinic', '+x,+y,+z', '-x,+y,-z'], [4, 1, '      P2_1', 'Monoclinic', '+x,+y,+z', '-x,+y+1/2,-z'], [5, 1, '        C2', 'Monoclinic', '+x,+y,+z', '-x,+y,-z', '+x+1/2,+y+1/2,+z', '-x+1/2,+y+1/2,-z'], [6, 1, '        Pm', 'Monoclinic', '+x,+y,+z', '+x,-y,+z'], [7, 1, '        Pc', 'Monoclinic', '+x,+y,+z', '+x,-y,+z+1/2'], [8, 1, '        Cm', 'Monoclinic', '+x,+y,+z', '+x,-y,+z', '+x+1/2,+y+1/2,+z', '+x+1/2,-y+1/2,+z'], [9, 1, '        Cc', 'Monoclinic', '+x,+y,+z', '+x,-y,+z+1/2', '+x+1/2,+y+1/2,+z', '+x+1/2,-y+1/2,+z+1/2'], [10, 1, '      P2/m', 'Monoclinic', '+x,+y,+z', '-x,+y,-z', '-x,-y,-z', '+x,-y,+z'], [11, 1, '    P2_1/m', 'Monoclinic', '+x,+y,+z', '-x,+y+1/2,-z', '-x,-y,-z', '+x,-y+1/2,+z'], [12, 1, '      C2/m', 'Monoclinic', '+x,+y,+z', '-x,+y,-z', '-x,-y,-z', '+x,-y,+z', '+x+1/2,+y+1/2,+z', '-x+1/2,+y+1/2,-z', '-x+1/2,-y+1/2,-z', '+x+1/2,-y+1/2,+z'], [13, 1, '      P2/c', 'Monoclinic', '+x,+y,+z', '-x,+y,-z+1/2', '-x,-y,-z', '+x,-y,+z+1/2'], [14, 1, '    P2_1/c', 'Monoclinic', '+x,+y,+z', '-x,+y+1/2,-z+1/2', '-x,-y,-z', '+x,-y+1/2,+z+1/2'], [15, 1, '      C2/c', 'Monoclinic', '+x,+y,+z', '-x,+y,-z+1/2', '-x,-y,-z', '+x,-y,+z+1/2', '+x+1/2,+y+1/2,+z', '-x+1/2,+y+1/2,-z+1/2', '-x+1/2,-y+1/2,-z', '+x+1/2,-y+1/2,+z+1/2'], [16, 1, '      P222', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z', '-x,+y,-z', '+x,-y,-z'], [17, 1, '    P222_1', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z+1/2', '-x,+y,-z+1/2', '+x,-y,-z'], [18, 1, '  P2_12_12', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z', '-x+1/2,+y+1/2,-z', '+x+1/2,-y+1/2,-z'], [19, 1, 'P2_12_12_1', 'Orthorhombic', '+x,+y,+z', '-x+1/2,-y,+z+1/2', '-x,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,-z'], [20, 1, '    C222_1', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z+1/2', '-x,+y,-z+1/2', '+x,-y,-z', '+x+1/2,+y+1/2,+z', '-x+1/2,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,-z'], [21, 1, '      C222', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z', '-x,+y,-z', '+x,-y,-z', '+x+1/2,+y+1/2,+z', '-x+1/2,-y+1/2,+z', '-x+1/2,+y+1/2,-z', '+x+1/2,-y+1/2,-z'], [22, 1, '      F222', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z', '-x,+y,-z', '+x,-y,-z', '+x,+y+1/2,+z+1/2', '-x,-y+1/2,+z+1/2', '-x,+y+1/2,-z+1/2', '+x,-y+1/2,-z+1/2', '+x+1/2,+y,+z+1/2', '-x+1/2,-y,+z+1/2', '-x+1/2,+y,-z+1/2', '+x+1/2,-y,-z+1/2', '+x+1/2,+y+1/2,+z', '-x+1/2,-y+1/2,+z', '-x+1/2,+y+1/2,-z', '+x+1/2,-y+1/2,-z'], [23, 1, '      I222', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z', '-x,+y,-z', '+x,-y,-z', '+x+1/2,+y+1/2,+z+1/2', '-x+1/2,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,-z+1/2'], [24, 1, 'I2_12_12_1', 'Orthorhombic', '+x,+y,+z', '-x+1/2,-y,+z+1/2', '-x,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,-z', '+x+1/2,+y+1/2,+z+1/2', '-x+1,-y+1/2,+z+1', '-x+1/2,+y+1,-z+1', '+x+1,-y+1,-z+1/2'], [25, 1, '      Pmm2', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z', '+x,-y,+z', '-x,+y,+z'], [26, 1, '    Pmc2_1', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z+1/2', '+x,-y,+z+1/2', '-x,+y,+z'], [27, 1, '      Pcc2', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z', '+x,-y,+z+1/2', '-x,+y,+z+1/2'], [28, 1, '      Pma2', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z', '+x+1/2,-y,+z', '-x+1/2,+y,+z'], [29, 1, '    Pca2_1', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z+1/2', '+x+1/2,-y,+z', '-x+1/2,+y,+z+1/2'], [30, 1, '      Pnc2', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z', '+x,-y+1/2,+z+1/2', '-x,+y+1/2,+z+1/2'], [31, 1, '    Pmn2_1', 'Orthorhombic', '+x,+y,+z', '-x+1/2,-y,+z+1/2', '+x+1/2,-y,+z+1/2', '-x,+y,+z'], [32, 1, '      Pba2', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z', '+x+1/2,-y+1/2,+z', '-x+1/2,+y+1/2,+z'], [33, 1, '    Pna2_1', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z+1/2', '+x+1/2,-y+1/2,+z', '-x+1/2,+y+1/2,+z+1/2'], [34, 1, '      Pnn2', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z', '+x+1/2,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,+z+1/2'], [35, 1, '      Cmm2', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z', '+x,-y,+z', '-x,+y,+z', '+x+1/2,+y+1/2,+z', '-x+1/2,-y+1/2,+z', '+x+1/2,-y+1/2,+z', '-x+1/2,+y+1/2,+z'], [36, 1, '    Cmc2_1', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z+1/2', '+x,-y,+z+1/2', '-x,+y,+z', '+x+1/2,+y+1/2,+z', '-x+1/2,-y+1/2,+z+1/2', '+x+1/2,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,+z'], [37, 1, '      Ccc2', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z', '+x,-y,+z+1/2', '-x,+y,+z+1/2', '+x+1/2,+y+1/2,+z', '-x+1/2,-y+1/2,+z', '+x+1/2,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,+z+1/2'], [38, 1, '      Amm2', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z', '+x,-y,+z', '-x,+y,+z', '+x,+y+1/2,+z+1/2', '-x,-y+1/2,+z+1/2', '+x,-y+1/2,+z+1/2', '-x,+y+1/2,+z+1/2'], [39, 1, '      Abm2', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z', '+x,-y+1/2,+z', '-x,+y+1/2,+z', '+x,+y+1/2,+z+1/2', '-x,-y+1/2,+z+1/2', '+x,-y+1,+z+1/2', '-x,+y+1,+z+1/2'], [40, 1, '      Ama2', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z', '+x+1/2,-y,+z', '-x+1/2,+y,+z', '+x,+y+1/2,+z+1/2', '-x,-y+1/2,+z+1/2', '+x+1/2,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,+z+1/2'], [41, 1, '      Aba2', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z', '+x+1/2,-y+1/2,+z', '-x+1/2,+y+1/2,+z', '+x,+y+1/2,+z+1/2', '-x,-y+1/2,+z+1/2', '+x+1/2,-y+1,+z+1/2', '-x+1/2,+y+1,+z+1/2'], [42, 1, '      Fmm2', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z', '+x,-y,+z', '-x,+y,+z', '+x,+y+1/2,+z+1/2', '-x,-y+1/2,+z+1/2', '+x,-y+1/2,+z+1/2', '-x,+y+1/2,+z+1/2', '+x+1/2,+y,+z+1/2', '-x+1/2,-y,+z+1/2', '+x+1/2,-y,+z+1/2', '-x+1/2,+y,+z+1/2', '+x+1/2,+y+1/2,+z', '-x+1/2,-y+1/2,+z', '+x+1/2,-y+1/2,+z', '-x+1/2,+y+1/2,+z'], [43, 1, '      Fdd2', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z', '+x+1/4,-y+1/4,+z+1/4', '-x+1/4,+y+1/4,+z+1/4', '+x,+y+1/2,+z+1/2', '-x,-y+1/2,+z+1/2', '+x+1/4,-y+3/4,+z+3/4', '-x+1/4,+y+3/4,+z+3/4', '+x+1/2,+y,+z+1/2', '-x+1/2,-y,+z+1/2', '+x+3/4,-y+1/4,+z+3/4', '-x+3/4,+y+1/4,+z+3/4', '+x+1/2,+y+1/2,+z', '-x+1/2,-y+1/2,+z', '+x+3/4,-y+3/4,+z+1/4', '-x+3/4,+y+3/4,+z+1/4'], [44, 1, '      Imm2', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z', '+x,-y,+z', '-x,+y,+z', '+x+1/2,+y+1/2,+z+1/2', '-x+1/2,-y+1/2,+z+1/2', '+x+1/2,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,+z+1/2'], [45, 1, '      Iba2', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z', '+x+1/2,-y+1/2,+z', '-x+1/2,+y+1/2,+z', '+x+1/2,+y+1/2,+z+1/2', '-x+1/2,-y+1/2,+z+1/2', '+x+1,-y+1,+z+1/2', '-x+1,+y+1,+z+1/2'], [46, 1, '      Ima2', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z', '+x+1/2,-y,+z', '-x+1/2,+y,+z', '+x+1/2,+y+1/2,+z+1/2', '-x+1/2,-y+1/2,+z+1/2', '+x+1,-y+1/2,+z+1/2', '-x+1,+y+1/2,+z+1/2'], [47, 1, '      Pmmm', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z', '-x,+y,-z', '+x,-y,-z', '-x,-y,-z', '+x,+y,-z', '+x,-y,+z', '-x,+y,+z'], [48, 1, '      Pnnn', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z', '-x,+y,-z', '+x,-y,-z', '-x+1/2,-y+1/2,-z+1/2', '+x+1/2,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,+z+1/2'], [49, 1, '      Pccm', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z', '-x,+y,-z+1/2', '+x,-y,-z+1/2', '-x,-y,-z', '+x,+y,-z', '+x,-y,+z+1/2', '-x,+y,+z+1/2'], [50, 1, '      Pban', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z', '-x,+y,-z', '+x,-y,-z', '-x+1/2,-y+1/2,-z', '+x+1/2,+y+1/2,-z', '+x+1/2,-y+1/2,+z', '-x+1/2,+y+1/2,+z'], [51, 1, '      Pmma', 'Orthorhombic', '+x,+y,+z', '-x+1/2,-y,+z', '-x,+y,-z', '+x+1/2,-y,-z', '-x,-y,-z', '+x+1/2,+y,-z', '+x,-y,+z', '-x+1/2,+y,+z'], [52, 1, '      Pnna', 'Orthorhombic', '+x,+y,+z', '-x+1/2,-y,+z', '-x+1/2,+y+1/2,-z+1/2', '+x,-y+1/2,-z+1/2', '-x,-y,-z', '+x+1/2,+y,-z', '+x+1/2,-y+1/2,+z+1/2', '-x,+y+1/2,+z+1/2'], [53, 1, '      Pmna', 'Orthorhombic', '+x,+y,+z', '-x+1/2,-y,+z+1/2', '-x+1/2,+y,-z+1/2', '+x,-y,-z', '-x,-y,-z', '+x+1/2,+y,-z+1/2', '+x+1/2,-y,+z+1/2', '-x,+y,+z'], [54, 1, '      Pcca', 'Orthorhombic', '+x,+y,+z', '-x+1/2,-y,+z', '-x,+y,-z+1/2', '+x+1/2,-y,-z+1/2', '-x,-y,-z', '+x+1/2,+y,-z', '+x,-y,+z+1/2', '-x+1/2,+y,+z+1/2'], [55, 1, '      Pbam', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z', '-x+1/2,+y+1/2,-z', '+x+1/2,-y+1/2,-z', '-x,-y,-z', '+x,+y,-z', '+x+1/2,-y+1/2,+z', '-x+1/2,+y+1/2,+z'], [56, 1, '      Pccn', 'Orthorhombic', '+x,+y,+z', '-x+1/2,-y+1/2,+z', '-x,+y+1/2,-z+1/2', '+x+1/2,-y,-z+1/2', '-x,-y,-z', '+x+1/2,+y+1/2,-z', '+x,-y+1/2,+z+1/2', '-x+1/2,+y,+z+1/2'], [57, 1, '      Pbcm', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z+1/2', '-x,+y+1/2,-z+1/2', '+x,-y+1/2,-z', '-x,-y,-z', '+x,+y,-z+1/2', '+x,-y+1/2,+z+1/2', '-x,+y+1/2,+z'], [58, 1, '      Pnnm', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z', '-x+1/2,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,-z+1/2', '-x,-y,-z', '+x,+y,-z', '+x+1/2,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,+z+1/2'], [59, 1, '      Pmmn', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z', '-x+1/2,+y+1/2,-z', '+x+1/2,-y+1/2,-z', '-x+1/2,-y+1/2,-z', '+x+1/2,+y+1/2,-z', '+x,-y,+z', '-x,+y,+z'], [60, 1, '      Pbcn', 'Orthorhombic', '+x,+y,+z', '-x+1/2,-y+1/2,+z+1/2', '-x,+y,-z+1/2', '+x+1/2,-y+1/2,-z', '-x,-y,-z', '+x+1/2,+y+1/2,-z+1/2', '+x,-y,+z+1/2', '-x+1/2,+y+1/2,+z'], [61, 1, '      Pbca', 'Orthorhombic', '+x,+y,+z', '-x+1/2,-y,+z+1/2', '-x,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,-z', '-x,-y,-z', '+x+1/2,+y,-z+1/2', '+x,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,+z'], [62, 1, '      Pnma', 'Orthorhombic', '+x,+y,+z', '-x+1/2,-y,+z+1/2', '-x,+y+1/2,-z', '+x+1/2,-y+1/2,-z+1/2', '-x,-y,-z', '+x+1/2,+y,-z+1/2', '+x,-y+1/2,+z', '-x+1/2,+y+1/2,+z+1/2'], [63, 1, '      Cmcm', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z+1/2', '-x,+y,-z+1/2', '+x,-y,-z', '-x,-y,-z', '+x,+y,-z+1/2', '+x,-y,+z+1/2', '-x,+y,+z', '+x+1/2,+y+1/2,+z', '-x+1/2,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,-z', '-x+1/2,-y+1/2,-z', '+x+1/2,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,+z'], [64, 1, '      Cmca', 'Orthorhombic', '+x,+y,+z', '-x,-y+1/2,+z+1/2', '-x,+y+1/2,-z+1/2', '+x,-y,-z', '-x,-y,-z', '+x,+y+1/2,-z+1/2', '+x,-y+1/2,+z+1/2', '-x,+y,+z', '+x+1/2,+y+1/2,+z', '-x+1/2,-y+1,+z+1/2', '-x+1/2,+y+1,-z+1/2', '+x+1/2,-y+1/2,-z', '-x+1/2,-y+1/2,-z', '+x+1/2,+y+1,-z+1/2', '+x+1/2,-y+1,+z+1/2', '-x+1/2,+y+1/2,+z'], [65, 1, '      Cmmm', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z', '-x,+y,-z', '+x,-y,-z', '-x,-y,-z', '+x,+y,-z', '+x,-y,+z', '-x,+y,+z', '+x+1/2,+y+1/2,+z', '-x+1/2,-y+1/2,+z', '-x+1/2,+y+1/2,-z', '+x+1/2,-y+1/2,-z', '-x+1/2,-y+1/2,-z', '+x+1/2,+y+1/2,-z', '+x+1/2,-y+1/2,+z', '-x+1/2,+y+1/2,+z'], [66, 1, '      Cccm', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z', '-x,+y,-z+1/2', '+x,-y,-z+1/2', '-x,-y,-z', '+x,+y,-z', '+x,-y,+z+1/2', '-x,+y,+z+1/2', '+x+1/2,+y+1/2,+z', '-x+1/2,-y+1/2,+z', '-x+1/2,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,-z+1/2', '-x+1/2,-y+1/2,-z', '+x+1/2,+y+1/2,-z', '+x+1/2,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,+z+1/2'], [67, 1, '      Cmma', 'Orthorhombic', '+x,+y,+z', '-x,-y+1/2,+z', '-x,+y+1/2,-z', '+x,-y,-z', '-x,-y,-z', '+x,+y+1/2,-z', '+x,-y+1/2,+z', '-x,+y,+z', '+x+1/2,+y+1/2,+z', '-x+1/2,-y+1,+z', '-x+1/2,+y+1,-z', '+x+1/2,-y+1/2,-z', '-x+1/2,-y+1/2,-z', '+x+1/2,+y+1,-z', '+x+1/2,-y+1,+z', '-x+1/2,+y+1/2,+z'], [68, 1, '      Ccca', 'Orthorhombic', '+x,+y,+z', '-x+1/2,-y+1/2,+z', '-x,+y,-z', '+x+1/2,-y+1/2,-z', '-x,-y+1/2,-z+1/2', '+x+1/2,+y,-z+1/2', '+x,-y+1/2,+z+1/2', '-x+1/2,+y,+z+1/2', '+x+1/2,+y+1/2,+z', '-x+1,-y+1,+z', '-x+1/2,+y+1/2,-z', '+x+1,-y+1,-z', '-x+1/2,-y+1,-z+1/2', '+x+1,+y+1/2,-z+1/2', '+x+1/2,-y+1,+z+1/2', '-x+1,+y+1/2,+z+1/2'], [69, 1, '      Fmmm', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z', '-x,+y,-z', '+x,-y,-z', '-x,-y,-z', '+x,+y,-z', '+x,-y,+z', '-x,+y,+z', '+x,+y+1/2,+z+1/2', '-x,-y+1/2,+z+1/2', '-x,+y+1/2,-z+1/2', '+x,-y+1/2,-z+1/2', '-x,-y+1/2,-z+1/2', '+x,+y+1/2,-z+1/2', '+x,-y+1/2,+z+1/2', '-x,+y+1/2,+z+1/2', '+x+1/2,+y,+z+1/2', '-x+1/2,-y,+z+1/2', '-x+1/2,+y,-z+1/2', '+x+1/2,-y,-z+1/2', '-x+1/2,-y,-z+1/2', '+x+1/2,+y,-z+1/2', '+x+1/2,-y,+z+1/2', '-x+1/2,+y,+z+1/2', '+x+1/2,+y+1/2,+z', '-x+1/2,-y+1/2,+z', '-x+1/2,+y+1/2,-z', '+x+1/2,-y+1/2,-z', '-x+1/2,-y+1/2,-z', '+x+1/2,+y+1/2,-z', '+x+1/2,-y+1/2,+z', '-x+1/2,+y+1/2,+z'], [70, 1, '      Fddd', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z', '-x,+y,-z', '+x,-y,-z', '-x+1/4,-y+1/4,-z+1/4', '+x+1/4,+y+1/4,-z+1/4', '+x+1/4,-y+1/4,+z+1/4', '-x+1/4,+y+1/4,+z+1/4', '+x,+y+1/2,+z+1/2', '-x,-y+1/2,+z+1/2', '-x,+y+1/2,-z+1/2', '+x,-y+1/2,-z+1/2', '-x+1/4,-y+3/4,-z+3/4', '+x+1/4,+y+3/4,-z+3/4', '+x+1/4,-y+3/4,+z+3/4', '-x+1/4,+y+3/4,+z+3/4', '+x+1/2,+y,+z+1/2', '-x+1/2,-y,+z+1/2', '-x+1/2,+y,-z+1/2', '+x+1/2,-y,-z+1/2', '-x+3/4,-y+1/4,-z+3/4', '+x+3/4,+y+1/4,-z+3/4', '+x+3/4,-y+1/4,+z+3/4', '-x+3/4,+y+1/4,+z+3/4', '+x+1/2,+y+1/2,+z', '-x+1/2,-y+1/2,+z', '-x+1/2,+y+1/2,-z', '+x+1/2,-y+1/2,-z', '-x+3/4,-y+3/4,-z+1/4', '+x+3/4,+y+3/4,-z+1/4', '+x+3/4,-y+3/4,+z+1/4', '-x+3/4,+y+3/4,+z+1/4'], [71, 1, '      Immm', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z', '-x,+y,-z', '+x,-y,-z', '-x,-y,-z', '+x,+y,-z', '+x,-y,+z', '-x,+y,+z', '+x+1/2,+y+1/2,+z+1/2', '-x+1/2,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,-z+1/2', '-x+1/2,-y+1/2,-z+1/2', '+x+1/2,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,+z+1/2'], [72, 1, '      Ibam', 'Orthorhombic', '+x,+y,+z', '-x,-y,+z', '-x+1/2,+y+1/2,-z', '+x+1/2,-y+1/2,-z', '-x,-y,-z', '+x,+y,-z', '+x+1/2,-y+1/2,+z', '-x+1/2,+y+1/2,+z', '+x+1/2,+y+1/2,+z+1/2', '-x+1/2,-y+1/2,+z+1/2', '-x+1,+y+1,-z+1/2', '+x+1,-y+1,-z+1/2', '-x+1/2,-y+1/2,-z+1/2', '+x+1/2,+y+1/2,-z+1/2', '+x+1,-y+1,+z+1/2', '-x+1,+y+1,+z+1/2'], [73, 1, '      Ibca', 'Orthorhombic', '+x,+y,+z', '-x+1/2,-y,+z+1/2', '-x,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,-z', '-x,-y,-z', '+x+1/2,+y,-z+1/2', '+x,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,+z', '+x+1/2,+y+1/2,+z+1/2', '-x+1,-y+1/2,+z+1', '-x+1/2,+y+1,-z+1', '+x+1,-y+1,-z+1/2', '-x+1/2,-y+1/2,-z+1/2', '+x+1,+y+1/2,-z+1', '+x+1/2,-y+1,+z+1', '-x+1,+y+1,+z+1/2'], [74, 1, '      Imma', 'Orthorhombic', '+x,+y,+z', '-x,-y+1/2,+z', '-x,+y+1/2,-z', '+x,-y,-z', '-x,-y,-z', '+x,+y+1/2,-z', '+x,-y+1/2,+z', '-x,+y,+z', '+x+1/2,+y+1/2,+z+1/2', '-x+1/2,-y+1,+z+1/2', '-x+1/2,+y+1,-z+1/2', '+x+1/2,-y+1/2,-z+1/2', '-x+1/2,-y+1/2,-z+1/2', '+x+1/2,+y+1,-z+1/2', '+x+1/2,-y+1,+z+1/2', '-x+1/2,+y+1/2,+z+1/2'], [75, 1, '        P4', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y,+x,+z', '+y,-x,+z'], [76, 1, '      P4_1', 'Tetragonal', '+x,+y,+z', '-x,-y,+z+1/2', '-y,+x,+z+1/4', '+y,-x,+z+3/4'], [77, 1, '      P4_2', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y,+x,+z+1/2', '+y,-x,+z+1/2'], [78, 1, '      P4_3', 'Tetragonal', '+x,+y,+z', '-x,-y,+z+1/2', '-y,+x,+z+3/4', '+y,-x,+z+1/4'], [79, 1, '        I4', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y,+x,+z', '+y,-x,+z', '+x+1/2,+y+1/2,+z+1/2', '-x+1/2,-y+1/2,+z+1/2', '-y+1/2,+x+1/2,+z+1/2', '+y+1/2,-x+1/2,+z+1/2'], [80, 1, '      I4_1', 'Tetragonal', '+x,+y,+z', '-x+1/2,-y+1/2,+z+1/2', '-y,+x+1/2,+z+1/4', '+y+1/2,-x,+z+3/4', '+x+1/2,+y+1/2,+z+1/2', '-x+1,-y+1,+z+1', '-y+1/2,+x+1,+z+3/4', '+y+1,-x+1/2,+z+5/4'], [81, 1, '       P-4', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '+y,-x,-z', '-y,+x,-z'], [82, 1, '       I-4', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '+y,-x,-z', '-y,+x,-z', '+x+1/2,+y+1/2,+z+1/2', '-x+1/2,-y+1/2,+z+1/2', '+y+1/2,-x+1/2,-z+1/2', '-y+1/2,+x+1/2,-z+1/2'], [83, 1, '      P4/m', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y,+x,+z', '+y,-x,+z', '-x,-y,-z', '+x,+y,-z', '+y,-x,-z', '-y,+x,-z'], [84, 1, '    P4_2/m', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y,+x,+z+1/2', '+y,-x,+z+1/2', '-x,-y,-z', '+x,+y,-z', '+y,-x,-z+1/2', '-y,+x,-z+1/2'], [85, 1, '      P4/n', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y+1/2,+x+1/2,+z', '+y+1/2,-x+1/2,+z', '-x+1/2,-y+1/2,-z', '+x+1/2,+y+1/2,-z', '+y,-x,-z', '-y,+x,-z'], [86, 1, '    P4_2/n', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y+1/2,+x+1/2,+z+1/2', '+y+1/2,-x+1/2,+z+1/2', '-x+1/2,-y+1/2,-z+1/2', '+x+1/2,+y+1/2,-z+1/2', '+y,-x,-z', '-y,+x,-z'], [87, 1, '      I4/m', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y,+x,+z', '+y,-x,+z', '-x,-y,-z', '+x,+y,-z', '+y,-x,-z', '-y,+x,-z', '+x+1/2,+y+1/2,+z+1/2', '-x+1/2,-y+1/2,+z+1/2', '-y+1/2,+x+1/2,+z+1/2', '+y+1/2,-x+1/2,+z+1/2', '-x+1/2,-y+1/2,-z+1/2', '+x+1/2,+y+1/2,-z+1/2', '+y+1/2,-x+1/2,-z+1/2', '-y+1/2,+x+1/2,-z+1/2'], [88, 1, '    I4_1/a', 'Tetragonal', '+x,+y,+z', '-x+1/2,-y+1/2,+z+1/2', '-y,+x+1/2,+z+1/4', '+y+1/2,-x,+z+3/4', '-x,-y+1/2,-z+1/4', '+x+1/2,+y,-z+3/4', '+y,-x,-z', '-y+1/2,+x+1/2,-z+1/2', '+x+1/2,+y+1/2,+z+1/2', '-x+1,-y+1,+z+1', '-y+1/2,+x+1,+z+3/4', '+y+1,-x+1/2,+z+5/4', '-x+1/2,-y+1,-z+3/4', '+x+1,+y+1/2,-z+5/4', '+y+1/2,-x+1/2,-z+1/2', '-y+1,+x+1,-z+1'], [89, 1, '      P422', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y,+x,+z', '+y,-x,+z', '-x,+y,-z', '+x,-y,-z', '+y,+x,-z', '-y,-x,-z'], [90, 1, '    P42_12', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y+1/2,+x+1/2,+z', '+y+1/2,-x+1/2,+z', '-x+1/2,+y+1/2,-z', '+x+1/2,-y+1/2,-z', '+y,+x,-z', '-y,-x,-z'], [91, 1, '    P4_122', 'Tetragonal', '+x,+y,+z', '-x,-y,+z+1/2', '-y,+x,+z+1/4', '+y,-x,+z+3/4', '-x,+y,-z', '+x,-y,-z+1/2', '+y,+x,-z+3/4', '-y,-x,-z+1/4'], [92, 1, '  P4_12_12', 'Tetragonal', '+x,+y,+z', '-x,-y,+z+1/2', '-y+1/2,+x+1/2,+z+1/4', '+y+1/2,-x+1/2,+z+3/4', '-x+1/2,+y+1/2,-z+1/4', '+x+1/2,-y+1/2,-z+3/4', '+y,+x,-z', '-y,-x,-z+1/2'], [93, 1, '    P4_222', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y,+x,+z+1/2', '+y,-x,+z+1/2', '-x,+y,-z', '+x,-y,-z', '+y,+x,-z+1/2', '-y,-x,-z+1/2'], [94, 1, '  P4_22_12', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y+1/2,+x+1/2,+z+1/2', '+y+1/2,-x+1/2,+z+1/2', '-x+1/2,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,-z+1/2', '+y,+x,-z', '-y,-x,-z'], [95, 1, '    P4_322', 'Tetragonal', '+x,+y,+z', '-x,-y,+z+1/2', '-y,+x,+z+3/4', '+y,-x,+z+1/4', '-x,+y,-z', '+x,-y,-z+1/2', '+y,+x,-z+1/4', '-y,-x,-z+3/4'], [96, 1, '  P4_32_12', 'Tetragonal', '+x,+y,+z', '-x,-y,+z+1/2', '-y+1/2,+x+1/2,+z+3/4', '+y+1/2,-x+1/2,+z+1/4', '-x+1/2,+y+1/2,-z+3/4', '+x+1/2,-y+1/2,-z+1/4', '+y,+x,-z', '-y,-x,-z+1/2'], [97, 1, '      I422', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y,+x,+z', '+y,-x,+z', '-x,+y,-z', '+x,-y,-z', '+y,+x,-z', '-y,-x,-z', '+x+1/2,+y+1/2,+z+1/2', '-x+1/2,-y+1/2,+z+1/2', '-y+1/2,+x+1/2,+z+1/2', '+y+1/2,-x+1/2,+z+1/2', '-x+1/2,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,-z+1/2', '+y+1/2,+x+1/2,-z+1/2', '-y+1/2,-x+1/2,-z+1/2'], [98, 1, '    I4_122', 'Tetragonal', '+x,+y,+z', '-x+1/2,-y+1/2,+z+1/2', '-y,+x+1/2,+z+1/4', '+y+1/2,-x,+z+3/4', '-x+1/2,+y,-z+3/4', '+x,-y+1/2,-z+1/4', '+y+1/2,+x+1/2,-z+1/2', '-y,-x,-z', '+x+1/2,+y+1/2,+z+1/2', '-x+1,-y+1,+z+1', '-y+1/2,+x+1,+z+3/4', '+y+1,-x+1/2,+z+5/4', '-x+1,+y+1/2,-z+5/4', '+x+1/2,-y+1,-z+3/4', '+y+1,+x+1,-z+1', '-y+1/2,-x+1/2,-z+1/2'], [99, 1, '      P4mm', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y,+x,+z', '+y,-x,+z', '+x,-y,+z', '-x,+y,+z', '-y,-x,+z', '+y,+x,+z'], [100, 1, '      P4bm', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y,+x,+z', '+y,-x,+z', '+x+1/2,-y+1/2,+z', '-x+1/2,+y+1/2,+z', '-y+1/2,-x+1/2,+z', '+y+1/2,+x+1/2,+z'], [101, 1, '    P4_2cm', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y,+x,+z+1/2', '+y,-x,+z+1/2', '+x,-y,+z+1/2', '-x,+y,+z+1/2', '-y,-x,+z', '+y,+x,+z'], [102, 1, '    P4_2nm', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y+1/2,+x+1/2,+z+1/2', '+y+1/2,-x+1/2,+z+1/2', '+x+1/2,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,+z+1/2', '-y,-x,+z', '+y,+x,+z'], [103, 1, '      P4cc', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y,+x,+z', '+y,-x,+z', '+x,-y,+z+1/2', '-x,+y,+z+1/2', '-y,-x,+z+1/2', '+y,+x,+z+1/2'], [104, 1, '      P4nc', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y,+x,+z', '+y,-x,+z', '+x+1/2,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,+z+1/2', '-y+1/2,-x+1/2,+z+1/2', '+y+1/2,+x+1/2,+z+1/2'], [105, 1, '    P4_2mc', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y,+x,+z+1/2', '+y,-x,+z+1/2', '+x,-y,+z', '-x,+y,+z', '-y,-x,+z+1/2', '+y,+x,+z+1/2'], [106, 1, '    P4_2bc', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y,+x,+z+1/2', '+y,-x,+z+1/2', '+x+1/2,-y+1/2,+z', '-x+1/2,+y+1/2,+z', '-y+1/2,-x+1/2,+z+1/2', '+y+1/2,+x+1/2,+z+1/2'], [107, 1, '      I4mm', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y,+x,+z', '+y,-x,+z', '+x,-y,+z', '-x,+y,+z', '-y,-x,+z', '+y,+x,+z', '+x+1/2,+y+1/2,+z+1/2', '-x+1/2,-y+1/2,+z+1/2', '-y+1/2,+x+1/2,+z+1/2', '+y+1/2,-x+1/2,+z+1/2', '+x+1/2,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,+z+1/2', '-y+1/2,-x+1/2,+z+1/2', '+y+1/2,+x+1/2,+z+1/2'], [108, 1, '      I4cm', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y,+x,+z', '+y,-x,+z', '+x,-y,+z+1/2', '-x,+y,+z+1/2', '-y,-x,+z+1/2', '+y,+x,+z+1/2', '+x+1/2,+y+1/2,+z+1/2', '-x+1/2,-y+1/2,+z+1/2', '-y+1/2,+x+1/2,+z+1/2', '+y+1/2,-x+1/2,+z+1/2', '+x+1/2,-y+1/2,+z+1', '-x+1/2,+y+1/2,+z+1', '-y+1/2,-x+1/2,+z+1', '+y+1/2,+x+1/2,+z+1'], [109, 1, '    I4_1md', 'Tetragonal', '+x,+y,+z', '-x+1/2,-y+1/2,+z+1/2', '-y,+x+1/2,+z+1/4', '+y+1/2,-x,+z+3/4', '+x,-y,+z', '-x+1/2,+y+1/2,+z+1/2', '-y,-x+1/2,+z+1/4', '+y+1/2,+x,+z+3/4', '+x+1/2,+y+1/2,+z+1/2', '-x+1,-y+1,+z+1', '-y+1/2,+x+1,+z+3/4', '+y+1,-x+1/2,+z+5/4', '+x+1/2,-y+1/2,+z+1/2', '-x+1,+y+1,+z+1', '-y+1/2,-x+1,+z+3/4', '+y+1,+x+1/2,+z+5/4'], [110, 1, '    I4_1cd', 'Tetragonal', '+x,+y,+z', '-x+1/2,-y+1/2,+z+1/2', '-y,+x+1/2,+z+1/4', '+y+1/2,-x,+z+3/4', '+x,-y,+z+1/2', '-x+1/2,+y+1/2,+z', '-y,-x+1/2,+z+3/4', '+y+1/2,+x,+z+1/4', '+x+1/2,+y+1/2,+z+1/2', '-x+1,-y+1,+z+1', '-y+1/2,+x+1,+z+3/4', '+y+1,-x+1/2,+z+5/4', '+x+1/2,-y+1/2,+z+1', '-x+1,+y+1,+z+1/2', '-y+1/2,-x+1,+z+5/4', '+y+1,+x+1/2,+z+3/4'], [111, 1, '     P-42m', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '+y,-x,-z', '-y,+x,-z', '-x,+y,-z', '+x,-y,-z', '-y,-x,+z', '+y,+x,+z'], [112, 1, '     P-42c', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '+y,-x,-z', '-y,+x,-z', '-x,+y,-z+1/2', '+x,-y,-z+1/2', '-y,-x,+z+1/2', '+y,+x,+z+1/2'], [113, 1, '   P-42_1m', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '+y,-x,-z', '-y,+x,-z', '-x+1/2,+y+1/2,-z', '+x+1/2,-y+1/2,-z', '-y+1/2,-x+1/2,+z', '+y+1/2,+x+1/2,+z'], [114, 1, '   P-42_1c', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '+y,-x,-z', '-y,+x,-z', '-x+1/2,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,-z+1/2', '-y+1/2,-x+1/2,+z+1/2', '+y+1/2,+x+1/2,+z+1/2'], [115, 1, '     P-4m2', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '+y,-x,-z', '-y,+x,-z', '+x,-y,+z', '-x,+y,+z', '+y,+x,-z', '-y,-x,-z'], [116, 1, '     P-4c2', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '+y,-x,-z', '-y,+x,-z', '+x,-y,+z+1/2', '-x,+y,+z+1/2', '+y,+x,-z+1/2', '-y,-x,-z+1/2'], [117, 1, '     P-4b2', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '+y,-x,-z', '-y,+x,-z', '+x+1/2,-y+1/2,+z', '-x+1/2,+y+1/2,+z', '+y+1/2,+x+1/2,-z', '-y+1/2,-x+1/2,-z'], [118, 1, '     P-4n2', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '+y,-x,-z', '-y,+x,-z', '+x+1/2,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,+z+1/2', '+y+1/2,+x+1/2,-z+1/2', '-y+1/2,-x+1/2,-z+1/2'], [119, 1, '     I-4m2', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '+y,-x,-z', '-y,+x,-z', '+x,-y,+z', '-x,+y,+z', '+y,+x,-z', '-y,-x,-z', '+x+1/2,+y+1/2,+z+1/2', '-x+1/2,-y+1/2,+z+1/2', '+y+1/2,-x+1/2,-z+1/2', '-y+1/2,+x+1/2,-z+1/2', '+x+1/2,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,+z+1/2', '+y+1/2,+x+1/2,-z+1/2', '-y+1/2,-x+1/2,-z+1/2'], [120, 1, '     I-4c2', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '+y,-x,-z', '-y,+x,-z', '+x,-y,+z+1/2', '-x,+y,+z+1/2', '+y,+x,-z+1/2', '-y,-x,-z+1/2', '+x+1/2,+y+1/2,+z+1/2', '-x+1/2,-y+1/2,+z+1/2', '+y+1/2,-x+1/2,-z+1/2', '-y+1/2,+x+1/2,-z+1/2', '+x+1/2,-y+1/2,+z+1', '-x+1/2,+y+1/2,+z+1', '+y+1/2,+x+1/2,-z+1', '-y+1/2,-x+1/2,-z+1'], [121, 1, '     I-42m', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '+y,-x,-z', '-y,+x,-z', '-x,+y,-z', '+x,-y,-z', '-y,-x,+z', '+y,+x,+z', '+x+1/2,+y+1/2,+z+1/2', '-x+1/2,-y+1/2,+z+1/2', '+y+1/2,-x+1/2,-z+1/2', '-y+1/2,+x+1/2,-z+1/2', '-x+1/2,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,-z+1/2', '-y+1/2,-x+1/2,+z+1/2', '+y+1/2,+x+1/2,+z+1/2'], [122, 1, '     I-42d', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '+y,-x,-z', '-y,+x,-z', '-x+1/2,+y,-z+3/4', '+x+1/2,-y,-z+3/4', '-y+1/2,-x,+z+3/4', '+y+1/2,+x,+z+3/4', '+x+1/2,+y+1/2,+z+1/2', '-x+1/2,-y+1/2,+z+1/2', '+y+1/2,-x+1/2,-z+1/2', '-y+1/2,+x+1/2,-z+1/2', '-x+1,+y+1/2,-z+5/4', '+x+1,-y+1/2,-z+5/4', '-y+1,-x+1/2,+z+5/4', '+y+1,+x+1/2,+z+5/4'], [123, 1, '    P4/mmm', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y,+x,+z', '+y,-x,+z', '-x,+y,-z', '+x,-y,-z', '+y,+x,-z', '-y,-x,-z', '-x,-y,-z', '+x,+y,-z', '+y,-x,-z', '-y,+x,-z', '+x,-y,+z', '-x,+y,+z', '-y,-x,+z', '+y,+x,+z'], [124, 1, '    P4/mcc', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y,+x,+z', '+y,-x,+z', '-x,+y,-z+1/2', '+x,-y,-z+1/2', '+y,+x,-z+1/2', '-y,-x,-z+1/2', '-x,-y,-z', '+x,+y,-z', '+y,-x,-z', '-y,+x,-z', '+x,-y,+z+1/2', '-x,+y,+z+1/2', '-y,-x,+z+1/2', '+y,+x,+z+1/2'], [125, 1, '    P4/nbm', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y,+x,+z', '+y,-x,+z', '-x,+y,-z', '+x,-y,-z', '+y,+x,-z', '-y,-x,-z', '-x+1/2,-y+1/2,-z', '+x+1/2,+y+1/2,-z', '+y+1/2,-x+1/2,-z', '-y+1/2,+x+1/2,-z', '+x+1/2,-y+1/2,+z', '-x+1/2,+y+1/2,+z', '-y+1/2,-x+1/2,+z', '+y+1/2,+x+1/2,+z'], [126, 1, '    P4/nnc', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y,+x,+z', '+y,-x,+z', '-x,+y,-z', '+x,-y,-z', '+y,+x,-z', '-y,-x,-z', '-x+1/2,-y+1/2,-z+1/2', '+x+1/2,+y+1/2,-z+1/2', '+y+1/2,-x+1/2,-z+1/2', '-y+1/2,+x+1/2,-z+1/2', '+x+1/2,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,+z+1/2', '-y+1/2,-x+1/2,+z+1/2', '+y+1/2,+x+1/2,+z+1/2'], [127, 1, '    P4/mbm', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y,+x,+z', '+y,-x,+z', '-x+1/2,+y+1/2,-z', '+x+1/2,-y+1/2,-z', '+y+1/2,+x+1/2,-z', '-y+1/2,-x+1/2,-z', '-x,-y,-z', '+x,+y,-z', '+y,-x,-z', '-y,+x,-z', '+x+1/2,-y+1/2,+z', '-x+1/2,+y+1/2,+z', '-y+1/2,-x+1/2,+z', '+y+1/2,+x+1/2,+z'], [128, 1, '    P4/mnc', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y,+x,+z', '+y,-x,+z', '-x+1/2,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,-z+1/2', '+y+1/2,+x+1/2,-z+1/2', '-y+1/2,-x+1/2,-z+1/2', '-x,-y,-z', '+x,+y,-z', '+y,-x,-z', '-y,+x,-z', '+x+1/2,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,+z+1/2', '-y+1/2,-x+1/2,+z+1/2', '+y+1/2,+x+1/2,+z+1/2'], [129, 1, '    P4/nmm', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y+1/2,+x+1/2,+z', '+y+1/2,-x+1/2,+z', '-x+1/2,+y+1/2,-z', '+x+1/2,-y+1/2,-z', '+y,+x,-z', '-y,-x,-z', '-x+1/2,-y+1/2,-z', '+x+1/2,+y+1/2,-z', '+y,-x,-z', '-y,+x,-z', '+x,-y,+z', '-x,+y,+z', '-y+1/2,-x+1/2,+z', '+y+1/2,+x+1/2,+z'], [130, 1, '    P4/ncc', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y+1/2,+x+1/2,+z', '+y+1/2,-x+1/2,+z', '-x+1/2,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,-z+1/2', '+y,+x,-z+1/2', '-y,-x,-z+1/2', '-x+1/2,-y+1/2,-z', '+x+1/2,+y+1/2,-z', '+y,-x,-z', '-y,+x,-z', '+x,-y,+z+1/2', '-x,+y,+z+1/2', '-y+1/2,-x+1/2,+z+1/2', '+y+1/2,+x+1/2,+z+1/2'], [131, 1, '  P4_2/mmc', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y,+x,+z+1/2', '+y,-x,+z+1/2', '-x,+y,-z', '+x,-y,-z', '+y,+x,-z+1/2', '-y,-x,-z+1/2', '-x,-y,-z', '+x,+y,-z', '+y,-x,-z+1/2', '-y,+x,-z+1/2', '+x,-y,+z', '-x,+y,+z', '-y,-x,+z+1/2', '+y,+x,+z+1/2'], [132, 1, '  P4_2/mcm', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y,+x,+z+1/2', '+y,-x,+z+1/2', '-x,+y,-z+1/2', '+x,-y,-z+1/2', '+y,+x,-z', '-y,-x,-z', '-x,-y,-z', '+x,+y,-z', '+y,-x,-z+1/2', '-y,+x,-z+1/2', '+x,-y,+z+1/2', '-x,+y,+z+1/2', '-y,-x,+z', '+y,+x,+z'], [133, 1, '  P4_2/nbc', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y+1/2,+x+1/2,+z+1/2', '+y+1/2,-x+1/2,+z+1/2', '-x,+y,-z+1/2', '+x,-y,-z+1/2', '+y+1/2,+x+1/2,-z', '-y+1/2,-x+1/2,-z', '-x+1/2,-y+1/2,-z+1/2', '+x+1/2,+y+1/2,-z+1/2', '+y,-x,-z', '-y,+x,-z', '+x+1/2,-y+1/2,+z', '-x+1/2,+y+1/2,+z', '-y,-x,+z+1/2', '+y,+x,+z+1/2'], [134, 1, '  P4_2/nnm', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y+1/2,+x+1/2,+z+1/2', '+y+1/2,-x+1/2,+z+1/2', '-x,+y,-z', '+x,-y,-z', '+y+1/2,+x+1/2,-z+1/2', '-y+1/2,-x+1/2,-z+1/2', '-x+1/2,-y+1/2,-z+1/2', '+x+1/2,+y+1/2,-z+1/2', '+y,-x,-z', '-y,+x,-z', '+x+1/2,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,+z+1/2', '-y,-x,+z', '+y,+x,+z'], [135, 1, '  P4_2/mbc', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y,+x,+z+1/2', '+y,-x,+z+1/2', '-x+1/2,+y+1/2,-z', '+x+1/2,-y+1/2,-z', '+y+1/2,+x+1/2,-z+1/2', '-y+1/2,-x+1/2,-z+1/2', '-x,-y,-z', '+x,+y,-z', '+y,-x,-z+1/2', '-y,+x,-z+1/2', '+x+1/2,-y+1/2,+z', '-x+1/2,+y+1/2,+z', '-y+1/2,-x+1/2,+z+1/2', '+y+1/2,+x+1/2,+z+1/2'], [136, 1, '  P4_2/mnm', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y+1/2,+x+1/2,+z+1/2', '+y+1/2,-x+1/2,+z+1/2', '-x+1/2,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,-z+1/2', '+y,+x,-z', '-y,-x,-z', '-x,-y,-z', '+x,+y,-z', '+y+1/2,-x+1/2,-z+1/2', '-y+1/2,+x+1/2,-z+1/2', '+x+1/2,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,+z+1/2', '-y,-x,+z', '+y,+x,+z'], [137, 1, '  P4_2/nmc', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y+1/2,+x+1/2,+z+1/2', '+y+1/2,-x+1/2,+z+1/2', '-x+1/2,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,-z+1/2', '+y,+x,-z', '-y,-x,-z', '-x+1/2,-y+1/2,-z+1/2', '+x+1/2,+y+1/2,-z+1/2', '+y,-x,-z', '-y,+x,-z', '+x,-y,+z', '-x,+y,+z', '-y+1/2,-x+1/2,+z+1/2', '+y+1/2,+x+1/2,+z+1/2'], [138, 1, '  P4_2/ncm', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y+1/2,+x+1/2,+z+1/2', '+y+1/2,-x+1/2,+z+1/2', '-x+1/2,+y+1/2,-z', '+x+1/2,-y+1/2,-z', '+y,+x,-z+1/2', '-y,-x,-z+1/2', '-x+1/2,-y+1/2,-z+1/2', '+x+1/2,+y+1/2,-z+1/2', '+y,-x,-z', '-y,+x,-z', '+x,-y,+z+1/2', '-x,+y,+z+1/2', '-y+1/2,-x+1/2,+z', '+y+1/2,+x+1/2,+z'], [139, 1, '    I4/mmm', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y,+x,+z', '+y,-x,+z', '-x,+y,-z', '+x,-y,-z', '+y,+x,-z', '-y,-x,-z', '-x,-y,-z', '+x,+y,-z', '+y,-x,-z', '-y,+x,-z', '+x,-y,+z', '-x,+y,+z', '-y,-x,+z', '+y,+x,+z', '+x+1/2,+y+1/2,+z+1/2', '-x+1/2,-y+1/2,+z+1/2', '-y+1/2,+x+1/2,+z+1/2', '+y+1/2,-x+1/2,+z+1/2', '-x+1/2,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,-z+1/2', '+y+1/2,+x+1/2,-z+1/2', '-y+1/2,-x+1/2,-z+1/2', '-x+1/2,-y+1/2,-z+1/2', '+x+1/2,+y+1/2,-z+1/2', '+y+1/2,-x+1/2,-z+1/2', '-y+1/2,+x+1/2,-z+1/2', '+x+1/2,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,+z+1/2', '-y+1/2,-x+1/2,+z+1/2', '+y+1/2,+x+1/2,+z+1/2'], [140, 1, '    I4/mcm', 'Tetragonal', '+x,+y,+z', '-x,-y,+z', '-y,+x,+z', '+y,-x,+z', '-x,+y,-z+1/2', '+x,-y,-z+1/2', '+y,+x,-z+1/2', '-y,-x,-z+1/2', '-x,-y,-z', '+x,+y,-z', '+y,-x,-z', '-y,+x,-z', '+x,-y,+z+1/2', '-x,+y,+z+1/2', '-y,-x,+z+1/2', '+y,+x,+z+1/2', '+x+1/2,+y+1/2,+z+1/2', '-x+1/2,-y+1/2,+z+1/2', '-y+1/2,+x+1/2,+z+1/2', '+y+1/2,-x+1/2,+z+1/2', '-x+1/2,+y+1/2,-z+1', '+x+1/2,-y+1/2,-z+1', '+y+1/2,+x+1/2,-z+1', '-y+1/2,-x+1/2,-z+1', '-x+1/2,-y+1/2,-z+1/2', '+x+1/2,+y+1/2,-z+1/2', '+y+1/2,-x+1/2,-z+1/2', '-y+1/2,+x+1/2,-z+1/2', '+x+1/2,-y+1/2,+z+1', '-x+1/2,+y+1/2,+z+1', '-y+1/2,-x+1/2,+z+1', '+y+1/2,+x+1/2,+z+1'], [141, 1, '  I4_1/amd', 'Tetragonal', '+x,+y,+z', '-x+1/2,-y+1/2,+z+1/2', '-y,+x+1/2,+z+1/4', '+y+1/2,-x,+z+3/4', '-x+1/2,+y,-z+3/4', '+x,-y+1/2,-z+1/4', '+y+1/2,+x+1/2,-z+1/2', '-y,-x,-z', '-x,-y+1/2,-z+1/4', '+x+1/2,+y,-z+3/4', '+y,-x,-z', '-y+1/2,+x+1/2,-z+1/2', '+x+1/2,-y+1/2,+z+1/2', '-x,+y,+z', '-y+1/2,-x,+z+3/4', '+y,+x+1/2,+z+1/4', '+x+1/2,+y+1/2,+z+1/2', '-x+1,-y+1,+z+1', '-y+1/2,+x+1,+z+3/4', '+y+1,-x+1/2,+z+5/4', '-x+1,+y+1/2,-z+5/4', '+x+1/2,-y+1,-z+3/4', '+y+1,+x+1,-z+1', '-y+1/2,-x+1/2,-z+1/2', '-x+1/2,-y+1,-z+3/4', '+x+1,+y+1/2,-z+5/4', '+y+1/2,-x+1/2,-z+1/2', '-y+1,+x+1,-z+1', '+x+1,-y+1,+z+1', '-x+1/2,+y+1/2,+z+1/2', '-y+1,-x+1/2,+z+5/4', '+y+1/2,+x+1,+z+3/4'], [142, 1, '  I4_1/acd', 'Tetragonal', '+x,+y,+z', '-x+1/2,-y+1/2,+z+1/2', '-y,+x+1/2,+z+1/4', '+y+1/2,-x,+z+3/4', '-x+1/2,+y,-z+1/4', '+x,-y+1/2,-z+3/4', '+y+1/2,+x+1/2,-z', '-y,-x,-z+1/2', '-x,-y+1/2,-z+1/4', '+x+1/2,+y,-z+3/4', '+y,-x,-z', '-y+1/2,+x+1/2,-z+1/2', '+x+1/2,-y+1/2,+z', '-x,+y,+z+1/2', '-y+1/2,-x,+z+1/4', '+y,+x+1/2,+z+3/4', '+x+1/2,+y+1/2,+z+1/2', '-x+1,-y+1,+z+1', '-y+1/2,+x+1,+z+3/4', '+y+1,-x+1/2,+z+5/4', '-x+1,+y+1/2,-z+3/4', '+x+1/2,-y+1,-z+5/4', '+y+1,+x+1,-z+1/2', '-y+1/2,-x+1/2,-z+1', '-x+1/2,-y+1,-z+3/4', '+x+1,+y+1/2,-z+5/4', '+y+1/2,-x+1/2,-z+1/2', '-y+1,+x+1,-z+1', '+x+1,-y+1,+z+1/2', '-x+1/2,+y+1/2,+z+1', '-y+1,-x+1/2,+z+3/4', '+y+1/2,+x+1,+z+5/4'], [143, 1, '        P3', 'Trigonal', '+x,+y,+z', '-y,+x-y,+z', '-x+y,-x,+z'], [144, 1, '      P3_1', 'Trigonal', '+x,+y,+z', '-y,+x-y,+z+1/3', '-x+y,-x,+z+2/3'], [145, 1, '      P3_2', 'Trigonal', '+x,+y,+z', '-y,+x-y,+z+2/3', '-x+y,-x,+z+1/3'], [146, 1, '        R3', 'Trigonal', '+x,+y,+z', '-y,+x-y,+z', '-x+y,-x,+z', '+x+2/3,+y+1/3,+z+1/3', '-y+2/3,+x-y+1/3,+z+1/3', '-x+y+2/3,-x+1/3,+z+1/3', '+x+1/3,+y+2/3,+z+2/3', '-y+1/3,+x-y+2/3,+z+2/3', '-x+y+1/3,-x+2/3,+z+2/3'], [147, 1, '       P-3', 'Trigonal', '+x,+y,+z', '-y,+x-y,+z', '-x+y,-x,+z', '-x,-y,-z', '+y,-x+y,-z', '+x-y,+x,-z'], [148, 1, '       R-3', 'Trigonal', '+x,+y,+z', '-y,+x-y,+z', '-x+y,-x,+z', '-x,-y,-z', '+y,-x+y,-z', '+x-y,+x,-z', '+x+2/3,+y+1/3,+z+1/3', '-y+2/3,+x-y+1/3,+z+1/3', '-x+y+2/3,-x+1/3,+z+1/3', '-x+2/3,-y+1/3,-z+1/3', '+y+2/3,-x+y+1/3,-z+1/3', '+x-y+2/3,+x+1/3,-z+1/3', '+x+1/3,+y+2/3,+z+2/3', '-y+1/3,+x-y+2/3,+z+2/3', '-x+y+1/3,-x+2/3,+z+2/3', '-x+1/3,-y+2/3,-z+2/3', '+y+1/3,-x+y+2/3,-z+2/3', '+x-y+1/3,+x+2/3,-z+2/3'], [149, 1, '      P312', 'Trigonal', '+x,+y,+z', '-y,+x-y,+z', '-x+y,-x,+z', '-y,-x,-z', '-x+y,+y,-z', '+x,+x-y,-z'], [150, 1, '      P321', 'Trigonal', '+x,+y,+z', '-y,+x-y,+z', '-x+y,-x,+z', '+y,+x,-z', '+x-y,-y,-z', '-x,-x+y,-z'], [151, 1, '    P3_112', 'Trigonal', '+x,+y,+z', '-y,+x-y,+z+1/3', '-x+y,-x,+z+2/3', '-y,-x,-z+2/3', '-x+y,+y,-z+1/3', '+x,+x-y,-z'], [152, 1, '    P3_121', 'Trigonal', '+x,+y,+z', '-y,+x-y,+z+1/3', '-x+y,-x,+z+2/3', '+y,+x,-z', '+x-y,-y,-z+2/3', '-x,-x+y,-z+1/3'], [153, 1, '    P3_212', 'Trigonal', '+x,+y,+z', '-y,+x-y,+z+2/3', '-x+y,-x,+z+1/3', '-y,-x,-z+1/3', '-x+y,+y,-z+2/3', '+x,+x-y,-z'], [154, 1, '    P3_221', 'Trigonal', '+x,+y,+z', '-y,+x-y,+z+2/3', '-x+y,-x,+z+1/3', '+y,+x,-z', '+x-y,-y,-z+1/3', '-x,-x+y,-z+2/3'], [155, 1, '       R32', 'Trigonal', '+x,+y,+z', '-y,+x-y,+z', '-x+y,-x,+z', '+y,+x,-z', '+x-y,-y,-z', '-x,-x+y,-z', '+x+2/3,+y+1/3,+z+1/3', '-y+2/3,+x-y+1/3,+z+1/3', '-x+y+2/3,-x+1/3,+z+1/3', '+y+2/3,+x+1/3,-z+1/3', '+x-y+2/3,-y+1/3,-z+1/3', '-x+2/3,-x+y+1/3,-z+1/3', '+x+1/3,+y+2/3,+z+2/3', '-y+1/3,+x-y+2/3,+z+2/3', '-x+y+1/3,-x+2/3,+z+2/3', '+y+1/3,+x+2/3,-z+2/3', '+x-y+1/3,-y+2/3,-z+2/3', '-x+1/3,-x+y+2/3,-z+2/3'], [156, 1, '      P3m1', 'Trigonal', '+x,+y,+z', '-y,+x-y,+z', '-x+y,-x,+z', '-y,-x,+z', '-x+y,+y,+z', '+x,+x-y,+z'], [157, 1, '      P31m', 'Trigonal', '+x,+y,+z', '-y,+x-y,+z', '-x+y,-x,+z', '+y,+x,+z', '+x-y,-y,+z', '-x,-x+y,+z'], [158, 1, '      P3c1', 'Trigonal', '+x,+y,+z', '-y,+x-y,+z', '-x+y,-x,+z', '-y,-x,+z+1/2', '-x+y,+y,+z+1/2', '+x,+x-y,+z+1/2'], [159, 1, '      P31c', 'Trigonal', '+x,+y,+z', '-y,+x-y,+z', '-x+y,-x,+z', '+y,+x,+z+1/2', '+x-y,-y,+z+1/2', '-x,-x+y,+z+1/2'], [160, 1, '       R3m', 'Trigonal', '+x,+y,+z', '-y,+x-y,+z', '-x+y,-x,+z', '-y,-x,+z', '-x+y,+y,+z', '+x,+x-y,+z', '+x+2/3,+y+1/3,+z+1/3', '-y+2/3,+x-y+1/3,+z+1/3', '-x+y+2/3,-x+1/3,+z+1/3', '-y+2/3,-x+1/3,+z+1/3', '-x+y+2/3,+y+1/3,+z+1/3', '+x+2/3,+x-y+1/3,+z+1/3', '+x+1/3,+y+2/3,+z+2/3', '-y+1/3,+x-y+2/3,+z+2/3', '-x+y+1/3,-x+2/3,+z+2/3', '-y+1/3,-x+2/3,+z+2/3', '-x+y+1/3,+y+2/3,+z+2/3', '+x+1/3,+x-y+2/3,+z+2/3'], [161, 1, '       R3c', 'Trigonal', '+x,+y,+z', '-y,+x-y,+z', '-x+y,-x,+z', '-y,-x,+z+1/2', '-x+y,+y,+z+1/2', '+x,+x-y,+z+1/2', '+x+2/3,+y+1/3,+z+1/3', '-y+2/3,+x-y+1/3,+z+1/3', '-x+y+2/3,-x+1/3,+z+1/3', '-y+2/3,-x+1/3,+z+5/6', '-x+y+2/3,+y+1/3,+z+5/6', '+x+2/3,+x-y+1/3,+z+5/6', '+x+1/3,+y+2/3,+z+2/3', '-y+1/3,+x-y+2/3,+z+2/3', '-x+y+1/3,-x+2/3,+z+2/3', '-y+1/3,-x+2/3,+z+7/6', '-x+y+1/3,+y+2/3,+z+7/6', '+x+1/3,+x-y+2/3,+z+7/6'], [162, 1, '     P-31m', 'Trigonal', '+x,+y,+z', '-y,+x-y,+z', '-x+y,-x,+z', '-y,-x,-z', '-x+y,+y,-z', '+x,+x-y,-z', '-x,-y,-z', '+y,-x+y,-z', '+x-y,+x,-z', '+y,+x,+z', '+x-y,-y,+z', '-x,-x+y,+z'], [163, 1, '     P-31c', 'Trigonal', '+x,+y,+z', '-y,+x-y,+z', '-x+y,-x,+z', '-y,-x,-z+1/2', '-x+y,+y,-z+1/2', '+x,+x-y,-z+1/2', '-x,-y,-z', '+y,-x+y,-z', '+x-y,+x,-z', '+y,+x,+z+1/2', '+x-y,-y,+z+1/2', '-x,-x+y,+z+1/2'], [164, 1, '     P-3m1', 'Trigonal', '+x,+y,+z', '-y,+x-y,+z', '-x+y,-x,+z', '+y,+x,-z', '+x-y,-y,-z', '-x,-x+y,-z', '-x,-y,-z', '+y,-x+y,-z', '+x-y,+x,-z', '-y,-x,+z', '-x+y,+y,+z', '+x,+x-y,+z'], [165, 1, '     P-3c1', 'Trigonal', '+x,+y,+z', '-y,+x-y,+z', '-x+y,-x,+z', '+y,+x,-z+1/2', '+x-y,-y,-z+1/2', '-x,-x+y,-z+1/2', '-x,-y,-z', '+y,-x+y,-z', '+x-y,+x,-z', '-y,-x,+z+1/2', '-x+y,+y,+z+1/2', '+x,+x-y,+z+1/2'], [166, 1, '      R-3m', 'Trigonal', '+x,+y,+z', '-y,+x-y,+z', '-x+y,-x,+z', '+y,+x,-z', '+x-y,-y,-z', '-x,-x+y,-z', '-x,-y,-z', '+y,-x+y,-z', '+x-y,+x,-z', '-y,-x,+z', '-x+y,+y,+z', '+x,+x-y,+z', '+x+2/3,+y+1/3,+z+1/3', '-y+2/3,+x-y+1/3,+z+1/3', '-x+y+2/3,-x+1/3,+z+1/3', '+y+2/3,+x+1/3,-z+1/3', '+x-y+2/3,-y+1/3,-z+1/3', '-x+2/3,-x+y+1/3,-z+1/3', '-x+2/3,-y+1/3,-z+1/3', '+y+2/3,-x+y+1/3,-z+1/3', '+x-y+2/3,+x+1/3,-z+1/3', '-y+2/3,-x+1/3,+z+1/3', '-x+y+2/3,+y+1/3,+z+1/3', '+x+2/3,+x-y+1/3,+z+1/3', '+x+1/3,+y+2/3,+z+2/3', '-y+1/3,+x-y+2/3,+z+2/3', '-x+y+1/3,-x+2/3,+z+2/3', '+y+1/3,+x+2/3,-z+2/3', '+x-y+1/3,-y+2/3,-z+2/3', '-x+1/3,-x+y+2/3,-z+2/3', '-x+1/3,-y+2/3,-z+2/3', '+y+1/3,-x+y+2/3,-z+2/3', '+x-y+1/3,+x+2/3,-z+2/3', '-y+1/3,-x+2/3,+z+2/3', '-x+y+1/3,+y+2/3,+z+2/3', '+x+1/3,+x-y+2/3,+z+2/3'], [167, 1, '      R-3c', 'Trigonal', '+x,+y,+z', '-y,+x-y,+z', '-x+y,-x,+z', '+y,+x,-z+1/2', '+x-y,-y,-z+1/2', '-x,-x+y,-z+1/2', '-x,-y,-z', '+y,-x+y,-z', '+x-y,+x,-z', '-y,-x,+z+1/2', '-x+y,+y,+z+1/2', '+x,+x-y,+z+1/2', '+x+2/3,+y+1/3,+z+1/3', '-y+2/3,+x-y+1/3,+z+1/3', '-x+y+2/3,-x+1/3,+z+1/3', '+y+2/3,+x+1/3,-z+5/6', '+x-y+2/3,-y+1/3,-z+5/6', '-x+2/3,-x+y+1/3,-z+5/6', '-x+2/3,-y+1/3,-z+1/3', '+y+2/3,-x+y+1/3,-z+1/3', '+x-y+2/3,+x+1/3,-z+1/3', '-y+2/3,-x+1/3,+z+5/6', '-x+y+2/3,+y+1/3,+z+5/6', '+x+2/3,+x-y+1/3,+z+5/6', '+x+1/3,+y+2/3,+z+2/3', '-y+1/3,+x-y+2/3,+z+2/3', '-x+y+1/3,-x+2/3,+z+2/3', '+y+1/3,+x+2/3,-z+7/6', '+x-y+1/3,-y+2/3,-z+7/6', '-x+1/3,-x+y+2/3,-z+7/6', '-x+1/3,-y+2/3,-z+2/3', '+y+1/3,-x+y+2/3,-z+2/3', '+x-y+1/3,+x+2/3,-z+2/3', '-y+1/3,-x+2/3,+z+7/6', '-x+y+1/3,+y+2/3,+z+7/6', '+x+1/3,+x-y+2/3,+z+7/6'], [168, 1, '        P6', 'Hexagonal', '+x,+y,+z', '-y,+x-y,+z', '-x+y,-x,+z', '-x,-y,+z', '+y,-x+y,+z', '+x-y,+x,+z'], [169, 1, '      P6_1', 'Hexagonal', '+x,+y,+z', '-y,+x-y,+z+1/3', '-x+y,-x,+z+2/3', '-x,-y,+z+1/2', '+y,-x+y,+z+5/6', '+x-y,+x,+z+1/6'], [170, 1, '      P6_5', 'Hexagonal', '+x,+y,+z', '-y,+x-y,+z+2/3', '-x+y,-x,+z+1/3', '-x,-y,+z+1/2', '+y,-x+y,+z+1/6', '+x-y,+x,+z+5/6'], [171, 1, '      P6_2', 'Hexagonal', '+x,+y,+z', '-y,+x-y,+z+2/3', '-x+y,-x,+z+1/3', '-x,-y,+z', '+y,-x+y,+z+2/3', '+x-y,+x,+z+1/3'], [172, 1, '      P6_4', 'Hexagonal', '+x,+y,+z', '-y,+x-y,+z+1/3', '-x+y,-x,+z+2/3', '-x,-y,+z', '+y,-x+y,+z+1/3', '+x-y,+x,+z+2/3'], [173, 1, '      P6_3', 'Hexagonal', '+x,+y,+z', '-y,+x-y,+z', '-x+y,-x,+z', '-x,-y,+z+1/2', '+y,-x+y,+z+1/2', '+x-y,+x,+z+1/2'], [174, 1, '       P-6', 'Hexagonal', '+x,+y,+z', '-y,+x-y,+z', '-x+y,-x,+z', '+x,+y,-z', '-y,+x-y,-z', '-x+y,-x,-z'], [175, 1, '      P6/m', 'Hexagonal', '+x,+y,+z', '-y,+x-y,+z', '-x+y,-x,+z', '-x,-y,+z', '+y,-x+y,+z', '+x-y,+x,+z', '-x,-y,-z', '+y,-x+y,-z', '+x-y,+x,-z', '+x,+y,-z', '-y,+x-y,-z', '-x+y,-x,-z'], [176, 1, '    P6_3/m', 'Hexagonal', '+x,+y,+z', '-y,+x-y,+z', '-x+y,-x,+z', '-x,-y,+z+1/2', '+y,-x+y,+z+1/2', '+x-y,+x,+z+1/2', '-x,-y,-z', '+y,-x+y,-z', '+x-y,+x,-z', '+x,+y,-z+1/2', '-y,+x-y,-z+1/2', '-x+y,-x,-z+1/2'], [177, 1, '      P622', 'Hexagonal', '+x,+y,+z', '-y,+x-y,+z', '-x+y,-x,+z', '-x,-y,+z', '+y,-x+y,+z', '+x-y,+x,+z', '+y,+x,-z', '+x-y,-y,-z', '-x,-x+y,-z', '-y,-x,-z', '-x+y,+y,-z', '+x,+x-y,-z'], [178, 1, '    P6_122', 'Hexagonal', '+x,+y,+z', '-y,+x-y,+z+1/3', '-x+y,-x,+z+2/3', '-x,-y,+z+1/2', '+y,-x+y,+z+5/6', '+x-y,+x,+z+1/6', '+y,+x,-z+1/3', '+x-y,-y,-z', '-x,-x+y,-z+2/3', '-y,-x,-z+5/6', '-x+y,+y,-z+1/2', '+x,+x-y,-z+1/6'], [179, 1, '    P6_522', 'Hexagonal', '+x,+y,+z', '-y,+x-y,+z+2/3', '-x+y,-x,+z+1/3', '-x,-y,+z+1/2', '+y,-x+y,+z+1/6', '+x-y,+x,+z+5/6', '+y,+x,-z+2/3', '+x-y,-y,-z', '-x,-x+y,-z+1/3', '-y,-x,-z+1/6', '-x+y,+y,-z+1/2', '+x,+x-y,-z+5/6'], [180, 1, '    P6_222', 'Hexagonal', '+x,+y,+z', '-y,+x-y,+z+2/3', '-x+y,-x,+z+1/3', '-x,-y,+z', '+y,-x+y,+z+2/3', '+x-y,+x,+z+1/3', '+y,+x,-z+2/3', '+x-y,-y,-z', '-x,-x+y,-z+1/3', '-y,-x,-z+2/3', '-x+y,+y,-z', '+x,+x-y,-z+1/3'], [181, 1, '    P6_422', 'Hexagonal', '+x,+y,+z', '-y,+x-y,+z+1/3', '-x+y,-x,+z+2/3', '-x,-y,+z', '+y,-x+y,+z+1/3', '+x-y,+x,+z+2/3', '+y,+x,-z+1/3', '+x-y,-y,-z', '-x,-x+y,-z+2/3', '-y,-x,-z+1/3', '-x+y,+y,-z', '+x,+x-y,-z+2/3'], [182, 1, '    P6_322', 'Hexagonal', '+x,+y,+z', '-y,+x-y,+z', '-x+y,-x,+z', '-x,-y,+z+1/2', '+y,-x+y,+z+1/2', '+x-y,+x,+z+1/2', '+y,+x,-z', '+x-y,-y,-z', '-x,-x+y,-z', '-y,-x,-z+1/2', '-x+y,+y,-z+1/2', '+x,+x-y,-z+1/2'], [183, 1, '      P6mm', 'Hexagonal', '+x,+y,+z', '-y,+x-y,+z', '-x+y,-x,+z', '-x,-y,+z', '+y,-x+y,+z', '+x-y,+x,+z', '-y,-x,+z', '-x+y,+y,+z', '+x,+x-y,+z', '+y,+x,+z', '+x-y,-y,+z', '-x,-x+y,+z'], [184, 1, '      P6cc', 'Hexagonal', '+x,+y,+z', '-y,+x-y,+z', '-x+y,-x,+z', '-x,-y,+z', '+y,-x+y,+z', '+x-y,+x,+z', '-y,-x,+z+1/2', '-x+y,+y,+z+1/2', '+x,+x-y,+z+1/2', '+y,+x,+z+1/2', '+x-y,-y,+z+1/2', '-x,-x+y,+z+1/2'], [185, 1, '    P6_3cm', 'Hexagonal', '+x,+y,+z', '-y,+x-y,+z', '-x+y,-x,+z', '-x,-y,+z+1/2', '+y,-x+y,+z+1/2', '+x-y,+x,+z+1/2', '-y,-x,+z+1/2', '-x+y,+y,+z+1/2', '+x,+x-y,+z+1/2', '+y,+x,+z', '+x-y,-y,+z', '-x,-x+y,+z'], [186, 1, '    P6_3mc', 'Hexagonal', '+x,+y,+z', '-y,+x-y,+z', '-x+y,-x,+z', '-x,-y,+z+1/2', '+y,-x+y,+z+1/2', '+x-y,+x,+z+1/2', '-y,-x,+z', '-x+y,+y,+z', '+x,+x-y,+z', '+y,+x,+z+1/2', '+x-y,-y,+z+1/2', '-x,-x+y,+z+1/2'], [187, 1, '     P-6m2', 'Hexagonal', '+x,+y,+z', '-y,+x-y,+z', '-x+y,-x,+z', '+x,+y,-z', '-y,+x-y,-z', '-x+y,-x,-z', '-y,-x,+z', '-x+y,+y,+z', '+x,+x-y,+z', '-y,-x,-z', '-x+y,+y,-z', '+x,+x-y,-z'], [188, 1, '     P-6c2', 'Hexagonal', '+x,+y,+z', '-y,+x-y,+z', '-x+y,-x,+z', '+x,+y,-z+1/2', '-y,+x-y,-z+1/2', '-x+y,-x,-z+1/2', '-y,-x,+z+1/2', '-x+y,+y,+z+1/2', '+x,+x-y,+z+1/2', '-y,-x,-z', '-x+y,+y,-z', '+x,+x-y,-z'], [189, 1, '     P-62m', 'Hexagonal', '+x,+y,+z', '-y,+x-y,+z', '-x+y,-x,+z', '+x,+y,-z', '-y,+x-y,-z', '-x+y,-x,-z', '+y,+x,-z', '+x-y,-y,-z', '-x,-x+y,-z', '+y,+x,+z', '+x-y,-y,+z', '-x,-x+y,+z'], [190, 1, '     P-62c', 'Hexagonal', '+x,+y,+z', '-y,+x-y,+z', '-x+y,-x,+z', '+x,+y,-z+1/2', '-y,+x-y,-z+1/2', '-x+y,-x,-z+1/2', '+y,+x,-z', '+x-y,-y,-z', '-x,-x+y,-z', '+y,+x,+z+1/2', '+x-y,-y,+z+1/2', '-x,-x+y,+z+1/2'], [191, 1, '    P6/mmm', 'Hexagonal', '+x,+y,+z', '-y,+x-y,+z', '-x+y,-x,+z', '-x,-y,+z', '+y,-x+y,+z', '+x-y,+x,+z', '+y,+x,-z', '+x-y,-y,-z', '-x,-x+y,-z', '-y,-x,-z', '-x+y,+y,-z', '+x,+x-y,-z', '-x,-y,-z', '+y,-x+y,-z', '+x-y,+x,-z', '+x,+y,-z', '-y,+x-y,-z', '-x+y,-x,-z', '-y,-x,+z', '-x+y,+y,+z', '+x,+x-y,+z', '+y,+x,+z', '+x-y,-y,+z', '-x,-x+y,+z'], [192, 1, '    P6/mcc', 'Hexagonal', '+x,+y,+z', '-y,+x-y,+z', '-x+y,-x,+z', '-x,-y,+z', '+y,-x+y,+z', '+x-y,+x,+z', '+y,+x,-z+1/2', '+x-y,-y,-z+1/2', '-x,-x+y,-z+1/2', '-y,-x,-z+1/2', '-x+y,+y,-z+1/2', '+x,+x-y,-z+1/2', '-x,-y,-z', '+y,-x+y,-z', '+x-y,+x,-z', '+x,+y,-z', '-y,+x-y,-z', '-x+y,-x,-z', '-y,-x,+z+1/2', '-x+y,+y,+z+1/2', '+x,+x-y,+z+1/2', '+y,+x,+z+1/2', '+x-y,-y,+z+1/2', '-x,-x+y,+z+1/2'], [193, 1, '  P6_3/mcm', 'Hexagonal', '+x,+y,+z', '-y,+x-y,+z', '-x+y,-x,+z', '-x,-y,+z+1/2', '+y,-x+y,+z+1/2', '+x-y,+x,+z+1/2', '+y,+x,-z+1/2', '+x-y,-y,-z+1/2', '-x,-x+y,-z+1/2', '-y,-x,-z', '-x+y,+y,-z', '+x,+x-y,-z', '-x,-y,-z', '+y,-x+y,-z', '+x-y,+x,-z', '+x,+y,-z+1/2', '-y,+x-y,-z+1/2', '-x+y,-x,-z+1/2', '-y,-x,+z+1/2', '-x+y,+y,+z+1/2', '+x,+x-y,+z+1/2', '+y,+x,+z', '+x-y,-y,+z', '-x,-x+y,+z'], [194, 1, '  P6_3/mmc', 'Hexagonal', '+x,+y,+z', '-y,+x-y,+z', '-x+y,-x,+z', '-x,-y,+z+1/2', '+y,-x+y,+z+1/2', '+x-y,+x,+z+1/2', '+y,+x,-z', '+x-y,-y,-z', '-x,-x+y,-z', '-y,-x,-z+1/2', '-x+y,+y,-z+1/2', '+x,+x-y,-z+1/2', '-x,-y,-z', '+y,-x+y,-z', '+x-y,+x,-z', '+x,+y,-z+1/2', '-y,+x-y,-z+1/2', '-x+y,-x,-z+1/2', '-y,-x,+z', '-x+y,+y,+z', '+x,+x-y,+z', '+y,+x,+z+1/2', '+x-y,-y,+z+1/2', '-x,-x+y,+z+1/2'], [195, 1, '       P23', 'Cubic', '+x,+y,+z', '-x,-y,+z', '-x,+y,-z', '+x,-y,-z', '+z,+x,+y', '+z,-x,-y', '-z,-x,+y', '-z,+x,-y', '+y,+z,+x', '-y,+z,-x', '+y,-z,-x', '-y,-z,+x'], [196, 1, '       F23', 'Cubic', '+x,+y,+z', '-x,-y,+z', '-x,+y,-z', '+x,-y,-z', '+z,+x,+y', '+z,-x,-y', '-z,-x,+y', '-z,+x,-y', '+y,+z,+x', '-y,+z,-x', '+y,-z,-x', '-y,-z,+x', '+x,+y+1/2,+z+1/2', '-x,-y+1/2,+z+1/2', '-x,+y+1/2,-z+1/2', '+x,-y+1/2,-z+1/2', '+z,+x+1/2,+y+1/2', '+z,-x+1/2,-y+1/2', '-z,-x+1/2,+y+1/2', '-z,+x+1/2,-y+1/2', '+y,+z+1/2,+x+1/2', '-y,+z+1/2,-x+1/2', '+y,-z+1/2,-x+1/2', '-y,-z+1/2,+x+1/2', '+x+1/2,+y,+z+1/2', '-x+1/2,-y,+z+1/2', '-x+1/2,+y,-z+1/2', '+x+1/2,-y,-z+1/2', '+z+1/2,+x,+y+1/2', '+z+1/2,-x,-y+1/2', '-z+1/2,-x,+y+1/2', '-z+1/2,+x,-y+1/2', '+y+1/2,+z,+x+1/2', '-y+1/2,+z,-x+1/2', '+y+1/2,-z,-x+1/2', '-y+1/2,-z,+x+1/2', '+x+1/2,+y+1/2,+z', '-x+1/2,-y+1/2,+z', '-x+1/2,+y+1/2,-z', '+x+1/2,-y+1/2,-z', '+z+1/2,+x+1/2,+y', '+z+1/2,-x+1/2,-y', '-z+1/2,-x+1/2,+y', '-z+1/2,+x+1/2,-y', '+y+1/2,+z+1/2,+x', '-y+1/2,+z+1/2,-x', '+y+1/2,-z+1/2,-x', '-y+1/2,-z+1/2,+x'], [197, 1, '       I23', 'Cubic', '+x,+y,+z', '-x,-y,+z', '-x,+y,-z', '+x,-y,-z', '+z,+x,+y', '+z,-x,-y', '-z,-x,+y', '-z,+x,-y', '+y,+z,+x', '-y,+z,-x', '+y,-z,-x', '-y,-z,+x', '+x+1/2,+y+1/2,+z+1/2', '-x+1/2,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,-z+1/2', '+z+1/2,+x+1/2,+y+1/2', '+z+1/2,-x+1/2,-y+1/2', '-z+1/2,-x+1/2,+y+1/2', '-z+1/2,+x+1/2,-y+1/2', '+y+1/2,+z+1/2,+x+1/2', '-y+1/2,+z+1/2,-x+1/2', '+y+1/2,-z+1/2,-x+1/2', '-y+1/2,-z+1/2,+x+1/2'], [198, 1, '     P2_13', 'Cubic', '+x,+y,+z', '-x+1/2,-y,+z+1/2', '-x,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,-z', '+z,+x,+y', '+z+1/2,-x+1/2,-y', '-z+1/2,-x,+y+1/2', '-z,+x+1/2,-y+1/2', '+y,+z,+x', '-y,+z+1/2,-x+1/2', '+y+1/2,-z+1/2,-x', '-y+1/2,-z,+x+1/2'], [199, 1, '     I2_13', 'Cubic', '+x,+y,+z', '-x+1/2,-y,+z+1/2', '-x,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,-z', '+z,+x,+y', '+z+1/2,-x+1/2,-y', '-z+1/2,-x,+y+1/2', '-z,+x+1/2,-y+1/2', '+y,+z,+x', '-y,+z+1/2,-x+1/2', '+y+1/2,-z+1/2,-x', '-y+1/2,-z,+x+1/2', '+x+1/2,+y+1/2,+z+1/2', '-x+1,-y+1/2,+z+1', '-x+1/2,+y+1,-z+1', '+x+1,-y+1,-z+1/2', '+z+1/2,+x+1/2,+y+1/2', '+z+1,-x+1,-y+1/2', '-z+1,-x+1/2,+y+1', '-z+1/2,+x+1,-y+1', '+y+1/2,+z+1/2,+x+1/2', '-y+1/2,+z+1,-x+1', '+y+1,-z+1,-x+1/2', '-y+1,-z+1/2,+x+1'], [200, 1, '      Pm-3', 'Cubic', '+x,+y,+z', '-x,-y,+z', '-x,+y,-z', '+x,-y,-z', '+z,+x,+y', '+z,-x,-y', '-z,-x,+y', '-z,+x,-y', '+y,+z,+x', '-y,+z,-x', '+y,-z,-x', '-y,-z,+x', '-x,-y,-z', '+x,+y,-z', '+x,-y,+z', '-x,+y,+z', '-z,-x,-y', '-z,+x,+y', '+z,+x,-y', '+z,-x,+y', '-y,-z,-x', '+y,-z,+x', '-y,+z,+x', '+y,+z,-x'], [201, 1, '      Pn-3', 'Cubic', '+x,+y,+z', '-x,-y,+z', '-x,+y,-z', '+x,-y,-z', '+z,+x,+y', '+z,-x,-y', '-z,-x,+y', '-z,+x,-y', '+y,+z,+x', '-y,+z,-x', '+y,-z,-x', '-y,-z,+x', '-x+1/2,-y+1/2,-z+1/2', '+x+1/2,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,+z+1/2', '-z+1/2,-x+1/2,-y+1/2', '-z+1/2,+x+1/2,+y+1/2', '+z+1/2,+x+1/2,-y+1/2', '+z+1/2,-x+1/2,+y+1/2', '-y+1/2,-z+1/2,-x+1/2', '+y+1/2,-z+1/2,+x+1/2', '-y+1/2,+z+1/2,+x+1/2', '+y+1/2,+z+1/2,-x+1/2'], [202, 1, '      Fm-3', 'Cubic', '+x,+y,+z', '-x,-y,+z', '-x,+y,-z', '+x,-y,-z', '+z,+x,+y', '+z,-x,-y', '-z,-x,+y', '-z,+x,-y', '+y,+z,+x', '-y,+z,-x', '+y,-z,-x', '-y,-z,+x', '-x,-y,-z', '+x,+y,-z', '+x,-y,+z', '-x,+y,+z', '-z,-x,-y', '-z,+x,+y', '+z,+x,-y', '+z,-x,+y', '-y,-z,-x', '+y,-z,+x', '-y,+z,+x', '+y,+z,-x', '+x,+y+1/2,+z+1/2', '-x,-y+1/2,+z+1/2', '-x,+y+1/2,-z+1/2', '+x,-y+1/2,-z+1/2', '+z,+x+1/2,+y+1/2', '+z,-x+1/2,-y+1/2', '-z,-x+1/2,+y+1/2', '-z,+x+1/2,-y+1/2', '+y,+z+1/2,+x+1/2', '-y,+z+1/2,-x+1/2', '+y,-z+1/2,-x+1/2', '-y,-z+1/2,+x+1/2', '-x,-y+1/2,-z+1/2', '+x,+y+1/2,-z+1/2', '+x,-y+1/2,+z+1/2', '-x,+y+1/2,+z+1/2', '-z,-x+1/2,-y+1/2', '-z,+x+1/2,+y+1/2', '+z,+x+1/2,-y+1/2', '+z,-x+1/2,+y+1/2', '-y,-z+1/2,-x+1/2', '+y,-z+1/2,+x+1/2', '-y,+z+1/2,+x+1/2', '+y,+z+1/2,-x+1/2', '+x+1/2,+y,+z+1/2', '-x+1/2,-y,+z+1/2', '-x+1/2,+y,-z+1/2', '+x+1/2,-y,-z+1/2', '+z+1/2,+x,+y+1/2', '+z+1/2,-x,-y+1/2', '-z+1/2,-x,+y+1/2', '-z+1/2,+x,-y+1/2', '+y+1/2,+z,+x+1/2', '-y+1/2,+z,-x+1/2', '+y+1/2,-z,-x+1/2', '-y+1/2,-z,+x+1/2', '-x+1/2,-y,-z+1/2', '+x+1/2,+y,-z+1/2', '+x+1/2,-y,+z+1/2', '-x+1/2,+y,+z+1/2', '-z+1/2,-x,-y+1/2', '-z+1/2,+x,+y+1/2', '+z+1/2,+x,-y+1/2', '+z+1/2,-x,+y+1/2', '-y+1/2,-z,-x+1/2', '+y+1/2,-z,+x+1/2', '-y+1/2,+z,+x+1/2', '+y+1/2,+z,-x+1/2', '+x+1/2,+y+1/2,+z', '-x+1/2,-y+1/2,+z', '-x+1/2,+y+1/2,-z', '+x+1/2,-y+1/2,-z', '+z+1/2,+x+1/2,+y', '+z+1/2,-x+1/2,-y', '-z+1/2,-x+1/2,+y', '-z+1/2,+x+1/2,-y', '+y+1/2,+z+1/2,+x', '-y+1/2,+z+1/2,-x', '+y+1/2,-z+1/2,-x', '-y+1/2,-z+1/2,+x', '-x+1/2,-y+1/2,-z', '+x+1/2,+y+1/2,-z', '+x+1/2,-y+1/2,+z', '-x+1/2,+y+1/2,+z', '-z+1/2,-x+1/2,-y', '-z+1/2,+x+1/2,+y', '+z+1/2,+x+1/2,-y', '+z+1/2,-x+1/2,+y', '-y+1/2,-z+1/2,-x', '+y+1/2,-z+1/2,+x', '-y+1/2,+z+1/2,+x', '+y+1/2,+z+1/2,-x'], [203, 1, '      Fd-3', 'Cubic', '+x,+y,+z', '-x,-y,+z', '-x,+y,-z', '+x,-y,-z', '+z,+x,+y', '+z,-x,-y', '-z,-x,+y', '-z,+x,-y', '+y,+z,+x', '-y,+z,-x', '+y,-z,-x', '-y,-z,+x', '-x+1/4,-y+1/4,-z+1/4', '+x+1/4,+y+1/4,-z+1/4', '+x+1/4,-y+1/4,+z+1/4', '-x+1/4,+y+1/4,+z+1/4', '-z+1/4,-x+1/4,-y+1/4', '-z+1/4,+x+1/4,+y+1/4', '+z+1/4,+x+1/4,-y+1/4', '+z+1/4,-x+1/4,+y+1/4', '-y+1/4,-z+1/4,-x+1/4', '+y+1/4,-z+1/4,+x+1/4', '-y+1/4,+z+1/4,+x+1/4', '+y+1/4,+z+1/4,-x+1/4', '+x,+y+1/2,+z+1/2', '-x,-y+1/2,+z+1/2', '-x,+y+1/2,-z+1/2', '+x,-y+1/2,-z+1/2', '+z,+x+1/2,+y+1/2', '+z,-x+1/2,-y+1/2', '-z,-x+1/2,+y+1/2', '-z,+x+1/2,-y+1/2', '+y,+z+1/2,+x+1/2', '-y,+z+1/2,-x+1/2', '+y,-z+1/2,-x+1/2', '-y,-z+1/2,+x+1/2', '-x+1/4,-y+3/4,-z+3/4', '+x+1/4,+y+3/4,-z+3/4', '+x+1/4,-y+3/4,+z+3/4', '-x+1/4,+y+3/4,+z+3/4', '-z+1/4,-x+3/4,-y+3/4', '-z+1/4,+x+3/4,+y+3/4', '+z+1/4,+x+3/4,-y+3/4', '+z+1/4,-x+3/4,+y+3/4', '-y+1/4,-z+3/4,-x+3/4', '+y+1/4,-z+3/4,+x+3/4', '-y+1/4,+z+3/4,+x+3/4', '+y+1/4,+z+3/4,-x+3/4', '+x+1/2,+y,+z+1/2', '-x+1/2,-y,+z+1/2', '-x+1/2,+y,-z+1/2', '+x+1/2,-y,-z+1/2', '+z+1/2,+x,+y+1/2', '+z+1/2,-x,-y+1/2', '-z+1/2,-x,+y+1/2', '-z+1/2,+x,-y+1/2', '+y+1/2,+z,+x+1/2', '-y+1/2,+z,-x+1/2', '+y+1/2,-z,-x+1/2', '-y+1/2,-z,+x+1/2', '-x+3/4,-y+1/4,-z+3/4', '+x+3/4,+y+1/4,-z+3/4', '+x+3/4,-y+1/4,+z+3/4', '-x+3/4,+y+1/4,+z+3/4', '-z+3/4,-x+1/4,-y+3/4', '-z+3/4,+x+1/4,+y+3/4', '+z+3/4,+x+1/4,-y+3/4', '+z+3/4,-x+1/4,+y+3/4', '-y+3/4,-z+1/4,-x+3/4', '+y+3/4,-z+1/4,+x+3/4', '-y+3/4,+z+1/4,+x+3/4', '+y+3/4,+z+1/4,-x+3/4', '+x+1/2,+y+1/2,+z', '-x+1/2,-y+1/2,+z', '-x+1/2,+y+1/2,-z', '+x+1/2,-y+1/2,-z', '+z+1/2,+x+1/2,+y', '+z+1/2,-x+1/2,-y', '-z+1/2,-x+1/2,+y', '-z+1/2,+x+1/2,-y', '+y+1/2,+z+1/2,+x', '-y+1/2,+z+1/2,-x', '+y+1/2,-z+1/2,-x', '-y+1/2,-z+1/2,+x', '-x+3/4,-y+3/4,-z+1/4', '+x+3/4,+y+3/4,-z+1/4', '+x+3/4,-y+3/4,+z+1/4', '-x+3/4,+y+3/4,+z+1/4', '-z+3/4,-x+3/4,-y+1/4', '-z+3/4,+x+3/4,+y+1/4', '+z+3/4,+x+3/4,-y+1/4', '+z+3/4,-x+3/4,+y+1/4', '-y+3/4,-z+3/4,-x+1/4', '+y+3/4,-z+3/4,+x+1/4', '-y+3/4,+z+3/4,+x+1/4', '+y+3/4,+z+3/4,-x+1/4'], [204, 1, '      Im-3', 'Cubic', '+x,+y,+z', '-x,-y,+z', '-x,+y,-z', '+x,-y,-z', '+z,+x,+y', '+z,-x,-y', '-z,-x,+y', '-z,+x,-y', '+y,+z,+x', '-y,+z,-x', '+y,-z,-x', '-y,-z,+x', '-x,-y,-z', '+x,+y,-z', '+x,-y,+z', '-x,+y,+z', '-z,-x,-y', '-z,+x,+y', '+z,+x,-y', '+z,-x,+y', '-y,-z,-x', '+y,-z,+x', '-y,+z,+x', '+y,+z,-x', '+x+1/2,+y+1/2,+z+1/2', '-x+1/2,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,-z+1/2', '+z+1/2,+x+1/2,+y+1/2', '+z+1/2,-x+1/2,-y+1/2', '-z+1/2,-x+1/2,+y+1/2', '-z+1/2,+x+1/2,-y+1/2', '+y+1/2,+z+1/2,+x+1/2', '-y+1/2,+z+1/2,-x+1/2', '+y+1/2,-z+1/2,-x+1/2', '-y+1/2,-z+1/2,+x+1/2', '-x+1/2,-y+1/2,-z+1/2', '+x+1/2,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,+z+1/2', '-z+1/2,-x+1/2,-y+1/2', '-z+1/2,+x+1/2,+y+1/2', '+z+1/2,+x+1/2,-y+1/2', '+z+1/2,-x+1/2,+y+1/2', '-y+1/2,-z+1/2,-x+1/2', '+y+1/2,-z+1/2,+x+1/2', '-y+1/2,+z+1/2,+x+1/2', '+y+1/2,+z+1/2,-x+1/2'], [205, 1, '      Pa-3', 'Cubic', '+x,+y,+z', '-x+1/2,-y,+z+1/2', '-x,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,-z', '+z,+x,+y', '+z+1/2,-x+1/2,-y', '-z+1/2,-x,+y+1/2', '-z,+x+1/2,-y+1/2', '+y,+z,+x', '-y,+z+1/2,-x+1/2', '+y+1/2,-z+1/2,-x', '-y+1/2,-z,+x+1/2', '-x,-y,-z', '+x+1/2,+y,-z+1/2', '+x,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,+z', '-z,-x,-y', '-z+1/2,+x+1/2,+y', '+z+1/2,+x,-y+1/2', '+z,-x+1/2,+y+1/2', '-y,-z,-x', '+y,-z+1/2,+x+1/2', '-y+1/2,+z+1/2,+x', '+y+1/2,+z,-x+1/2'], [206, 1, '      Ia-3', 'Cubic', '+x,+y,+z', '-x+1/2,-y,+z+1/2', '-x,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,-z', '+z,+x,+y', '+z+1/2,-x+1/2,-y', '-z+1/2,-x,+y+1/2', '-z,+x+1/2,-y+1/2', '+y,+z,+x', '-y,+z+1/2,-x+1/2', '+y+1/2,-z+1/2,-x', '-y+1/2,-z,+x+1/2', '-x,-y,-z', '+x+1/2,+y,-z+1/2', '+x,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,+z', '-z,-x,-y', '-z+1/2,+x+1/2,+y', '+z+1/2,+x,-y+1/2', '+z,-x+1/2,+y+1/2', '-y,-z,-x', '+y,-z+1/2,+x+1/2', '-y+1/2,+z+1/2,+x', '+y+1/2,+z,-x+1/2', '+x+1/2,+y+1/2,+z+1/2', '-x+1,-y+1/2,+z+1', '-x+1/2,+y+1,-z+1', '+x+1,-y+1,-z+1/2', '+z+1/2,+x+1/2,+y+1/2', '+z+1,-x+1,-y+1/2', '-z+1,-x+1/2,+y+1', '-z+1/2,+x+1,-y+1', '+y+1/2,+z+1/2,+x+1/2', '-y+1/2,+z+1,-x+1', '+y+1,-z+1,-x+1/2', '-y+1,-z+1/2,+x+1', '-x+1/2,-y+1/2,-z+1/2', '+x+1,+y+1/2,-z+1', '+x+1/2,-y+1,+z+1', '-x+1,+y+1,+z+1/2', '-z+1/2,-x+1/2,-y+1/2', '-z+1,+x+1,+y+1/2', '+z+1,+x+1/2,-y+1', '+z+1/2,-x+1,+y+1', '-y+1/2,-z+1/2,-x+1/2', '+y+1/2,-z+1,+x+1', '-y+1,+z+1,+x+1/2', '+y+1,+z+1/2,-x+1'], [207, 1, '      P432', 'Cubic', '+x,+y,+z', '-x,-y,+z', '-x,+y,-z', '+x,-y,-z', '+z,+x,+y', '+z,-x,-y', '-z,-x,+y', '-z,+x,-y', '+y,+z,+x', '-y,+z,-x', '+y,-z,-x', '-y,-z,+x', '+y,+x,-z', '-y,-x,-z', '+y,-x,+z', '-y,+x,+z', '+x,+z,-y', '-x,+z,+y', '-x,-z,-y', '+x,-z,+y', '+z,+y,-x', '+z,-y,+x', '-z,+y,+x', '-z,-y,-x'], [208, 1, '    P4_232', 'Cubic', '+x,+y,+z', '-x,-y,+z', '-x,+y,-z', '+x,-y,-z', '+z,+x,+y', '+z,-x,-y', '-z,-x,+y', '-z,+x,-y', '+y,+z,+x', '-y,+z,-x', '+y,-z,-x', '-y,-z,+x', '+y+1/2,+x+1/2,-z+1/2', '-y+1/2,-x+1/2,-z+1/2', '+y+1/2,-x+1/2,+z+1/2', '-y+1/2,+x+1/2,+z+1/2', '+x+1/2,+z+1/2,-y+1/2', '-x+1/2,+z+1/2,+y+1/2', '-x+1/2,-z+1/2,-y+1/2', '+x+1/2,-z+1/2,+y+1/2', '+z+1/2,+y+1/2,-x+1/2', '+z+1/2,-y+1/2,+x+1/2', '-z+1/2,+y+1/2,+x+1/2', '-z+1/2,-y+1/2,-x+1/2'], [209, 1, '      F432', 'Cubic', '+x,+y,+z', '-x,-y,+z', '-x,+y,-z', '+x,-y,-z', '+z,+x,+y', '+z,-x,-y', '-z,-x,+y', '-z,+x,-y', '+y,+z,+x', '-y,+z,-x', '+y,-z,-x', '-y,-z,+x', '+y,+x,-z', '-y,-x,-z', '+y,-x,+z', '-y,+x,+z', '+x,+z,-y', '-x,+z,+y', '-x,-z,-y', '+x,-z,+y', '+z,+y,-x', '+z,-y,+x', '-z,+y,+x', '-z,-y,-x', '+x,+y+1/2,+z+1/2', '-x,-y+1/2,+z+1/2', '-x,+y+1/2,-z+1/2', '+x,-y+1/2,-z+1/2', '+z,+x+1/2,+y+1/2', '+z,-x+1/2,-y+1/2', '-z,-x+1/2,+y+1/2', '-z,+x+1/2,-y+1/2', '+y,+z+1/2,+x+1/2', '-y,+z+1/2,-x+1/2', '+y,-z+1/2,-x+1/2', '-y,-z+1/2,+x+1/2', '+y,+x+1/2,-z+1/2', '-y,-x+1/2,-z+1/2', '+y,-x+1/2,+z+1/2', '-y,+x+1/2,+z+1/2', '+x,+z+1/2,-y+1/2', '-x,+z+1/2,+y+1/2', '-x,-z+1/2,-y+1/2', '+x,-z+1/2,+y+1/2', '+z,+y+1/2,-x+1/2', '+z,-y+1/2,+x+1/2', '-z,+y+1/2,+x+1/2', '-z,-y+1/2,-x+1/2', '+x+1/2,+y,+z+1/2', '-x+1/2,-y,+z+1/2', '-x+1/2,+y,-z+1/2', '+x+1/2,-y,-z+1/2', '+z+1/2,+x,+y+1/2', '+z+1/2,-x,-y+1/2', '-z+1/2,-x,+y+1/2', '-z+1/2,+x,-y+1/2', '+y+1/2,+z,+x+1/2', '-y+1/2,+z,-x+1/2', '+y+1/2,-z,-x+1/2', '-y+1/2,-z,+x+1/2', '+y+1/2,+x,-z+1/2', '-y+1/2,-x,-z+1/2', '+y+1/2,-x,+z+1/2', '-y+1/2,+x,+z+1/2', '+x+1/2,+z,-y+1/2', '-x+1/2,+z,+y+1/2', '-x+1/2,-z,-y+1/2', '+x+1/2,-z,+y+1/2', '+z+1/2,+y,-x+1/2', '+z+1/2,-y,+x+1/2', '-z+1/2,+y,+x+1/2', '-z+1/2,-y,-x+1/2', '+x+1/2,+y+1/2,+z', '-x+1/2,-y+1/2,+z', '-x+1/2,+y+1/2,-z', '+x+1/2,-y+1/2,-z', '+z+1/2,+x+1/2,+y', '+z+1/2,-x+1/2,-y', '-z+1/2,-x+1/2,+y', '-z+1/2,+x+1/2,-y', '+y+1/2,+z+1/2,+x', '-y+1/2,+z+1/2,-x', '+y+1/2,-z+1/2,-x', '-y+1/2,-z+1/2,+x', '+y+1/2,+x+1/2,-z', '-y+1/2,-x+1/2,-z', '+y+1/2,-x+1/2,+z', '-y+1/2,+x+1/2,+z', '+x+1/2,+z+1/2,-y', '-x+1/2,+z+1/2,+y', '-x+1/2,-z+1/2,-y', '+x+1/2,-z+1/2,+y', '+z+1/2,+y+1/2,-x', '+z+1/2,-y+1/2,+x', '-z+1/2,+y+1/2,+x', '-z+1/2,-y+1/2,-x'], [210, 1, '    F4_132', 'Cubic', '+x,+y,+z', '-x,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,-z', '+x+1/2,-y,-z+1/2', '+z,+x,+y', '+z+1/2,-x,-y+1/2', '-z,-x+1/2,+y+1/2', '-z+1/2,+x+1/2,-y', '+y,+z,+x', '-y+1/2,+z+1/2,-x', '+y+1/2,-z,-x+1/2', '-y,-z+1/2,+x+1/2', '+y+3/4,+x+1/4,-z+3/4', '-y+1/4,-x+1/4,-z+1/4', '+y+1/4,-x+3/4,+z+3/4', '-y+3/4,+x+3/4,+z+1/4', '+x+3/4,+z+1/4,-y+3/4', '-x+3/4,+z+3/4,+y+1/4', '-x+1/4,-z+1/4,-y+1/4', '+x+1/4,-z+3/4,+y+3/4', '+z+3/4,+y+1/4,-x+3/4', '+z+1/4,-y+3/4,+x+3/4', '-z+3/4,+y+3/4,+x+1/4', '-z+1/4,-y+1/4,-x+1/4', '+x,+y+1/2,+z+1/2', '-x,-y+1,+z+1', '-x+1/2,+y+1,-z+1/2', '+x+1/2,-y+1/2,-z+1', '+z,+x+1/2,+y+1/2', '+z+1/2,-x+1/2,-y+1', '-z,-x+1,+y+1', '-z+1/2,+x+1,-y+1/2', '+y,+z+1/2,+x+1/2', '-y+1/2,+z+1,-x+1/2', '+y+1/2,-z+1/2,-x+1', '-y,-z+1,+x+1', '+y+3/4,+x+3/4,-z+5/4', '-y+1/4,-x+3/4,-z+3/4', '+y+1/4,-x+5/4,+z+5/4', '-y+3/4,+x+5/4,+z+3/4', '+x+3/4,+z+3/4,-y+5/4', '-x+3/4,+z+5/4,+y+3/4', '-x+1/4,-z+3/4,-y+3/4', '+x+1/4,-z+5/4,+y+5/4', '+z+3/4,+y+3/4,-x+5/4', '+z+1/4,-y+5/4,+x+5/4', '-z+3/4,+y+5/4,+x+3/4', '-z+1/4,-y+3/4,-x+3/4', '+x+1/2,+y,+z+1/2', '-x+1/2,-y+1/2,+z+1', '-x+1,+y+1/2,-z+1/2', '+x+1,-y,-z+1', '+z+1/2,+x,+y+1/2', '+z+1,-x,-y+1', '-z+1/2,-x+1/2,+y+1', '-z+1,+x+1/2,-y+1/2', '+y+1/2,+z,+x+1/2', '-y+1,+z+1/2,-x+1/2', '+y+1,-z,-x+1', '-y+1/2,-z+1/2,+x+1', '+y+5/4,+x+1/4,-z+5/4', '-y+3/4,-x+1/4,-z+3/4', '+y+3/4,-x+3/4,+z+5/4', '-y+5/4,+x+3/4,+z+3/4', '+x+5/4,+z+1/4,-y+5/4', '-x+5/4,+z+3/4,+y+3/4', '-x+3/4,-z+1/4,-y+3/4', '+x+3/4,-z+3/4,+y+5/4', '+z+5/4,+y+1/4,-x+5/4', '+z+3/4,-y+3/4,+x+5/4', '-z+5/4,+y+3/4,+x+3/4', '-z+3/4,-y+1/4,-x+3/4', '+x+1/2,+y+1/2,+z', '-x+1/2,-y+1,+z+1/2', '-x+1,+y+1,-z', '+x+1,-y+1/2,-z+1/2', '+z+1/2,+x+1/2,+y', '+z+1,-x+1/2,-y+1/2', '-z+1/2,-x+1,+y+1/2', '-z+1,+x+1,-y', '+y+1/2,+z+1/2,+x', '-y+1,+z+1,-x', '+y+1,-z+1/2,-x+1/2', '-y+1/2,-z+1,+x+1/2', '+y+5/4,+x+3/4,-z+3/4', '-y+3/4,-x+3/4,-z+1/4', '+y+3/4,-x+5/4,+z+3/4', '-y+5/4,+x+5/4,+z+1/4', '+x+5/4,+z+3/4,-y+3/4', '-x+5/4,+z+5/4,+y+1/4', '-x+3/4,-z+3/4,-y+1/4', '+x+3/4,-z+5/4,+y+3/4', '+z+5/4,+y+3/4,-x+3/4', '+z+3/4,-y+5/4,+x+3/4', '-z+5/4,+y+5/4,+x+1/4', '-z+3/4,-y+3/4,-x+1/4'], [211, 1, '      I432', 'Cubic', '+x,+y,+z', '-x,-y,+z', '-x,+y,-z', '+x,-y,-z', '+z,+x,+y', '+z,-x,-y', '-z,-x,+y', '-z,+x,-y', '+y,+z,+x', '-y,+z,-x', '+y,-z,-x', '-y,-z,+x', '+y,+x,-z', '-y,-x,-z', '+y,-x,+z', '-y,+x,+z', '+x,+z,-y', '-x,+z,+y', '-x,-z,-y', '+x,-z,+y', '+z,+y,-x', '+z,-y,+x', '-z,+y,+x', '-z,-y,-x', '+x+1/2,+y+1/2,+z+1/2', '-x+1/2,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,-z+1/2', '+z+1/2,+x+1/2,+y+1/2', '+z+1/2,-x+1/2,-y+1/2', '-z+1/2,-x+1/2,+y+1/2', '-z+1/2,+x+1/2,-y+1/2', '+y+1/2,+z+1/2,+x+1/2', '-y+1/2,+z+1/2,-x+1/2', '+y+1/2,-z+1/2,-x+1/2', '-y+1/2,-z+1/2,+x+1/2', '+y+1/2,+x+1/2,-z+1/2', '-y+1/2,-x+1/2,-z+1/2', '+y+1/2,-x+1/2,+z+1/2', '-y+1/2,+x+1/2,+z+1/2', '+x+1/2,+z+1/2,-y+1/2', '-x+1/2,+z+1/2,+y+1/2', '-x+1/2,-z+1/2,-y+1/2', '+x+1/2,-z+1/2,+y+1/2', '+z+1/2,+y+1/2,-x+1/2', '+z+1/2,-y+1/2,+x+1/2', '-z+1/2,+y+1/2,+x+1/2', '-z+1/2,-y+1/2,-x+1/2'], [212, 1, '    P4_332', 'Cubic', '+x,+y,+z', '-x+1/2,-y,+z+1/2', '-x,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,-z', '+z,+x,+y', '+z+1/2,-x+1/2,-y', '-z+1/2,-x,+y+1/2', '-z,+x+1/2,-y+1/2', '+y,+z,+x', '-y,+z+1/2,-x+1/2', '+y+1/2,-z+1/2,-x', '-y+1/2,-z,+x+1/2', '+y+1/4,+x+3/4,-z+3/4', '-y+1/4,-x+1/4,-z+1/4', '+y+3/4,-x+3/4,+z+1/4', '-y+3/4,+x+1/4,+z+3/4', '+x+1/4,+z+3/4,-y+3/4', '-x+3/4,+z+1/4,+y+3/4', '-x+1/4,-z+1/4,-y+1/4', '+x+3/4,-z+3/4,+y+1/4', '+z+1/4,+y+3/4,-x+3/4', '+z+3/4,-y+3/4,+x+1/4', '-z+3/4,+y+1/4,+x+3/4', '-z+1/4,-y+1/4,-x+1/4'], [213, 1, '    P4_132', 'Cubic', '+x,+y,+z', '-x+1/2,-y,+z+1/2', '-x,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,-z', '+z,+x,+y', '+z+1/2,-x+1/2,-y', '-z+1/2,-x,+y+1/2', '-z,+x+1/2,-y+1/2', '+y,+z,+x', '-y,+z+1/2,-x+1/2', '+y+1/2,-z+1/2,-x', '-y+1/2,-z,+x+1/2', '+y+3/4,+x+1/4,-z+1/4', '-y+3/4,-x+3/4,-z+3/4', '+y+1/4,-x+1/4,+z+3/4', '-y+1/4,+x+3/4,+z+1/4', '+x+3/4,+z+1/4,-y+1/4', '-x+1/4,+z+3/4,+y+1/4', '-x+3/4,-z+3/4,-y+3/4', '+x+1/4,-z+1/4,+y+3/4', '+z+3/4,+y+1/4,-x+1/4', '+z+1/4,-y+1/4,+x+3/4', '-z+1/4,+y+3/4,+x+1/4', '-z+3/4,-y+3/4,-x+3/4'], [214, 1, '    I4_132', 'Cubic', '+x,+y,+z', '-x+1/2,-y,+z+1/2', '-x,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,-z', '+z,+x,+y', '+z+1/2,-x+1/2,-y', '-z+1/2,-x,+y+1/2', '-z,+x+1/2,-y+1/2', '+y,+z,+x', '-y,+z+1/2,-x+1/2', '+y+1/2,-z+1/2,-x', '-y+1/2,-z,+x+1/2', '+y+3/4,+x+1/4,-z+1/4', '-y+3/4,-x+3/4,-z+3/4', '+y+1/4,-x+1/4,+z+3/4', '-y+1/4,+x+3/4,+z+1/4', '+x+3/4,+z+1/4,-y+1/4', '-x+1/4,+z+3/4,+y+1/4', '-x+3/4,-z+3/4,-y+3/4', '+x+1/4,-z+1/4,+y+3/4', '+z+3/4,+y+1/4,-x+1/4', '+z+1/4,-y+1/4,+x+3/4', '-z+1/4,+y+3/4,+x+1/4', '-z+3/4,-y+3/4,-x+3/4', '+x+1/2,+y+1/2,+z+1/2', '-x+1,-y+1/2,+z+1', '-x+1/2,+y+1,-z+1', '+x+1,-y+1,-z+1/2', '+z+1/2,+x+1/2,+y+1/2', '+z+1,-x+1,-y+1/2', '-z+1,-x+1/2,+y+1', '-z+1/2,+x+1,-y+1', '+y+1/2,+z+1/2,+x+1/2', '-y+1/2,+z+1,-x+1', '+y+1,-z+1,-x+1/2', '-y+1,-z+1/2,+x+1', '+y+5/4,+x+3/4,-z+3/4', '-y+5/4,-x+5/4,-z+5/4', '+y+3/4,-x+3/4,+z+5/4', '-y+3/4,+x+5/4,+z+3/4', '+x+5/4,+z+3/4,-y+3/4', '-x+3/4,+z+5/4,+y+3/4', '-x+5/4,-z+5/4,-y+5/4', '+x+3/4,-z+3/4,+y+5/4', '+z+5/4,+y+3/4,-x+3/4', '+z+3/4,-y+3/4,+x+5/4', '-z+3/4,+y+5/4,+x+3/4', '-z+5/4,-y+5/4,-x+5/4'], [215, 1, '     P-43m', 'Cubic', '+x,+y,+z', '-x,-y,+z', '-x,+y,-z', '+x,-y,-z', '+z,+x,+y', '+z,-x,-y', '-z,-x,+y', '-z,+x,-y', '+y,+z,+x', '-y,+z,-x', '+y,-z,-x', '-y,-z,+x', '+y,+x,+z', '-y,-x,+z', '+y,-x,-z', '-y,+x,-z', '+x,+z,+y', '-x,+z,-y', '-x,-z,+y', '+x,-z,-y', '+z,+y,+x', '+z,-y,-x', '-z,+y,-x', '-z,-y,+x'], [216, 1, '     F-43m', 'Cubic', '+x,+y,+z', '-x,-y,+z', '-x,+y,-z', '+x,-y,-z', '+z,+x,+y', '+z,-x,-y', '-z,-x,+y', '-z,+x,-y', '+y,+z,+x', '-y,+z,-x', '+y,-z,-x', '-y,-z,+x', '+y,+x,+z', '-y,-x,+z', '+y,-x,-z', '-y,+x,-z', '+x,+z,+y', '-x,+z,-y', '-x,-z,+y', '+x,-z,-y', '+z,+y,+x', '+z,-y,-x', '-z,+y,-x', '-z,-y,+x', '+x,+y+1/2,+z+1/2', '-x,-y+1/2,+z+1/2', '-x,+y+1/2,-z+1/2', '+x,-y+1/2,-z+1/2', '+z,+x+1/2,+y+1/2', '+z,-x+1/2,-y+1/2', '-z,-x+1/2,+y+1/2', '-z,+x+1/2,-y+1/2', '+y,+z+1/2,+x+1/2', '-y,+z+1/2,-x+1/2', '+y,-z+1/2,-x+1/2', '-y,-z+1/2,+x+1/2', '+y,+x+1/2,+z+1/2', '-y,-x+1/2,+z+1/2', '+y,-x+1/2,-z+1/2', '-y,+x+1/2,-z+1/2', '+x,+z+1/2,+y+1/2', '-x,+z+1/2,-y+1/2', '-x,-z+1/2,+y+1/2', '+x,-z+1/2,-y+1/2', '+z,+y+1/2,+x+1/2', '+z,-y+1/2,-x+1/2', '-z,+y+1/2,-x+1/2', '-z,-y+1/2,+x+1/2', '+x+1/2,+y,+z+1/2', '-x+1/2,-y,+z+1/2', '-x+1/2,+y,-z+1/2', '+x+1/2,-y,-z+1/2', '+z+1/2,+x,+y+1/2', '+z+1/2,-x,-y+1/2', '-z+1/2,-x,+y+1/2', '-z+1/2,+x,-y+1/2', '+y+1/2,+z,+x+1/2', '-y+1/2,+z,-x+1/2', '+y+1/2,-z,-x+1/2', '-y+1/2,-z,+x+1/2', '+y+1/2,+x,+z+1/2', '-y+1/2,-x,+z+1/2', '+y+1/2,-x,-z+1/2', '-y+1/2,+x,-z+1/2', '+x+1/2,+z,+y+1/2', '-x+1/2,+z,-y+1/2', '-x+1/2,-z,+y+1/2', '+x+1/2,-z,-y+1/2', '+z+1/2,+y,+x+1/2', '+z+1/2,-y,-x+1/2', '-z+1/2,+y,-x+1/2', '-z+1/2,-y,+x+1/2', '+x+1/2,+y+1/2,+z', '-x+1/2,-y+1/2,+z', '-x+1/2,+y+1/2,-z', '+x+1/2,-y+1/2,-z', '+z+1/2,+x+1/2,+y', '+z+1/2,-x+1/2,-y', '-z+1/2,-x+1/2,+y', '-z+1/2,+x+1/2,-y', '+y+1/2,+z+1/2,+x', '-y+1/2,+z+1/2,-x', '+y+1/2,-z+1/2,-x', '-y+1/2,-z+1/2,+x', '+y+1/2,+x+1/2,+z', '-y+1/2,-x+1/2,+z', '+y+1/2,-x+1/2,-z', '-y+1/2,+x+1/2,-z', '+x+1/2,+z+1/2,+y', '-x+1/2,+z+1/2,-y', '-x+1/2,-z+1/2,+y', '+x+1/2,-z+1/2,-y', '+z+1/2,+y+1/2,+x', '+z+1/2,-y+1/2,-x', '-z+1/2,+y+1/2,-x', '-z+1/2,-y+1/2,+x'], [217, 1, '     I-43m', 'Cubic', '+x,+y,+z', '-x,-y,+z', '-x,+y,-z', '+x,-y,-z', '+z,+x,+y', '+z,-x,-y', '-z,-x,+y', '-z,+x,-y', '+y,+z,+x', '-y,+z,-x', '+y,-z,-x', '-y,-z,+x', '+y,+x,+z', '-y,-x,+z', '+y,-x,-z', '-y,+x,-z', '+x,+z,+y', '-x,+z,-y', '-x,-z,+y', '+x,-z,-y', '+z,+y,+x', '+z,-y,-x', '-z,+y,-x', '-z,-y,+x', '+x+1/2,+y+1/2,+z+1/2', '-x+1/2,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,-z+1/2', '+z+1/2,+x+1/2,+y+1/2', '+z+1/2,-x+1/2,-y+1/2', '-z+1/2,-x+1/2,+y+1/2', '-z+1/2,+x+1/2,-y+1/2', '+y+1/2,+z+1/2,+x+1/2', '-y+1/2,+z+1/2,-x+1/2', '+y+1/2,-z+1/2,-x+1/2', '-y+1/2,-z+1/2,+x+1/2', '+y+1/2,+x+1/2,+z+1/2', '-y+1/2,-x+1/2,+z+1/2', '+y+1/2,-x+1/2,-z+1/2', '-y+1/2,+x+1/2,-z+1/2', '+x+1/2,+z+1/2,+y+1/2', '-x+1/2,+z+1/2,-y+1/2', '-x+1/2,-z+1/2,+y+1/2', '+x+1/2,-z+1/2,-y+1/2', '+z+1/2,+y+1/2,+x+1/2', '+z+1/2,-y+1/2,-x+1/2', '-z+1/2,+y+1/2,-x+1/2', '-z+1/2,-y+1/2,+x+1/2'], [218, 1, '     P-43n', 'Cubic', '+x,+y,+z', '-x,-y,+z', '-x,+y,-z', '+x,-y,-z', '+z,+x,+y', '+z,-x,-y', '-z,-x,+y', '-z,+x,-y', '+y,+z,+x', '-y,+z,-x', '+y,-z,-x', '-y,-z,+x', '+y+1/2,+x+1/2,+z+1/2', '-y+1/2,-x+1/2,+z+1/2', '+y+1/2,-x+1/2,-z+1/2', '-y+1/2,+x+1/2,-z+1/2', '+x+1/2,+z+1/2,+y+1/2', '-x+1/2,+z+1/2,-y+1/2', '-x+1/2,-z+1/2,+y+1/2', '+x+1/2,-z+1/2,-y+1/2', '+z+1/2,+y+1/2,+x+1/2', '+z+1/2,-y+1/2,-x+1/2', '-z+1/2,+y+1/2,-x+1/2', '-z+1/2,-y+1/2,+x+1/2'], [219, 1, '     F-43c', 'Cubic', '+x,+y,+z', '-x,-y,+z', '-x,+y,-z', '+x,-y,-z', '+z,+x,+y', '+z,-x,-y', '-z,-x,+y', '-z,+x,-y', '+y,+z,+x', '-y,+z,-x', '+y,-z,-x', '-y,-z,+x', '+y+1/2,+x+1/2,+z+1/2', '-y+1/2,-x+1/2,+z+1/2', '+y+1/2,-x+1/2,-z+1/2', '-y+1/2,+x+1/2,-z+1/2', '+x+1/2,+z+1/2,+y+1/2', '-x+1/2,+z+1/2,-y+1/2', '-x+1/2,-z+1/2,+y+1/2', '+x+1/2,-z+1/2,-y+1/2', '+z+1/2,+y+1/2,+x+1/2', '+z+1/2,-y+1/2,-x+1/2', '-z+1/2,+y+1/2,-x+1/2', '-z+1/2,-y+1/2,+x+1/2', '+x,+y+1/2,+z+1/2', '-x,-y+1/2,+z+1/2', '-x,+y+1/2,-z+1/2', '+x,-y+1/2,-z+1/2', '+z,+x+1/2,+y+1/2', '+z,-x+1/2,-y+1/2', '-z,-x+1/2,+y+1/2', '-z,+x+1/2,-y+1/2', '+y,+z+1/2,+x+1/2', '-y,+z+1/2,-x+1/2', '+y,-z+1/2,-x+1/2', '-y,-z+1/2,+x+1/2', '+y+1/2,+x+1,+z+1', '-y+1/2,-x+1,+z+1', '+y+1/2,-x+1,-z+1', '-y+1/2,+x+1,-z+1', '+x+1/2,+z+1,+y+1', '-x+1/2,+z+1,-y+1', '-x+1/2,-z+1,+y+1', '+x+1/2,-z+1,-y+1', '+z+1/2,+y+1,+x+1', '+z+1/2,-y+1,-x+1', '-z+1/2,+y+1,-x+1', '-z+1/2,-y+1,+x+1', '+x+1/2,+y,+z+1/2', '-x+1/2,-y,+z+1/2', '-x+1/2,+y,-z+1/2', '+x+1/2,-y,-z+1/2', '+z+1/2,+x,+y+1/2', '+z+1/2,-x,-y+1/2', '-z+1/2,-x,+y+1/2', '-z+1/2,+x,-y+1/2', '+y+1/2,+z,+x+1/2', '-y+1/2,+z,-x+1/2', '+y+1/2,-z,-x+1/2', '-y+1/2,-z,+x+1/2', '+y+1,+x+1/2,+z+1', '-y+1,-x+1/2,+z+1', '+y+1,-x+1/2,-z+1', '-y+1,+x+1/2,-z+1', '+x+1,+z+1/2,+y+1', '-x+1,+z+1/2,-y+1', '-x+1,-z+1/2,+y+1', '+x+1,-z+1/2,-y+1', '+z+1,+y+1/2,+x+1', '+z+1,-y+1/2,-x+1', '-z+1,+y+1/2,-x+1', '-z+1,-y+1/2,+x+1', '+x+1/2,+y+1/2,+z', '-x+1/2,-y+1/2,+z', '-x+1/2,+y+1/2,-z', '+x+1/2,-y+1/2,-z', '+z+1/2,+x+1/2,+y', '+z+1/2,-x+1/2,-y', '-z+1/2,-x+1/2,+y', '-z+1/2,+x+1/2,-y', '+y+1/2,+z+1/2,+x', '-y+1/2,+z+1/2,-x', '+y+1/2,-z+1/2,-x', '-y+1/2,-z+1/2,+x', '+y+1,+x+1,+z+1/2', '-y+1,-x+1,+z+1/2', '+y+1,-x+1,-z+1/2', '-y+1,+x+1,-z+1/2', '+x+1,+z+1,+y+1/2', '-x+1,+z+1,-y+1/2', '-x+1,-z+1,+y+1/2', '+x+1,-z+1,-y+1/2', '+z+1,+y+1,+x+1/2', '+z+1,-y+1,-x+1/2', '-z+1,+y+1,-x+1/2', '-z+1,-y+1,+x+1/2'], [220, 1, '     I-43d', 'Cubic', '+x,+y,+z', '-x+1/2,-y,+z+1/2', '-x,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,-z', '+z,+x,+y', '+z+1/2,-x+1/2,-y', '-z+1/2,-x,+y+1/2', '-z,+x+1/2,-y+1/2', '+y,+z,+x', '-y,+z+1/2,-x+1/2', '+y+1/2,-z+1/2,-x', '-y+1/2,-z,+x+1/2', '+y+1/4,+x+1/4,+z+1/4', '-y+1/4,-x+3/4,+z+3/4', '+y+3/4,-x+1/4,-z+3/4', '-y+3/4,+x+3/4,-z+1/4', '+x+1/4,+z+1/4,+y+1/4', '-x+3/4,+z+3/4,-y+1/4', '-x+1/4,-z+3/4,+y+3/4', '+x+3/4,-z+1/4,-y+3/4', '+z+1/4,+y+1/4,+x+1/4', '+z+3/4,-y+1/4,-x+3/4', '-z+3/4,+y+3/4,-x+1/4', '-z+1/4,-y+3/4,+x+3/4', '+x+1/2,+y+1/2,+z+1/2', '-x+1,-y+1/2,+z+1', '-x+1/2,+y+1,-z+1', '+x+1,-y+1,-z+1/2', '+z+1/2,+x+1/2,+y+1/2', '+z+1,-x+1,-y+1/2', '-z+1,-x+1/2,+y+1', '-z+1/2,+x+1,-y+1', '+y+1/2,+z+1/2,+x+1/2', '-y+1/2,+z+1,-x+1', '+y+1,-z+1,-x+1/2', '-y+1,-z+1/2,+x+1', '+y+3/4,+x+3/4,+z+3/4', '-y+3/4,-x+5/4,+z+5/4', '+y+5/4,-x+3/4,-z+5/4', '-y+5/4,+x+5/4,-z+3/4', '+x+3/4,+z+3/4,+y+3/4', '-x+5/4,+z+5/4,-y+3/4', '-x+3/4,-z+5/4,+y+5/4', '+x+5/4,-z+3/4,-y+5/4', '+z+3/4,+y+3/4,+x+3/4', '+z+5/4,-y+3/4,-x+5/4', '-z+5/4,+y+5/4,-x+3/4', '-z+3/4,-y+5/4,+x+5/4'], [221, 1, '     Pm-3m', 'Cubic', '+x,+y,+z', '-x,-y,+z', '-x,+y,-z', '+x,-y,-z', '+z,+x,+y', '+z,-x,-y', '-z,-x,+y', '-z,+x,-y', '+y,+z,+x', '-y,+z,-x', '+y,-z,-x', '-y,-z,+x', '+y,+x,-z', '-y,-x,-z', '+y,-x,+z', '-y,+x,+z', '+x,+z,-y', '-x,+z,+y', '-x,-z,-y', '+x,-z,+y', '+z,+y,-x', '+z,-y,+x', '-z,+y,+x', '-z,-y,-x', '-x,-y,-z', '+x,+y,-z', '+x,-y,+z', '-x,+y,+z', '-z,-x,-y', '-z,+x,+y', '+z,+x,-y', '+z,-x,+y', '-y,-z,-x', '+y,-z,+x', '-y,+z,+x', '+y,+z,-x', '-y,-x,+z', '+y,+x,+z', '-y,+x,-z', '+y,-x,-z', '-x,-z,+y', '+x,-z,-y', '+x,+z,+y', '-x,+z,-y', '-z,-y,+x', '-z,+y,-x', '+z,-y,-x', '+z,+y,+x'], [222, 1, '     Pn-3n', 'Cubic', '+x,+y,+z', '-x,-y,+z', '-x,+y,-z', '+x,-y,-z', '+z,+x,+y', '+z,-x,-y', '-z,-x,+y', '-z,+x,-y', '+y,+z,+x', '-y,+z,-x', '+y,-z,-x', '-y,-z,+x', '+y,+x,-z', '-y,-x,-z', '+y,-x,+z', '-y,+x,+z', '+x,+z,-y', '-x,+z,+y', '-x,-z,-y', '+x,-z,+y', '+z,+y,-x', '+z,-y,+x', '-z,+y,+x', '-z,-y,-x', '-x+1/2,-y+1/2,-z+1/2', '+x+1/2,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,+z+1/2', '-z+1/2,-x+1/2,-y+1/2', '-z+1/2,+x+1/2,+y+1/2', '+z+1/2,+x+1/2,-y+1/2', '+z+1/2,-x+1/2,+y+1/2', '-y+1/2,-z+1/2,-x+1/2', '+y+1/2,-z+1/2,+x+1/2', '-y+1/2,+z+1/2,+x+1/2', '+y+1/2,+z+1/2,-x+1/2', '-y+1/2,-x+1/2,+z+1/2', '+y+1/2,+x+1/2,+z+1/2', '-y+1/2,+x+1/2,-z+1/2', '+y+1/2,-x+1/2,-z+1/2', '-x+1/2,-z+1/2,+y+1/2', '+x+1/2,-z+1/2,-y+1/2', '+x+1/2,+z+1/2,+y+1/2', '-x+1/2,+z+1/2,-y+1/2', '-z+1/2,-y+1/2,+x+1/2', '-z+1/2,+y+1/2,-x+1/2', '+z+1/2,-y+1/2,-x+1/2', '+z+1/2,+y+1/2,+x+1/2'], [223, 1, '     Pm-3n', 'Cubic', '+x,+y,+z', '-x,-y,+z', '-x,+y,-z', '+x,-y,-z', '+z,+x,+y', '+z,-x,-y', '-z,-x,+y', '-z,+x,-y', '+y,+z,+x', '-y,+z,-x', '+y,-z,-x', '-y,-z,+x', '+y+1/2,+x+1/2,-z+1/2', '-y+1/2,-x+1/2,-z+1/2', '+y+1/2,-x+1/2,+z+1/2', '-y+1/2,+x+1/2,+z+1/2', '+x+1/2,+z+1/2,-y+1/2', '-x+1/2,+z+1/2,+y+1/2', '-x+1/2,-z+1/2,-y+1/2', '+x+1/2,-z+1/2,+y+1/2', '+z+1/2,+y+1/2,-x+1/2', '+z+1/2,-y+1/2,+x+1/2', '-z+1/2,+y+1/2,+x+1/2', '-z+1/2,-y+1/2,-x+1/2', '-x,-y,-z', '+x,+y,-z', '+x,-y,+z', '-x,+y,+z', '-z,-x,-y', '-z,+x,+y', '+z,+x,-y', '+z,-x,+y', '-y,-z,-x', '+y,-z,+x', '-y,+z,+x', '+y,+z,-x', '-y+1/2,-x+1/2,+z+1/2', '+y+1/2,+x+1/2,+z+1/2', '-y+1/2,+x+1/2,-z+1/2', '+y+1/2,-x+1/2,-z+1/2', '-x+1/2,-z+1/2,+y+1/2', '+x+1/2,-z+1/2,-y+1/2', '+x+1/2,+z+1/2,+y+1/2', '-x+1/2,+z+1/2,-y+1/2', '-z+1/2,-y+1/2,+x+1/2', '-z+1/2,+y+1/2,-x+1/2', '+z+1/2,-y+1/2,-x+1/2', '+z+1/2,+y+1/2,+x+1/2'], [224, 1, '     Pn-3m', 'Cubic', '+x,+y,+z', '-x,-y,+z', '-x,+y,-z', '+x,-y,-z', '+z,+x,+y', '+z,-x,-y', '-z,-x,+y', '-z,+x,-y', '+y,+z,+x', '-y,+z,-x', '+y,-z,-x', '-y,-z,+x', '+y+1/2,+x+1/2,-z+1/2', '-y+1/2,-x+1/2,-z+1/2', '+y+1/2,-x+1/2,+z+1/2', '-y+1/2,+x+1/2,+z+1/2', '+x+1/2,+z+1/2,-y+1/2', '-x+1/2,+z+1/2,+y+1/2', '-x+1/2,-z+1/2,-y+1/2', '+x+1/2,-z+1/2,+y+1/2', '+z+1/2,+y+1/2,-x+1/2', '+z+1/2,-y+1/2,+x+1/2', '-z+1/2,+y+1/2,+x+1/2', '-z+1/2,-y+1/2,-x+1/2', '-x+1/2,-y+1/2,-z+1/2', '+x+1/2,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,+z+1/2', '-z+1/2,-x+1/2,-y+1/2', '-z+1/2,+x+1/2,+y+1/2', '+z+1/2,+x+1/2,-y+1/2', '+z+1/2,-x+1/2,+y+1/2', '-y+1/2,-z+1/2,-x+1/2', '+y+1/2,-z+1/2,+x+1/2', '-y+1/2,+z+1/2,+x+1/2', '+y+1/2,+z+1/2,-x+1/2', '-y,-x,+z', '+y,+x,+z', '-y,+x,-z', '+y,-x,-z', '-x,-z,+y', '+x,-z,-y', '+x,+z,+y', '-x,+z,-y', '-z,-y,+x', '-z,+y,-x', '+z,-y,-x', '+z,+y,+x'], [225, 1, '     Fm-3m', 'Cubic', '+x,+y,+z', '-x,-y,+z', '-x,+y,-z', '+x,-y,-z', '+z,+x,+y', '+z,-x,-y', '-z,-x,+y', '-z,+x,-y', '+y,+z,+x', '-y,+z,-x', '+y,-z,-x', '-y,-z,+x', '+y,+x,-z', '-y,-x,-z', '+y,-x,+z', '-y,+x,+z', '+x,+z,-y', '-x,+z,+y', '-x,-z,-y', '+x,-z,+y', '+z,+y,-x', '+z,-y,+x', '-z,+y,+x', '-z,-y,-x', '-x,-y,-z', '+x,+y,-z', '+x,-y,+z', '-x,+y,+z', '-z,-x,-y', '-z,+x,+y', '+z,+x,-y', '+z,-x,+y', '-y,-z,-x', '+y,-z,+x', '-y,+z,+x', '+y,+z,-x', '-y,-x,+z', '+y,+x,+z', '-y,+x,-z', '+y,-x,-z', '-x,-z,+y', '+x,-z,-y', '+x,+z,+y', '-x,+z,-y', '-z,-y,+x', '-z,+y,-x', '+z,-y,-x', '+z,+y,+x', '+x,+y+1/2,+z+1/2', '-x,-y+1/2,+z+1/2', '-x,+y+1/2,-z+1/2', '+x,-y+1/2,-z+1/2', '+z,+x+1/2,+y+1/2', '+z,-x+1/2,-y+1/2', '-z,-x+1/2,+y+1/2', '-z,+x+1/2,-y+1/2', '+y,+z+1/2,+x+1/2', '-y,+z+1/2,-x+1/2', '+y,-z+1/2,-x+1/2', '-y,-z+1/2,+x+1/2', '+y,+x+1/2,-z+1/2', '-y,-x+1/2,-z+1/2', '+y,-x+1/2,+z+1/2', '-y,+x+1/2,+z+1/2', '+x,+z+1/2,-y+1/2', '-x,+z+1/2,+y+1/2', '-x,-z+1/2,-y+1/2', '+x,-z+1/2,+y+1/2', '+z,+y+1/2,-x+1/2', '+z,-y+1/2,+x+1/2', '-z,+y+1/2,+x+1/2', '-z,-y+1/2,-x+1/2', '-x,-y+1/2,-z+1/2', '+x,+y+1/2,-z+1/2', '+x,-y+1/2,+z+1/2', '-x,+y+1/2,+z+1/2', '-z,-x+1/2,-y+1/2', '-z,+x+1/2,+y+1/2', '+z,+x+1/2,-y+1/2', '+z,-x+1/2,+y+1/2', '-y,-z+1/2,-x+1/2', '+y,-z+1/2,+x+1/2', '-y,+z+1/2,+x+1/2', '+y,+z+1/2,-x+1/2', '-y,-x+1/2,+z+1/2', '+y,+x+1/2,+z+1/2', '-y,+x+1/2,-z+1/2', '+y,-x+1/2,-z+1/2', '-x,-z+1/2,+y+1/2', '+x,-z+1/2,-y+1/2', '+x,+z+1/2,+y+1/2', '-x,+z+1/2,-y+1/2', '-z,-y+1/2,+x+1/2', '-z,+y+1/2,-x+1/2', '+z,-y+1/2,-x+1/2', '+z,+y+1/2,+x+1/2', '+x+1/2,+y,+z+1/2', '-x+1/2,-y,+z+1/2', '-x+1/2,+y,-z+1/2', '+x+1/2,-y,-z+1/2', '+z+1/2,+x,+y+1/2', '+z+1/2,-x,-y+1/2', '-z+1/2,-x,+y+1/2', '-z+1/2,+x,-y+1/2', '+y+1/2,+z,+x+1/2', '-y+1/2,+z,-x+1/2', '+y+1/2,-z,-x+1/2', '-y+1/2,-z,+x+1/2', '+y+1/2,+x,-z+1/2', '-y+1/2,-x,-z+1/2', '+y+1/2,-x,+z+1/2', '-y+1/2,+x,+z+1/2', '+x+1/2,+z,-y+1/2', '-x+1/2,+z,+y+1/2', '-x+1/2,-z,-y+1/2', '+x+1/2,-z,+y+1/2', '+z+1/2,+y,-x+1/2', '+z+1/2,-y,+x+1/2', '-z+1/2,+y,+x+1/2', '-z+1/2,-y,-x+1/2', '-x+1/2,-y,-z+1/2', '+x+1/2,+y,-z+1/2', '+x+1/2,-y,+z+1/2', '-x+1/2,+y,+z+1/2', '-z+1/2,-x,-y+1/2', '-z+1/2,+x,+y+1/2', '+z+1/2,+x,-y+1/2', '+z+1/2,-x,+y+1/2', '-y+1/2,-z,-x+1/2', '+y+1/2,-z,+x+1/2', '-y+1/2,+z,+x+1/2', '+y+1/2,+z,-x+1/2', '-y+1/2,-x,+z+1/2', '+y+1/2,+x,+z+1/2', '-y+1/2,+x,-z+1/2', '+y+1/2,-x,-z+1/2', '-x+1/2,-z,+y+1/2', '+x+1/2,-z,-y+1/2', '+x+1/2,+z,+y+1/2', '-x+1/2,+z,-y+1/2', '-z+1/2,-y,+x+1/2', '-z+1/2,+y,-x+1/2', '+z+1/2,-y,-x+1/2', '+z+1/2,+y,+x+1/2', '+x+1/2,+y+1/2,+z', '-x+1/2,-y+1/2,+z', '-x+1/2,+y+1/2,-z', '+x+1/2,-y+1/2,-z', '+z+1/2,+x+1/2,+y', '+z+1/2,-x+1/2,-y', '-z+1/2,-x+1/2,+y', '-z+1/2,+x+1/2,-y', '+y+1/2,+z+1/2,+x', '-y+1/2,+z+1/2,-x', '+y+1/2,-z+1/2,-x', '-y+1/2,-z+1/2,+x', '+y+1/2,+x+1/2,-z', '-y+1/2,-x+1/2,-z', '+y+1/2,-x+1/2,+z', '-y+1/2,+x+1/2,+z', '+x+1/2,+z+1/2,-y', '-x+1/2,+z+1/2,+y', '-x+1/2,-z+1/2,-y', '+x+1/2,-z+1/2,+y', '+z+1/2,+y+1/2,-x', '+z+1/2,-y+1/2,+x', '-z+1/2,+y+1/2,+x', '-z+1/2,-y+1/2,-x', '-x+1/2,-y+1/2,-z', '+x+1/2,+y+1/2,-z', '+x+1/2,-y+1/2,+z', '-x+1/2,+y+1/2,+z', '-z+1/2,-x+1/2,-y', '-z+1/2,+x+1/2,+y', '+z+1/2,+x+1/2,-y', '+z+1/2,-x+1/2,+y', '-y+1/2,-z+1/2,-x', '+y+1/2,-z+1/2,+x', '-y+1/2,+z+1/2,+x', '+y+1/2,+z+1/2,-x', '-y+1/2,-x+1/2,+z', '+y+1/2,+x+1/2,+z', '-y+1/2,+x+1/2,-z', '+y+1/2,-x+1/2,-z', '-x+1/2,-z+1/2,+y', '+x+1/2,-z+1/2,-y', '+x+1/2,+z+1/2,+y', '-x+1/2,+z+1/2,-y', '-z+1/2,-y+1/2,+x', '-z+1/2,+y+1/2,-x', '+z+1/2,-y+1/2,-x', '+z+1/2,+y+1/2,+x'], [226, 1, '     Fm-3c', 'Cubic', '+x,+y,+z', '-x,-y,+z', '-x,+y,-z', '+x,-y,-z', '+z,+x,+y', '+z,-x,-y', '-z,-x,+y', '-z,+x,-y', '+y,+z,+x', '-y,+z,-x', '+y,-z,-x', '-y,-z,+x', '+y+1/2,+x+1/2,-z+1/2', '-y+1/2,-x+1/2,-z+1/2', '+y+1/2,-x+1/2,+z+1/2', '-y+1/2,+x+1/2,+z+1/2', '+x+1/2,+z+1/2,-y+1/2', '-x+1/2,+z+1/2,+y+1/2', '-x+1/2,-z+1/2,-y+1/2', '+x+1/2,-z+1/2,+y+1/2', '+z+1/2,+y+1/2,-x+1/2', '+z+1/2,-y+1/2,+x+1/2', '-z+1/2,+y+1/2,+x+1/2', '-z+1/2,-y+1/2,-x+1/2', '-x,-y,-z', '+x,+y,-z', '+x,-y,+z', '-x,+y,+z', '-z,-x,-y', '-z,+x,+y', '+z,+x,-y', '+z,-x,+y', '-y,-z,-x', '+y,-z,+x', '-y,+z,+x', '+y,+z,-x', '-y+1/2,-x+1/2,+z+1/2', '+y+1/2,+x+1/2,+z+1/2', '-y+1/2,+x+1/2,-z+1/2', '+y+1/2,-x+1/2,-z+1/2', '-x+1/2,-z+1/2,+y+1/2', '+x+1/2,-z+1/2,-y+1/2', '+x+1/2,+z+1/2,+y+1/2', '-x+1/2,+z+1/2,-y+1/2', '-z+1/2,-y+1/2,+x+1/2', '-z+1/2,+y+1/2,-x+1/2', '+z+1/2,-y+1/2,-x+1/2', '+z+1/2,+y+1/2,+x+1/2', '+x,+y+1/2,+z+1/2', '-x,-y+1/2,+z+1/2', '-x,+y+1/2,-z+1/2', '+x,-y+1/2,-z+1/2', '+z,+x+1/2,+y+1/2', '+z,-x+1/2,-y+1/2', '-z,-x+1/2,+y+1/2', '-z,+x+1/2,-y+1/2', '+y,+z+1/2,+x+1/2', '-y,+z+1/2,-x+1/2', '+y,-z+1/2,-x+1/2', '-y,-z+1/2,+x+1/2', '+y+1/2,+x+1,-z+1', '-y+1/2,-x+1,-z+1', '+y+1/2,-x+1,+z+1', '-y+1/2,+x+1,+z+1', '+x+1/2,+z+1,-y+1', '-x+1/2,+z+1,+y+1', '-x+1/2,-z+1,-y+1', '+x+1/2,-z+1,+y+1', '+z+1/2,+y+1,-x+1', '+z+1/2,-y+1,+x+1', '-z+1/2,+y+1,+x+1', '-z+1/2,-y+1,-x+1', '-x,-y+1/2,-z+1/2', '+x,+y+1/2,-z+1/2', '+x,-y+1/2,+z+1/2', '-x,+y+1/2,+z+1/2', '-z,-x+1/2,-y+1/2', '-z,+x+1/2,+y+1/2', '+z,+x+1/2,-y+1/2', '+z,-x+1/2,+y+1/2', '-y,-z+1/2,-x+1/2', '+y,-z+1/2,+x+1/2', '-y,+z+1/2,+x+1/2', '+y,+z+1/2,-x+1/2', '-y+1/2,-x+1,+z+1', '+y+1/2,+x+1,+z+1', '-y+1/2,+x+1,-z+1', '+y+1/2,-x+1,-z+1', '-x+1/2,-z+1,+y+1', '+x+1/2,-z+1,-y+1', '+x+1/2,+z+1,+y+1', '-x+1/2,+z+1,-y+1', '-z+1/2,-y+1,+x+1', '-z+1/2,+y+1,-x+1', '+z+1/2,-y+1,-x+1', '+z+1/2,+y+1,+x+1', '+x+1/2,+y,+z+1/2', '-x+1/2,-y,+z+1/2', '-x+1/2,+y,-z+1/2', '+x+1/2,-y,-z+1/2', '+z+1/2,+x,+y+1/2', '+z+1/2,-x,-y+1/2', '-z+1/2,-x,+y+1/2', '-z+1/2,+x,-y+1/2', '+y+1/2,+z,+x+1/2', '-y+1/2,+z,-x+1/2', '+y+1/2,-z,-x+1/2', '-y+1/2,-z,+x+1/2', '+y+1,+x+1/2,-z+1', '-y+1,-x+1/2,-z+1', '+y+1,-x+1/2,+z+1', '-y+1,+x+1/2,+z+1', '+x+1,+z+1/2,-y+1', '-x+1,+z+1/2,+y+1', '-x+1,-z+1/2,-y+1', '+x+1,-z+1/2,+y+1', '+z+1,+y+1/2,-x+1', '+z+1,-y+1/2,+x+1', '-z+1,+y+1/2,+x+1', '-z+1,-y+1/2,-x+1', '-x+1/2,-y,-z+1/2', '+x+1/2,+y,-z+1/2', '+x+1/2,-y,+z+1/2', '-x+1/2,+y,+z+1/2', '-z+1/2,-x,-y+1/2', '-z+1/2,+x,+y+1/2', '+z+1/2,+x,-y+1/2', '+z+1/2,-x,+y+1/2', '-y+1/2,-z,-x+1/2', '+y+1/2,-z,+x+1/2', '-y+1/2,+z,+x+1/2', '+y+1/2,+z,-x+1/2', '-y+1,-x+1/2,+z+1', '+y+1,+x+1/2,+z+1', '-y+1,+x+1/2,-z+1', '+y+1,-x+1/2,-z+1', '-x+1,-z+1/2,+y+1', '+x+1,-z+1/2,-y+1', '+x+1,+z+1/2,+y+1', '-x+1,+z+1/2,-y+1', '-z+1,-y+1/2,+x+1', '-z+1,+y+1/2,-x+1', '+z+1,-y+1/2,-x+1', '+z+1,+y+1/2,+x+1', '+x+1/2,+y+1/2,+z', '-x+1/2,-y+1/2,+z', '-x+1/2,+y+1/2,-z', '+x+1/2,-y+1/2,-z', '+z+1/2,+x+1/2,+y', '+z+1/2,-x+1/2,-y', '-z+1/2,-x+1/2,+y', '-z+1/2,+x+1/2,-y', '+y+1/2,+z+1/2,+x', '-y+1/2,+z+1/2,-x', '+y+1/2,-z+1/2,-x', '-y+1/2,-z+1/2,+x', '+y+1,+x+1,-z+1/2', '-y+1,-x+1,-z+1/2', '+y+1,-x+1,+z+1/2', '-y+1,+x+1,+z+1/2', '+x+1,+z+1,-y+1/2', '-x+1,+z+1,+y+1/2', '-x+1,-z+1,-y+1/2', '+x+1,-z+1,+y+1/2', '+z+1,+y+1,-x+1/2', '+z+1,-y+1,+x+1/2', '-z+1,+y+1,+x+1/2', '-z+1,-y+1,-x+1/2', '-x+1/2,-y+1/2,-z', '+x+1/2,+y+1/2,-z', '+x+1/2,-y+1/2,+z', '-x+1/2,+y+1/2,+z', '-z+1/2,-x+1/2,-y', '-z+1/2,+x+1/2,+y', '+z+1/2,+x+1/2,-y', '+z+1/2,-x+1/2,+y', '-y+1/2,-z+1/2,-x', '+y+1/2,-z+1/2,+x', '-y+1/2,+z+1/2,+x', '+y+1/2,+z+1/2,-x', '-y+1,-x+1,+z+1/2', '+y+1,+x+1,+z+1/2', '-y+1,+x+1,-z+1/2', '+y+1,-x+1,-z+1/2', '-x+1,-z+1,+y+1/2', '+x+1,-z+1,-y+1/2', '+x+1,+z+1,+y+1/2', '-x+1,+z+1,-y+1/2', '-z+1,-y+1,+x+1/2', '-z+1,+y+1,-x+1/2', '+z+1,-y+1,-x+1/2', '+z+1,+y+1,+x+1/2'], [227, 1, '     Fd-3m', 'Cubic', '+x,+y,+z', '-x,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,-z', '+x+1/2,-y,-z+1/2', '+z,+x,+y', '+z+1/2,-x,-y+1/2', '-z,-x+1/2,+y+1/2', '-z+1/2,+x+1/2,-y', '+y,+z,+x', '-y+1/2,+z+1/2,-x', '+y+1/2,-z,-x+1/2', '-y,-z+1/2,+x+1/2', '+y+3/4,+x+1/4,-z+3/4', '-y+1/4,-x+1/4,-z+1/4', '+y+1/4,-x+3/4,+z+3/4', '-y+3/4,+x+3/4,+z+1/4', '+x+3/4,+z+1/4,-y+3/4', '-x+3/4,+z+3/4,+y+1/4', '-x+1/4,-z+1/4,-y+1/4', '+x+1/4,-z+3/4,+y+3/4', '+z+3/4,+y+1/4,-x+3/4', '+z+1/4,-y+3/4,+x+3/4', '-z+3/4,+y+3/4,+x+1/4', '-z+1/4,-y+1/4,-x+1/4', '-x+1/4,-y+1/4,-z+1/4', '+x+1/4,+y+3/4,-z+3/4', '+x+3/4,-y+3/4,+z+1/4', '-x+3/4,+y+1/4,+z+3/4', '-z+1/4,-x+1/4,-y+1/4', '-z+3/4,+x+1/4,+y+3/4', '+z+1/4,+x+3/4,-y+3/4', '+z+3/4,-x+3/4,+y+1/4', '-y+1/4,-z+1/4,-x+1/4', '+y+3/4,-z+3/4,+x+1/4', '-y+3/4,+z+1/4,+x+3/4', '+y+1/4,+z+3/4,-x+3/4', '-y+1/2,-x,+z+1/2', '+y,+x,+z', '-y,+x+1/2,-z+1/2', '+y+1/2,-x+1/2,-z', '-x+1/2,-z,+y+1/2', '+x+1/2,-z+1/2,-y', '+x,+z,+y', '-x,+z+1/2,-y+1/2', '-z+1/2,-y,+x+1/2', '-z,+y+1/2,-x+1/2', '+z+1/2,-y+1/2,-x', '+z,+y,+x', '+x,+y+1/2,+z+1/2', '-x,-y+1,+z+1', '-x+1/2,+y+1,-z+1/2', '+x+1/2,-y+1/2,-z+1', '+z,+x+1/2,+y+1/2', '+z+1/2,-x+1/2,-y+1', '-z,-x+1,+y+1', '-z+1/2,+x+1,-y+1/2', '+y,+z+1/2,+x+1/2', '-y+1/2,+z+1,-x+1/2', '+y+1/2,-z+1/2,-x+1', '-y,-z+1,+x+1', '+y+3/4,+x+3/4,-z+5/4', '-y+1/4,-x+3/4,-z+3/4', '+y+1/4,-x+5/4,+z+5/4', '-y+3/4,+x+5/4,+z+3/4', '+x+3/4,+z+3/4,-y+5/4', '-x+3/4,+z+5/4,+y+3/4', '-x+1/4,-z+3/4,-y+3/4', '+x+1/4,-z+5/4,+y+5/4', '+z+3/4,+y+3/4,-x+5/4', '+z+1/4,-y+5/4,+x+5/4', '-z+3/4,+y+5/4,+x+3/4', '-z+1/4,-y+3/4,-x+3/4', '-x+1/4,-y+3/4,-z+3/4', '+x+1/4,+y+5/4,-z+5/4', '+x+3/4,-y+5/4,+z+3/4', '-x+3/4,+y+3/4,+z+5/4', '-z+1/4,-x+3/4,-y+3/4', '-z+3/4,+x+3/4,+y+5/4', '+z+1/4,+x+5/4,-y+5/4', '+z+3/4,-x+5/4,+y+3/4', '-y+1/4,-z+3/4,-x+3/4', '+y+3/4,-z+5/4,+x+3/4', '-y+3/4,+z+3/4,+x+5/4', '+y+1/4,+z+5/4,-x+5/4', '-y+1/2,-x+1/2,+z+1', '+y,+x+1/2,+z+1/2', '-y,+x+1,-z+1', '+y+1/2,-x+1,-z+1/2', '-x+1/2,-z+1/2,+y+1', '+x+1/2,-z+1,-y+1/2', '+x,+z+1/2,+y+1/2', '-x,+z+1,-y+1', '-z+1/2,-y+1/2,+x+1', '-z,+y+1,-x+1', '+z+1/2,-y+1,-x+1/2', '+z,+y+1/2,+x+1/2', '+x+1/2,+y,+z+1/2', '-x+1/2,-y+1/2,+z+1', '-x+1,+y+1/2,-z+1/2', '+x+1,-y,-z+1', '+z+1/2,+x,+y+1/2', '+z+1,-x,-y+1', '-z+1/2,-x+1/2,+y+1', '-z+1,+x+1/2,-y+1/2', '+y+1/2,+z,+x+1/2', '-y+1,+z+1/2,-x+1/2', '+y+1,-z,-x+1', '-y+1/2,-z+1/2,+x+1', '+y+5/4,+x+1/4,-z+5/4', '-y+3/4,-x+1/4,-z+3/4', '+y+3/4,-x+3/4,+z+5/4', '-y+5/4,+x+3/4,+z+3/4', '+x+5/4,+z+1/4,-y+5/4', '-x+5/4,+z+3/4,+y+3/4', '-x+3/4,-z+1/4,-y+3/4', '+x+3/4,-z+3/4,+y+5/4', '+z+5/4,+y+1/4,-x+5/4', '+z+3/4,-y+3/4,+x+5/4', '-z+5/4,+y+3/4,+x+3/4', '-z+3/4,-y+1/4,-x+3/4', '-x+3/4,-y+1/4,-z+3/4', '+x+3/4,+y+3/4,-z+5/4', '+x+5/4,-y+3/4,+z+3/4', '-x+5/4,+y+1/4,+z+5/4', '-z+3/4,-x+1/4,-y+3/4', '-z+5/4,+x+1/4,+y+5/4', '+z+3/4,+x+3/4,-y+5/4', '+z+5/4,-x+3/4,+y+3/4', '-y+3/4,-z+1/4,-x+3/4', '+y+5/4,-z+3/4,+x+3/4', '-y+5/4,+z+1/4,+x+5/4', '+y+3/4,+z+3/4,-x+5/4', '-y+1,-x,+z+1', '+y+1/2,+x,+z+1/2', '-y+1/2,+x+1/2,-z+1', '+y+1,-x+1/2,-z+1/2', '-x+1,-z,+y+1', '+x+1,-z+1/2,-y+1/2', '+x+1/2,+z,+y+1/2', '-x+1/2,+z+1/2,-y+1', '-z+1,-y,+x+1', '-z+1/2,+y+1/2,-x+1', '+z+1,-y+1/2,-x+1/2', '+z+1/2,+y,+x+1/2', '+x+1/2,+y+1/2,+z', '-x+1/2,-y+1,+z+1/2', '-x+1,+y+1,-z', '+x+1,-y+1/2,-z+1/2', '+z+1/2,+x+1/2,+y', '+z+1,-x+1/2,-y+1/2', '-z+1/2,-x+1,+y+1/2', '-z+1,+x+1,-y', '+y+1/2,+z+1/2,+x', '-y+1,+z+1,-x', '+y+1,-z+1/2,-x+1/2', '-y+1/2,-z+1,+x+1/2', '+y+5/4,+x+3/4,-z+3/4', '-y+3/4,-x+3/4,-z+1/4', '+y+3/4,-x+5/4,+z+3/4', '-y+5/4,+x+5/4,+z+1/4', '+x+5/4,+z+3/4,-y+3/4', '-x+5/4,+z+5/4,+y+1/4', '-x+3/4,-z+3/4,-y+1/4', '+x+3/4,-z+5/4,+y+3/4', '+z+5/4,+y+3/4,-x+3/4', '+z+3/4,-y+5/4,+x+3/4', '-z+5/4,+y+5/4,+x+1/4', '-z+3/4,-y+3/4,-x+1/4', '-x+3/4,-y+3/4,-z+1/4', '+x+3/4,+y+5/4,-z+3/4', '+x+5/4,-y+5/4,+z+1/4', '-x+5/4,+y+3/4,+z+3/4', '-z+3/4,-x+3/4,-y+1/4', '-z+5/4,+x+3/4,+y+3/4', '+z+3/4,+x+5/4,-y+3/4', '+z+5/4,-x+5/4,+y+1/4', '-y+3/4,-z+3/4,-x+1/4', '+y+5/4,-z+5/4,+x+1/4', '-y+5/4,+z+3/4,+x+3/4', '+y+3/4,+z+5/4,-x+3/4', '-y+1,-x+1/2,+z+1/2', '+y+1/2,+x+1/2,+z', '-y+1/2,+x+1,-z+1/2', '+y+1,-x+1,-z', '-x+1,-z+1/2,+y+1/2', '+x+1,-z+1,-y', '+x+1/2,+z+1/2,+y', '-x+1/2,+z+1,-y+1/2', '-z+1,-y+1/2,+x+1/2', '-z+1/2,+y+1,-x+1/2', '+z+1,-y+1,-x', '+z+1/2,+y+1/2,+x'], [228, 1, '     Fd-3c', 'Cubic', '+x,+y,+z', '-x,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,-z', '+x+1/2,-y,-z+1/2', '+z,+x,+y', '+z+1/2,-x,-y+1/2', '-z,-x+1/2,+y+1/2', '-z+1/2,+x+1/2,-y', '+y,+z,+x', '-y+1/2,+z+1/2,-x', '+y+1/2,-z,-x+1/2', '-y,-z+1/2,+x+1/2', '+y+3/4,+x+1/4,-z+3/4', '-y+1/4,-x+1/4,-z+1/4', '+y+1/4,-x+3/4,+z+3/4', '-y+3/4,+x+3/4,+z+1/4', '+x+3/4,+z+1/4,-y+3/4', '-x+3/4,+z+3/4,+y+1/4', '-x+1/4,-z+1/4,-y+1/4', '+x+1/4,-z+3/4,+y+3/4', '+z+3/4,+y+1/4,-x+3/4', '+z+1/4,-y+3/4,+x+3/4', '-z+3/4,+y+3/4,+x+1/4', '-z+1/4,-y+1/4,-x+1/4', '-x+3/4,-y+3/4,-z+3/4', '+x+3/4,+y+1/4,-z+1/4', '+x+1/4,-y+1/4,+z+3/4', '-x+1/4,+y+3/4,+z+1/4', '-z+3/4,-x+3/4,-y+3/4', '-z+1/4,+x+3/4,+y+1/4', '+z+3/4,+x+1/4,-y+1/4', '+z+1/4,-x+1/4,+y+3/4', '-y+3/4,-z+3/4,-x+3/4', '+y+1/4,-z+1/4,+x+3/4', '-y+1/4,+z+3/4,+x+1/4', '+y+3/4,+z+1/4,-x+1/4', '-y,-x+1/2,+z', '+y+1/2,+x+1/2,+z+1/2', '-y+1/2,+x,-z', '+y,-x,-z+1/2', '-x,-z+1/2,+y', '+x,-z,-y+1/2', '+x+1/2,+z+1/2,+y+1/2', '-x+1/2,+z,-y', '-z,-y+1/2,+x', '-z+1/2,+y,-x', '+z,-y,-x+1/2', '+z+1/2,+y+1/2,+x+1/2', '+x,+y+1/2,+z+1/2', '-x,-y+1,+z+1', '-x+1/2,+y+1,-z+1/2', '+x+1/2,-y+1/2,-z+1', '+z,+x+1/2,+y+1/2', '+z+1/2,-x+1/2,-y+1', '-z,-x+1,+y+1', '-z+1/2,+x+1,-y+1/2', '+y,+z+1/2,+x+1/2', '-y+1/2,+z+1,-x+1/2', '+y+1/2,-z+1/2,-x+1', '-y,-z+1,+x+1', '+y+3/4,+x+3/4,-z+5/4', '-y+1/4,-x+3/4,-z+3/4', '+y+1/4,-x+5/4,+z+5/4', '-y+3/4,+x+5/4,+z+3/4', '+x+3/4,+z+3/4,-y+5/4', '-x+3/4,+z+5/4,+y+3/4', '-x+1/4,-z+3/4,-y+3/4', '+x+1/4,-z+5/4,+y+5/4', '+z+3/4,+y+3/4,-x+5/4', '+z+1/4,-y+5/4,+x+5/4', '-z+3/4,+y+5/4,+x+3/4', '-z+1/4,-y+3/4,-x+3/4', '-x+3/4,-y+5/4,-z+5/4', '+x+3/4,+y+3/4,-z+3/4', '+x+1/4,-y+3/4,+z+5/4', '-x+1/4,+y+5/4,+z+3/4', '-z+3/4,-x+5/4,-y+5/4', '-z+1/4,+x+5/4,+y+3/4', '+z+3/4,+x+3/4,-y+3/4', '+z+1/4,-x+3/4,+y+5/4', '-y+3/4,-z+5/4,-x+5/4', '+y+1/4,-z+3/4,+x+5/4', '-y+1/4,+z+5/4,+x+3/4', '+y+3/4,+z+3/4,-x+3/4', '-y,-x+1,+z+1/2', '+y+1/2,+x+1,+z+1', '-y+1/2,+x+1/2,-z+1/2', '+y,-x+1/2,-z+1', '-x,-z+1,+y+1/2', '+x,-z+1/2,-y+1', '+x+1/2,+z+1,+y+1', '-x+1/2,+z+1/2,-y+1/2', '-z,-y+1,+x+1/2', '-z+1/2,+y+1/2,-x+1/2', '+z,-y+1/2,-x+1', '+z+1/2,+y+1,+x+1', '+x+1/2,+y,+z+1/2', '-x+1/2,-y+1/2,+z+1', '-x+1,+y+1/2,-z+1/2', '+x+1,-y,-z+1', '+z+1/2,+x,+y+1/2', '+z+1,-x,-y+1', '-z+1/2,-x+1/2,+y+1', '-z+1,+x+1/2,-y+1/2', '+y+1/2,+z,+x+1/2', '-y+1,+z+1/2,-x+1/2', '+y+1,-z,-x+1', '-y+1/2,-z+1/2,+x+1', '+y+5/4,+x+1/4,-z+5/4', '-y+3/4,-x+1/4,-z+3/4', '+y+3/4,-x+3/4,+z+5/4', '-y+5/4,+x+3/4,+z+3/4', '+x+5/4,+z+1/4,-y+5/4', '-x+5/4,+z+3/4,+y+3/4', '-x+3/4,-z+1/4,-y+3/4', '+x+3/4,-z+3/4,+y+5/4', '+z+5/4,+y+1/4,-x+5/4', '+z+3/4,-y+3/4,+x+5/4', '-z+5/4,+y+3/4,+x+3/4', '-z+3/4,-y+1/4,-x+3/4', '-x+5/4,-y+3/4,-z+5/4', '+x+5/4,+y+1/4,-z+3/4', '+x+3/4,-y+1/4,+z+5/4', '-x+3/4,+y+3/4,+z+3/4', '-z+5/4,-x+3/4,-y+5/4', '-z+3/4,+x+3/4,+y+3/4', '+z+5/4,+x+1/4,-y+3/4', '+z+3/4,-x+1/4,+y+5/4', '-y+5/4,-z+3/4,-x+5/4', '+y+3/4,-z+1/4,+x+5/4', '-y+3/4,+z+3/4,+x+3/4', '+y+5/4,+z+1/4,-x+3/4', '-y+1/2,-x+1/2,+z+1/2', '+y+1,+x+1/2,+z+1', '-y+1,+x,-z+1/2', '+y+1/2,-x,-z+1', '-x+1/2,-z+1/2,+y+1/2', '+x+1/2,-z,-y+1', '+x+1,+z+1/2,+y+1', '-x+1,+z,-y+1/2', '-z+1/2,-y+1/2,+x+1/2', '-z+1,+y,-x+1/2', '+z+1/2,-y,-x+1', '+z+1,+y+1/2,+x+1', '+x+1/2,+y+1/2,+z', '-x+1/2,-y+1,+z+1/2', '-x+1,+y+1,-z', '+x+1,-y+1/2,-z+1/2', '+z+1/2,+x+1/2,+y', '+z+1,-x+1/2,-y+1/2', '-z+1/2,-x+1,+y+1/2', '-z+1,+x+1,-y', '+y+1/2,+z+1/2,+x', '-y+1,+z+1,-x', '+y+1,-z+1/2,-x+1/2', '-y+1/2,-z+1,+x+1/2', '+y+5/4,+x+3/4,-z+3/4', '-y+3/4,-x+3/4,-z+1/4', '+y+3/4,-x+5/4,+z+3/4', '-y+5/4,+x+5/4,+z+1/4', '+x+5/4,+z+3/4,-y+3/4', '-x+5/4,+z+5/4,+y+1/4', '-x+3/4,-z+3/4,-y+1/4', '+x+3/4,-z+5/4,+y+3/4', '+z+5/4,+y+3/4,-x+3/4', '+z+3/4,-y+5/4,+x+3/4', '-z+5/4,+y+5/4,+x+1/4', '-z+3/4,-y+3/4,-x+1/4', '-x+5/4,-y+5/4,-z+3/4', '+x+5/4,+y+3/4,-z+1/4', '+x+3/4,-y+3/4,+z+3/4', '-x+3/4,+y+5/4,+z+1/4', '-z+5/4,-x+5/4,-y+3/4', '-z+3/4,+x+5/4,+y+1/4', '+z+5/4,+x+3/4,-y+1/4', '+z+3/4,-x+3/4,+y+3/4', '-y+5/4,-z+5/4,-x+3/4', '+y+3/4,-z+3/4,+x+3/4', '-y+3/4,+z+5/4,+x+1/4', '+y+5/4,+z+3/4,-x+1/4', '-y+1/2,-x+1,+z', '+y+1,+x+1,+z+1/2', '-y+1,+x+1/2,-z', '+y+1/2,-x+1/2,-z+1/2', '-x+1/2,-z+1,+y', '+x+1/2,-z+1/2,-y+1/2', '+x+1,+z+1,+y+1/2', '-x+1,+z+1/2,-y', '-z+1/2,-y+1,+x', '-z+1,+y+1/2,-x', '+z+1/2,-y+1/2,-x+1/2', '+z+1,+y+1,+x+1/2'], [229, 1, '     Im-3m', 'Cubic', '+x,+y,+z', '-x,-y,+z', '-x,+y,-z', '+x,-y,-z', '+z,+x,+y', '+z,-x,-y', '-z,-x,+y', '-z,+x,-y', '+y,+z,+x', '-y,+z,-x', '+y,-z,-x', '-y,-z,+x', '+y,+x,-z', '-y,-x,-z', '+y,-x,+z', '-y,+x,+z', '+x,+z,-y', '-x,+z,+y', '-x,-z,-y', '+x,-z,+y', '+z,+y,-x', '+z,-y,+x', '-z,+y,+x', '-z,-y,-x', '-x,-y,-z', '+x,+y,-z', '+x,-y,+z', '-x,+y,+z', '-z,-x,-y', '-z,+x,+y', '+z,+x,-y', '+z,-x,+y', '-y,-z,-x', '+y,-z,+x', '-y,+z,+x', '+y,+z,-x', '-y,-x,+z', '+y,+x,+z', '-y,+x,-z', '+y,-x,-z', '-x,-z,+y', '+x,-z,-y', '+x,+z,+y', '-x,+z,-y', '-z,-y,+x', '-z,+y,-x', '+z,-y,-x', '+z,+y,+x', '+x+1/2,+y+1/2,+z+1/2', '-x+1/2,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,-z+1/2', '+z+1/2,+x+1/2,+y+1/2', '+z+1/2,-x+1/2,-y+1/2', '-z+1/2,-x+1/2,+y+1/2', '-z+1/2,+x+1/2,-y+1/2', '+y+1/2,+z+1/2,+x+1/2', '-y+1/2,+z+1/2,-x+1/2', '+y+1/2,-z+1/2,-x+1/2', '-y+1/2,-z+1/2,+x+1/2', '+y+1/2,+x+1/2,-z+1/2', '-y+1/2,-x+1/2,-z+1/2', '+y+1/2,-x+1/2,+z+1/2', '-y+1/2,+x+1/2,+z+1/2', '+x+1/2,+z+1/2,-y+1/2', '-x+1/2,+z+1/2,+y+1/2', '-x+1/2,-z+1/2,-y+1/2', '+x+1/2,-z+1/2,+y+1/2', '+z+1/2,+y+1/2,-x+1/2', '+z+1/2,-y+1/2,+x+1/2', '-z+1/2,+y+1/2,+x+1/2', '-z+1/2,-y+1/2,-x+1/2', '-x+1/2,-y+1/2,-z+1/2', '+x+1/2,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,+z+1/2', '-z+1/2,-x+1/2,-y+1/2', '-z+1/2,+x+1/2,+y+1/2', '+z+1/2,+x+1/2,-y+1/2', '+z+1/2,-x+1/2,+y+1/2', '-y+1/2,-z+1/2,-x+1/2', '+y+1/2,-z+1/2,+x+1/2', '-y+1/2,+z+1/2,+x+1/2', '+y+1/2,+z+1/2,-x+1/2', '-y+1/2,-x+1/2,+z+1/2', '+y+1/2,+x+1/2,+z+1/2', '-y+1/2,+x+1/2,-z+1/2', '+y+1/2,-x+1/2,-z+1/2', '-x+1/2,-z+1/2,+y+1/2', '+x+1/2,-z+1/2,-y+1/2', '+x+1/2,+z+1/2,+y+1/2', '-x+1/2,+z+1/2,-y+1/2', '-z+1/2,-y+1/2,+x+1/2', '-z+1/2,+y+1/2,-x+1/2', '+z+1/2,-y+1/2,-x+1/2', '+z+1/2,+y+1/2,+x+1/2'], [230, 1, '     Ia-3d', 'Cubic', '+x,+y,+z', '-x+1/2,-y,+z+1/2', '-x,+y+1/2,-z+1/2', '+x+1/2,-y+1/2,-z', '+z,+x,+y', '+z+1/2,-x+1/2,-y', '-z+1/2,-x,+y+1/2', '-z,+x+1/2,-y+1/2', '+y,+z,+x', '-y,+z+1/2,-x+1/2', '+y+1/2,-z+1/2,-x', '-y+1/2,-z,+x+1/2', '+y+3/4,+x+1/4,-z+1/4', '-y+3/4,-x+3/4,-z+3/4', '+y+1/4,-x+1/4,+z+3/4', '-y+1/4,+x+3/4,+z+1/4', '+x+3/4,+z+1/4,-y+1/4', '-x+1/4,+z+3/4,+y+1/4', '-x+3/4,-z+3/4,-y+3/4', '+x+1/4,-z+1/4,+y+3/4', '+z+3/4,+y+1/4,-x+1/4', '+z+1/4,-y+1/4,+x+3/4', '-z+1/4,+y+3/4,+x+1/4', '-z+3/4,-y+3/4,-x+3/4', '-x,-y,-z', '+x+1/2,+y,-z+1/2', '+x,-y+1/2,+z+1/2', '-x+1/2,+y+1/2,+z', '-z,-x,-y', '-z+1/2,+x+1/2,+y', '+z+1/2,+x,-y+1/2', '+z,-x+1/2,+y+1/2', '-y,-z,-x', '+y,-z+1/2,+x+1/2', '-y+1/2,+z+1/2,+x', '+y+1/2,+z,-x+1/2', '-y+1/4,-x+3/4,+z+3/4', '+y+1/4,+x+1/4,+z+1/4', '-y+3/4,+x+3/4,-z+1/4', '+y+3/4,-x+1/4,-z+3/4', '-x+1/4,-z+3/4,+y+3/4', '+x+3/4,-z+1/4,-y+3/4', '+x+1/4,+z+1/4,+y+1/4', '-x+3/4,+z+3/4,-y+1/4', '-z+1/4,-y+3/4,+x+3/4', '-z+3/4,+y+3/4,-x+1/4', '+z+3/4,-y+1/4,-x+3/4', '+z+1/4,+y+1/4,+x+1/4', '+x+1/2,+y+1/2,+z+1/2', '-x+1,-y+1/2,+z+1', '-x+1/2,+y+1,-z+1', '+x+1,-y+1,-z+1/2', '+z+1/2,+x+1/2,+y+1/2', '+z+1,-x+1,-y+1/2', '-z+1,-x+1/2,+y+1', '-z+1/2,+x+1,-y+1', '+y+1/2,+z+1/2,+x+1/2', '-y+1/2,+z+1,-x+1', '+y+1,-z+1,-x+1/2', '-y+1,-z+1/2,+x+1', '+y+5/4,+x+3/4,-z+3/4', '-y+5/4,-x+5/4,-z+5/4', '+y+3/4,-x+3/4,+z+5/4', '-y+3/4,+x+5/4,+z+3/4', '+x+5/4,+z+3/4,-y+3/4', '-x+3/4,+z+5/4,+y+3/4', '-x+5/4,-z+5/4,-y+5/4', '+x+3/4,-z+3/4,+y+5/4', '+z+5/4,+y+3/4,-x+3/4', '+z+3/4,-y+3/4,+x+5/4', '-z+3/4,+y+5/4,+x+3/4', '-z+5/4,-y+5/4,-x+5/4', '-x+1/2,-y+1/2,-z+1/2', '+x+1,+y+1/2,-z+1', '+x+1/2,-y+1,+z+1', '-x+1,+y+1,+z+1/2', '-z+1/2,-x+1/2,-y+1/2', '-z+1,+x+1,+y+1/2', '+z+1,+x+1/2,-y+1', '+z+1/2,-x+1,+y+1', '-y+1/2,-z+1/2,-x+1/2', '+y+1/2,-z+1,+x+1', '-y+1,+z+1,+x+1/2', '+y+1,+z+1/2,-x+1', '-y+3/4,-x+5/4,+z+5/4', '+y+3/4,+x+3/4,+z+3/4', '-y+5/4,+x+5/4,-z+3/4', '+y+5/4,-x+3/4,-z+5/4', '-x+3/4,-z+5/4,+y+5/4', '+x+5/4,-z+3/4,-y+5/4', '+x+3/4,+z+3/4,+y+3/4', '-x+5/4,+z+5/4,-y+3/4', '-z+3/4,-y+5/4,+x+5/4', '-z+5/4,+y+5/4,-x+3/4', '+z+5/4,-y+3/4,-x+5/4', '+z+3/4,+y+3/4,+x+3/4']]

              // symmetry here
              var symops,nops,j,groupfound,setting,gname,cname,groupname,groupnumber;

              groupname = "P1";
              if (data.includes("_symmetry_space_group_name_H-M")) {
                 groupname = data.split("_symmetry_space_group_name_H-M")[1].split("\n")[0].trim();
              } 
              groupnumber = 1;
              if (data.includes("_space_group_IT_number")) {
                 groupnumber = data.split("_space_group_IT_number")[1].split("\n")[0].trim();
              }
              cname = "Triclinic"
              if (data.includes("_symmetry_cell_setting")) {
                 cname = jsUcfirst(data.split("_symmetry_cell_setting")[1].split("\n")[0].trim());
              }
           
              symops = ["x,y,z"];
              if (data.includes("_symmetry_equiv_pos_as_xyz") || data.includes("_space_group_symop_operation_xyz")) {
                 if (data.includes("_symmetry_equiv_pos_as_xyz")) {
                    symops = []; 
                    j = data.split("_symmetry_equiv_pos_as_xyz")[0].split("loop_")[1].trim().split("\n").length;
                    console.log("symops j=",j);
                    var tmp = data.split("_symmetry_equiv_pos_as_xyz")[1].split("loop_")[0].trim().replace(/'/g,"").split("\n");
                    for (var jj=0; jj<tmp.length; ++jj) {
                       var tmp2 = tmp[jj].trim();
                       if (tmp2.includes(" ")) {
                          tmp2  = tmp2.split(/\s+/)[j];
                       } 
                       symops.push(tmp2);
                    }

                 } else {
                    symops = data.split("_space_group_symop_operation_xyz")[1].split("loop_")[0].trim().replace(/'/g,"").replace(/ /g, "").split("\n");
                 }
                 nops   = symops.length-1;
                 document.getElementById("symmetryops").value = symops.slice(0,nops).join("\n");

                 j=0;
                 groupfound = false;
                 while ((!groupfound) && (j<symall.length)) {
                    nops = symall[j].length;
                    groupfound = compare_ops(symall[j].slice(4,nops),symops);
                    j += 1;
                 }

                 if (groupfound) {
                    groupnumber = symall[j-1][0];
                    setting = symall[j-1][1];
                    gname   = symall[j-1][2];
                    cname   = symall[j-1][3];
                 } else {
                    setting = 0;
                    gname = groupname.replace(" ","").replace("\'","");
                 }
                 document.getElementById("lattice_group").value = gname.trim();
                 document.getElementById("lattice_group_setting").value = setting;
                 document.getElementById("lattice_group_number").value  = groupnumber;
                 document.getElementById("crystal_system").value  = cname;
              }

              // geometry here 
              var loops = data.split("loop_")
              j=0;
              var geomfound = false;
              while ((!geomfound) && (j<loops.length)) {
                 geomfound = loops[j].includes("_atom_site_type_symbol");
                 geomfound = geomfound || loops[j].includes("_atom_site_label");
                 j += 1;
              }
              var looplines = loops[j-1].trim().split("\n");
              var isym,ix,iy,iz,istart,ss,symb;
              isym = -1; ix = -1; iy = -1; iz = -1; istart = -1;
              for (j=0; j<looplines.length; ++j) {
                  if (looplines[j].includes("_atom_site_type_symbol")) {
                     isym = j;
                  }
                  if ((looplines[j].includes("_atom_site_label")) && (isym<0)) {
                     isym = j;
                  }
                  if (looplines[j].includes("_atom_site_fract_x")) {
                     ix = j;
                  }
                  if (looplines[j].includes("_atom_site_fract_y")) {
                     iy = j;
                  }
                  if (looplines[j].includes("_atom_site_fract_z")) {
                     iz = j;
                  }
                  if (looplines[j].includes("_")) {istart = j;}
               }
               console.log("ISYM=",isym);
               console.log(ix); console.log(iy); console.log(iz);
               console.log("LOOPLINES=",looplines);
               istart += 1;
               var fracgeom = [] ;
               for (j=istart; j<looplines.length; ++j) {
                  ss = looplines[j].trim().split(/[ ,]+/);
                  if (ss[isym].length>1) {
                     symb = ss[isym].charAt(0);
                     if (isLetter(ss[isym].charAt(1))) { symb += ss[isym].charAt(1); }
                  } else {
                     symb = ss[isym].charAt(0);
                  }
                  x = parseFloat(ss[ix].split("(")[0]); 
                  y = parseFloat(ss[iy].split("(")[0]);
                  z = parseFloat(ss[iz].split("(")[0]);
                  console.log("j=",j," symb=",symb,"  fx,fy,fz=",x,y,z);

                  fracgeom2 = symmetry_genfracgeom(symops,symb,x,y,z);
                  console.log("j=",j,"  fracgom2=",fracgeom2);
                  for (n=0; n<fracgeom2.length; ++n) {
                     m = 0;
                     geomfound = false;
                     while ((!geomfound) && (m<fracgeom.length)) {
                        geomfound = (fracgeom2[n][0]==fracgeom[m][0]);
                        geomfound = geomfound && (Math.abs(fracgeom2[n][1]-fracgeom[m][1])<1.0e-4);
                        geomfound = geomfound && (Math.abs(fracgeom2[n][2]-fracgeom[m][2])<1.0e-4);
                        geomfound = geomfound && (Math.abs(fracgeom2[n][3]-fracgeom[m][3])<1.0e-4);
                        m += 1;
                     }
                     if (!geomfound) {
                        fracgeom.push(fracgeom2[n]);
                     }
                     console.log("j=",j," n=",n,"  fracgom=",fracgeom);
                  }
               }

	       // unitcell update
               ucell = jmsfetchucell();
               var a1 = ucell[1];
               var a2 = ucell[2];
               var a3 = ucell[3];
               fracdat = '';
               xyzdat  = '';
               for (j=0; j<fracgeom.length; ++j) {
                  fracdat += fracgeom[j][0] + " " + fracgeom[j][1].toFixed(6)
                                            + " " + fracgeom[j][2].toFixed(6)
                                            + " " + fracgeom[j][3].toFixed(6) + "\n";
                  x = a1[0]*fracgeom[j][1] + a2[0]*fracgeom[j][2] + a3[0]*fracgeom[j][3];
                  y = a1[1]*fracgeom[j][1] + a2[1]*fracgeom[j][2] + a3[1]*fracgeom[j][3];
                  z = a1[2]*fracgeom[j][1] + a2[2]*fracgeom[j][2] + a3[2]*fracgeom[j][3];
                  xyzdat += fracgeom[j][0] + " " + x.toFixed(6)
                                           + " " + y.toFixed(6)
                                           + " " + z.toFixed(6) + "\n";
               }
               //document.getElementById("fractionalCoords").value = fracdat;
               //document.getElementById("cartesianCoords").value  = xyzdat;
               document.getElementById("fractionalCoords").textContent = fracdat;
               document.getElementById("cartesianCoords").textContent  = xyzdat;
               console.log(xyzdat);
               console.log(fracdat);
               nion = fracgeom.length;
               xyzdat = nion + "\n\n" + xyzdat;
               data = xyzdat;
           }

           return data;
        } 

        function myPick() {
           alert('you clicked on atom with index=' + arguments[2]);
        }

        var jm_cmdlist = [];
        var jm_cmdlist2 = [];

        function jm_cmdlist_reset() {
           jm_cmdlist  = [];
           jm_cmdlist2 = [];
        }
        function jm_cmdlist_add() {
           var moldat = "\"model reset\"\n" + exMod() + "end \"model reset\"";
           var orient = jmvar("script('show orientation')");
           orient =  "reset; " + orient.split("reset;")[1];
           jm_cmdlist.push([moldat,orient]);
           var n = jm_cmdlist.length;
           if (n>20) {
              jm_cmdlist.shift();
           }
        }
        function jm_cmdlist2_add() {
           var moldat = "\"model reset\"\n" + exMod() + "end \"model reset\"";
           var orient = jmvar("script('show orientation')");
           orient =  "reset; " + orient.split("reset;")[1];
           jm_cmdlist2.push([moldat,orient]);
           var m = jm_cmdlist2.length;
           if (m>40) {
              jm_cmdlist2.shift();
           }
        }

        function jm_cmdlist_undo() {
           var n = jm_cmdlist.length;
           if (n>0) {
              jm_cmdlist2_add();
              var cdat = jm_cmdlist.pop();
              var moldat = cdat[0];
              var orient = cdat[1];
              var scpt = "load data "+moldat + " ;";
                  scpt += 'select Meitnerium; color atoms TRANSLUCENT orange; label "e-"; color label cpk; ';
              //Jmol.script(jmolApplet0, "load data "+moldat);
              Jmol.script(jmolApplet0, scpt);
              //Jmol.script(jmolApplet0, orient);
           }
        }
        function jm_cmdlist_redo() {
           var m = jm_cmdlist2.length;
           if (m>0) {
              jm_cmdlist_add();
              var cdat = jm_cmdlist2.pop();
              var moldat = cdat[0];
              var orient = cdat[1];
              var scpt = "load data "+moldat + " ;";
                  scpt += 'select Meitnerium; color atoms TRANSLUCENT orange; label "e-"; color label cpk; ';
              //Jmol.script(jmolApplet0, "load data "+moldat);
              Jmol.script(jmolApplet0, scpt);
              //Jmol.script(jmolApplet0, orient);
           }
        }


        // basic JMOL routines - all other routines call these functions
        function jms(scpt) { 
           jm_cmdlist_add();
           Jmol.script(jmolApplet0, scpt); 
           jmsetcoordboxes();
        }
        function jms0(scpt) { 
           Jmol.script(jmolApplet0, scpt); 
        }
        function jmstr(scpt) { 
           return Jmol.getPropertyAsString(jmolApplet0,scpt); 
        }
        function jmarray(scpt) { 
           return Jmol.getPropertyAsArray(jmolApplet0,scpt); 
        }
        function jmvar(x) {
           return Jmol.evaluateVar(jmolApplet0, x);
        }



        function jmreset() { jms("load smiles \"" + "C" + "\"; set modelKitMode;"); }



        // ****************************
        // *                          *
        // *     a1a2a3_to_lat        *
        // *                          *
        // ****************************
        function a1a2a3_to_lat(a1,a2,a3) {
           var a = Math.sqrt(a1[0]*a1[0] + a1[1]*a1[1] + a1[2]*a1[2]);
           var b = Math.sqrt(a2[0]*a2[0] + a2[1]*a2[1] + a2[2]*a2[2]);
           var c = Math.sqrt(a3[0]*a3[0] + a3[1]*a3[1] + a3[2]*a3[2]);

           var d2 = (a2[0]-a3[0])*(a2[0]-a3[0])
                  + (a2[1]-a3[1])*(a2[1]-a3[1])
                  + (a2[2]-a3[2])*(a2[2]-a3[2]);
           var alpha = (b*b + c*c - d2)/(2.00*b*c);
           alpha = Math.acos(alpha)*180.00/Math.PI;

           d2 = (a3[0]-a1[0])*(a3[0]-a1[0])
              + (a3[1]-a1[1])*(a3[1]-a1[1])
              + (a3[2]-a1[2])*(a3[2]-a1[2]);
           var beta = (c*c + a*a - d2)/(2.00*c*a);
           beta = Math.acos(beta)*180.00/Math.PI;

           d2 = (a1[0]-a2[0])*(a1[0]-a2[0])
              + (a1[1]-a2[1])*(a1[1]-a2[1])
              + (a1[2]-a2[2])*(a1[2]-a2[2]);
           var gamma = (a*a + b*b - d2)/(2.00*a*b);
           gamma = Math.acos(gamma)*180.00/Math.PI;

           return [a,b,c,alpha,beta,gamma];
        }

        // ****************************
        // *                          *
        // *     a1a2a3_to_b1b2b3     *
        // *                          *
        // ****************************
        function a1a2a3_to_b1b2b3(a1,a2,a3) {
           var   b1 = [a2[1]*a3[2]-a2[2]*a3[1], a2[2]*a3[0]-a2[0]*a3[2], a2[0]*a3[1]-a2[1]*a3[0]];
           var   b2 = [a3[1]*a1[2]-a3[2]*a1[1], a3[2]*a1[0]-a3[0]*a1[2], a3[0]*a1[1]-a3[1]*a1[0]];
           var   b3 = [a1[1]*a2[2]-a1[2]*a2[1], a1[2]*a2[0]-a1[0]*a2[2], a1[0]*a2[1]-a1[1]*a2[0]];
           var vol = a1[0]*b1[0] + a1[1]*b1[1] + a1[2]*b1[2];
           b1[0] /= vol; b1[1] /= vol; b1[2] /= vol;
           b2[0] /= vol; b2[1] /= vol; b2[2] /= vol;
           b3[0] /= vol; b3[1] /= vol; b3[2] /= vol;
           return [b1,b2,b3];
        }

        // ****************************
        // *                          *
        // *     a1a2a3_to_volume     *
        // *                          *
        // ****************************
        function a1a2a3_to_volume(a1,a2,a3) {
           var   b1 = [a2[1]*a3[2]-a2[2]*a3[1], a2[2]*a3[0]-a2[0]*a3[2], a2[0]*a3[1]-a2[1]*a3[0]];
           var   b2 = [a3[1]*a1[2]-a3[2]*a1[1], a3[2]*a1[0]-a3[0]*a1[2], a3[0]*a1[1]-a3[1]*a1[0]];
           var   b3 = [a1[1]*a2[2]-a1[2]*a2[1], a1[2]*a2[0]-a1[0]*a2[2], a1[0]*a2[1]-a1[1]*a2[0]];
           var vol = Math.abs(a1[0]*b1[0] + a1[1]*b1[1] + a1[2]*b1[2]);
           return vol;
        }

        // ****************************
        // *                          *
        // *     a1a2a3_to_lattice    *
        // *                          *
        // ****************************
        function a1a2a3_to_lattice(a1,a2,a3) {
           var [b1,b2,b3] = a1a2a3_to_b1b2b3(a1,a2,a3);
           var lat        = a1a2a3_to_lat(a1,a2,a3);

           return [a1,a2,a3,b1,b2,b3,lat];
        }

        // ****************************
        // *                          *
        // *     abcabg_to_lattice    *
        // *                          *
        // ****************************
        function abcabg_to_lattice(a,b,c,alpha,beta,gamma) {
           var conv = Math.PI/180.0;
           var cdist = [a,b,c];
           var cang  = [alpha*conv,beta*conv,gamma*conv];
           var gmat = [cdist[0]*cdist[0],
                       cdist[1]*cdist[0]*Math.cos(cang[2]),
                       cdist[2]*cdist[0]*Math.cos(cang[1]),
                       cdist[0]*cdist[1]*Math.cos(cang[2]),
                       cdist[1]*cdist[1],
                       cdist[2]*cdist[1]*Math.cos(cang[0]),
                       cdist[0]*cdist[2]*Math.cos(cang[1]),
                       cdist[1]*cdist[2]*Math.cos(cang[0]),
                       cdist[2]*cdist[2]]
           var deter3 = gmat[0]*(gmat[4]*gmat[8]-gmat[7]*gmat[5])
                      - gmat[3]*(gmat[1]*gmat[8]-gmat[7]*gmat[2])
                      + gmat[6]*(gmat[1]*gmat[5]-gmat[4]*gmat[2]);
           var vol = Math.sqrt(deter3)

           var c1=Math.cos(cang[0]);
           var c2=Math.cos(cang[1]);
           var c3=Math.cos(cang[2]);
           var s3=Math.sin(cang[2]);

           var a1 = [cdist[0]*s3,              cdist[0]*c3, 0.0];
           var a2 = [0.0,                      cdist[1],    0.0];
           var a3 = [(cdist[2]*(c2-c1*c3)/s3), cdist[2]*c1, (vol/(cdist[0]*cdist[1]*s3))];

           var [b1,b2,b3] = a1a2a3_to_b1b2b3(a1,a2,a3);
           var lat        = [a,b,c,alpha,beta,gamma];

           return [a1,a2,a3,b1,b2,b3,lat];
        }
        // ****************************
        // *                          *
        // *     abcabg_to_clattice   *
        // *                          *
        // ****************************
        function abcabg_to_clattice(a,b,c,alpha,beta,gamma) {
           var conv = Math.PI/180.0;
           var cdist = [a,b,c];
           var cang  = [alpha*conv,beta*conv,gamma*conv];
           var gmat = [cdist[0]*cdist[0],
                       cdist[1]*cdist[0]*Math.cos(cang[2]),
                       cdist[2]*cdist[0]*Math.cos(cang[1]),
                       cdist[0]*cdist[1]*Math.cos(cang[2]),
                       cdist[1]*cdist[1],
                       cdist[2]*cdist[1]*Math.cos(cang[0]),
                       cdist[0]*cdist[2]*Math.cos(cang[1]),
                       cdist[1]*cdist[2]*Math.cos(cang[0]),
                       cdist[2]*cdist[2]]
           var deter3 = gmat[0]*(gmat[4]*gmat[8]-gmat[7]*gmat[5])
                      - gmat[3]*(gmat[1]*gmat[8]-gmat[7]*gmat[2])
                      + gmat[6]*(gmat[1]*gmat[5]-gmat[4]*gmat[2]);
           var vol = Math.sqrt(deter3)

           var c1=Math.cos(cang[0]);
           var c2=Math.cos(cang[1]);
           var s2=Math.sin(cang[1]);
           var c3=Math.cos(cang[2]);

           var a1 = [cdist[0]*s2,             0.0,                         cdist[0]*c2];
           var a2 = [cdist[1]*(c3-c1*c2)/s2, (vol/(cdist[0]*cdist[2]*s2)), cdist[1]*c1];
           var a3 = [0.0,                     0.0,                         cdist[2]];

           var [b1,b2,b3] = a1a2a3_to_b1b2b3(a1,a2,a3);
           var lat        = [a,b,c,alpha,beta,gamma];

           return [a1,a2,a3,b1,b2,b3,lat];
        }

        // ****************************
        // *                          *
        // *       aligntocaxis       *
        // *                          *
        // ****************************
        function aligntocaxis(atoms,a1,a2,a3) {
           var x,y,z,f1,f2,f3;
           var lattice0 = a1a2a3_to_lattice(a1,a2,a3);
           var lattice1 = abcabg_to_clattice(lattice0[6][0],lattice0[6][1],lattice0[6][2],lattice0[6][3],lattice0[6][4],lattice0[6][5])
           var atoms1 = []
           for (var i=0; i<atoms.length; ++i) {
              x = atoms[i][1]; 
              y = atoms[i][2]; 
              z = atoms[i][3];
              f1 = lattice0[3][0]*x + lattice0[3][1]*y + lattice0[3][2]*z;
              f2 = lattice0[4][0]*x + lattice0[4][1]*y + lattice0[4][2]*z;
              f3 = lattice0[5][0]*x + lattice0[5][1]*y + lattice0[5][2]*z;

              x = f1*lattice1[0][0] + f2*lattice1[1][0] + f3*lattice1[2][0];
              y = f1*lattice1[0][1] + f2*lattice1[1][1] + f3*lattice1[2][1];
              z = f1*lattice1[0][2] + f2*lattice1[1][2] + f3*lattice1[2][2];
              atoms1.push([atoms[i][0],x,y,z]);
           }
           return [atoms1,lattice1[0],lattice1[1],lattice1[2]]
        }


        // ****************************
        // *                          *
        // *     vec3_to_string3      *
        // *                          *
        // ****************************
        function vec3_to_string3(vec3) {
           var string3 = vec3[0].toFixed(6) + " " + vec3[1].toFixed(6) + " " + vec3[2].toFixed(6);
           return string3;
        }

        // ****************************
        // *                          *
        // *     string3_to_vec3      *
        // *                          *
        // ****************************
        function string3_to_vec3(string3) {
           var x = string3.trim().split(/[ ,]+/);
           if (x.length>=3) {
              return  [parseFloat(x[0]),parseFloat(x[1]),parseFloat(x[2])];
           } else {
              return  [0.0,0.0,0.0];
           }
        }


        // ****************************
        // *                          *
        // *    xyzrow2_to_lattice    *
        // *                          *
        // ****************************
        function xyzrow2_to_lattice(x) {
           var a1,a2,a3,b1,b2,b3,lat,lattice;
           var haslattice = true;
           if (x.length==9) {
              a1 = [parseFloat(x[0]),parseFloat(x[1]),parseFloat(x[2])];
              a2 = [parseFloat(x[3]),parseFloat(x[4]),parseFloat(x[5])];
              a3 = [parseFloat(x[6]),parseFloat(x[7]),parseFloat(x[8])];
              lattice = a1a2a3_to_lattice(a1,a2,a3);
           } else {
              a1 = [1.0,0.0,0.0];
              a2 = [0.0,1.0,0.0];
              a3 = [0.0,0.0,1.0];
              b1 = [1.0,0.0,0.0];
              b2 = [0.0,1.0,0.0];
              b3 = [0.0,0.0,1.0];
              lat = [1.0,1.0,1.0,90.0,90.0,90.0];
              lattice = [a1,a2,a3,b1,b2,b3,lat];
              haslattice = false;
           }

           return [lattice,haslattice];
        }

        // ****************************
        // *                          *
        // *       jmshowcell0        *
        // *                          *
        // ****************************
        function jmshowcell0(isshowing) {
           var centeron  = document.getElementById("centercell").value == "Origin";
           if (isshowing) {
              var a1 = document.getElementById("lattice_a1").value;
              var a2 = document.getElementById("lattice_a2").value;
              var a3 = document.getElementById("lattice_a3").value;
              var origin = string3_to_vec3(document.getElementById("lattice_center").value);
              var scpt = "unitcell [{" + origin + "} {" + a1 + "} {" + a2 + "} {" + a3 + "}];";
              scpt += "unitcell ON;"
              jms0(scpt);
              document.getElementById("showcell").value = "Unit cell off";
              document.getElementById("showcell0").value = "Unit cell off";
              document.getElementById("showcell1").value = "Unit cell off";
              if (centeron) { jms0("unitcell {-0.5 -0.5 -0.5};"); }
           } else {
              jms0("unitcell OFF;");
              document.getElementById("showcell").value = "Unit cell on";
              document.getElementById("showcell0").value = "Unit cell on";
              document.getElementById("showcell1").value = "Unit cell on";
           }
        }

        // ****************************
        // *                          *
        // *       jmshowcell         *
        // *                          *
        // ****************************
        function jmshowcell() { 
           var isshowing = document.getElementById("showcell").value =="Unit cell on";
           console.log("isshowing=",isshowing);
           jmshowcell0(isshowing);
        }

        // ****************************
        // *                          *
        // *     jmscentercell0       *
        // *                          *
        // ****************************
        function jmscentercell0(docenter) {
           if (docenter) {
              jms("unitcell {-0.5 -0.5 -0.5};");
              document.getElementById("centercell").value = "Origin";
              document.getElementById("centercell0").value = "Origin";
              document.getElementById("centercell1").value = "Origin";
           } else {
              jms("unitcell {0.0 0.0 0.0};");
              document.getElementById("centercell").value = "Center";
              document.getElementById("centercell0").value = "Center";
              document.getElementById("centercell1").value = "Center";
           }
        }

        // ****************************
        // *                          *
        // *     jmscentercell        *
        // *                          *
        // ****************************
        function jmscentercell() { 
           var docenter = document.getElementById("centercell").value == "Center";
           jmscentercell0(docenter);
        }

        // ****************************
        // *                          *
        // *     jmsshiftcell        *
        // *                          *
        // ****************************
        function jmsshiftcell(n1n2n3) {
           var x0 = n1n2n3.trim().split(/[ ,]+/);
           var n1 = parseFloat(x0[0]);
           var n2 = parseFloat(x0[1]);
           var n3 = parseFloat(x0[2]);
           //var fracdat = document.getElementById("fractionalCoords").value;
           var fracdat = document.getElementById("fractionalCoords").textContent;
           var xyz = fracdat.trim().split("\n");
           var nion = xyz.length;
           var i,line,x,y,z;
           var fracdat2 = ''
           for (i=0; i<nion; ++i) {
              line = xyz[i].trim().split(/[ ,]+/);
              x = parseFloat(line[1]) + n1;
              y = parseFloat(line[2]) + n2;
              z = parseFloat(line[3]) + n3;
              if (x>0.5)  x -= 1.0;
              if (x<=-0.5) x += 1.0;
              if (y>0.5)  y -= 1.0;
              if (y<=-0.5) y += 1.0;
              if (z>0.5)  z -= 1.0;
              if (z<=-0.5) z += 1.0;
              fracdat2 += line[0] + " " + x.toFixed(6) 
                                  + " " + y.toFixed(6) 
                                  + " " + z.toFixed(6) + "\n";
           }
           //document.getElementById("fractionalCoords").value = fracdat2;
           document.getElementById("fractionalCoords").textContent = fracdat2;
           jmsupdatefracbox();
        }

        // ****************************
        // *                          *
        // *     jmschangecellunits   *
        // *                          *
        // ****************************
        function jmschangecellunits(scal) {
           document.getElementById("cell_a").value *= scal;
           document.getElementById("cell_b").value *= scal;
           document.getElementById("cell_c").value *= scal;
           jsmcellchange(true,true);
        }

        // ****************************
        // *                          *
        // *     jsmcellchange        *
        // *                          *
        // ****************************
        function jsmcellchange(cellchange,scoords) {
           var a1,a2,a3;
           var cellon = document.getElementById("showcell").value == "Unit cell off";
           //var cellon = true;
           var centeron = document.getElementById("centercell").value == "Origin";
           console.log("jsmcellchange, cellchange=",cellchange, " sccords=",scoords, " cellon=",cellon);
           if (cellchange) {
               var a = parseFloat(document.getElementById("cell_a").value);
               var b = parseFloat(document.getElementById("cell_b").value);
               var c = parseFloat(document.getElementById("cell_c").value);
               var alpha = parseFloat(document.getElementById("cell_alpha").value);
               var beta  = parseFloat(document.getElementById("cell_beta").value);
               var gamma = parseFloat(document.getElementById("cell_gamma").value); 
               var lat = abcabg_to_lattice(a,b,c,alpha,beta,gamma);
               a1 = lat[0]; a2 = lat[1]; a3 = lat[2];	
               document.getElementById("lattice_a1").value = vec3_to_string3(a1);
               document.getElementById("lattice_a2").value = vec3_to_string3(a2);
               document.getElementById("lattice_a3").value = vec3_to_string3(a3);
           } else {
              a1 = string3_to_vec3(document.getElementById("lattice_a1").value);
              a2 = string3_to_vec3(document.getElementById("lattice_a2").value);
              a3 = string3_to_vec3(document.getElementById("lattice_a3").value);
              var lattice = a1a2a3_to_lattice(a1,a2,a3);
              var lat = lattice[6];
              document.getElementById("cell_a").value = lat[0]
              document.getElementById("cell_b").value = lat[1]
              document.getElementById("cell_c").value = lat[2]
              document.getElementById("cell_alpha").value = lat[3]
              document.getElementById("cell_beta").value  = lat[4]
              document.getElementById("cell_gamma").value = lat[5]
           }
           var origin = string3_to_vec3(document.getElementById("lattice_center").value);
           var scpt = "unitcell [{" + origin + "} {" + vec3_to_string3(a1) + "} {" + vec3_to_string3(a2) + "} {" + vec3_to_string3(a3) + "}];";
           if (centeron) { scpt += "unitcell {-0.5 -0.5 -0.5};"; }
           if (cellon) { jms(scpt); }
           if (scoords) {jmsetcoordboxes();}
           jms0('echo "finished jmcellchange";')
        }

        // ****************************
        // *                          *
        // *     jsmcellchange0       *
        // *                          *
        // ****************************
        function jsmcellchange0() {
           var a1,a2,a3;
           var cellon = document.getElementById("showcell").value.includes("Unit cell off");
           var centeron = document.getElementById("centercell").value.includes("Origin");
           
           a1 = string3_to_vec3(document.getElementById("lattice_a1").value);
           a2 = string3_to_vec3(document.getElementById("lattice_a2").value);
           a3 = string3_to_vec3(document.getElementById("lattice_a3").value);
           var lattice = a1a2a3_to_lattice(a1,a2,a3);
           var lat = lattice[6];
           document.getElementById("cell_a").value = lat[0]
           document.getElementById("cell_b").value = lat[1]
           document.getElementById("cell_c").value = lat[2]
           document.getElementById("cell_alpha").value = lat[3]
           document.getElementById("cell_beta").value  = lat[4]
           document.getElementById("cell_gamma").value = lat[5]
           var origin = string3_to_vec3(document.getElementById("lattice_center").value);
           var scpt = "unitcell [{" + origin + "} {" + vec3_to_string3(a1) + "} {" + vec3_to_string3(a2) + "} {" + vec3_to_string3(a3) + "}];";
           if (centeron) { scpt += "unitcell {-0.5 -0.5 -0.5};"; }
           if (cellon) { jms0(scpt); }
        }


        // ****************************
        // *                          *
        // *    loadframe2jsmol       *
        // *                          *
        // ****************************
        var xyzframes_ntotal = 1;
        var xyzframes_cur = 0;
        var xyzframes = [];
        function loadframe2jsmol(addmodel,append,fn) {
           var a1,a2,a3,xyzcell;
           //var xyzdat = jmvar("data({1.1},\"xyz\")");
           var xyzdat = jmvar("data({thisModel},\"xyz\")");
           var nion = xyzdat.trim().split("\n").length;
           xyzdat = nion + "\n\n" + xyzdat;

           var ttt = jmvar("_someModelsHaveUnitcells");
           var ttt = jmvar("_m.unitCellParams[1][6]");

           var a1 = document.getElementById("lattice_a1").value;
           var a2 = document.getElementById("lattice_a2").value;
           var a3 = document.getElementById("lattice_a3").value;
           xyzcell = [xyzdat,a1,a2,a3];
           if (addmodel) {
              window.xyzframes_ntotal += 1;
              window.xyzframes.push(xyzcell);
           }

           var orient = jmvar("script('show orientation')");
           orient     =  "reset; " + orient.split("reset;")[1];

           if (append) {
              var amodel = fn;
              //var  amodel = parseInt(prompt("Please enter model to append:", (1+(window.xyzframes_cur+1) % window.xyzframes_ntotal)));
              if (amodel<1) {
                 amodel = parseInt(prompt("Please enter model to append:", (1+(window.xyzframes_cur+1) % window.xyzframes_ntotal)));
              }
              amodel -= 1;
              var xyzcell1 = window.xyzframes[amodel];
              var xyzdat1 = "\"append\"|" + xyzcell1[0].trim().replace(/\n/g,' | ') + "|end \"append\"";
              jms("set appendNew false; data "+xyzdat1);

               if (fn==1) {
                 document.getElementById("lattice_a1").value = xyzcell1[1];
                 document.getElementById("lattice_a2").value = xyzcell1[2];
                 document.getElementById("lattice_a3").value = xyzcell1[3];
               } else {
                  if (confirm("Merging lattice from model " + (amodel+1).toString() + "?")){
                    document.getElementById("lattice_a1").value = xyzcell1[1];
                    document.getElementById("lattice_a2").value = xyzcell1[2];
                    document.getElementById("lattice_a3").value = xyzcell1[3];
                  }
               }

           } else {
              var nframes = window.xyzframes.length;
              if (nframes<window.xyzframes_ntotal) {
                 window.xyzframes.push(xyzcell);
                 window.xyzframes_cur = (window.xyzframes_cur + 1) % window.xyzframes_ntotal;
              } else {
                    window.xyzframes[window.xyzframes_cur] = xyzcell;
                    window.xyzframes_cur = (window.xyzframes_cur + 1) % window.xyzframes_ntotal;
                    xyzcell = window.xyzframes[window.xyzframes_cur];
              }
              var i = window.xyzframes_cur + 1;
              document.getElementById("model_label").innerHTML = "Model " + i + " out of " + window.xyzframes_ntotal;
              document.getElementById("model_label2").innerHTML = "Model " + i + " out of " + window.xyzframes_ntotal;
              Text2Speech0("Model " + i + " out of " + window.xyzframes_ntotal);

              var scpt = "load data " + "\"model editor\"|" + xyzcell[0].trim().replace(/\n/g,' | ') + "|end \"model editor\"";
              jms(scpt);
              document.getElementById("lattice_a1").value = xyzcell[1];
              document.getElementById("lattice_a2").value = xyzcell[2];
              document.getElementById("lattice_a3").value = xyzcell[3];
           } 
           jms(orient);
           jsmcellchange(false,true);
        }

        function prevframe2jsmol() {
           if (window.xyzframes_ntotal>1) {
              var a1,a2,a3,xyzcell;
              //var xyzdat = jmvar("data({1.1},\"xyz\")");
              var xyzdat = jmvar("data({thisModel},\"xyz\")");
              var nion = xyzdat.trim().split("\n").length;
              xyzdat = nion + "\n\n" + xyzdat;
              var a1 = document.getElementById("lattice_a1").value;
              var a2 = document.getElementById("lattice_a2").value;
              var a3 = document.getElementById("lattice_a3").value;
              xyzcell = [xyzdat,a1,a2,a3];

              var orient = jmvar("script('show orientation')");
              orient     =  "reset; " + orient.split("reset;")[1];

              window.xyzframes[window.xyzframes_cur] = xyzcell;
              if (window.xyzframes_cur==0) {
                 window.xyzframes_cur = window.xyzframes_ntotal - 1 ;
              } else {
                 window.xyzframes_cur = (window.xyzframes_cur - 1) % window.xyzframes_ntotal;
              }
              xyzcell = window.xyzframes[window.xyzframes_cur];

              var i = window.xyzframes_cur + 1;
              document.getElementById("model_label").innerHTML = "Model " + i + " out of " + window.xyzframes_ntotal;
              document.getElementById("model_label2").innerHTML = "Model " + i + " out of " + window.xyzframes_ntotal;
              Text2Speech0("Model " + i + " out of " + window.xyzframes_ntotal);

              var scpt = "load data " + "\"model editor\"|" + xyzcell[0].trim().replace(/\n/g,' | ') + "|end \"model editor\"";
              jms(scpt);
              document.getElementById("lattice_a1").value = xyzcell[1];
              document.getElementById("lattice_a2").value = xyzcell[2];
              document.getElementById("lattice_a3").value = xyzcell[3];

              jms(orient);
              jsmcellchange(false,true);
           }
        }
        function deleteframeall() {
            window.xyzframes_ntotal = 1;
            window.xyzframes_cur = 0;
            window.xyzframes = [];
            var i=1;
            document.getElementById("model_label").innerHTML = "Model " + i + " out of " + window.xyzframes_ntotal;
            document.getElementById("model_label2").innerHTML = "Model " + i + " out of " + window.xyzframes_ntotal;
        }

        function deleteframe2jsmol() {
           if (window.xyzframes_ntotal>1) {

              var orient = jmvar("script('show orientation')");
              orient     =  "reset; " + orient.split("reset;")[1];

              for (j=(window.xyzframes_cur); j<(window.xyzframes_ntotal); ++j) {
                 window.xyzframes[j] = window.xyzframes[j+1];
              }
              window.xyzframes_ntotal -= 1;
              if (window.xyzframes_cur >= (window.xyzframes_ntotal-1)) {
                 window.xyzframes_cur -=  1;
              }
              xyzcell = window.xyzframes[window.xyzframes_cur];
              var i = window.xyzframes_cur + 1;
              document.getElementById("model_label").innerHTML = "Model " + i + " out of " + window.xyzframes_ntotal;
              document.getElementById("model_label2").innerHTML = "Model " + i + " out of " + window.xyzframes_ntotal;
              Text2Speech0("Model " + i + " out of " + window.xyzframes_ntotal);

              var scpt = "load data " + "\"model editor\"|" + xyzcell[0].trim().replace(/\n/g,' | ') + "|end \"model editor\"";
              jms(scpt);
              document.getElementById("lattice_a1").value = xyzcell[1];
              document.getElementById("lattice_a2").value = xyzcell[2];
              document.getElementById("lattice_a3").value = xyzcell[3];
              jms(orient);
              jsmcellchange(false,true);
           }
        }





        function fetchframexyz(amodel) {
           var xyzcell1 = window.xyzframes[amodel];
           var xyzlines = xyzcell1[0].trim().split("\n");
           var xyzstr = "";
           for (var i=2; i<xyzlines.length; ++i) {
              xyzstr += xyzlines[i] + "\n";
           }
           return xyzstr;
        }
        function fetchframefrac(amodel) {
           var symb,x,y,z,f1,f2,f3;
           var xyzcell1 = window.xyzframes[amodel];
           var xyzstr = "";
           xyzstr += "system crystal\n";
           xyzstr += "   lattice_vectors\n";
           xyzstr += "   " + xyzcell1[1] + "\n";
           xyzstr += "   " + xyzcell1[2] + "\n";
           xyzstr += "   " + xyzcell1[3] + "\n";
           xyzstr += "end\n\n";
           var a1 = string3_to_vec3(xyzcell1[1]);
           var a2 = string3_to_vec3(xyzcell1[2]);
           var a3 = string3_to_vec3(xyzcell1[3]);
           var [b1,b2,b3] = a1a2a3_to_b1b2b3(a1,a2,a3);
           var xyzlines = xyzcell1[0].trim().split("\n");
           for (var i=2; i<xyzlines.length; ++i) {
              ss = xyzlines[i].trim().split(/[ ,]+/);
              symb = ss[0];
              x = parseFloat(ss[1]);
              y = parseFloat(ss[2]);
              z = parseFloat(ss[3]);
              f1 = b1[0]*x + b1[1]*y + b1[2]*z;
              f2 = b2[0]*x + b2[1]*y + b2[2]*z;
              f3 = b3[0]*x + b3[1]*y + b3[2]*z;
              xyzstr += symb + " " + f1.toFixed(6) + " " + f2.toFixed(6) + " " + f3.toFixed(6) +  "\n";
           }
           return xyzstr;
        }
        function fetchframelat(amodel) {
           var xyzcell1 = window.xyzframes[amodel];
           var fstr = '';
           fstr += "simulation_cell units angstroms\n";
           fstr += "lattice_vectors\n";
           fstr += xyzcell1[1] + "\n";
           fstr += xyzcell1[2] + "\n";
           fstr += xyzcell1[3] + "\n";
           fstr += "end\n";
           return fstr;
        }

        function addxyzcell2frame(xyzcell) {
           var nframes = window.xyzframes.length;
           window.xyzframes_ntotal += 1;
           window.xyzframes.push(xyzcell);
           window.xyzframes_cur =  window.xyzframes_ntotal - 1;

           var orient = jmvar("script('show orientation')");
           orient     =  "reset; " + orient.split("reset;")[1];

           var i = window.xyzframes_cur + 1;
           document.getElementById("model_label").innerHTML = "Model " + i + " out of " + window.xyzframes_ntotal;
           document.getElementById("model_label2").innerHTML = "Model " + i + " out of " + window.xyzframes_ntotal;

           var scpt = "load data " + "\"model editor\"|" + xyzcell[0].trim().replace(/\n/g,' | ') + "|end \"model editor\"";
           jms(scpt);
           document.getElementById("lattice_a1").value = xyzcell[1];
           document.getElementById("lattice_a2").value = xyzcell[2];
           document.getElementById("lattice_a3").value = xyzcell[3];
           jms(orient);
           jsmcellchange(false,true);
        }


        // ****************************
        // *                          *
        // *       jmssupercell       *
        // *                          *
        // ****************************
        function jmssupercell(n1n2n3) { 

           var ucell = jmsfetchucell();
           console.log("supercell ucell=",ucell);

           if (n1n2n3.trim().length < 1 ) { n1n2n3 = prompt("Enter n1 n2 n3:","1 1 1"); }
           var x0 = n1n2n3.trim().split(/[ ,]+/);
           var n1 = parseInt(x0[0]);
           var n2 = parseInt(x0[1]);
           var n3 = parseInt(x0[2]);
           console.log("supercell n1=",n1);
           console.log("supercell n2=",n2);
           console.log("supercell n3=",n3);
           var ss,symb,f1,f2,f3,x,y,z,y0,z0;
           var centeron = document.getElementById("centercell").value == "Center";
           //var xyzdat = jmvar("data({1.1},\"xyz\")");
           var xyzdat = jmvar("data({thisModel},\"xyz\")");
           console.log("supercell xyzdat=",xyzdat);
           if (xyzdat.includes('Mt')) {
              var ss = xyzdat.split('\n');
              xyzdat = ''
              for (var i=0; i<ss.length; ++i) {
                 if (!ss[i].includes('Mt')) {
                    xyzdat += ss[i] + '\n';
                 }
              }
           }
           var cntr = ucell[0];
           var a1 = ucell[1];
           var a2 = ucell[2];
           var a3 = ucell[3];
           var b1 = ucell[4];
           var b2 = ucell[5];
           var b3 = ucell[6];

           var xyzlines = xyzdat.trim().split("\n");
           var nion = xyzlines.length;
           var xcm = 0.0;
           var ycm = 0.0;
           var zcm = 0.0;
           var countcm = 0.0;


           for (var i=0; i<nion; ++i) {
              ss = xyzlines[i].trim().split(/[ ,]+/);
              symb = ss[0];
              x0 = parseFloat(ss[1]);
              y0 = parseFloat(ss[2]);
              z0 = parseFloat(ss[3]);
              for (var i3=0; i3<n3; ++i3) {
              for (var i2=0; i2<n2; ++i2) {
              for (var i1=0; i1<n1; ++i1) {

                 x = x0 + i1*a1[0] + i2*a2[0] + i3*a3[0];
                 y = y0 + i1*a1[1] + i2*a2[1] + i3*a3[1];
                 z = z0 + i1*a1[2] + i2*a2[2] + i3*a3[2];
                 xcm += x;
                 ycm += y;
                 zcm += z;
                 countcm += 1.0;
              }}}
           }
           xcm = xcm/countcm;
           ycm = ycm/countcm;
           zcm = zcm/countcm;

           var fracdat = '';
           xyzdat  = '';
           for (var i3=0; i3<n3; ++i3) {
           for (var i2=0; i2<n2; ++i2) {
           for (var i1=0; i1<n1; ++i1) {
              for (var i=0; i<nion; ++i) {
                 ss = xyzlines[i].trim().split(/[ ,]+/);
                 symb = ss[0];
                 x0 = parseFloat(ss[1]);
                 y0 = parseFloat(ss[2]);
                 z0 = parseFloat(ss[3]);

                 x = x0 + i1*a1[0] + i2*a2[0] + i3*a3[0] - xcm;
                 y = y0 + i1*a1[1] + i2*a2[1] + i3*a3[1] - ycm;
                 z = z0 + i1*a1[2] + i2*a2[2] + i3*a3[2] - zcm;

                 f1 = x*b1[0] + y*b1[1] + z*b1[2];
                 f2 = x*b2[0] + y*b2[1] + z*b2[2];
                 f3 = x*b3[0] + y*b3[1] + z*b3[2];
                 fracdat += symb + " " + f1.toFixed(6) + " " + f2.toFixed(6) + " " + f3.toFixed(6) + "\n";
                 xyzdat  += symb + " " + x.toFixed(6)  + " " + y.toFixed(6)  + " " + z.toFixed(6) + "\n";
              }
           }}}
           //document.getElementById("cartesianCoords").textContent  = xyzdat;

           var xyzdat1 = nion*n1*n2*n3 + "\n\n" + xyzdat;
           var orient = jmvar("script('show orientation')");
           orient =  "reset; " + orient.split("reset;")[1];
           var xyzdat2 = "\"model editor\"|" + xyzdat1.trim().replace(/\n/g,' | ') + "|end \"model editor\"";
           jms("load data "+xyzdat2);
           jms(orient);

           a1[0] *= n1; a1[1] *= n1; a1[2] *= n1;
           a2[0] *= n2; a2[1] *= n2; a2[2] *= n2;
           a3[0] *= n3; a3[1] *= n3; a3[2] *= n3;
           document.getElementById("lattice_a1").value = vec3_to_string3(a1);
           document.getElementById("lattice_a2").value = vec3_to_string3(a2);
           document.getElementById("lattice_a3").value = vec3_to_string3(a3);

           document.getElementById("cartesianCoords").textContent  = xyzdat;

           console.log("into atomlist penalty");
           supercell_atomlist_color_penalty('atomlist1','colortype1','penalty1a','penalty1b','penalty1c',nion,n1,n2,n3);
           supercell_atomlist_color_penalty('atomlist2','colortype2','penalty2a','penalty2b','penalty2c',nion,n1,n2,n3);
           supercell_atomlist_color_penalty('atomlist3','colortype3','penalty3a','penalty3b','penalty3c',nion,n1,n2,n3);
           supercell_atomlist_color_penalty('atomlist4','colortype4','penalty4a','penalty4b','penalty4c',nion,n1,n2,n3);

            setTimeout(() => { jsmcellchange(false,true); }, 1500);

        }


        // ****************************
        // *                          *
        // *       jmsfoldcell        *
        // *                          *
        // ****************************
        function jmsfoldcell() { 
           var ss,symb,f1,f2,f3,x,y,z;
           var ucell = jmsfetchucell();
           var centeron = document.getElementById("centercell").value == "Center";
           //var xyzdat = jmvar("data({1.1},\"xyz\")");
           var xyzdat = jmvar("data({thisModel},\"xyz\")");
           if (xyzdat.includes('Mt')) {
              var ss = xyzdat.split('\n');
              xyzdat = ''
              for (var i=0; i<ss.length; ++i) {
                 if (!ss[i].includes('Mt')) {
                    xyzdat += ss[i] + '\n';
                 }
              }
           }
           var cntr = ucell[0];
           var a1 = ucell[1];
           var a2 = ucell[2];
           var a3 = ucell[3];
           var b1 = ucell[4];
           var b2 = ucell[5];
           var b3 = ucell[6];
           
           var xyzlines = xyzdat.trim().split("\n");
           var nion = xyzlines.length;
           var fracdat = '';
           xyzdat  = '';
           for (var i=0; i<nion; ++i) {
              ss = xyzlines[i].trim().split(/[ ,]+/);
              symb = ss[0];
              x = parseFloat(ss[1]);
              y = parseFloat(ss[2]);
              z = parseFloat(ss[3]);
              f1 = x*b1[0] + y*b1[1] + z*b1[2];
              f2 = x*b2[0] + y*b2[1] + z*b2[2];
              f3 = x*b3[0] + y*b3[1] + z*b3[2];
              while (f1>=0.5) { f1 -= 1.0;}
              while (f2>=0.5) { f2 -= 1.0;}
              while (f3>=0.5) { f3 -= 1.0;}
              while (f1<(-0.5)) { f1 += 1.0;}
              while (f2<(-0.5)) { f2 += 1.0;}
              while (f3<(-0.5)) { f3 += 1.0;}
              //f1 = f1 - Math.floor(f1);
              //f2 = f2 - Math.floor(f2);
              //f3 = f3 - Math.floor(f3);
            
              x = f1*a1[0] + f2*a2[0] + f3*a3[0];
              y = f1*a1[1] + f2*a2[1] + f3*a3[1];
              z = f1*a1[2] + f2*a2[2] + f3*a3[2];
              fracdat += symb + " " + f1.toFixed(6) + " " + f2.toFixed(6) + " " + f3.toFixed(6) + "\n";
              xyzdat  += symb + " " + x.toFixed(6)  + " " + y.toFixed(6)  + " " + z.toFixed(6) + "\n";
           }
           var xyzdat1 = nion + "\n\n" + xyzdat;
           var orient = jmvar("script('show orientation')");
           orient =  "reset; " + orient.split("reset;")[1];
           var xyzdat2 = "\"model editor\"|" + xyzdat1.trim().replace(/\n/g,' | ') + "|end \"model editor\"";
           jms("load data "+xyzdat2);
           jms(orient);
           jsmcellchange(false,false);

           //document.getElementById("fractionalCoords").value = fracdat;
           //document.getElementById("cartesianCoords").value  = xyzdat;
           document.getElementById("fractionalCoords").textContent = value;
           document.getElementById("cartesianCoords").textContent  = value;
        }

        // ****************************
        // *                          *
        // *       jmsfetchucell      *
        // *                          *
        // ****************************
        function jmsfetchucell() { 
     
           var ucell = jmvar("unitcell()");
           var cntr = ucell[0];
           var a1 = ucell[1];
           var a2 = ucell[2];
           var a3 = ucell[3];

           var [b1,b2,b3] = a1a2a3_to_b1b2b3(a1,a2,a3);

           return [cntr,a1,a2,a3,b1,b2,b3]
        }

        function differentxyzs(xyz1,xyz2) {
           var reindx = false;
           var nion1 = xyz1.trim().split("\n").length;
           var nion2 = xyz2.trim().split("\n").length;
           if (nion1!=nion2) {
              reindx = true;
           } else {
                var xyzlist1 = xyz1.trim().split("\n");
                var xyzlist2 = xyz2.trim().split("\n");
                for (var ii=0; ii<nion1; ++ii) {
                   var ss1 = xyzlist1[ii].trim().split(/[ ,]+/);
                   var ss2 = xyzlist2[ii].trim().split(/[ ,]+/);
                   if (ss1[0] != ss2[0]) {reindx = true;}
                }
           }
           return reindx;
        }

        // ****************************
        // *                          *
        // *     jmsetcoordboxes      *
        // *                          *
        // ****************************
        function jmsetcoordboxes() { 
           console.log("IN JMSETCOORDBOXES");
           var ss,symb,x,y,z,fx,fy,fz;
           //var xyzdat = jmvar("data({1.1},\"xyz\")");
           var xyzdat = jmvar("data({thisModel},\"xyz\")");
           
           if (xyzdat.includes('Mt')) {
              var ss = xyzdat.split('\n');
              xyzdat = ''
              for (var i=0; i<ss.length; ++i) {
                 if (!ss[i].includes('Mt')) {
                    xyzdat += ss[i] + '\n';
                 }
              }
           }
           //var oldxyz = document.getElementById("cartesianCoords").value;
           var oldxyz = document.getElementById("cartesianCoords").textContent;
           var reindex = differentxyzs(oldxyz,xyzdat);

           //document.getElementById("cartesianCoords").value = xyzdat;
           document.getElementById("cartesianCoords").textContent = xyzdat;
           var a1 = string3_to_vec3(document.getElementById("lattice_a1").value);
           var a2 = string3_to_vec3(document.getElementById("lattice_a2").value);
           var a3 = string3_to_vec3(document.getElementById("lattice_a3").value);
           var [b1,b2,b3] = a1a2a3_to_b1b2b3(a1,a2,a3);
           
           var xyzlines = xyzdat.trim().split("\n");
           var fracdat = '';
           for (var i=0; i<xyzlines.length; ++i) {
              ss = xyzlines[i].trim().split(/[ ,]+/);
              symb = ss[0];
              x = parseFloat(ss[1]);
              y = parseFloat(ss[2]);
              z = parseFloat(ss[3]);
              fx = x*b1[0] + y*b1[1] + z*b1[2];
              fy = x*b2[0] + y*b2[1] + z*b2[2];
              fz = x*b3[0] + y*b3[1] + z*b3[2];
              fracdat += symb + " " + fx.toFixed(6) + " " + fy.toFixed(6) + " " + fz.toFixed(6) + "\n";
           }
           //document.getElementById("fractionalCoords").value = fracdat;
           document.getElementById("fractionalCoords").textContent = fracdat;


           if (!window.reindex) {
              var atominfo = jmarray("atomInfo");
              window.reindex = false;
              for (var j=0; j<atominfo.length; ++j) {
                 if (atominfo[j].atomIndex!=j) {
                    window.reindex = true;
                 }
              }
              if ((window.reindex) && (reindex)) {
                 setTimeout(function(){
                    //your code here
                    //jmredrawMolecule0();
                    reset_color_penalty(atominfo,'atomlist1','colortype1','penalty1a','penalty1b','penalty1c');
                    reset_color_penalty(atominfo,'atomlist2','colortype2','penalty2a','penalty2b','penalty2c');
                    reset_color_penalty(atominfo,'atomlist3','colortype3','penalty3a','penalty3b','penalty3c');
                    reset_color_penalty(atominfo,'atomlist4','colortype4','penalty4a','penalty4b','penalty4c');
                    window.reindex = false;
                    jsmcellchange0();
                    set_color_penalty('atomlist1','colortype1','penalty1a','penalty1b','penalty1c');
                    set_color_penalty('atomlist2','colortype2','penalty2a','penalty2b','penalty2c');
                    set_color_penalty('atomlist3','colortype3','penalty3a','penalty3b','penalty3c');
                    set_color_penalty('atomlist4','colortype4','penalty4a','penalty4b','penalty4c');
                 }, 500);
              }
           }

        }
 
        // ****************************
        // *                          *
        // *     jmsupdatefracbox     *
        // *                          *
        // ****************************
        function jmsupdatefracbox() { 
           var ss,symb,f1,f2,f3,x,y,z;
           var ucell   = jmsfetchucell();
           var a1 = ucell[1];
           var a2 = ucell[2];
           var a3 = ucell[3];
           //var fracdat   = document.getElementById("fractionalCoords").value;
           var fracdat   = document.getElementById("fractionalCoords").textContent;
           console.log("JMSUPDATEFRACBOX- FRACDAT = ",fracdat);
           var fraclines = fracdat.trim().split("\n");
           var nion = fraclines.length;
           var xyzdat = ''
           for (var i=0; i<nion; ++i) {
              ss = fraclines[i].trim().split(/[ ,]+/);
              symb = ss[0];
              f1 = parseFloat(ss[1]);
              f2 = parseFloat(ss[2]);
              f3 = parseFloat(ss[3]);
              x = f1*a1[0] + f2*a2[0] + f3*a3[0];
              y = f1*a1[1] + f2*a2[1] + f3*a3[1];
              z = f1*a1[2] + f2*a2[2] + f3*a3[2];
              xyzdat += symb + " " + x.toFixed(6) + " " + y.toFixed(6) + " " + z.toFixed(6) + "\n";
           }
           //document.getElementById("fractionalCoords").value = fracdat;
           //document.getElementById("cartesianCoords").value = xyzdat;
           document.getElementById("fractionalCoords").textContent = fracdat;
           document.getElementById("cartesianCoords").textContent  = xyzdat;
           xyzdat = nion + "\n\n" + xyzdat;

           var orient = jmvar("script('show orientation')");
           orient =  "reset; " + orient.split("reset;")[1];
           var xyzdat2 = "\"model editor\"|" + xyzdat.trim().replace(/\n/g,' | ') + "|end \"model editor\"";
           jms0("load data "+xyzdat2);
           jms0(orient);
           console.log("INTO JSMCELLCHANGE0(true,false)");
           setTimeout(() => { jsmcellchange0(); }, 300);
           //jsmcellchange0();
        }

        function jmsupdatecartbox() { 
           var ss,symb,f1,f2,f3,x,y,z;
           var ucell   = jmsfetchucell();
           var b1 = ucell[4];
           var b2 = ucell[5];
           var b3 = ucell[6];

           //var xyzdat   = document.getElementById("cartesianCoords").value;
           var xyzdat   = document.getElementById("cartesianCoords").textContent;
           var xyzlines = xyzdat.trim().split("\n");
           var nion = xyzlines.length;

           //update jsmol data
           xyzdat = nion + "\n\n" + xyzdat;
           var orient = jmvar("script('show orientation')");
           orient =  "reset; " + orient.split("reset;")[1];
           var xyzdat2 = "\"model editor\"|" + xyzdat.trim().replace(/\n/g,' | ') + "|end \"model editor\"";
           jms("load data "+xyzdat2);
           jms(orient);
           jsmcellchange(true,false);

           //update fractional coordinates box
           var fracdat = ''
           for (var i=0; i<nion; ++i) {
              ss = xyzlines[i].trim().split(/[ ,]+/);
              symb = ss[0];
              x = parseFloat(ss[1]);
              y = parseFloat(ss[2]);
              z = parseFloat(ss[3]);
              f1 = x*b1[0] + y*b1[1] + z*b1[2];
              f2 = x*b2[0] + y*b2[1] + z*b2[2];
              f3 = x*b3[0] + y*b3[1] + z*b3[2];
              fracdat += symb + " " + f1.toFixed(6) + " " + f2.toFixed(6) + " " + f3.toFixed(6) + "\n";
           }
           //document.getElementById("fractionalCoords").value = fracdat;
           document.getElementById("fractionalCoords").textContent = fracdat;
        }

        function jmsupdatesymmetry() { 
           symops = document.getElementById("symmetryops").value;
           console.log("symops=",symops);
        }


        function jmresetPointer() {
           var scpt = 'set picking off; unbind; set picking on; set picking identify; set pickingStyle toggle; set PickCallback \"\"';
           Jmol.script(jmolApplet0, scpt); 
        }



	function jmredrawMolecule() {
                //jms("saveOrientation 99");
                //jms("restore orientation 99");
                //orient =  orient.split("reset;")[0];
                var orient = jmvar("script('show orientation')");
                orient =  "reset; " + orient.split("reset;")[1];
		//var xyz = exModXYZ();
		var xyz = exMod();
                console.log("redraw=",xyz);
                //var scpt = "load data " + "\"model editor\"|" + xyz.trim().replace(/\n/g,' | ') + "|end \"model editor\"";
                var scpt = "load data " + "\"model editor\"" + xyz + "end \"model editor\"";
                console.log("scpt=",scpt);
                jms(scpt);
                jms(orient);
	}
	function jmredrawMolecule0() {
                //jms("saveOrientation 99");
                //jms("restore orientation 99");
                //orient =  orient.split("reset;")[0];
                var orient = jmvar("script('show orientation')");
                orient =  "reset; " + orient.split("reset;")[1];
		//var xyz = exModXYZ();
		var xyz = exMod();
                //var scpt = "load data " + "\"model editor\"|" + xyz.trim().replace(/\n/g,' | ') + "|end \"model editor\"";
                var scpt = "load data " + "\"model editor\"" + xyz + "end \"model editor\"";
                jms0(scpt);
                jms0(orient);
	}

        function jmsmiles0(smiles) { 
            jms("load smiles \"" + smiles.replace('>>','.') + "\"");
            var hasreaction = document.getElementById("jmolreactionplane").value == "Reaction off";
            if (hasreaction) {
               scpt  = "draw reactionarrow diameter 0.2  color red arrow {-2,0,0}, {2,0,0}; ";
               scpt += "draw reactionplane \"reaction plane\" 1500 color translucent red plane {0,0,0} {0,1,0} {0,0,1};"
               jms0(scpt);
            }
        }


        function jmsmiles() { 
            jms("load smiles \"" + document.JME.smiles().replace('>>','.') + "\""); 
            var hasreaction = document.getElementById("jmolreactionplane").value == "Reaction off";
            if (hasreaction) {
               scpt  = "draw reactionarrow diameter 0.2  color red arrow {-2,0,0}, {2,0,0}; ";
               scpt += "draw reactionplane \"reaction plane\" 1500 color translucent red plane {0,0,0} {0,1,0} {0,0,1};"
               jms0(scpt);
            }
            Text2Speech0("Copying JSME to JSMol");
        }
        function jmasmiles() { jms("set appendNew false;load append smiles \"" + document.JME.smiles().replace('>>','.') + "\"; select all; select within(molecule,(*)[0]); minimize select selected;"); 
           Text2Speech0("Appending JMSE to JSMol");
        }

        function exMod() { 
            return jmstr("extractModel");
         }
        function exModXYZ() { 
           //var xyzdat0 = jmvar("data({1.1},\"xyz\")").trim();
           var xyzdat0 = jmvar("data({thisModel},\"xyz\")").trim();
           var nion = xyzdat0.split("\n").length;
           var cellon = document.getElementById("showcell").value == "Unit cell off";

           var xyzdat = nion + "\n";
           if (cellon) {
              xyzdat += document.getElementById("lattice_a1").value + " ";
              xyzdat += document.getElementById("lattice_a2").value + " ";
              xyzdat += document.getElementById("lattice_a3").value;
           }
           xyzdat += "\n";
           xyzdat += xyzdat0;
           return xyzdat;
        }

        function jmoltoeditor() {
           Text2Speech0("Copying JSMol to editor");
           editor.setValue(exModXYZ(),1); 
           document.getElementById("queue_nwchem_permdir").value = "";
           document.getElementById("queue_nwchem_curdir").value = "";
        }



        // ****************************
        // *                          *
        // *        myoptimizer       *
        // *                          *
        // ****************************
        function myoptimizer() {

           /* fetch md parameters */
           var mdparam = document.getElementById("MD_parameters").value;

           var molecule_str = exMod();
           let ismol = true;
           let tmp   = molecule_str.split("V2000")[0].split("\n");
           let nion = 1999;
           if (tmp.length==4) {
              nion  = eval(tmp[tmp.length-1].trim().split(/\s+/)[0]);
           }
           if ((nion>90) || (mdparam.includes("lj"))) {
              ismol = false;
              molecule_str = exModXYZ();
              nion = parseInt(molecule_str.split("\n")[0].trim());
           }
           var orient = jmvar("script('show orientation')");
           orient =  "reset; " + orient.split("reset;")[1];
           jms(orient);
           jsmcellchange(false,true);


           var cellon = document.getElementById("showcell").value =="Unit cell off";
           let a1 = [30.0, 0.0, 0.0];
           let a2 = [ 0.0,30.0, 0.0];
           let a3 = [ 0.0, 0.0,30.0];
           if (cellon) {
              a1 = string3_to_vec3(document.getElementById("lattice_a1").value);
              a2 = string3_to_vec3(document.getElementById("lattice_a2").value);
              a3 = string3_to_vec3(document.getElementById("lattice_a3").value);
           }
           let it_out = 1;
           let it_in  = 120;
           let mdtime_step = 51.8;
           let mdtol   = 1.0e-7;
           if (mdparam.includes("outer_iterations")) {
              it_out = parseInt(mdparam.split("outer_iterations")[1].split(";")[0].trim());
           }
           if (mdparam.includes("inner_iterations")) {
              it_in = parseInt(mdparam.split("inner_iterations")[1].split(";")[0].trim());
           }
           if (mdparam.includes("time_step")) {
              mdtime_step = parseFloat(mdparam.split("time_step")[1].split(";")[0].trim());
           }
           if (mdparam.includes("tolerance")) {
              mdtol = parseFloat(mdparam.split("tolerance")[1].split(";")[0].trim());
           }
           let mdappend = mdparam.includes("mdappend");

           if (mdappend) {loadframe2jsmol(true,false,0);}


           console.log("MDPARAM:");
           console.log("mdparam=",mdparam);
           console.log("it_in=", it_in, " it_out=",it_out);
           console.log("cellon=",cellon);
           console.log("time_step=",mdtime_step);
           console.log("tolerance=",mdtol);
           console.log("mdappend=",mdappend);
           var xyzdat;
           jms0("set refreshing TRUE;");
           for (let i=0; i<(it_out-1); ++i) {
              setTimeout(function(){
                 orient = jmvar("script('show orientation')");
                 orient = "reset; " + orient.split("reset;")[1];
                 molecule_str = xyzsdf_minimize(molecule_str,mdparam,it_in,mdtime_step,mdtol,ismol,false,cellon,a1,a2,a3);
                 if (ismol) {
                    xyzdat = "\"model editor\"|" + molecule_str + "|end \"model editor\"";
                 } else {
                    xyzdat = "\"model editor\"|" + molecule_str.trim().replace(/\n/g,' | ') + "|end \"model editor\"";
                 }
                 jms("load data "+xyzdat);
                 jms(orient);
                 if (cellon) { jsmcellchange(false,true); }
                 jms("refresh;");
              }, 100);
           }


           setTimeout(function(){
              orient = jmvar("script('show orientation')");
              orient = "reset; " + orient.split("reset;")[1];
              molecule_str = xyzsdf_minimize(molecule_str,mdparam,it_in,mdtime_step,mdtol,ismol,true,cellon,a1,a2,a3);
              if (ismol) {
                 xyzdat = "\"model editor\"|" + molecule_str + "|end \"model editor\"";
              } else {
                 xyzdat = "\"model editor\"|" + molecule_str.trim().replace(/\n/g,' | ') + "|end \"model editor\"";
              }
              jms("load data "+xyzdat);
              jms(orient);
              if (cellon) { jsmcellchange(false,true); }
              jms("refresh;");
           }, 100);

           let mditerations = parseInt(document.getElementById('md_banner').innerHTML.replace("iterations").trim());
           mditerations    += it_in*it_out;
           document.getElementById('md_banner').innerHTML=mditerations.toString() + " iterations";

           //console.log("XYZDAT=",xyzdat);
        }


        // ****************************
        // *                          *
        // *    submit_nwchemjob2     *
        // *                          *
        // ****************************
        function submit_nwchemjob2(callback) {
           //var arrows_post_url = 'https://arrows.emsl.pnnl.gov/api/upload/';
           //var arrows_get_url  = 'https://arrows.emsl.pnnl.gov/api/queue_nwchem_add/';
           //var arrows_post_url = '{{ arrows_api }}upload/';
           //var arrows_get_url  = '{{ arrows_api }}queue_nwchem_add/';
           var calc_url        = document.getElementById("arrows_calculation_url").value;
           var arrows_post_url = calc_url + 'upload/';
           var arrows_get_url  = calc_url + 'queue_nwchem_add/';


           var textToSave0 = editor.getValue();
           var textToSave  = textToSave0

           if (textToSave0.includes("#JOB HAS ALREADY BEEN SUBMITTED")) {
              document.getElementById('runmebanner3').innerHTML= "This NWChem Job has already been submitted!";
              return;
           }

           //var fileInput = document.getElementById("fileInput");
           if (textToSave.includes("start")) {
              ii = Math.floor(Math.random() * 1000) + 1;
              filenameguess = "nwchem-" + ii +".nw";
              var fileNameToSaveAs =  filenameguess

              var queue_name = document.getElementById("queue_name").value.trim();
              if (queue_name.length==0) {
                 queue_name = "nwchem"
              }
              textToSave += "\n# queue_name: " + queue_name + " :queue_name\n";

              var labelInput = document.getElementById("queue_nwchem_label").value;
              if (labelInput.length==0) {
                 labelInput =  prompt("Please enter Queue Label:", "NWChem Job #" + ii);
              }

              if (textToSave.includes("#curdir ")) {
                 labelInput += " curdir=" + textToSave.split("#curdir ")[1].split("\n")[0].trim();
              }
              var qwaitInput = document.getElementById("queue_wait_label").value;
              if (qwaitInput.length>0) {
                 labelInput += " QWAIT::" + qwaitInput + "::QWAIT";
              }

              if (labelInput.length>0) {
                 textToSave += "# label:" + fileNameToSaveAs + " " + labelInput + " :label\n";
              }
              var secret = document.getElementById("queue_secret_code").value.trim();
              if (secret.length>0) {
                 textToSave += "# ARROWS_PASSWORD:" + secret + ":ARROWS_PASSWORD\n"
              }
              if (confirm("Do you want to submit " + labelInput + "?")) {

                 var textToSaveAsBlob = new Blob([textToSave], {type:"text/plain"});
                 var textToSaveAsURL  = window.URL.createObjectURL(textToSaveAsBlob);

                 var formD = new FormData();
                 formD.append('file', textToSaveAsBlob,fileNameToSaveAs);
                 formD.append('title', fileNameToSaveAs);

                 var xhr = new XMLHttpRequest();
                 xhr.open("POST",  arrows_post_url, true);
                 xhr.send(formD);

                 document.getElementById('runmebanner3').innerHTML= "NWChem Job was uploaded as " + fileNameToSaveAs ;

                 var request = new XMLHttpRequest();
                 request.open('GET', arrows_get_url+fileNameToSaveAs, true);
                 request.onload = function (e) {
                   if (request.readyState === 4) {
                     if (request.status === 200) {
                       console.log(request.responseText);
                       document.getElementById('runmebanner3b').innerHTML= request.responseText;
                       if (request.responseText.includes("=")) {
                          document.getElementById("queue_wait_label").value = request.responseText.split("=")[1].trim();
                          editor.setValue("#JOB HAS ALREADY BEEN SUBMITTED" + " - " + request.responseText +"\n"  + textToSave0,1);
                       }
                       callback("submit_nwchemjob2");
                     } else {
                       console.error(request.statusText);
                       document.getElementById('runmebanner3b').innerHTML= request.statusText;
                     }
                   }
                 };
                 request.onerror = function (e) {
                   console.error(request.statusText);
                   document.getElementById('runmebanner3b').innerHTML= request.statusText;
                 };
                 request.send();
              }


           } else {
              document.getElementById('runmebanner3').innerHTML= "This is not an NWChem input deck";
           }

        }

        // **********************************
        // *                                *
        // *    submit_splitnwchemjob2      *
        // *                                *
        // **********************************
        function submit_splitnwchemjob2(callback) {
           //var arrows_post_url = 'https://arrows.emsl.pnnl.gov/api/upload/';
           //var arrows_get_url  = 'https://arrows.emsl.pnnl.gov/api/queue_nwchem_add/';
           //var arrows_post_url = '{{ arrows_api }}upload/';
           //var arrows_get_url  = '{{ arrows_api }}queue_nwchem_add/';
           var calc_url        = document.getElementById("arrows_calculation_url").value;
           var arrows_post_url = calc_url + 'upload/';
           var arrows_get_url  = calc_url + 'queue_nwchem_add/';

           var data = editor.getValue();

           if (data.includes("#JOB HAS ALREADY BEEN SUBMITTED")) {
              document.getElementById('runmebanner3').innerHTML= "This NWChem Job has already been submitted!";
              return;
           }

           // NWChem input deck splitting
           if (data.includes("### restart here ###")) {
              var nwinputs = data.split("### restart here ###");
              var nwlen = nwinputs.length;
              console.log("nwlen=",nwlen);
              console.log("NWINPUts=",nwinputs);
              if (nwlen>1) {
                 var header = nwinputs[0].split("title")[0];
                 header += "\n";
                 header += "title" + nwinputs[0].split("title")[1].split("\n")[0] + "\n\n";
                 header += "echo\n\n";
                 header += "restart " + nwinputs[0].split("start ")[1].split("\n")[0] + "\n\n";
                 header += "memory "  + nwinputs[0].split("memory ")[1].split("\n")[0] + "\n\n";

                 var nwin0 = nwinputs[0].split("nwchem_input")[1].split("\n")[0].trim();
                 if (!nwin0.includes(".rs.")) { 
                    var nwin1 = nwin0.replace(".nw",".rs.nw");
                    header = header.replace(nwin0,nwin1);
                 }
                 //header = header.replace(nwin0,nwin1);

                 var nwoutput = nwinputs[0].split("nwchem_output")[1].split("\n")[0].trim();
                 var numtag = nwoutput.split("out")[1];
                 var num = parseInt(nwoutput.split("out")[1]);
                 var numtag000 = "000";

                 for (i=1; i<nwlen; ++i) {
                    num += 1;

                    //nwinputs[i] = header.replace(numtag,(numtag+num.toString()).slice(-2)) + nwinputs[i];

                    var tt = header.split("nwchem_output")[1].split("\n")[0].trim();
                    var uu = tt.split("out")[0] + "out" + tt.split("out")[1].replace(numtag,(numtag000+num.toString()).slice(-2));
                    var header0  = header.replace(tt,uu);
                    var nwinput0 = nwinputs[i];

                    if (nwinputs[i].includes("#ncpus")) {
                       tt = "#ncpus" +      header.split("#ncpus")[1].split("\n")[0];
                       uu = "#ncpus" + nwinputs[i].split("#ncpus")[1].split("\n")[0];
                       header0  = header0.replace(tt,uu);
                       nwinput0 = nwinput0.replace(uu,"");
                    } 
                    if (nwinputs[i].includes("#machine")) {
                       tt = "#machine" +      header.split("#machine")[1].split("\n")[0];
                       uu = "#machine" + nwinputs[i].split("#machine")[1].split("\n")[0];
                       header0  = header0.replace(tt,uu);
                       nwinput0 = nwinput0.replace(uu,"");
                    } 
                    if (nwinputs[i].includes("#queue")) {
                       tt = "#queue" +      header.split("#queue")[1].split("\n")[0];
                       uu = "#queue" + nwinputs[i].split("#queue")[1].split("\n")[0];
                       header0  = header0.replace(tt,uu);
                       nwinput0 = nwinput0.replace(uu,"");
                    } 
                    if (nwinputs[i].includes("#cputime")) {
                       tt = "#cputime" +      header.split("#cputime")[1].split("\n")[0];
                       uu = "#cputime" + nwinputs[i].split("#cputime")[1].split("\n")[0];
                       header0  = header0.replace(tt,uu);
                       nwinput0 = nwinput0.replace(uu,"");
                    } 
                    nwinputs[i] = header0 + nwinput0;
 
                    //console.log("i=",i);
                    //console.log("tt=",tt);
                    //console.log("uu=",uu);
                    //console.log("numtag=",numtag, "  ",(numtag+num.toString()).slice(-2));
                    //console.log("nwinputs=",nwinputs[i]);
                 }
                 console.log("NWINPuts=",nwinputs);
                 submit_splitnwchemjob_sub(nwinputs,"",callback);
                 editor.setValue("#JOB HAS ALREADY BEEN SUBMITTED" + " - Multiple Submissions\n"  + data,1);

   
              }
           }
        }

        function submit_splitnwchemjob_sub(nwinputs,qwaitInput,callback) {
           //var arrows_post_url = 'https://arrows.emsl.pnnl.gov/api/upload/';
           //var arrows_get_url  = 'https://arrows.emsl.pnnl.gov/api/queue_nwchem_add/';
           //var arrows_post_url = '{{ arrows_api }}upload/';
           //var arrows_get_url  = '{{ arrows_api }}queue_nwchem_add/';
           var calc_url        = document.getElementById("arrows_calculation_url").value;
           var arrows_post_url = calc_url + 'upload/';
           var arrows_get_url  = calc_url + 'queue_nwchem_add/';
           nwlen = nwinputs.length;
           if (nwlen>0) {
              var textToSave0 = nwinputs[0];
              var textToSave  = textToSave0
              if (textToSave0.includes("#JOB HAS ALREADY BEEN SUBMITTED")) {
                 document.getElementById('runmebanner3').innerHTML= "This NWChem Job has already been submitted!";
                 return;
              }
              if (textToSave.includes("start")) {
                 var ii = Math.floor(Math.random() * 1000) + 1;
                 var filenameguess = "nwchem-" + ii +".nw";
                 var fileNameToSaveAs =  filenameguess

                 var queue_name = document.getElementById("queue_name").value.trim();
                 if (queue_name.length==0) {
                    queue_name = "nwchem"
                 }
                 textToSave += "\n# queue_name: " + queue_name + " :queue_name\n";


                 var labelInput = document.getElementById("queue_nwchem_label").value;
                 if (labelInput.length==0) {
                    var nwoutput = "NWChem Job #" + ii;
                    if (nwinputs[0].includes("nwchem_output")) {
                       nwoutput = nwinputs[0].split("nwchem_output")[1].split("\n")[0].trim();
                    }
                    labelInput =  nwoutput;
                    if (labelInput.length==0) {
                       labelInput =  prompt("Please enter Queue Label:", nwoutput);
                    }
                 }
                 if (textToSave.includes("#curdir ")) {
                    labelInput += " curdir=" + textToSave.split("#curdir ")[1].split("\n")[0].trim();
                 }
                 //var qwaitInput = document.getElementById("queue_wait_label").value;
                 if (qwaitInput.length>0) {
                    labelInput += " QWAIT::" + qwaitInput + "::QWAIT";
                 }
                 if (labelInput.length>0) {
                    textToSave += "# label:" + fileNameToSaveAs + " " + labelInput + " :label\n";
                 }
                 var secret = document.getElementById("queue_secret_code").value.trim();
                 if (secret.length>0) {
                    textToSave += "# ARROWS_PASSWORD:" + secret + ":ARROWS_PASSWORD\n"
                 }
                 //if (confirm("Do you want to submit " + labelInput + "?")) {
                 if (true) {

                    document.getElementById('apirunning').value += "+ running submit_splitnwchemjob2\n";
                    var textToSaveAsBlob = new Blob([textToSave], {type:"text/plain"});
                    var textToSaveAsURL  = window.URL.createObjectURL(textToSaveAsBlob);

                    var formD = new FormData();
                    formD.append('file', textToSaveAsBlob,fileNameToSaveAs);
                    formD.append('title', fileNameToSaveAs);

                    var xhr = new XMLHttpRequest();
                    xhr.open("POST",  arrows_post_url, true);
                    xhr.send(formD);

                    document.getElementById('runmebanner3').innerHTML= "NWChem Job was uploaded as " + fileNameToSaveAs ;

                    var request = new XMLHttpRequest();
                    request.open('GET', arrows_get_url+fileNameToSaveAs, true);
                    request.onload = function (e) {
                      if (request.readyState === 4) {
                        if (request.status === 200) {
                          console.log(request.responseText);
                          document.getElementById('runmebanner3b').innerHTML= request.responseText;
                          if (request.responseText.includes("=")) {
                             //document.getElementById("queue_wait_label").value = request.responseText.split("=")[1].trim();
                             var newqwait = request.responseText.split("=")[1].trim();
                             document.getElementById("queue_wait_label").value = newqwait
                             document.getElementById('runmebanner3b').innerHTML= "#JOB HAS BEEN SUBMITTED" + " - " + request.responseText +"\n";
                             //editor.setValue("#JOB HAS ALREADY BEEN SUBMITTED" + " - " + request.responseText +"\n"  + textToSave0,1);

                             nwinputs.shift();
                             submit_splitnwchemjob_sub(nwinputs,newqwait,callback);
                             document.getElementById('apirunning').value = document.getElementById('apirunning').value.replace("+ running submit_splitnwchemjob2\n","");
                          }
                        } else {
                          console.error(request.statusText);
                          document.getElementById('runmebanner3b').innerHTML= request.statusText;
                        }
                      }
                    };
                    request.onerror = function (e) {
                      console.error(request.statusText);
                      document.getElementById('runmebanner3b').innerHTML= request.statusText;
                    };
                    request.send();
                 }
              }
           } else {
             callback("submit_splitnwchemjob");
           }
         }




        // **********************************
        // *                                *
        // *        parse_ion_motion        *
        // *                                *
        // **********************************
        function parse_ion_motion(data) {
           var datalines = data.trim().split("\n");
           var nargs = datalines[0].trim().split(/[ ,]+/).length;
           if (nargs==12) {
              var firstln= datalines[0].trim().split(/[ ,]+/);
              var nion   = parseInt(firstln[1]);
              var ss,symbol,x,y,z;
              console.log("FIRSTLN=",firstln);

              var amatrix = [parseFloat(firstln[3]) *0.529177,
                             parseFloat(firstln[4]) *0.529177,
                             parseFloat(firstln[5]) *0.529177,
                             parseFloat(firstln[6]) *0.529177,
                             parseFloat(firstln[7]) *0.529177,
                             parseFloat(firstln[8]) *0.529177,
                             parseFloat(firstln[9]) *0.529177,
                             parseFloat(firstln[10])*0.529177,
                             parseFloat(firstln[11])*0.529177];

              var newdata = nion.toString() + "\n";
              newdata += amatrix[0].toFixed(6) + " "
                      +  amatrix[1].toFixed(6) + " "
                      +  amatrix[2].toFixed(6) + " "
                      +  amatrix[3].toFixed(6) + " "
                      +  amatrix[4].toFixed(6) + " "
                      +  amatrix[5].toFixed(6) + " "
                      +  amatrix[6].toFixed(6) + " "
                      +  amatrix[7].toFixed(6) + " "
                      +  amatrix[8].toFixed(6) + "\n";

              for (var i=0; i<nion; ++i) {
                 ss = datalines[i+1].trim().split(/[ ,]+/);
                 symbol = ss[1];
                 x = parseFloat(ss[3])*0.529177;
                 y = parseFloat(ss[4])*0.529177;
                 z = parseFloat(ss[5])*0.529177;
                 newdata += symbol + " " + x.toFixed(6) + " " + y.toFixed(6) + " " + z.toFixed(6) + "\n";
              }
              return newdata;
           } else {
              return data;
           }
        }



        // This routine loads xyzdata into jmol from editor
        //load data "model example"|2|testing|C 1.22 1 1|O 12 2 2|end "model example"
        function jmloadxyz() {
           var xyz =  parse_ion_motion(editor_fetchXYZ());
           var xyzdat = "\"model editor\"|" + xyz.trim().replace(/\n/g,' | ') + "|end \"model editor\"";
           jms("load data "+xyzdat); 
           jsmcellchange(true,true);
           //setTimeout(function(){
              //your code here
              // jsmcellchange(true,true);
           //}, 100);
           Text2Speech0("Copying editor to JSMol");
           var amatrix = xyz.split("\n")[1].trim().split(/[ ,]+/);
           console.log("amatrix=",amatrix);
           if (amatrix.length==9) {
              var latxyz = xyzrow2_to_lattice(amatrix);
              document.getElementById("lattice_a1").value = vec3_to_string3(latxyz[0][0]);
              document.getElementById("lattice_a2").value = vec3_to_string3(latxyz[0][1]);
              document.getElementById("lattice_a3").value = vec3_to_string3(latxyz[0][2]);
              console.log("latxyz=",latxyz);
              jsmcellchange(false,true);
           }
           
        }

        // This routine loads nwdata, xyzdata, or cifdata into jmol from editor
        function jmloadnwxyzcif() {

        }

        // This routine appends xyzdata into jmol from editor
        function jmappendxyz() {
           var xyzdat = "\"append\"|" + editor_fetchXYZ().trim().replace(/\n/g,' | ') + "|end \"append\"";
           jms("set appendNew false; data "+xyzdat); 
           jsmcellchange(true,true);
           Text2Speech0("Appending editor to JSMol");
        }

        function jmloadtraj() {
           var i,im,data,xyz,amatrix,latxyz,nion;
           var a1,a2,a3,xyzcell;

           var nframes = window.xyzframes.length;
           if (nframes<window.xyzframes_ntotal) {
              //xyz = jmvar("data({1.1},\"xyz\")");
              xyz = jmvar("data({thisModel},\"xyz\")");
              nion = xyz.trim().split("\n").length;
              xyz  = nion + "\n\n" + xyz;
              a1 = document.getElementById("lattice_a1").value;
              a2 = document.getElementById("lattice_a2").value;
              a3 = document.getElementById("lattice_a3").value;
              xyzcell = [xyz,a1,a2,a3];
              window.xyzframes.push(xyzcell);
              window.xyzframes_cur = (window.xyzframes_cur + 1) % window.xyzframes_ntotal;
           }

	   var frames =  prompt("Please enter frames:", "1 2").trim().split(/[ ,]+/);

           for (i=0; i<frames.length; ++i) {
              im = parseInt(frames[i])-1; 
              data = window.inputframes[im];
              xyz  = parse_ion_motion(data);
              amatrix = xyz.split("\n")[1].trim().split(/[ ,]+/);
              latxyz = xyzrow2_to_lattice(amatrix);
              a1 = vec3_to_string3(latxyz[0][0]);
              a2 = vec3_to_string3(latxyz[0][1]);
              a3 = vec3_to_string3(latxyz[0][2]);

              xyzcell = [xyz,a1,a2,a3];
              window.xyzframes_ntotal += 1;
              window.xyzframes.push(xyzcell);
              
           }

           i = window.xyzframes_cur + 1;
           document.getElementById("model_label").innerHTML = "Model " + i + " out of " + window.xyzframes_ntotal;
           document.getElementById("model_label2").innerHTML = "Model " + i + " out of " + window.xyzframes_ntotal;
           Text2Speech0("Model " + i + " out of " + window.xyzframes_ntotal);
        }


        function savefile(textToSave,fileNameToSaveAs) {
           var textToSaveAsBlob = new Blob([textToSave], {type:"text/plain"});
           var textToSaveAsURL  = window.URL.createObjectURL(textToSaveAsBlob);

           var downloadLink = document.createElement("a");
           downloadLink.download = fileNameToSaveAs;
           downloadLink.innerHTML = "Download File";
           downloadLink.href = textToSaveAsURL;
           downloadLink.onclick = destroyClickedElement;
           downloadLink.style.display = "none";
           document.body.appendChild(downloadLink);

           downloadLink.click();
        }


        function editorsave() {
           var textToSave = editor.getValue();
           var filenameguess = "nwchem.xyz";
           if (textToSave.includes("geometry")) {
              filenameguess = "nwchem.nw"
           }
           var textToSaveAsBlob = new Blob([textToSave], {type:"text/plain"});
           var textToSaveAsURL  = window.URL.createObjectURL(textToSaveAsBlob);
	   var fileNameToSaveAs =  prompt("Please enter filename:", filenameguess);

           var downloadLink = document.createElement("a");
           downloadLink.download = fileNameToSaveAs;
           downloadLink.innerHTML = "Download File";
           downloadLink.href = textToSaveAsURL;
           downloadLink.onclick = destroyClickedElement;
           downloadLink.style.display = "none";
           document.body.appendChild(downloadLink);

           downloadLink.click();
        }
        function destroyClickedElement(event) {
           document.body.removeChild(event.target);
        }

        function fileprunexyzframes(filename,text) {
           var i;
           var prunedtext = "";
           var datalines  = text.trim().split("\n");
           var ndatalines = datalines.length;
           var nargs      = datalines[0].trim().split(/[ ,]+/).length;

           if (filename.includes(".xyz") || filename.includes(".ion_motion")) {
              if (filename.includes(".xyz") && (nargs==1)) {
                 var nion  = parseInt(datalines[0].trim().split(/[ ,]+/)[0]);
                 var nstride = nion + 2;
              } else if (filename.includes(".ion_motion") && (nargs==12)) {
                 var nstride = 0;
                 i = 1;
                 while ((i<ndatalines) && (nstride==0)) {
                    var nargsl  = datalines[i].trim().split(/[ ,]+/).length;
                    if (nargsl==12) {nstride = i;}
                    i += 1;
                 }
              } else {
                 return text;
              }

              var nframes = ndatalines/nstride;
              var input = prompt("Nframes="+nframes.toString()+"\nPlease enter [start [end [stride]]] (blank for whole trajectory):", "");
              var argsi = input.trim().split(/[ ,]+/);
              var start  = 0;
              var end    = nframes;
              var stride = 1;
              if (argsi.length==0) {
                 prunedtext = text;
              } else if (argsi.length==1) {
                 start = parseInt(argsi[0])-1;
                 prunedtext = datalines.slice(start*nstride,end*nstride).join("\n");
              } else if (argsi.length==2) {
                 start = parseInt(argsi[0])-1;
                 end   = parseInt(argsi[1]);
                 prunedtext = datalines.slice(start*nstride,end*nstride).join("\n");
              } else {
                 start  = parseInt(argsi[0])-1;
                 end    = parseInt(argsi[1]);
                 stride = parseInt(argsi[2]);
                 prunedtext = "";
                 for (i=start; i<end; ++i) {
                    if (((i-start)%stride)==0) {
                       prunedtext += datalines.slice(i*nstride,(i+1)*nstride).join("\n") + "\n"; 
                    }
                 }
              }
              return prunedtext;

           } else {
              return text;
           }
        }

        function loadfiletoeditor() {
           var data = "no data";
	   var fileToLoad = document.getElementById("fileToLoad").files[0];

           var fileReader = new FileReader();
           fileReader.onload = function(fileLoadedEvent) {
              var textFromFileLoaded = fileLoadedEvent.target.result;
              editor.setValue(fileprunexyzframes(fileToLoad['name'],textFromFileLoaded),1);
           };
           fileReader.readAsText(fileToLoad, "UTF-8");
        }

        function loadurltoeditor0(url0) {
           //var corh = "https://cors-anywhere.herokuapp.com/";
           var corh = ""
           var url = corh + url0;

           if (url.trim().length>9) {
              var ajax = new XMLHttpRequest();
              ajax.open("GET", url, false); // third parameter is async flag
              ajax.send();
              var textFromUrl = ajax.responseText;
              editor.setValue(textFromUrl,1);
           }
        }

        function loadurltoeditor() {
           loadurltoeditor(document.getElementById("urlToLoad").value);
        }

        function fetchurldata() {
           //var corh = "https://cors-anywhere.herokuapp.com/";
           var corh = ""
           var url = corh + document.getElementById("urlToLoad").value;
           var textFromUrl = "";
           console.log("fetching urldata");
           
           if (url.trim().length>9) {
              var ajax = new XMLHttpRequest();
              ajax.open("GET", url, false); // third parameter is async flag
              ajax.send();
              textFromUrl = ajax.responseText;
           }
           console.log("finished fetching urldata");
           return textFromUrl;
        }



        // ****************************
        // *                          *
        // *     splitparsingdata     *
        // *                          *
        // ****************************
        function splitparsingdata(parsing0,data0) {
           var parsing1 = parsing0.slice();
           var data     = data0.slice();

           console.log("parsing1=",parsing1);
           while ((parsing1.includes("split:")) && (parsing1.includes(":split"))) {
              var midstr = parsing1.split("split:")[1].split(":split")[0];
              parsing1   = parsing1.replace("split:"+midstr+":split","");
              console.log("midstr=",midstr);
              console.log("loop parsing1=",parsing1);
              if (midstr.includes("|")) {
                  var sstr = midstr.split("|")[0].trim(); 
                  if (sstr=="eoln")   { sstr = "\n";}
                  if (sstr=="spaces")  { sstr =  /[ ,]+/; }
                  var ii   = parseInt(midstr.split("|")[1].trim());
                  console.log("sstr=",sstr);
                  console.log("ii=",ii);
                  if (ii==-1) {
                     data = data.split(sstr).pop();
                  } else {
                     data = data.split(sstr)[ii];
                  }
               } else {
                  data = data.trim();
              }
           }
            
           return data;
        }

        // ****************************
        // *                          *
        // *       loadurldata        *
        // *                          *
        // ****************************

        function loadurldata(url0) {
           //var corh = "https://cors-anywhere.herokuapp.com/"
           var corh = "";
           var url = corh + url0;
           var data = "";

           if (url.trim().length>9) {
              var ajax = new XMLHttpRequest();
              ajax.open("GET", url, false); // third parameter is async flag
              ajax.send();
              data = ajax.responseText;
           }

           return data;
        }


        // ****************************
        // *                          *
        // *         newgenbulk       *
        // *                          *
        // ****************************
        /*  Generate bulk crystal structures

           a: Lattice constant.
           b: Lattice constant. 
           c: Lattice constant.
           alpha: Angle in degrees for rhombohedral lattice. for mcl this value is used as beta
           covera: c/a ratio used for hcp.  Default is ideal ratio: sqrt(8/3).
           u: Internal coordinate for Wurtzite structure.
           bt: crystal type  - sc, fcc, bcc, tetragonal, bct, hcp, rhombohedral, orthorhombic, mlc, diamond, zincblende, rocksalt, cesiumchloride, fluorite or wurtzite.
           bn: chemical symbol names
           bp: if true, construct primitive cell, otherwize orthorhomiccell
           bc: if true, construct cubic unit cell if possible.
        */
        function newgenbulk(a,b,c,covera,alpha,u,bt,bn,bp,bc) {
           var lattice,xyzdat;

           //Simple Cube or Cesium Chloride
           if ((bt=="sc")||(bt=="cesiumchloride")) {
              var aa2 = a/2.0;
              lattice = abcabg_to_lattice(a,a,a,90.0,90.0,90.0);
              var ss = bn.trim().split(/[ ,]+/);
              var s1 = ss[0];
              var s2 = s1;
              if (ss.length>1) { s2 = ss[1]; }
              if (bt=="sc") {
                 xyzdat = "1\n\n";
                 xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
              } else {
                 xyzdat = "2\n\n";
                 xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
                 xyzdat += s2.trim() + " " + aa2.toFixed(6) + " " + aa2.toFixed(6) + " " + aa2.toFixed(6) + "\n";
              }
           }

           //fcc,diamond,zincblende,rocksalt and primitive and not cubic  or fluorite
           if ((((bt=="fcc")||(bt=="diamond")||(bt=="zincblende")||(bt=="rocksalt"))&&(bp)&&(!bc))||(bt=="fluorite")) {
              var aa = a/2.0;
              var zz = 0.0;
              var a1 = aa.toFixed(6) + " " + aa.toFixed(6) + " " + zz.toFixed(6);
              var a2 = aa.toFixed(6) + " " + zz.toFixed(6) + " " + aa.toFixed(6);
              var a3 = zz.toFixed(6) + " " + aa.toFixed(6) + " " + aa.toFixed(6);
              lattice = a1a2a3_to_lattice(string3_to_vec3(a1),string3_to_vec3(a2),string3_to_vec3(a3));

              var ss = bn.trim().split(/[ ,]+/);
              var s1 = ss[0];
              var s2 = s1;
              if (ss.length>1) { s2 = ss[1]; }
              var s3 = s2;
              if (ss.length>2) { s3 = ss[2]; }
              if (bt=="fcc") {
                 xyzdat = "1\n\n";
                 xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
              } else if ((bt=="zincblende") || (bt=="diamond")|| (bt=="rocksalt")) {
                 if (bt=="rocksalt") {
                    var aa2 = a/2.0;
                    xyzdat = "2\n\n";
                    xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
                    xyzdat += s2.trim() + " " + aa2.toFixed(6) + " 0.0 0.0\n";
                 } else {
                    var aa4 = a/4.0;
                    xyzdat = "2\n\n";
                    xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
                    xyzdat += s2.trim() + " " + aa4.toFixed(6) + " " + aa4.toFixed(6) + " " + aa4.toFixed(6) + "\n";
                 }
              } else {
                 var aa4 = a/4.0;
                 var aa34 = 3.0*a/4.0;
                 xyzdat = "3\n\n";
                 xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
                 xyzdat += s2.trim() + " " + aa4.toFixed(6) + " " + aa4.toFixed(6) + " " + aa4.toFixed(6) + "\n";
                 xyzdat += s3.trim() + " " + aa34.toFixed(6) + " " + aa34.toFixed(6) + " " + aa34.toFixed(6) + "\n";
                 console.log("a1=",a1);
                 console.log("a2=",a2);
                 console.log("a3=",a3);
              }
           }

           //fcc,diamond,zincblende,rocksalt and  orthorhombic and not cubic
           if (((bt=="fcc")||(bt=="diamond")||(bt=="zincblende")||(bt=="rocksalt"))  && (!bp) && (!bc)) {
              var bb = a/Math.sqrt(2.0);
              var aa2 = a/2.0;
              var aa4 = a/4.0;
              var aa34 = 3*a/4.0;
              var bb2 = bb/2.0;
              var zz = 0.0;
              lattice = abcabg_to_lattice(bb,bb,a,a,90.0,90.0,90.0);

              var ss = bn.trim().split(/[ ,]+/);
              var s1 = ss[0];
              var s2 = s1;
              if (ss.length>1) { s2 = ss[1]; }
              if (bt=="fcc") {
                 xyzdat = "2\n\n";
                 xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
                 xyzdat += s2.trim() + " " + bb2.toFixed(6) + " " +  bb2.toFixed(6) + " " + aa2.toFixed(6) + "\n";
              } else if ((bt=="diamond")||(bt=="zincblende")) {
                 xyzdat = "4\n\n";
                 xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
                 xyzdat += s2.trim() + " " + bb2.toFixed(6) + " " +  zz.toFixed(6) + " " + aa4.toFixed(6) + "\n";
                 xyzdat += s1.trim() + " " + bb2.toFixed(6) + " " +  bb2.toFixed(6) + " " + aa2.toFixed(6) + "\n";
                 xyzdat += s2.trim() + " " + zz.toFixed(6) + " " +  bb2.toFixed(6) + " " + aa34.toFixed(6) + "\n";
              } else {
                 xyzdat = "4\n\n";
                 xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
                 xyzdat += s2.trim() + " " + bb2.toFixed(6) + " " +  bb2.toFixed(6) + " " + zz.toFixed(6) + "\n";
                 xyzdat += s1.trim() + " " + bb2.toFixed(6) + " " +  bb2.toFixed(6) + " " + aa2.toFixed(6) + "\n";
                 xyzdat += s2.trim() + " " + zz.toFixed(6) + " " +  zz.toFixed(6) + " " + aa2.toFixed(6) + "\n";
              }
           }

           //fcc,diamond,zincblende,rocksalt and cubic
           if (((bt=="fcc")||(bt=="diamond")||(bt=="zincblende")||(bt=="rocksalt")) && bc) {
              var aa2 = a/2.0;
              var aa4 = a/4.0;
              var aa34 = 3*a/4.0;
              var zz = 0.0;
              lattice = abcabg_to_lattice(a,a,a,90.0,90.0,90.0);
              var ss = bn.trim().split(/[ ,]+/);
              var s1 = ss[0];
              var s2 = s1;
              if (ss.length>1) { s2 = ss[1]; }
              if (bt=="fcc") {
                 xyzdat = "4\n\n";
                 xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
                 xyzdat += s2.trim() + " 0.0 " + aa2.toFixed(6) + " " + aa2.toFixed(6) + "\n";
                 xyzdat += s2.trim() + " " + aa2.toFixed(6) + " 0.0 " + aa2.toFixed(6) + "\n";
                 xyzdat += s2.trim() + " " + aa2.toFixed(6) + " " + aa2.toFixed(6) + " 0.0\n";
              } else if ((bt=="diamond")||(bt=="zincblende")) {
                 xyzdat = "8\n\n";
                 xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
                 xyzdat += s2.trim() + " " + aa4.toFixed(6) + " " + aa4.toFixed(6) + " " + aa4.toFixed(6) + "\n";
                 xyzdat += s1.trim() + " 0.0 " + aa2.toFixed(6) + " " + aa2.toFixed(6) + "\n";
                 xyzdat += s2.trim() + " " + aa4.toFixed(6) + " " + aa34.toFixed(6) + " " + aa34.toFixed(6) + "\n";
                 xyzdat += s1.trim() + " " + aa2.toFixed(6) + " 0.0 " + aa2.toFixed(6) + "\n";
                 xyzdat += s2.trim() + " " + aa34.toFixed(6) + " " + aa4.toFixed(6) + " " + aa34.toFixed(6) + "\n";
                 xyzdat += s1.trim() + " " + aa2.toFixed(6) + " " + aa2.toFixed(6) + " 0.0\n";
                 xyzdat += s2.trim() + " " + aa34.toFixed(6) + " " + aa34.toFixed(6) + " " + aa4.toFixed(6) + "\n";
              } else {
                 xyzdat = "8\n\n";
                 xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
                 xyzdat += s2.trim() + " " + aa2.toFixed(6) + " " + zz.toFixed(6) + " " + zz.toFixed(6) + "\n";
                 xyzdat += s1.trim() + " 0.0 " + aa2.toFixed(6) + " " + aa2.toFixed(6) + "\n";
                 xyzdat += s2.trim() + " " + aa2.toFixed(6) + " " + aa2.toFixed(6) + " " + aa2.toFixed(6) + "\n";
                 xyzdat += s1.trim() + " " + aa2.toFixed(6) + " 0.0 " + aa2.toFixed(6) + "\n";
                 xyzdat += s2.trim() + " " + zz.toFixed(6) + " " + zz.toFixed(6) + " " + aa2.toFixed(6) + "\n";
                 xyzdat += s1.trim() + " " + aa2.toFixed(6) + " " + aa2.toFixed(6) + " 0.0\n";
                 xyzdat += s2.trim() + " " + zz.toFixed(6) + " " + aa2.toFixed(6) + " " + zz.toFixed(6) + "\n";
              }
           }

           //bcc  and primitive and not cubic
           if ((bt=="bcc") && (bp) && (!bc)) {
              var aa = a/2.0;
              var maa = -aa;
              var a1 = maa.toFixed(6) + " " + aa.toFixed(6) + " " + aa.toFixed(6);
              var a2 = aa.toFixed(6) + " " + maa.toFixed(6) + " " + aa.toFixed(6);
              var a3 = aa.toFixed(6) + " " + aa.toFixed(6) + " " + maa.toFixed(6);
              lattice = a1a2a3_to_lattice(string3_to_vec3(a1),string3_to_vec3(a2),string3_to_vec3(a3));

              var ss = bn.trim().split(/[ ,]+/);
              var s1 = ss[0];
              var s2 = s1;
              if (ss.length>1) { s2 = ss[1]; }
              xyzdat = "1\n\n";
              xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
           }

           //bcc and not primitive and cubic
           if ((bt=="bcc") && ((!bp) || bc)) {
              var aa2 = a/2.0;
              lattice = abcabg_to_lattice(a,a,a,90.0,90.0,90.0);

              var ss = bn.trim().split(/[ ,]+/);
              var s1 = ss[0];
              var s2 = s1;
              if (ss.length>1) { s2 = ss[1]; }
              xyzdat = "2\n\n";
              xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
              xyzdat += s2.trim() + " " + aa2.toFixed(6) + " " +  aa2.toFixed(6) + " " + aa2.toFixed(6) + "\n";
           }

           //hcp,wurtzite and primitive
           if (((bt=="hcp")||(bt=="wurtzite")) && (bp)) {
              var maa = -a/2.0;
              var zz = 0.0;
              var ca = Math.sqrt(8.0/3.0)
              if (c>1.0e-3) {
                 ca = a/c;
              }
              var aa32 = a*Math.sqrt(3)/2.0;
              var caa = ca*a;

              var a1 = a.toFixed(6)   + " " + zz.toFixed(6)   + " " + zz.toFixed(6);
              var a2 = maa.toFixed(6) + " " + aa32.toFixed(6) + " " + zz.toFixed(6);
              var a3 = zz.toFixed(6) + " " + zz.toFixed(6)    + " " + caa.toFixed(6);
              lattice = a1a2a3_to_lattice(string3_to_vec3(a1),string3_to_vec3(a2),string3_to_vec3(a3));

              var ss = bn.trim().split(/[ ,]+/);
              var s1 = ss[0];
              var s2 = s1;
              if (ss.length>1) { s2 = ss[1]; }
              if (bt=="hcp") {
                 var x = 0.0;
                 var y = a * Math.sqrt(3.0)/3.0;
                 var z = caa/2.0;
                 xyzdat = "2\n\n";
                 xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
                 xyzdat += s2.trim() + " " + x.toFixed(6) + " " + y.toFixed(6) + " " + z.toFixed(6) + "\n";
              } else {
                 if (u<1.0e-3) { u = 0.25 + (1.0/3.0)/(ca*ca); }
                 xyzdat = "4\n\n";
                 xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
                 var x = 1.0/3.0*a  + 2.0/3.0*maa  + (0.5-u)*zz;
                 var y = 1.0/3.0*zz + 2.0/3.0*aa32 + (0.5-u)*zz;
                 var z = 1.0/3.0*zz + 2.0/3.0*zz   + (0.5-u)*caa;
                 xyzdat += s2.trim() + " " + x.toFixed(6) + " " + y.toFixed(6) + " " + z.toFixed(6) + "\n";
                 x = 1.0/3.0*a  + 2.0/3.0*maa  + (0.5)*zz;
                 y = 1.0/3.0*zz + 2.0/3.0*aa32 + (0.5)*zz;
                 z = 1.0/3.0*zz + 2.0/3.0*zz   + (0.5)*caa;
                 xyzdat += s1.trim() + " " + x.toFixed(6) + " " + y.toFixed(6) + " " + z.toFixed(6) + "\n";
                 x = 0.0*a  + 0.0*maa  + (1.0-u)*zz;
                 y = 0.0*zz + 0.0*aa32 + (1.0-u)*zz;
                 z = 0.0*zz + 0.0*zz   + (1.0-u)*caa;
                 xyzdat += s2.trim() + " " + x.toFixed(6) + " " + y.toFixed(6) + " " + z.toFixed(6) + "\n";
              }
           }

           //hcp,wurtzite and not primitive
           if (((bt=="hcp")||(bt=="wurtzite")) && (!bp)) {
              var zz = 0.0;
              var ca = Math.sqrt(8.0/3.0)
              if (c>1.0e-3) {
                 ca = a/c;
              }
              var aa2  = a/2.0;
              var aa32  = a*Math.sqrt(3.0)/2.0;
              var aa36  = a*Math.sqrt(3.0)/6.0;
              var aa323  = 2.0*a*Math.sqrt(3.0)/3.0;
              var caa2 = ca*a/2.0;

              lattice = abcabg_to_lattice(a,a*Math.sqrt(3.0),ca*a,90.0,90.0,90.0);

              var ss = bn.trim().split(/[ ,]+/);
              var s1 = ss[0];
              var s2 = s1;
              if (ss.length>1) { s2 = ss[1]; }
              if (bt=="hcp") {
                 xyzdat = "4\n\n";
                 xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
                 xyzdat += s2.trim() + " " + aa2.toFixed(6) + " " +  aa32.toFixed(6) + " " + zz.toFixed(6) + "\n";
                 xyzdat += s2.trim() + " " + aa2.toFixed(6) + " " +  aa36.toFixed(6) + " " + caa2.toFixed(6) + "\n";
                 xyzdat += s1.trim() + " " + zz.toFixed(6) + " " +  aa323.toFixed(6) + " " + caa2.toFixed(6) + "\n";
              } else {
                 if (u<1.0e-3) { u = 0.25 + (1.0/3.0)/(ca*ca); }
                 xyzdat = "8\n\n";
                 xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
                 var x = 0.0*a;
                 var y = 1/3.0*a*Math.sqrt(3.0);
                 var z = (0.5-u)*ca*a;
                 xyzdat += s2.trim() + " " + x.toFixed(6) + " " + y.toFixed(6) + " " + z.toFixed(6) + "\n";
                 x = 0.0*a; y = 1/3.0*a*Math.sqrt(3.0);   z = (0.5)*ca*a;
                 xyzdat += s1.trim() + " " + x.toFixed(6) + " " + y.toFixed(6) + " " + z.toFixed(6) + "\n";
                 x = 0.0*a; y = 0.0*a*Math.sqrt(3.0);     z = (1.0-u)*ca*a;
                 xyzdat += s2.trim() + " " + x.toFixed(6) + " " + y.toFixed(6) + " " + z.toFixed(6) + "\n";
                 x = 0.5*a; y = 0.5*a*Math.sqrt(3.0);     z = 0.0*ca*a;
                 xyzdat += s1.trim() + " " + x.toFixed(6) + " " + y.toFixed(6) + " " + z.toFixed(6) + "\n";
                 x = 0.5*a; y = 5.0/6.0*a*Math.sqrt(3.0); z = (0.5-u)*ca*a;
                 xyzdat += s2.trim() + " " + x.toFixed(6) + " " + y.toFixed(6) + " " + z.toFixed(6) + "\n";
                 x = 0.5*a; y = 5.0/6.0*a*Math.sqrt(3.0); z = (0.5)*ca*a;
                 xyzdat += s1.trim() + " " + x.toFixed(6) + " " + y.toFixed(6) + " " + z.toFixed(6) + "\n";
                 x = 0.5*a; y = 0.5*a*Math.sqrt(3.0);     z = (1.0-u)*ca*a;
                 xyzdat += s2.trim() + " " + x.toFixed(6) + " " + y.toFixed(6) + " " + z.toFixed(6) + "\n";
              }

           }

           //graphite lattice - rhombohedral -  primive
           if ( (bt=="graphite") && (bp) && (!bc)) {
              var d = Math.sqrt(3.0)/3.0*a;

              var x = d*Math.sqrt(3.0)/2.0; var y = d*0.5; var z = c*0.5;
              var a1 = x.toFixed(6) + " " + y.toFixed(6) + " " + z.toFixed(6);
              x = 0.0; y=d; z=c*0.5;
              var a2 = x.toFixed(6) + " " + y.toFixed(6) + " " + z.toFixed(6);
              x = -d*Math.sqrt(3.0)/2.0; y= -d*0.5; z=c*0.5;
              var a3 = x.toFixed(6) + " " + y.toFixed(6) + " " + z.toFixed(6);
              lattice = a1a2a3_to_lattice(string3_to_vec3(a1),string3_to_vec3(a2),string3_to_vec3(a3));

              var ss = bn.trim().split(/[ ,]+/);
              var s1 = ss[0];
              var s2 = s1;
              xyzdat = "2\n\n";
              x = 0.0; y=0.0; z=0.0;
              xyzdat += s1.trim() + " " + x.toFixed(6) + " " + y.toFixed(6) + " " + z.toFixed(6) + "\n";
              x = 0.0; y=0.0; z=c*0.5;
              xyzdat += s1.trim() + " " + x.toFixed(6) + " " + y.toFixed(6) + " " + z.toFixed(6) + "\n";
           }

           //graphite lattice - hexagonal - not primive
           //a1 = a*[sqrt(3)/2, -1/2, 0]
           //a2 = a*[0,            1, 0]
           //a3 = c*[0,            0, 1]
           // f1=0.333333, f2=0.666667, f3 = 0
           // x = f1*a1x + f2*a2x + f3*a3x =  1/3*sqrt(3)/2*a  = sqrt(3)/6 * a
           // y = f1*a1y + f2*a2y + f3*a3y = 1/3*(-1/2)*a + 2/3*1*a = 2/3 - 1/6 = 1/2 * a
           // z = f1*a1z + f2*a2z + f3*a3z  = 0
           // f1=0.666667, f2=0.333333, f3 = 0
           // x = f1*a1x + f2*a2x + f3*a3x = (2/3)*sqrt(3)/2*a + (1/3)*0*a = sqrt(3)/3.0*a
           // y = f1*a1y + f2*a2y + f3*a3y = (2/3)*(-1/2)*a + (1/3)*1*a = 0
           // z = f1*a1z + f2*a2z + f3*a3z = 0
           if ((bt=="graphite") && (!bp)) {
              lattice = abcabg_to_lattice(a,a,c,90.0,90.0,120.0);

              var ss = bn.trim().split(/[ ,]+/);
              var s1 = ss[0];
              var s2 = s1;
              var x = 0.0;     var y = 0.0;           var z = 0.0;
              xyzdat = "4\n\n";
              xyzdat += s1.trim() + " " + x.toFixed(6) + " " + y.toFixed(6) + " " + z.toFixed(6) + "\n";
              x = Math.sqrt(3.0)/6.0*a; y = a/2.0; z= 0.0;
              xyzdat += s1.trim() + " " + x.toFixed(6) + " " + y.toFixed(6) + " " + z.toFixed(6) + "\n";
              x = 0.0;              y = 0.0; z = 0.5*c;
              xyzdat += s1.trim() + " " + x.toFixed(6) + " " + y.toFixed(6) + " " + z.toFixed(6) + "\n";
              x = Math.sqrt(3.0)/3.0*a; y= 0.0; z= 0.5*c
              xyzdat += s1.trim() + " " + x.toFixed(6) + " " + y.toFixed(6) + " " + z.toFixed(6) + "\n";
           }

           //graphene, graphite-1layer lattice
           //a1 = a*[sqrt(3)/2, -1/2, 0]
           //a2 = a*[0,            1, 0]
           //a3 = c*[0,            0, 1]
           // f1=0.333333, f2=0.666667, f3 = 0
           // x = f1*a1x + f2*a2x + f3*a3x =  1/3*sqrt(3)/2*a  = sqrt(3)/6 * a
           // y = f1*a1y + f2*a2y + f3*a3y = 1/3*(-1/2)*a + 2/3*1*a = 2/3 - 1/6 = 1/2 * a
           // z = f1*a1z + f2*a2z + f3*a3z  = 0
           if (bt=="graphene") {
              lattice = abcabg_to_lattice(a,a,c,90.0,90.0,120.0);

              var ss = bn.trim().split(/[ ,]+/);
              var s1 = ss[0];
              var s2 = s1;
              var x = 0.0;     var y = 0.0; var z = 0.0;
              xyzdat = "2\n\n";
              xyzdat += s1.trim() + " " + x.toFixed(6) + " " + y.toFixed(6) + " " + z.toFixed(6) + "\n";
              x = (Math.sqrt(3.0)/6.0)*a; y = a/2.0;    z= 0.0
              xyzdat += s1.trim() + " " + x.toFixed(6) + " " + y.toFixed(6) + " " + z.toFixed(6) + "\n";
           }

           if (bt=="bct") {
              lattice = abcabg_to_lattice(a,b,c,90.0,90.0,90.0);

              var ss = bn.trim().split(/[ ,]+/);
              var s1 = ss[0];
              var s2 = s1;
              xyzdat = "1\n\n";
              xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
           }

           if (bt=="mcl") {
              lattice = abcabg_to_lattice(a,b,c,90.0,alpha,90.0);

              var ss = bn.trim().split(/[ ,]+/);
              var s1 = ss[0];
              var s2 = s1;
              xyzdat = "1\n\n";
              xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
           }

           if (bt=="rhombohedral") {
              lattice = abcabg_to_lattice(a,a,a,alpha,alpha,alpha);

              var ss = bn.trim().split(/[ ,]+/);
              var s1 = ss[0];
              var s2 = s1;
              xyzdat = "1\n\n";
              xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
           }

           if (bt=="tetragonal") {
              lattice = abcabg_to_lattice(a,a,c,90.0,90.0,90.0);

              var ss = bn.trim().split(/[ ,]+/);
              var s1 = ss[0];
              var s2 = s1;
              xyzdat = "1\n\n";
              xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
           }

           if (bt=="orthorhombic") {
              lattice = abcabg_to_lattice(a,b,c,90.0,90.0,90.0);

              var ss = bn.trim().split(/[ ,]+/);
              var s1 = ss[0];
              var s2 = s1;
              xyzdat = "1\n\n";
              xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
           }
           return [lattice,xyzdat];
        }




        // ****************************
        // *                          *
        // *         genbulk          *
        // *                          *
        // ****************************
        // This routine generates a bulk cell for various types of unit cells.
        function genbulk(a,c,u,bt,bn,bp,bc) {
           var lattice,xyzdat;
           console.log("a=",a);
           console.log("c=",c);
           console.log("u=",u);
           console.log("bt=",bt);
           console.log("bn=",bn);
           console.log("bc=",bc);
           if ((bt=="sc")||(bt=="cesiumchloride")) {
              var aa2 = a/2.0;
              lattice = abcabg_to_lattice(a,a,a,90.0,90.0,90.0);
              var ss = bn.trim().split(/[ ,]+/);
              var s1 = ss[0];
              var s2 = s1;
              if (ss.length>1) { s2 = ss[1]; }
              if (bt=="sc") {
                 xyzdat = "1\n\n";
                 xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
              } else {
                 xyzdat = "2\n\n";
                 xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
                 xyzdat += s2.trim() + " " + aa2.toFixed(6) + " " + aa2.toFixed(6) + " " + aa2.toFixed(6) + "\n";
              }
           }
           if ((((bt=="fcc")||(bt=="diamond")||(bt=="zincblende")||(bt=="rocksalt"))&&(bp)&&(!bc))||(bt=="fluorite")) {
              var aa = a/2.0;
              var zz = 0.0;
              var a1 = aa.toFixed(6) + " " + aa.toFixed(6) + " " + zz.toFixed(6);
              var a2 = aa.toFixed(6) + " " + zz.toFixed(6) + " " + aa.toFixed(6);
              var a3 = zz.toFixed(6) + " " + aa.toFixed(6) + " " + aa.toFixed(6);
              lattice = a1a2a3_to_lattice(string3_to_vec3(a1),string3_to_vec3(a2),string3_to_vec3(a3));

              var ss = bn.trim().split(/[ ,]+/);
              var s1 = ss[0];
              var s2 = s1;
              if (ss.length>1) { s2 = ss[1]; }
              var s3 = s2;
              if (ss.length>2) { s3 = ss[2]; }
              if (bt=="fcc") {
                 xyzdat = "1\n\n";
                 xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
              } else if ((bt=="zincblende") || (bt=="diamond")|| (bt=="rocksalt")) {
                 if (bt=="rocksalt") {
                    var aa2 = a/2.0;
                    xyzdat = "2\n\n";
                    xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
                    xyzdat += s2.trim() + " " + aa2.toFixed(6) + " 0.0 0.0\n";
                 } else {
                    var aa4 = a/4.0;
                    xyzdat = "2\n\n";
                    xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
                    xyzdat += s2.trim() + " " + aa4.toFixed(6) + " " + aa4.toFixed(6) + " " + aa4.toFixed(6) + "\n";
                 }
              } else {
                 var aa4 = a/4.0;
                 var aa34 = 3.0*a/4.0;
                 xyzdat = "3\n\n";
                 xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
                 xyzdat += s2.trim() + " " + aa4.toFixed(6) + " " + aa4.toFixed(6) + " " + aa4.toFixed(6) + "\n";
                 xyzdat += s3.trim() + " " + aa34.toFixed(6) + " " + aa34.toFixed(6) + " " + aa34.toFixed(6) + "\n";
                 console.log("a1=",a1);
                 console.log("a2=",a2);
                 console.log("a3=",a3);
              }
           }
           if (((bt=="fcc")||(bt=="diamond")||(bt=="zincblende")||(bt=="rocksalt"))  && (!bp) && (!bc)) {
              var bb = a/Math.sqrt(2.0);
              var aa2 = a/2.0;
              var aa4 = a/4.0;
              var aa34 = 3*a/4.0;
              var bb2 = bb/2.0;
              var zz = 0.0;
              lattice = abcabg_to_lattice(bb,bb,a,a,90.0,90.0,90.0);

              var ss = bn.trim().split(/[ ,]+/);
              var s1 = ss[0];
              var s2 = s1;
              if (ss.length>1) { s2 = ss[1]; }
              if (bt=="fcc") {
                 xyzdat = "2\n\n";
                 xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
                 xyzdat += s2.trim() + " " + bb2.toFixed(6) + " " +  bb2.toFixed(6) + " " + aa2.toFixed(6) + "\n";
              } else if ((bt=="diamond")||(bt=="zincblende")) {
                 xyzdat = "4\n\n";
                 xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
                 xyzdat += s2.trim() + " " + bb2.toFixed(6) + " " +  zz.toFixed(6) + " " + aa4.toFixed(6) + "\n";
                 xyzdat += s1.trim() + " " + bb2.toFixed(6) + " " +  bb2.toFixed(6) + " " + aa2.toFixed(6) + "\n";
                 xyzdat += s2.trim() + " " + zz.toFixed(6) + " " +  bb2.toFixed(6) + " " + aa34.toFixed(6) + "\n";
              } else {
                 xyzdat = "4\n\n";
                 xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
                 xyzdat += s2.trim() + " " + bb2.toFixed(6) + " " +  bb2.toFixed(6) + " " + zz.toFixed(6) + "\n";
                 xyzdat += s1.trim() + " " + bb2.toFixed(6) + " " +  bb2.toFixed(6) + " " + aa2.toFixed(6) + "\n";
                 xyzdat += s2.trim() + " " + zz.toFixed(6) + " " +  zz.toFixed(6) + " " + aa2.toFixed(6) + "\n";
              }
           }

           if (((bt=="fcc")||(bt=="diamond")||(bt=="zincblende")||(bt=="rocksalt")) && bc) {
              var aa2 = a/2.0;
              var aa4 = a/4.0;
              var aa34 = 3*a/4.0;
              var zz = 0.0;
              lattice = abcabg_to_lattice(a,a,a,90.0,90.0,90.0);
              var ss = bn.trim().split(/[ ,]+/);
              var s1 = ss[0];
              var s2 = s1;
              if (ss.length>1) { s2 = ss[1]; }
              if (bt=="fcc") {
                 xyzdat = "4\n\n";
                 xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
                 xyzdat += s2.trim() + " 0.0 " + aa2.toFixed(6) + " " + aa2.toFixed(6) + "\n";
                 xyzdat += s2.trim() + " " + aa2.toFixed(6) + " 0.0 " + aa2.toFixed(6) + "\n";
                 xyzdat += s2.trim() + " " + aa2.toFixed(6) + " " + aa2.toFixed(6) + " 0.0\n";
              } else if ((bt=="diamond")||(bt=="zincblende")) {
                 xyzdat = "8\n\n";
                 xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
                 xyzdat += s2.trim() + " " + aa4.toFixed(6) + " " + aa4.toFixed(6) + " " + aa4.toFixed(6) + "\n";
                 xyzdat += s1.trim() + " 0.0 " + aa2.toFixed(6) + " " + aa2.toFixed(6) + "\n";
                 xyzdat += s2.trim() + " " + aa4.toFixed(6) + " " + aa34.toFixed(6) + " " + aa34.toFixed(6) + "\n";
                 xyzdat += s1.trim() + " " + aa2.toFixed(6) + " 0.0 " + aa2.toFixed(6) + "\n";
                 xyzdat += s2.trim() + " " + aa34.toFixed(6) + " " + aa4.toFixed(6) + " " + aa34.toFixed(6) + "\n";
                 xyzdat += s1.trim() + " " + aa2.toFixed(6) + " " + aa2.toFixed(6) + " 0.0\n";
                 xyzdat += s2.trim() + " " + aa34.toFixed(6) + " " + aa34.toFixed(6) + " " + aa4.toFixed(6) + "\n";
              } else {
                 xyzdat = "8\n\n";
                 xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
                 xyzdat += s2.trim() + " " + aa2.toFixed(6) + " " + zz.toFixed(6) + " " + zz.toFixed(6) + "\n";
                 xyzdat += s1.trim() + " 0.0 " + aa2.toFixed(6) + " " + aa2.toFixed(6) + "\n";
                 xyzdat += s2.trim() + " " + aa2.toFixed(6) + " " + aa2.toFixed(6) + " " + aa2.toFixed(6) + "\n";
                 xyzdat += s1.trim() + " " + aa2.toFixed(6) + " 0.0 " + aa2.toFixed(6) + "\n";
                 xyzdat += s2.trim() + " " + zz.toFixed(6) + " " + zz.toFixed(6) + " " + aa2.toFixed(6) + "\n";
                 xyzdat += s1.trim() + " " + aa2.toFixed(6) + " " + aa2.toFixed(6) + " 0.0\n";
                 xyzdat += s2.trim() + " " + zz.toFixed(6) + " " + aa2.toFixed(6) + " " + zz.toFixed(6) + "\n";
              }
           }
           if ((bt=="bcc") && (bp) && (!bc)) {
              var aa = a/2.0;
              var maa = -aa;
              var a1 = maa.toFixed(6) + " " + aa.toFixed(6) + " " + aa.toFixed(6);
              var a2 = aa.toFixed(6) + " " + maa.toFixed(6) + " " + aa.toFixed(6);
              var a3 = aa.toFixed(6) + " " + aa.toFixed(6) + " " + maa.toFixed(6);
              lattice = a1a2a3_to_lattice(string3_to_vec3(a1),string3_to_vec3(a2),string3_to_vec3(a3));

              var ss = bn.trim().split(/[ ,]+/);
              var s1 = ss[0];
              var s2 = s1;
              if (ss.length>1) { s2 = ss[1]; }
              xyzdat = "1\n\n";
              xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
           }
           if ((bt=="bcc") && ((!bp) || bc)) {
              var aa2 = a/2.0;
              lattice = abcabg_to_lattice(a,a,a,90.0,90.0,90.0);

              var ss = bn.trim().split(/[ ,]+/);
              var s1 = ss[0];
              var s2 = s1;
              if (ss.length>1) { s2 = ss[1]; }
              xyzdat = "2\n\n";
              xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
              xyzdat += s2.trim() + " " + aa2.toFixed(6) + " " +  aa2.toFixed(6) + " " + aa2.toFixed(6) + "\n";
           }
           if (((bt=="hcp")||(bt=="wurtzite")) && (bp)) {
              var maa = -a/2.0;
              var zz = 0.0;
              var ca = Math.sqrt(8.0/3.0)
              if (c>1.0e-3) {
                 ca = a/c;
              } 
              var aa32 = a*Math.sqrt(3)/2.0;
              var caa = ca*a;

              var a1 = a.toFixed(6)   + " " + zz.toFixed(6)   + " " + zz.toFixed(6);
              var a2 = maa.toFixed(6) + " " + aa32.toFixed(6) + " " + zz.toFixed(6);
              var a3 = zz.toFixed(6) + " " + zz.toFixed(6)    + " " + caa.toFixed(6);
              lattice = a1a2a3_to_lattice(string3_to_vec3(a1),string3_to_vec3(a2),string3_to_vec3(a3));

              var ss = bn.trim().split(/[ ,]+/);
              var s1 = ss[0];
              var s2 = s1;
              if (ss.length>1) { s2 = ss[1]; }
              if (bt=="hcp") { 
                 var x = 0.0;
                 var y = a * Math.sqrt(3.0)/3.0;
                 var z = caa/2.0;
                 xyzdat = "2\n\n";
                 xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
                 xyzdat += s2.trim() + " " + x.toFixed(6) + " " + y.toFixed(6) + " " + z.toFixed(6) + "\n";
              } else {
                 if (u<1.0e-3) { u = 0.25 + (1.0/3.0)/(ca*ca); }
                 xyzdat = "4\n\n";
                 xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
                 var x = 1.0/3.0*a  + 2.0/3.0*maa  + (0.5-u)*zz;
                 var y = 1.0/3.0*zz + 2.0/3.0*aa32 + (0.5-u)*zz;
                 var z = 1.0/3.0*zz + 2.0/3.0*zz   + (0.5-u)*caa;
                 xyzdat += s2.trim() + " " + x.toFixed(6) + " " + y.toFixed(6) + " " + z.toFixed(6) + "\n";
                 x = 1.0/3.0*a  + 2.0/3.0*maa  + (0.5)*zz;
                 y = 1.0/3.0*zz + 2.0/3.0*aa32 + (0.5)*zz;
                 z = 1.0/3.0*zz + 2.0/3.0*zz   + (0.5)*caa;
                 xyzdat += s1.trim() + " " + x.toFixed(6) + " " + y.toFixed(6) + " " + z.toFixed(6) + "\n";
                 x = 0.0*a  + 0.0*maa  + (1.0-u)*zz;
                 y = 0.0*zz + 0.0*aa32 + (1.0-u)*zz;
                 z = 0.0*zz + 0.0*zz   + (1.0-u)*caa;
                 xyzdat += s2.trim() + " " + x.toFixed(6) + " " + y.toFixed(6) + " " + z.toFixed(6) + "\n";
              }
           }
           if (((bt=="hcp")||(bt=="wurtzite")) && (!bp)) {
              var zz = 0.0;
              var ca = Math.sqrt(8.0/3.0)
              if (c>1.0e-3) {
                 ca = a/c;
              } 
              var aa2  = a/2.0;
              var aa32  = a*Math.sqrt(3.0)/2.0;
              var aa36  = a*Math.sqrt(3.0)/6.0;
              var aa323  = 2.0*a*Math.sqrt(3.0)/3.0;
              var caa2 = ca*a/2.0;

              lattice = abcabg_to_lattice(a,a*Math.sqrt(3.0),ca*a,90.0,90.0,90.0);

              var ss = bn.trim().split(/[ ,]+/);
              var s1 = ss[0];
              var s2 = s1;
              if (ss.length>1) { s2 = ss[1]; }
              if (bt=="hcp") {
                 xyzdat = "4\n\n";
                 xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
                 xyzdat += s2.trim() + " " + aa2.toFixed(6) + " " +  aa32.toFixed(6) + " " + zz.toFixed(6) + "\n";
                 xyzdat += s2.trim() + " " + aa2.toFixed(6) + " " +  aa36.toFixed(6) + " " + caa2.toFixed(6) + "\n";
                 xyzdat += s1.trim() + " " + zz.toFixed(6) + " " +  aa323.toFixed(6) + " " + caa2.toFixed(6) + "\n";
              } else {
                 if (u<1.0e-3) { u = 0.25 + (1.0/3.0)/(ca*ca); }
                 xyzdat = "8\n\n";
                 xyzdat += s1.trim() + " 0.0 0.0 0.0\n";
                 var x = 0.0*a;
                 var y = 1/3.0*a*Math.sqrt(3.0);
                 var z = (0.5-u)*ca*a;
                 xyzdat += s2.trim() + " " + x.toFixed(6) + " " + y.toFixed(6) + " " + z.toFixed(6) + "\n";
                 x = 0.0*a; y = 1/3.0*a*Math.sqrt(3.0);   z = (0.5)*ca*a;
                 xyzdat += s1.trim() + " " + x.toFixed(6) + " " + y.toFixed(6) + " " + z.toFixed(6) + "\n";
                 x = 0.0*a; y = 0.0*a*Math.sqrt(3.0);     z = (1.0-u)*ca*a;
                 xyzdat += s2.trim() + " " + x.toFixed(6) + " " + y.toFixed(6) + " " + z.toFixed(6) + "\n";
                 x = 0.5*a; y = 0.5*a*Math.sqrt(3.0);     z = 0.0*ca*a;
                 xyzdat += s1.trim() + " " + x.toFixed(6) + " " + y.toFixed(6) + " " + z.toFixed(6) + "\n";
                 x = 0.5*a; y = 5.0/6.0*a*Math.sqrt(3.0); z = (0.5-u)*ca*a;
                 xyzdat += s2.trim() + " " + x.toFixed(6) + " " + y.toFixed(6) + " " + z.toFixed(6) + "\n";
                 x = 0.5*a; y = 5.0/6.0*a*Math.sqrt(3.0); z = (0.5)*ca*a;
                 xyzdat += s1.trim() + " " + x.toFixed(6) + " " + y.toFixed(6) + " " + z.toFixed(6) + "\n";
                 x = 0.5*a; y = 0.5*a*Math.sqrt(3.0);     z = (1.0-u)*ca*a;
                 xyzdat += s2.trim() + " " + x.toFixed(6) + " " + y.toFixed(6) + " " + z.toFixed(6) + "\n";
              }

           }
           return [lattice,xyzdat];
        }


        // ****************************
        // *                          *
        // *    loadbulktojsmol       *
        // *                          *
        // ****************************
        function loadbulktojsmol() {
           var a      = parseFloat(document.getElementById("bulk_a").value);
           var b      = parseFloat(document.getElementById("bulk_b").value);
           var c      = parseFloat(document.getElementById("bulk_c").value);
           var alpha  = parseFloat(document.getElementById("bulk_alpha").value);
           var covera = parseFloat(document.getElementById("bulk_covera").value);
           var u      = parseFloat(document.getElementById("bulk_u").value);
           var bt = document.getElementById("bulk_type").value;
           var bn = document.getElementById("bulk_name").value;
           var bp = document.getElementById("bulk_primitive").checked;
           var bc = document.getElementById("bulk_cubic").checked;
           console.log("a=",a);
           console.log("b=",b);
           console.log("c=",c);
           console.log("covera=",covera);
           console.log("alpha=",alpha);
           console.log("u=",u);
           console.log("bt=",bt);
           console.log("bn=",bn);
           console.log("bc=",bc);

           //var latxyz = genbulk(a,c,u,bt,bn,bp,bc);
           var latxyz = newgenbulk(a,b,c,covera,alpha,u,bt,bn,bp,bc);
           var xyzdat = latxyz[1];

           document.getElementById("cell_a").value = latxyz[0][6][0];
           document.getElementById("cell_b").value = latxyz[0][6][1];
           document.getElementById("cell_c").value = latxyz[0][6][2];
           document.getElementById("cell_alpha").value = latxyz[0][6][3];
           document.getElementById("cell_beta").value  = latxyz[0][6][4];
           document.getElementById("cell_gamma").value = latxyz[0][6][5];
           document.getElementById("lattice_a1").value = vec3_to_string3(latxyz[0][0]);
           document.getElementById("lattice_a2").value = vec3_to_string3(latxyz[0][1]);
           document.getElementById("lattice_a3").value = vec3_to_string3(latxyz[0][2]);

           document.getElementById("showcell").value = "Unit cell off";
           document.getElementById("showcell0").value = "Unit cell off";
           document.getElementById("showcell1").value = "Unit cell off";
           document.getElementById("centercell").value = "Center";
           document.getElementById("centercell0").value = "Center";
           document.getElementById("centercell1").value = "Center";
           document.getElementById("bulk_atoms").value = "1-"+xyzdat.split("\n")[0].trim();


           var scpt = "load data \"model editor\"|" + xyzdat.trim().replace(/\n/g,' | ') + "|end \"model editor\"";
           jms(scpt);
           jsmcellchange(false,true);
        }




        var checkedRadio = [null,null,null,null,null,null,null,null,null,null,null,null,null,null];
        function ClearRd(ths,ii) {
           var f = 0.0;
           if (checkedRadio[ii] == ths) {
               ths.checked = false;
               checkedRadio[ii] = null;
               cacheInputbool(ths,false);
           } else {
               checkedRadio[ii] = ths; 
               cacheInputbool(ths,true);
           }
        }
        function defineslab(surface_cut,surface_a,surface_b,surface_c) {
           var sc = document.getElementById(surface_cut).value;
           if ((sc=="sc100")||(sc=="100")) { 
              document.getElementById(surface_a).value = "0.0  1.0  0.0";
              document.getElementById(surface_b).value = "0.0  0.0  1.0";
              document.getElementById(surface_c).value = "1.0  0.0  0.0";
           }
           if ((sc=="sc001")||(sc=="001")) { 
              document.getElementById(surface_a).value = "1.0  0.0  0.0";
              document.getElementById(surface_b).value = "0.0  1.0  0.0";
              document.getElementById(surface_c).value = "0.0  0.0  1.0";
           }
           if ((sc=="sc111")||(sc=="111")) { 
              document.getElementById(surface_a).value = " 1.0 -1.0  0.0";
              document.getElementById(surface_b).value = " 0.0  1.0 -1.0";
              document.getElementById(surface_c).value = "-1.0 -1.0 -1.0";
           }
           if (sc=="fcc100") { 
              document.getElementById(surface_a).value = " 0.0  1.0  0.0";
              document.getElementById(surface_b).value = " 0.0  0.0  1.0";
              document.getElementById(surface_c).value = " 1.0  0.0  0.0";
           }
           if ((sc=="fcc110")||(sc=="110")) { 
              document.getElementById(surface_a).value = " 0.0  0.0  2.0";
              document.getElementById(surface_b).value = " 1.5 -1.5  0.0";
              document.getElementById(surface_c).value = " 1.5  1.5  0.0";
           }
           if (sc=="fcc111") { 
              document.getElementById(surface_a).value = " 1.5 -1.5  0.0";
              document.getElementById(surface_b).value = " 0.0  1.5 -1.5";
              document.getElementById(surface_c).value = "-1.0 -1.0 -1.0";
           }
           if ((sc=="fcc211")||(sc=="211")) { 
              document.getElementById(surface_a).value = " 0.0  1.5 -1.5";
              document.getElementById(surface_b).value = " 1.0 -1.0 -1.0";
              document.getElementById(surface_c).value = " 2.0  1.0  1.0";
           }
           if (sc=="bcc100") { 
              document.getElementById(surface_a).value = " 0.0  1.0  0.0";
              document.getElementById(surface_b).value = " 0.0  0.0  1.0";
              document.getElementById(surface_c).value = " 1.0  0.0  0.0";
           }
           if (sc=="bcc001") { 
              document.getElementById(surface_a).value = " 1.0  0.0  0.0";
              document.getElementById(surface_b).value = " 0.0  1.0  0.0";
              document.getElementById(surface_c).value = " 0.0  0.0  1.0";
           }
           if (sc=="bcc110") { 
              document.getElementById(surface_a).value = " 0.0  0.0  2.0";
              document.getElementById(surface_b).value = " 1.0 -1.0  0.0";
              document.getElementById(surface_c).value = " 1.0  1.0  0.0";
           }
           if (sc=="bcc111") { 
              document.getElementById(surface_a).value = " 1.0 -1.0  0.0";
              document.getElementById(surface_b).value = " 0.0  1.0 -1.0";
              document.getElementById(surface_c).value = "-1.0 -1.0 -1.0";
           }
           if (sc=="hcp0001") { 
              document.getElementById(surface_a).value = " 1.0  0.0  0.0";
              document.getElementById(surface_b).value = " 0.0  1.0  0.0";
              document.getElementById(surface_c).value = " 0.0  0.0  1.0";
           }
           if (sc=="diamond100") { 
              document.getElementById(surface_a).value = " 0.0  1.0  0.0";
              document.getElementById(surface_b).value = " 0.0  0.0  1.0";
              document.getElementById(surface_c).value = " 1.0  0.0  0.0";
           }
           if (sc=="diamond111") { 
              document.getElementById(surface_a).value = " 1.0 -1.0  0.0";
              document.getElementById(surface_b).value = " 0.0  1.0 -1.0";
              document.getElementById(surface_c).value = "-1.0 -1.0 -1.0";
           }
           if (sc=="graphene001") { 
              document.getElementById(surface_a).value = "1.0  0.0  0.0";
              document.getElementById(surface_b).value = "0.0  1.0  0.0";
              document.getElementById(surface_c).value = "0.0  0.0  1.0";
           }

           cacheInput(document.getElementById(surface_cut));
           cacheInput(document.getElementById(surface_a));
           cacheInput(document.getElementById(surface_b));
           cacheInput(document.getElementById(surface_c));
        }

        function cutslab(opt) {
           var i,a,b,c,ss,origin,vacuum,scaling,tolerance,nlayers;
           var atoms,a1,a2,a3,tmp;

           ss = document.getElementById("surface_a").value.trim().split(/[ ,]+/);
           a = [parseFloat(ss[0]), parseFloat(ss[1]), parseFloat(ss[2])];

           ss = document.getElementById("surface_b").value.trim().split(/[ ,]+/);
           b = [parseFloat(ss[0]), parseFloat(ss[1]), parseFloat(ss[2])];

           ss = document.getElementById("surface_c").value.trim().split(/[ ,]+/);
           c = [parseFloat(ss[0]), parseFloat(ss[1]), parseFloat(ss[2])];

           ss = document.getElementById("surface_origin").value.trim().split(/[ ,]+/);
           origin = [parseFloat(ss[0]), parseFloat(ss[1]), parseFloat(ss[2])];

           tolerance = parseFloat(document.getElementById("surface_tolerance").value.trim());
           vacuum = parseFloat(document.getElementById("surface_vacuum").value.trim());
           ss = document.getElementById("surface_scaling").value.trim().split(/[ ,]+/);
           if (ss.length>2) {
              scaling = [parseFloat(ss[0]), parseFloat(ss[1]), parseFloat(ss[2])];
           } else if (ss.length==2) {
              scaling = [parseFloat(ss[0]), parseFloat(ss[0]), parseFloat(ss[1])];
           } else if (ss.length==1) {
              scaling = [parseFloat(ss[0]), parseFloat(ss[0]), parseFloat(ss[0])];
           } else  {
              scaling = [1.0,1.0,1.0];
           }

           ss = document.getElementById("lattice_a1").value.trim().split(/[ ,]+/);
           a1 = [parseFloat(ss[0]), parseFloat(ss[1]), parseFloat(ss[2])];
           
           ss = document.getElementById("lattice_a2").value.trim().split(/[ ,]+/);
           a2 = [parseFloat(ss[0]), parseFloat(ss[1]), parseFloat(ss[2])];

           ss = document.getElementById("lattice_a3").value.trim().split(/[ ,]+/); 
           a3 = [parseFloat(ss[0]), parseFloat(ss[1]), parseFloat(ss[2])];

           //tmp = document.getElementById("cartesianCoords").value.trim().split("\n");
           //tmp = jmvar("data({1.1},\"xyz\")").trim().split("\n");
           tmp = jmvar("data({thisModel},\"xyz\")").trim().split("\n");
           atoms = [];
           for (i=0; i<tmp.length; ++i) {
              ss = tmp[i].trim().split(/[ ,]+/); 
              atoms.push( [ss[0],parseFloat(ss[1]),parseFloat(ss[2]),parseFloat(ss[3])] );
           }

           //lattice vectors in cells are stored along rows!
         //  var cell = [a1[0],a2[0],a3[0],
         //              a1[1],a2[1],a3[1],
         //              a1[2],a2[2],a3[2]];

         //  if ((Math.abs(c[0])<1.0e-5) && (Math.abs(c[1])<1.0e-5) && (Math.abs(c[2])<1.0e-5)) {
         //     var metric = mat33mult(cell,mat33trans(cell));
         //     var vol = Math.sqrt(mat33det(metric));
         //     c = mat33vec3solv(mat33trans(metric),vec3cross(a,b))*Math.pow(vol,2.0/3.0);
         //  }

           a[0] *= scaling[0]; a[1] *= scaling[0]; a[2] *= scaling[0];
           b[0] *= scaling[1]; b[1] *= scaling[1]; b[2] *= scaling[1];
           c[0] *= scaling[2]; c[1] *= scaling[2]; c[2] *= scaling[2];
           var cutatomscell = cutslab0(atoms,a1,a2,a3,a,b,c,origin,vacuum,tolerance);
           atoms = cutatomscell[0];
           var aa1 = cutatomscell[1];
           var aa2 = cutatomscell[2];
           var aa3 = cutatomscell[3];

           //align along c-axis
           if (document.getElementById("surface_alignc").checked) {
              tmp = aligntocaxis(atoms,aa1,aa2,aa3);
              atoms = tmp[0];
              aa1   = tmp[1];
              aa2   = tmp[2];
              aa3   = tmp[3];
           }
           
           a1 = aa1[0].toFixed(6) + " " + aa1[1].toFixed(6) + " " + aa1[2].toFixed(6);
           a2 = aa2[0].toFixed(6) + " " + aa2[1].toFixed(6) + " " + aa2[2].toFixed(6);
           a3 = aa3[0].toFixed(6) + " " + aa3[1].toFixed(6) + " " + aa3[2].toFixed(6);
           document.getElementById("lattice_a1").value = a1;
           document.getElementById("lattice_a2").value = a2;
           document.getElementById("lattice_a3").value = a3;

           var xyzdat = atoms.length + "\n\n";
           for (i=0; i<atoms.length; ++i) {
              xyzdat += atoms[i][0] + " " + atoms[i][1].toFixed(6)
                                    + " " + atoms[i][2].toFixed(6)
                                    + " " + atoms[i][3].toFixed(6) + "\n";
           }

           document.getElementById("bulk_atoms").value = "1-"+xyzdat.split("\n")[0].trim();
           
          
           /* Determine the number of z-layers, nlayers */
           var f3,f3f;
           var slabs = {};
           var [b1,b2,b3] = a1a2a3_to_b1b2b3(aa1,aa2,aa3);
           for (i=0; i<atoms.length; ++i) {
              f3 = b3[0]*atoms[i][1] + b3[1]*atoms[i][2] + b3[2]*atoms[i][3];
              f3f = ((Math.abs(f3)<1.0e-5) ? 0.0  : f3.toFixed(4));
              if (f3f in slabs) {
                 slabs[f3f].push(i);
              } else {
                 slabs[f3f] = [i];
              }
           }
           var nlayers = Object.keys(slabs).length;
           var layers  = Object.keys(slabs).sort((a,b) => a-b);

           /* prune z-layers if surface_nzplane less than the number of zlayer */
           var nlayers0 = (document.getElementById("surface_nzplane").value  ? document.getElementById("surface_nzplane").value : 999999); 
           if (nlayers < nlayers0) {
              document.getElementById("surface_nzplane").value = nlayers;
           } else if (nlayers > nlayers0) {
              var m = parseInt((nlayers-nlayers0)/2);
              var p = (nlayers-nlayers0) - m;
              //console.log("MMMM, m=",m, " p=",p);
              var nion = 0;
              for (var i=p; i<(nlayers-m); ++i) {
                 var ckey = layers[i];
                 nion += slabs[ckey].length;
              }
              xyzdat = nion + "\n\n";
              for (var i=p; i<(nlayers-m); ++i) {
                 var ckey = layers[i];
                 for (var j=0; j<(slabs[ckey].length); ++j) {
                    var k = slabs[ckey][j];
                    xyzdat += atoms[k][0] + " " + atoms[k][1].toFixed(6)
                                          + " " + atoms[k][2].toFixed(6)
                                          + " " + atoms[k][3].toFixed(6) + "\n";
                 }
              }
              document.getElementById("bulk_atoms").value = "1-"+xyzdat.split("\n")[0].trim();
           }


           console.log("CUTSLAB - LOAD SLAB MODEL opt=",opt);
           /* Load the slab model */
           var scpt = "load data \"model editor\"|" + xyzdat.trim().replace(/\n/g,' | ') + "|end \"model editor\"";
           //scpt += '; set echoCallback \"hcleanaddsmiles\";';
           if (opt==1) {
              scpt += '; set echoCallback \"hcleancutslab\";';
           } else {
              scpt += '; set echoCallback \"hcleancutslab2\";';
           }
           jms0(scpt);
           console.log("CUTSLAB - INTO JSMCELLCHANGE,opt=",opt);
           jsmcellchange(false,true);
           console.log("CUTSLAB - OUT OF JSMCELLCHANGE,opt=",opt);

           //scpt = "select *; minimize FIX selected;";
           //jms(scpt);
        }


        function cutslab0(atoms,a1,a2,a3,a,b,c,origin,vacuum,tolerance) {
           var ii,i1,i2,i3,n1,n2,n3,f1,f2,f3,x,y,z,tx,ty,tz;
           var dd,ddmin,atom;

           var b1 = [a2[1]*a3[2]-a2[2]*a3[1], a2[2]*a3[0]-a2[0]*a3[2], a2[0]*a3[1]-a2[1]*a3[0]];
           var b2 = [a3[1]*a1[2]-a3[2]*a1[1], a3[2]*a1[0]-a3[0]*a1[2], a3[0]*a1[1]-a3[1]*a1[0]];
           var b3 = [a1[1]*a2[2]-a1[2]*a2[1], a1[2]*a2[0]-a1[0]*a2[2], a1[0]*a2[1]-a1[1]*a2[0]];
           var vol = a1[0]*b1[0] + a1[1]*b1[1] + a1[2]*b1[2];
           b1[0] /= vol; b1[1] /= vol; b1[2] /= vol;
           b2[0] /= vol; b2[1] /= vol; b2[2] /= vol;
           b3[0] /= vol; b3[1] /= vol; b3[2] /= vol;

           var aa1 = [a[0]*a1[0] + a[1]*a2[0] + a[2]*a3[0],
                      a[0]*a1[1] + a[1]*a2[1] + a[2]*a3[1],
                      a[0]*a1[2] + a[1]*a2[2] + a[2]*a3[2]];
           var aa2 = [b[0]*a1[0] + b[1]*a2[0] + b[2]*a3[0],
                      b[0]*a1[1] + b[1]*a2[1] + b[2]*a3[1],
                      b[0]*a1[2] + b[1]*a2[2] + b[2]*a3[2]];
           var aa3 = [c[0]*a1[0] + c[1]*a2[0] + c[2]*a3[0],
                      c[0]*a1[1] + c[1]*a2[1] + c[2]*a3[1],
                      c[0]*a1[2] + c[1]*a2[2] + c[2]*a3[2]];
           var bb1 = [aa2[1]*aa3[2]-aa2[2]*aa3[1], aa2[2]*aa3[0]-aa2[0]*aa3[2], aa2[0]*aa3[1]-aa2[1]*aa3[0]];
           var bb2 = [aa3[1]*aa1[2]-aa3[2]*aa1[1], aa3[2]*aa1[0]-aa3[0]*aa1[2], aa3[0]*aa1[1]-aa3[1]*aa1[0]];
           var bb3 = [aa1[1]*aa2[2]-aa1[2]*aa2[1], aa1[2]*aa2[0]-aa1[0]*aa2[2], aa1[0]*aa2[1]-aa1[1]*aa2[0]];

           var vol = aa1[0]*bb1[0] + aa1[1]*bb1[1] + aa1[2]*bb1[2];
           bb1[0] /= vol; bb1[1] /= vol; bb1[2] /= vol;
           bb2[0] /= vol; bb2[1] /= vol; bb2[2] /= vol;
           bb3[0] /= vol; bb3[1] /= vol; bb3[2] /= vol;

           n1=1;n2=1;n3=1;
           for (i3=0; i3<2; ++i3) {
              for (i2=0; i2<2; ++i2) {
                 for (i1=0; i1<2; ++i1) {
                    x = i1*aa1[0] + i2*aa2[0] + i3*aa3[0] - origin[0];
                    y = i1*aa1[1] + i2*aa2[1] + i3*aa3[1] - origin[1];
                    z = i1*aa1[2] + i2*aa2[2] + i3*aa3[2] - origin[2];
                    f1 = x*bb1[0] + y*bb1[1] + z*bb1[2];
                    f2 = x*bb2[0] + y*bb2[1] + z*bb2[2];
                    f3 = x*bb3[0] + y*bb3[1] + z*bb3[2];
                    if (Math.abs(f1)>n1) { n1 = Math.abs(f1); }
                    if (Math.abs(f2)>n2) { n2 = Math.abs(f2); }
                    if (Math.abs(f3)>n3) { n3 = Math.abs(f3); }
                 }
              }
           }
           n1 = 25;
           n2 = 25;
           n3 = 25;

           var delta = 1.0e-8;
           var xx,yy,zz;
           var atoms2 = [];
           for (i3=(-n3); i3<=n3; ++i3) {
              for (i2=(-n2); i2<=n2; ++i2) {
                 for (i1=(-n1); i1<=n1; ++i1) {
                    for (ii=0; ii<atoms.length; ++ii) {
                       atom = atoms[ii];
                       symb = atom[0];
                       x    = atom[1]; y = atom[2]; z = atom[3];

                       xx = x + i1*a1[0] + i2*a2[0] + i3*a3[0] - origin[0];
                       yy = y + i1*a1[1] + i2*a2[1] + i3*a3[1] - origin[1];
                       zz = z + i1*a1[2] + i2*a2[2] + i3*a3[2] - origin[2];

                       f1 = xx*bb1[0] + yy*bb1[1] + zz*bb1[2];
                       f2 = xx*bb2[0] + yy*bb2[1] + zz*bb2[2];
                       f3 = xx*bb3[0] + yy*bb3[1] + zz*bb3[2];
                       if ((f1>=(-0.5-delta)) && (f1<(0.5-delta)) && (f2>=(-0.5-delta)) && (f2<(0.5-delta)) && (f3>=(-0.5-delta)) && (f3<=(0.5+tolerance))) {
                          atoms2.push([atom[0],xx,yy,zz])
                       }
                    }
                 }
              }
           }

           tx = Math.sqrt(aa3[0]*aa3[0] + aa3[1]*aa3[1] + aa3[2]*aa3[2]);
           tz = tx/2 + vacuum/2;
           ty = 1.0 + vacuum/tx;
           aa3[0] *= ty;
           aa3[1] *= ty;
           aa3[2] *= ty;

           return [atoms2,aa1,aa2,aa3];
        }



        // ****************************************
        // *                                      *
        // *         geninterfacecell             *
        // *                                      *
        // ****************************************
        function geninterfacecell(bulk_a,bulk_b,bulk_c,bulk_covera,bulk_alpha,bulk_u,bulk_type,bulk_name,bulk_primitive,bulk_cubic,
                                  surface_a,surface_b,surface_c,surface_origin,surface_scaling,surface_vacuum,surface_tolerance) {

           var lat_a,lat_b,lat_u,bt,bn,bp,bc,latxyz;
           var tmp,atoms,i,ss,a,b,c,origin,scaling,vacuum,tolerance;
           console.log("GENINTERFACECELL!");

           lat_a  = parseFloat(document.getElementById(bulk_a).value);
           lat_b  = parseFloat(document.getElementById(bulk_b).value);
           lat_c  = parseFloat(document.getElementById(bulk_c).value);
           covera = parseFloat(document.getElementById(bulk_covera).value);
           alpha  = parseFloat(document.getElementById(bulk_alpha).value);
           lat_u = parseFloat(document.getElementById(bulk_u).value);
           bt = document.getElementById(bulk_type).value;
           bn = document.getElementById(bulk_name).value;
           bp = document.getElementById(bulk_primitive).checked;
           bc = document.getElementById(bulk_cubic).checked;
           //latxyz = genbulk(lat_a,lat_c,lat_u,bt,bn,bp,bc);
           latxyz = newgenbulk(lat_a,lat_b,lat_c,covera,alpha,lat_u,bt,bn,bp,bc);

           console.log("geninterfacecell lat_a =", lat_a);
           console.log("geninterfacecell lat_b =", lat_b);
           console.log("geninterfacecell lat_c =", lat_c);
           console.log("geninterfacecell covera=", covera);
           console.log("geninterfacecell alpha=", alpha);
           console.log("geninterfacecell lat_u =", lat_u);
           console.log("geninterfacecell bt = ", bt);
           console.log("geninterfacecell bn = ", bn);
           console.log("geninterfacecell bp = ", bp);
           console.log("geninterfacecell bc = ", bc);
           console.log("geninterfacecell latxyz = ", latxyz);


           tmp = latxyz[1].trim().split("\n");
           atoms = [];
           for (i=2; i<tmp.length; ++i) {
              ss = tmp[i].trim().split(/[ ,]+/); 
              atoms.push( [ss[0],parseFloat(ss[1]),parseFloat(ss[2]),parseFloat(ss[3])] );
           }

           a = string3_to_vec3(document.getElementById(surface_a).value.trim());
           b = string3_to_vec3(document.getElementById(surface_b).value.trim());
           c = string3_to_vec3(document.getElementById(surface_c).value.trim());
           origin = string3_to_vec3(document.getElementById(surface_origin).value.trim());

           //tolerance = parseFloat(document.getElementById(surface_tolerance).value.trim());
           //vacuum = parseFloat(document.getElementById(surface_vacuum).value.trim());
           tolerance = 0.0;
           vacuum = 0.0;
           ss = document.getElementById(surface_scaling).value.trim().split(/[ ,]+/);
           if (ss.length>2) {
              scaling = [parseFloat(ss[0]), parseFloat(ss[1]), parseFloat(ss[2])];
           } else if (ss.length==2) {
              scaling = [parseFloat(ss[0]), parseFloat(ss[0]), parseFloat(ss[1])];
           } else if (ss.length==1) {
              scaling = [parseFloat(ss[0]), parseFloat(ss[0]), parseFloat(ss[0])];
           } else  {
              scaling = [1.0,1.0,1.0];
           }
           a[0] *= scaling[0]; a[1] *= scaling[0]; a[2] *= scaling[0];
           b[0] *= scaling[1]; b[1] *= scaling[1]; b[2] *= scaling[1];
           c[0] *= scaling[2]; c[1] *= scaling[2]; c[2] *= scaling[2];

           var cutatomscell = cutslab0(atoms,latxyz[0][0],latxyz[0][1],latxyz[0][2],a,b,c,origin,vacuum,tolerance);
           atoms = cutatomscell[0];
           var aa1 = cutatomscell[1];
           var aa2 = cutatomscell[2];
           var aa3 = cutatomscell[3];

           tmp = aligntocaxis(atoms,aa1,aa2,aa3);
           atoms = tmp[0];
           aa1   = tmp[1];
           aa2   = tmp[2];
           aa3   = tmp[3];

           return [atoms,aa1,aa2,aa3];
        }


        function howcloseatom(atoms,x,y,z,a1,a2,a3) {
           var d2 = 9.9e9;
           var dx,dy,dz,r2,xx,yy,zz,i1,i2,i3,ii;
           var n1 = 2;
           var n2 = 2;
           var n3 = 2;
           for (ii=0; ii<atoms.length; ++ii) {
              dx = (atoms[ii][1] - x);
              dy = (atoms[ii][2] - y);
              dz = (atoms[ii][3] - z);
              for (i3=(-n3); i3<=n3; ++i3) {
                 for (i2=(-n2); i2<=n2; ++i2) {
                    for (i1=(-n1); i1<=n1; ++i1) {
                        xx = dx + i1*a1[0] + i2*a2[0] + i3*a3[0];
                        yy = dy + i1*a1[1] + i2*a2[1] + i3*a3[1];
                        zz = dz + i1*a1[2] + i2*a2[2] + i3*a3[2];
                        r2 = xx*xx + yy*yy + zz*zz;
                        if (r2<d2) { d2 = r2; }
                    }
                 }
              }
           }
           return Math.sqrt(d2);
        }


        function geninterface() {
           console.log("HERA");
           var cell1 = geninterfacecell("bulk1_a","bulk1_b","bulk1_c","bulk1_covera","bulk1_alpha","bulk1_u","bulk1_type","bulk1_name","bulk1_primitive","bulk1_cubic",
                                        "surface1_a","surface1_b","surface1_c","surface1_origin","surface1_scaling","surface1_vacuum","surface1_tolerance");
           var cell2 = geninterfacecell("bulk2_a","bulk2_b","bulk2_c","bulk2_covera","bulk2_alpha","bulk2_u","bulk2_type","bulk2_name","bulk2_primitive","bulk2_cubic",
                                        "surface2_a","surface2_b","surface2_c","surface2_origin","surface2_scaling","surface2_vacuum","surface2_tolerance");
           var deltaz = parseFloat(document.getElementById("interface_delta").value);
           console.log("CELL1=",cell1);
           console.log("CELL2=",cell2);
           console.log("deltaz=",deltaz)

           var atoms1 = cell1[0];
           var aa1    = cell1[1];
           var aa2    = cell1[2];
           var aa3    = cell1[3];


           var atoms = cell2[0];
           var a1    = cell2[1];
           var a2    = cell2[2];
           var a3    = cell2[3];
           var shiftz = (cell1[3][2] + cell2[3][2])/2.0;
           aa3[2]    += cell2[3][2] + 2*deltaz;
           deltaz    += shiftz;

           var bb1,bb2,bb3;
           [bb1,bb2,bb3] = a1a2a3_to_b1b2b3(aa1,aa2,aa3)

           var n1 = 15;
           var n2 = 15;
           var delta = 1.0e-8;
           var i1,i2,ii,symb,atom;
           var xx,yy,zz,x,y,z,f1,f2,f3;
           var atoms2 = [];
           for (i2=(-n2); i2<=n2; ++i2) {
              for (i1=(-n1); i1<=n1; ++i1) {
                 for (ii=0; ii<atoms.length; ++ii) {
                    atom = atoms[ii];
                    symb = atom[0];
                    x    = atom[1]; y = atom[2]; z = atom[3];

                    xx = x + i1*a1[0] + i2*a2[0];
                    yy = y + i1*a1[1] + i2*a2[1];
                    zz = z + i1*a1[2] + i2*a2[2];

                    f1 = xx*bb1[0] + yy*bb1[1] + zz*bb1[2];
                    f2 = xx*bb2[0] + yy*bb2[1] + zz*bb2[2];
                    f3 = xx*bb3[0] + yy*bb3[1] + zz*bb3[2];
                    if ((f1>=(-0.5-delta)) && (f1<(0.5-delta)) && (f2>=(-0.5-delta)) && (f2<(0.5-delta)) && (f3>=(-0.5-delta)) && (f3<(0.5-delta))) {
                       var dist = howcloseatom(atoms2,xx,yy,zz,aa1,aa2,aa3);
                       if (dist>1.3) {
                          atoms2.push([atom[0],xx,yy,zz])
                       }
                    }
                 }
              }
           }


           a1 = aa1[0].toFixed(6) + " " + aa1[1].toFixed(6) + " " + aa1[2].toFixed(6);
           a2 = aa2[0].toFixed(6) + " " + aa2[1].toFixed(6) + " " + aa2[2].toFixed(6);
           a3 = aa3[0].toFixed(6) + " " + aa3[1].toFixed(6) + " " + aa3[2].toFixed(6);
           document.getElementById("lattice_a1").value = a1;
           document.getElementById("lattice_a2").value = a2;
           document.getElementById("lattice_a3").value = a3;
           console.log("HERB");

           var xyzdat = atoms1.length + atoms2.length + "\n\n";
           for (var i=0; i<atoms1.length; ++i) {
              xyzdat += atoms1[i][0] + " " + atoms1[i][1].toFixed(6)
                                     + " " + atoms1[i][2].toFixed(6)
                                     + " " + atoms1[i][3].toFixed(6) + "\n";
           }
           for (var i=0; i<atoms2.length; ++i) {
              xyzdat += atoms2[i][0] + " " + atoms2[i][1].toFixed(6)
                                     + " " + atoms2[i][2].toFixed(6)
                                     + " " + (atoms2[i][3]+deltaz).toFixed(6) + "\n";
           }
           console.log("XYZdat=",xyzdat);
           var scpt = "load data \"model editor\"|" + xyzdat.trim().replace(/\n/g,' | ') + "|end \"model editor\"";
           jms(scpt);
           jsmcellchange(false,true);

        }




        function vec3cross(a,b) {
           return [(a[1]*b[2]-a[2]*b[1]),(a[2]*b[0]-a[0]*b[2]),(a[0]*b[1]-a[1]*b[0])];
        }
        function mat33trans(m) {
           return  [m[0],m[3],m[6],
                    m[1],m[4],m[7],
                    m[2],m[5],m[8]];
        }
        function mat33mult(m1,m2) {
           return [m1[0]*m2[0] + m1[3]*m2[1] + m1[6]*m2[2],
                   m1[1]*m2[0] + m1[4]*m2[1] + m1[7]*m2[2],
                   m1[2]*m2[0] + m1[5]*m2[1] + m1[8]*m2[2],
                   m1[0]*m2[3] + m1[3]*m2[4] + m1[6]*m2[5],
                   m1[1]*m2[3] + m1[4]*m2[4] + m1[7]*m2[5],
                   m1[2]*m2[3] + m1[5]*m2[4] + m1[8]*m2[5],
                   m1[0]*m2[6] + m1[3]*m2[7] + m1[6]*m2[8],
                   m1[1]*m2[6] + m1[4]*m2[7] + m1[7]*m2[8],
                   m1[2]*m2[6] + m1[5]*m2[7] + m1[8]*m2[8]];
        }
        function mat33det(m) {
           return (m[0]*(m[4]*m[8]-m[5]*m[7])+m[3]*(m[7]*m[2]-m[8]*m[1])+m[6]*(m[1]*m[5]-m[2]*m[4]));
        }
        function mat33norm(m) {
           return Math.sqrt(m[0]*m[0]+m[1]*m[1]+m[2]*m[2]+m[3]*m[3]+m[4]*m[4]+m[5]*m[5]+m[6]*m[6]+m[7]*m[7]+m[8]*m[8]);
        }

        function mat33vec3solv(m,b) {
           var d = mat33det(m);
           var dx = mat33det( [b[0],b[1],b[2], m[3],m[4],m[5], m[6],m[7],m[8]] );
           var dy = mat33det( [m[0],m[1],m[2], b[0],b[1],b[2], m[6],m[7],m[8]] );
           var dz = mat33det( [m[0],m[1],m[2], m[3],m[4],m[5], b[0],b[1],b[2]] );
           return [dx/d, dy/d, dz/d];
        }

        function finish_solvateurltojsmol(textFromUrl) {

           //var machine = prompt("Please enter machine name:", "we31869");
           var machine = document.getElementById("machine").value;
           var ncpus  = document.getElementById("queue_ncpus").value;
           var queue  = document.getElementById("queue").value.trim();
           var qtime  = document.getElementById("queue_time").value.trim();
           if (queue.trim().length<=0) { queue = "regular"; }
           if (qtime.length<3) {

              if (machine.includes("theta")) {
                 if (queue.includes("debug")) {
                    qtime = "0:58:00";
                 } else {
                    qtime = "3:00:00";
                 }
              } else {
                 if (queue.includes("debug")) {
                    qtime = "00:30:00";
                 } else {
                    qtime = "18:05:00";
                 }
              }
           }

           var tmp = textFromUrl.split("simulation_cell")[1].split("end")[0].trim();
           var a1,a2,a3;
           if (tmp.includes("lattice_vectors")) {
              a1 = string3_to_vec3(tmp.split("\n")[1]); a1[0] *= 0.529177; a1[1] *= 0.529177; a1[2] *= 0.529177;
              a2 = string3_to_vec3(tmp.split("\n")[2]); a2[0] *= 0.529177; a2[1] *= 0.529177; a2[2] *= 0.529177;
              a3 = string3_to_vec3(tmp.split("\n")[3]); a3[0] *= 0.529177; a3[1] *= 0.529177; a3[2] *= 0.529177;
           } else if (tmp.includes("SC")) {
              var a = 0.529177*parseFloat(tmp.split("SC")[1].split("\n")[0]);
              var lat = abcabg_to_lattice(a,a,a,90.0,90.0,90.0);
              a1 = lat[0];
              a2 = lat[1];
              a3 = lat[2];
           }
           document.getElementById("lattice_a1").value = vec3_to_string3(a1);
           document.getElementById("lattice_a2").value = vec3_to_string3(a2);
           document.getElementById("lattice_a3").value = vec3_to_string3(a3);
           document.getElementById("showcell").value   = "Unit cell off";
           document.getElementById("showcell0").value   = "Unit cell off";
           document.getElementById("showcell1").value   = "Unit cell off";
           //document.getElementById("centercell").value = "Origin";
           document.getElementById("centercell").value = "Origin";
           document.getElementById("centercell0").value = "Origin";
           document.getElementById("centercell1").value = "Origin";

           var xyz = textFromUrl.split("geometry noautosym noautoz")[1].split("end")[0].trim();
           var nion = xyz.split("\n").length;
           var xyzdat = nion + "\n\n" + xyz;

           var scpt = "load data \"model editor\"|" + xyzdat.trim().replace(/\n/g,' | ') + "|end \"model editor\"";
           jms(scpt);
           jsmcellchange(false,true);
           //jmscentercell();

           console.log("HERA: endsolvate");

           var mformula = textFromUrl.split("#mformula = ")[1].split("\n")[0].trim();
           var x =  "#nwchem_input  " + mformula + "-aimdmm.nw\n";
           x += "#nwchem_output " + mformula + "-aimdmm.out00\n";
           x += "#nwchem_done   " + mformula + "-aimdmm.done\n";
           x += "#\n";
           x += "#mformula_off\n";
           x += "#\n";
           x += "#transfer_files *.nw *.xyz *.ion_motion *.emotion *.fei *.cif *.hist *.gr meta_*.dat meta.dat *.meta_gaussians *.cube *_epath *_final_epath POWER_SPECTRUM VELOCITY_SPECTRUM VEL_CORRELATION PAIR_DISTRIBUTION *.dipole_powerspectrum *.dipole_correlation\n";
           x += "#bad_files md_xs\n";
           x += "#\n";

           var jobname     = mformula+"-aimdmm";
           if ((document.getElementById("queue_nwchem_jobname").value.trim().length) > 0) {
              jobname += "-" + document.getElementById("queue_nwchem_jobname").value.trim();
           }
           if (document.getElementById("queue_nwchem_jobmodel").checked) {
              var imm =  window.xyzframes_cur + 1;
              jobname += "-m-"+imm.toString();
           }
           if (document.getElementById("queue_nwchem_jobdate").checked) {
              var today = new Date();
              var date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
              jobname += "-d-" + date
           }

           var projectname = document.getElementById("queue_nwchem_projectname").value.trim();
           if (projectname.contains("myproject")) {
                projectname = prompt("Please enter projectname:", projectname);
           }
           var curdir0 = document.getElementById("queue_nwchem_curdir0").value;
           var curdir  = curdir0 + "/"+projectname+"/"+jobname

           curdir  = prompt("Please enter curdir:", curdir);
           document.getElementById("queue_nwchem_curdir").value  = curdir;
           document.getElementById("queue_nwchem_permdir").value = jobname;;
           x += "#curdir " + curdir + "\n"
           x += "#\n";
           x += "#permdir " + jobname + "\n";
           x += "#deletescratch no\n";
           x += "#queuesave no\n"
           x += "#\n";
           x += "#machine " + machine + "\n";

           x += "#cputime " + qtime + "\n";
           x += "#ncpus " + ncpus + "\n";
           x += "#queue " + queue + "\n";
           x += "#\n";
           var data = x + textFromUrl.split("#Fetched the following entry:")[1].split("</pre>")[0].trim();

           console.log("HERB: fetched input");

           editor.setValue(data,-1);
           document.getElementById('apirunning').value = document.getElementById('apirunning').value.replace("+ running solvateurltojsmol\n","");
           document.getElementById('runmebanner4b').innerHTML = "";

           changenwchemcutoff();
        }

        function solvateurltojsmol() {
           //var arrows_post_url = 'https://arrows.emsl.pnnl.gov/api/upload/';
           //var arrows_get_url  = 'https://arrows.emsl.pnnl.gov/api/molecular_calculation/';
           //var arrows_post_url = '{{ arrows_api }}upload/';
           //var arrows_get_url  = '{{ arrows_api }}molecular_calculation/';
           var calc_url        = document.getElementById("arrows_url").value;
           var arrows_post_url = calc_url + 'upload/';
           var arrows_get_url  = calc_url + 'molecular_calculation/';


           document.getElementById('apirunning').value += "+ running solvateurltojsmol\n";
           document.getElementById('runmebanner4b').innerHTML= "Solvation calculation started.";

           //var xyz = jmvar("data({1.1},\"xyz\")").trim();
           var xyz = jmvar("data({thisModel},\"xyz\")").trim();
           xyz = " xyzdata{" + xyz.trim().replace(/\n/g,' | ') + "} theory{aimd-mm}";
           xyz += " ^{"+ charge_arrowsdata()+"}";
           xyz += " mult{"+ mult_arrowsdata()+"}";
           if (document.getElementById("showcell").value=="Unit cell off") {;
              xyz += " unitcell{lattice_vectors | ";
              xyz += document.getElementById("lattice_a1").value + " | ";
              xyz += document.getElementById("lattice_a2").value + " | ";
              xyz += document.getElementById("lattice_a3").value + "}";
              var molarity = prompt("Please enter molarity:", "1.0");
              xyz += " molarity{"+ molarity+"}";
           } else {
              var molarity = prompt("Please enter molarity:", "1.0");
              xyz += " molarity{"+ molarity+"}";
           }

           //var url = "https://arrows.emsl.pnnl.gov/api/input_deck/\"" + xyz + "\"" ;
           textToSave = xyz;

           ii = Math.floor(Math.random() * 1000) + 1;
           filenameguess = "nwchem-" + ii +".nw";
           var fileNameToSaveAs =  filenameguess

           var textToSaveAsBlob = new Blob([textToSave], {type:"text/plain"});
           var textToSaveAsURL  = window.URL.createObjectURL(textToSaveAsBlob);

           var formD = new FormData();
           formD.append('file', textToSaveAsBlob,fileNameToSaveAs);
           formD.append('title', fileNameToSaveAs);

           var xhr = new XMLHttpRequest();
           xhr.open("POST", arrows_post_url, true);
           xhr.onload = function (e) {
              if (xhr.readyState === 4) {
                 if (xhr.status === 200) {
                   console.log("  - post response:" +xhr.responseText);
                  }
               }
           };
           xhr.onerror = function (e) {
              console.error(xhr.statusText);
           };
           xhr.send(formD);


          //    var request = new XMLHttpRequest();
          //    request.open('GET', saveurl1, true);
          //    request.onreadystatechange = function() {
          //       if (this.readyState == 4 && this.status == 200) {
          //        document.getElementById("HTMLOutput").innerHTML = this.responseText;
          //       }
          //    };
          //    request.send(); 

           var ajax = new XMLHttpRequest();
           ajax.open('GET', arrows_get_url+fileNameToSaveAs, true);
           ajax.onload = function (e) {
             if (ajax.readyState === 4) {
               if (ajax.status === 200) {
                 var textFromUrl = ajax.responseText;
                 console.log(textFromUrl);
                 document.getElementById('runmebanner4b').innerHTML= "Solvation Finished!";
                 finish_solvateurltojsmol(textFromUrl);
               } else {
                 console.error(ajax.statusText);
                 document.getElementById('runmebanner4b').innerHTML= ajax.statusText;
               }
             }
           };
           ajax.onerror = function (e) {
             console.error(ajax.statusText);
             document.getElementById('runmebanner4b').innerHTML= ajax.statusText;
           };
           ajax.send();
        }

        // ****************************************
        // *                                      *
        // *          finishsolvatewham           *
        // *                                      *
        // ****************************************

        function finish_solvatewham(textFromUrl,callback) {

           var rtype    = document.getElementById("reaction_type").value;
           var rgamma0  = document.getElementById("reaction_gamma").value;
           var rgamma   = parseFloat(document.getElementById("umbrella_gamma").value).toFixed(2);
           var rkappa   = parseFloat(document.getElementById("umbrella_spring").value);
           var rindexes = document.getElementById("reaction_indexes").value;
           var bondings =  document.getElementById("reaction_bondings").value.split("gamma")[1].split("\n")[0].trim();

           //var machine = prompt("Please enter machine name:", "we31869");
           var machine = document.getElementById("machine").value;
           var queue   = document.getElementById("queue").value;
           var qtime   = document.getElementById("queue_time").value;
           var ncpus   = document.getElementById("queue_ncpus").value;
           var account = document.getElementById("queue_account").value;

           //ncpus   = prompt("Please enter number cpus:", ncpus);
           var tmp = textFromUrl.split("simulation_cell")[1].split("end")[0].trim();
           var a1,a2,a3;
           if (tmp.includes("lattice_vectors")) {
              a1 = string3_to_vec3(tmp.split("\n")[1]); a1[0] *= 0.529177; a1[1] *= 0.529177; a1[2] *= 0.529177;
              a2 = string3_to_vec3(tmp.split("\n")[2]); a2[0] *= 0.529177; a2[1] *= 0.529177; a2[2] *= 0.529177;
              a3 = string3_to_vec3(tmp.split("\n")[3]); a3[0] *= 0.529177; a3[1] *= 0.529177; a3[2] *= 0.529177;
           } else if (tmp.includes("SC")) {
              var a = 0.529177*parseFloat(tmp.split("SC")[1].split("\n")[0]);
              var lat = abcabg_to_lattice(a,a,a,90.0,90.0,90.0);
              a1 = lat[0];
              a2 = lat[1];
              a3 = lat[2];
           }
           document.getElementById("lattice_a1").value = vec3_to_string3(a1);
           document.getElementById("lattice_a2").value = vec3_to_string3(a2);
           document.getElementById("lattice_a3").value = vec3_to_string3(a3);
           document.getElementById("showcell").value   = "Unit cell off";
           document.getElementById("showcell0").value   = "Unit cell off";
           document.getElementById("showcell1").value   = "Unit cell off";
           //document.getElementById("centercell").value = "Origin";
           document.getElementById("centercell").value = "Origin";
           document.getElementById("centercell0").value = "Origin";
           document.getElementById("centercell1").value = "Origin";

           var xyz = textFromUrl.split("geometry noautosym noautoz")[1].split("end")[0].trim();
           var nion = xyz.split("\n").length;
           var xyzdat = nion + "\n\n" + xyz;

           var scpt = "load data \"model editor\"|" + xyzdat.trim().replace(/\n/g,' | ') + "|end \"model editor\"";
           jms(scpt);
           jsmcellchange(false,true);
           //jmscentercell();

           var projectname  = document.getElementById("queue_nwchem_projectname").value.trim();
           if (projectname.contains("myproject")) {
              projectname = prompt("Please enter projectname:", projectname);
           }

           var mformula = textFromUrl.split("#mformula = ")[1].split("\n")[0].trim();
           var jobname  = mformula+"-wham" + rgamma;
           //jobname = prompt("Please enter jobname:", jobname);
           //var jobname      = document.getElementById("queue_nwchem_jobname").value.trim();

           var x =  "#nwchem_input  " + jobname + ".nw\n";
           x += "#nwchem_output " + jobname + ".out00\n";
           x += "#nwchem_done   " + jobname + ".done\n";
           x += "#\n";
           x += "#mformula_off\n";
           x += "#\n";
           x += "#transfer_files *.nw *.xyz *.ion_motion *.emotion *.fei *.cif *.hist *.gr meta_*.dat meta.dat *.meta_gaussians *.cube *_epath *_final_epath POWER_SPECTRUM VELOCITY_SPECTRUM VEL_CORRELATION PAIR_DISTRIBUTION *.dipole_powerspectrum *.dipole_correlation\n";
           x += "#bad_files md_xs\n";
           x += "#\n";
           var curdir0 = document.getElementById("queue_nwchem_curdir0").value;
           var curdir  = curdir0 + "/"+projectname+"/"+jobname

           x += "#curdir " + curdir + "\n"
           x += "#\n";
           x += "#permdir " + projectname+"_"+jobname + "\n";
           x += "#deletescratch no\n";
           x += "#queuesave no\n"
           x += "#\n";
           x += "#machine " + machine + "\n";
           //x += "#cputime 18:05:00\n";
           if (qtime.length<3) {
            
              if (machine.includes("theta")) {
                 if (queue.includes("debug")) {
                    qtime = "0:58:00";
                 } else {
                    qtime = "3:00:00";
                 }
              } else {
                 if (queue.includes("debug")) {
                    qtime = "00:30:00";
                 } else {
                    qtime = "18:05:00";
                 }
              }
           }
           x += "#cputime " + qtime + "\n"
           x += "#ncpus " + ncpus + "\n";
           if (queue.trim().length>0) {
              x += "#queue " + queue + "\n";
           } else {
              x += "#queue regular\n";
           }
           x += "#account " + account + "\n";
           //x += "#account emslc51527\n";
           //x += "#account mq_bylaska\n";
           //x += "#account br20_bylaska\n";
           x += "#\n";
 
           var data = x;
           if (document.getElementById('xc_type').value.trim().contains("b3lyp") || document.getElementById('xc_type').value.trim().contains("blyp")) {
              data += textFromUrl.split("#Fetched the following entry:")[1].split("### restart here ###")[0].trim().replace("pbe","blyp");
           } else {
              data += textFromUrl.split("#Fetched the following entry:")[1].split("### restart here ###")[0].trim();
           }

           data += "\n\n";
           //data += "### restart here ###" + "\n";
           data += "unset geometry:actlist" + "\n";

           // add reaction constraint
           data += "\n### Adding reaction ###\n";
           data += "# reaction_type    = " +rtype +"\n";
           data += "# reaction_indexes = " +rindexes +"\n";
           data += "# reaction_gamma   = " +rgamma +"\n";
           data += "# reaction_kappa   = " +rkappa  +"\n";
           data += "##### current gamma="+rgamma0+" ######\n";
           data += "nwpw\n";
           data += "   auxiliary_potentials\n";
           data += "      nonfragment\n";
           data += "         bondings " + rkappa.toFixed(6) + " " + rgamma  + " " +  bondings + "\n";
           data += "      end\n";
           data += "   end\n";
           data += "end\n\n";

           // add auxiliary functions
           if (document.getElementById('auxiliary_functions').value.trim().length > 2) {
              data += document.getElementById('auxiliary_functions').value.trim() + "\n\n";
           }

           data += "nwpw" + "\n";
           if (document.getElementById('xc_type').value.trim().contains("default")) {
              data += "   xc pbe" + "\n";
           } else if (document.getElementById('xc_type').value.trim().contains("single-pbe0")) {
              data += "   xc pbe0" + "\n";
              data += "   single_precision_hfx" + "\n";
           } else {
              data += "   xc " + document.getElementById('xc_type').value.trim() + "\n";
           }
           data += "   lmbfgs" + "\n";
           data += "   cutoff 50.0" + "\n";
           data += "end" + "\n";
           data += "set nwpw:kbpp_ray    .true.\n";
           data += "set nwpw:kbpp_filter .true.\n";
           data += "task pspw energy" + "\n";

           editor.setValue(data,1);
           document.getElementById('apirunning').value = document.getElementById('apirunning').value.replace("+ running solvatewhaminput\n","");
           callback("solvatewhaminput");

           changenwchemcutoff();
        }





        // ****************************************
        // *                                      *
        // *          solvatewhaminput            *
        // *                                      *
        // ****************************************

        function solvatewhaminput(molarity,callback) {
           //var arrows_post_url = 'https://arrows.emsl.pnnl.gov/api/upload/';
           //var arrows_get_url  = 'https://arrows.emsl.pnnl.gov/api/molecular_calculation/';
           //var arrows_post_url = '{{ arrows_api }}upload/';
           //var arrows_get_url  = '{{ arrows_api }}molecular_calculation/';
           var calc_url        = document.getElementById("arrows_url").value;
           var arrows_post_url = calc_url + 'upload/';
           var arrows_get_url  = calc_url + 'molecular_calculation/';
           document.getElementById('runmebanner4b').innerHTML= "Solvation calculation started.";
           document.getElementById('apirunning').value += "+ running solvatewhaminput\n";

           //var xyz = jmvar("data({1.1},\"xyz\")").trim();
           var xyz = jmvar("data({thisModel},\"xyz\")").trim();
           xyz = " xyzdata{" + xyz.trim().replace(/\n/g,' | ') + "} theory{aimd-mm}";
           xyz += " ^{"+ charge_arrowsdata()+"}";
           xyz += " mult{"+ mult_arrowsdata()+"}";
           if (document.getElementById("showcell").value=="Unit cell off") {;
              xyz += " unitcell{lattice_vectors | ";
              xyz += document.getElementById("lattice_a1").value + " | ";
              xyz += document.getElementById("lattice_a2").value + " | ";
              xyz += document.getElementById("lattice_a3").value + "}";
           } else {
              var molarity0 = molarity;
              if (molarity0<0.0) {
                 molarity0 = prompt("Please enter molarity:", "1.0");
              }
              xyz += " molarity{"+ molarity0+"}";
           }
           var nsolvent =document.getElementById("umbrella_nsolvent").value;

           textToSave = xyz;

           ii = Math.floor(Math.random() * 1000) + 1;
           filenameguess = "nwchem-" + ii +".nw";
           var fileNameToSaveAs =  filenameguess

           var textToSaveAsBlob = new Blob([textToSave], {type:"text/plain"});
           var textToSaveAsURL  = window.URL.createObjectURL(textToSaveAsBlob);

           var formD = new FormData();
           formD.append('file', textToSaveAsBlob,fileNameToSaveAs);
           formD.append('title', fileNameToSaveAs);
           console.log("FORMD=",formD);

           var xhr = new XMLHttpRequest();
           xhr.open("POST", arrows_post_url, true);
           xhr.onload = function (e) {
              if (xhr.readyState === 4) {
                 if (xhr.status === 200) {
                   console.log("  - post response:" +xhr.responseText);
                  }
               }
           };
           xhr.onerror = function (e) {
              console.error(xhr.statusText);
           };
           xhr.send(formD);


           var ajax = new XMLHttpRequest();
           ajax.open('GET', arrows_get_url+fileNameToSaveAs, true);
           ajax.onload = function (e) {
             if (ajax.readyState === 4) {
               if (ajax.status === 200) {
                 var textFromUrl = ajax.responseText;
                 console.log(textFromUrl);
                 document.getElementById('runmebanner4b').innerHTML= "Solvation Finished!";
                 finish_solvatewham(textFromUrl,callback);
               } else {
                 console.error(ajax.statusText);
                 document.getElementById('runmebanner4b').innerHTML= ajax.statusText;
               }
             }
           };
           ajax.onerror = function (e) {
             console.error(ajax.statusText);
             document.getElementById('runmebanner4b').innerHTML= ajax.statusText;
           };
           ajax.send();
        }

        // ****************************************
        // *                                      *
        // *          solvateborninput            *
        // *                                      *
        // ****************************************
        function solvateborninput() {
           convert2geometry(false);
        }






        function arrows_fetchsmiles(url) {
           //url2 = "https://arrows.emsl.pnnl.gov/api/esmiles/\"" + url.trim() + "\"" ;
           //url2 = "https://arrows.emsl.pnnl.gov/api/esmiles2xyz/\"" + url.trim() + "\"" ;
           var url2 = '{{ arrows_api }}esmiles2xyz/\"' + url.trim() + '\"' ;

           console.log(url2);

           var ajax2 = new XMLHttpRequest();
           ajax2.open("GET", url2, false); // third parameter is async flag
           ajax2.send();
           var textFromUrl2= ajax2.responseText;
           var obj = JSON.parse(textFromUrl2);
           //var smiles = obj["0"].smiles;
           var smiles = obj.smiles;
           console.log("from arrows obj=",obj);
           console.log("from arrows smiles=",smiles);
           return smiles;
        }


        function loadurltojsmol(append) {
           var urllist = document.getElementById("urlToLoad2").value.split(" + ");
           loadurltojsmol0(urllist,append);
        }

        function loadurltojsmol0(urllist,append) {
           if (append) {
              document.getElementById('runmebanner4b').innerHTML= "Appending esmiles.";
           } else {
              document.getElementById('runmebanner4b').innerHTML= "Loading esmiles.";
           }
           var append2 = append;
           //var urllist = document.getElementById("urlToLoad2").value.split(" + ");
           console.log(urllist);

           for (var i=0; i<urllist.length; ++i) {
              var x;
              var url = urllist[i];
              var url2 = "";
              var res = url.split(" ");
              if (/^\+?(0|[1-9]\d*)$/.test(res[0])){
                x = parseInt(res[0]);
                url = res.slice(1).join(" ");
              } else {
                x = 1;
              }
              if (url.indexOf("http") == -1) {
                 //url2 = "https://arrows.emsl.pnnl.gov/api/esmiles2xyz/\"" + url + "\"" ;
                 //url  = "https://arrows.emsl.pnnl.gov/api/mol/\"" + url + "\"" ;
                 url2 = '{{ arrows_api }}esmiles2xyz/\"' + url.trim() + '\"' ;
                 url  = '{{ arrows_api }}mol/\"' + url.trim() + '\"' ;
              }
              console.log(url);
              if (url.trim().length>9) {
                 document.getElementById('apirunning').value += "+ running load/append esmiles\n";
                 let textFromUrl;
                 let q = 0;
                 if (append2) {q=parseInt(document.getElementById("nwchemcharge").value);}
                 if (url2=="") {
                    console.log("Fetching ", url);
                    var ajax = new XMLHttpRequest();
                    ajax.open("GET", url, false); // third parameter is async flag
                    ajax.send();
                    textFromUrl = ajax.responseText;
                    textFromUrl = textFromUrl.split("</pre>")[0].split("<pre")[1].split(">")[1];
                 } else {
                    console.log("Fetching2 ", url2);
                    var ajax2 = new XMLHttpRequest();
                    ajax2.open("GET", url2, false); // third parameter is async flag
                    ajax2.send();
                    var textFromUrl2= ajax2.responseText;
                    var obj = JSON.parse(textFromUrl2);
                    //textFromUrl = obj.mol_blob.trim();
                    textFromUrl = obj.xyz_blob.trim();
                    q += parseInt(obj.charge);
                 }
                 document.getElementById("nwchemcharge").value = q;
                 console.log("q=",q);
                 console.log("MOL=",textFromUrl);

                 var trans = document.getElementById("translate_smiles").value;
                 console.log("trans=",trans);

                 //for (var j=0; j<x; ++j){
                    if (append2) {
                       //var xyzdat = "\"append\"|" + textFromUrl.trim().replace(/\n/g,' | ') + "|end \"append\";";
                       var moldat = "\"append\"" + textFromUrl + "end \"append\";";
                       var scpt = "set appendNew false; data "+moldat + "select all; select within(molecule,(*)[0]);";
                       //jms("set appendNew false; data "+moldat + "select all; select within(molecule,(*)[0]); minimize select selected; select {*}[0];");
                       //jms("set appendNew false; data "+moldat);
                       if (trans.trim().split(/[ ,]+/).length==3) {
                          scpt += 'translate {' + trans + '} selected;';
                       }
                       jms(scpt);
                    }
                    else {
                       //var xyzdat = "\"model arrows\"|" +textFromUrl.trim().replace(/\n/g,' | ') + "|end \"model arrows\";";
                       var moldat = "\"model arrows\"" +textFromUrl + "end \"model arrows\";";
                       var scpt   = "load data "+moldat  + "select all; select within(molecule,(*)[0]); minimize select selected; select {*}[0];";
                       //jms("load data "+moldat  + "select all; select within(molecule,(*)[0]); minimize select selected; select {*}[0];");
                       if (trans.trim().split(/[ ,]+/).length==3) {
                          scpt += 'translate {' + trans + '} selected;';
                       }
                       jms(scpt);
                       append2 = true;
                    }
                 //}
                 var cellon = document.getElementById("showcell").value =="Unit cell off";
                 if (cellon) { jsmcellchange(false,true); }
                 document.getElementById('apirunning').value = document.getElementById('apirunning').value.replace("+ running load/append esmiles\n","");
              }
           }
           document.getElementById('runmebanner4b').innerHTML = "";
        }


        function saveeditortourl() {
           //var arrows_post_url = 'https://arrows.emsl.pnnl.gov/api/upload/';
           //var arrows_post_url = '{{ arrows_api }}upload/';
           var calc_url        = document.getElementById("arrows_calculation_url").value;
           var arrows_post_url = calc_url + 'upload/';
           var url = document.getElementById("urlToLoad").value;
           var saveurl = url.replace("raw=","raw_deposit=");

           var textToSave = editor.getValue();
           var fileNameToSaveAs =  url.split("/").pop();

           if (confirm("Do you want to save " + fileNameToSaveAs + " ?")) {
              var textToSaveAsBlob = new Blob([textToSave], {type:"text/plain"});
              var textToSaveAsURL  = window.URL.createObjectURL(textToSaveAsBlob);

              var formD = new FormData();
              formD.append('file', textToSaveAsBlob,fileNameToSaveAs);
              formD.append('title', fileNameToSaveAs);

              var xhr = new XMLHttpRequest();
              xhr.open("POST", arrows_post_url, true);
              xhr.send(formD);

              var request = new XMLHttpRequest();
              request.open('GET', saveurl, true);
              request.send();
           }
        }

        function submiturl() {
           var url = document.getElementById("urlToLoad").value;
           var saveurl1 = url.replace("raw=","submit_nwchem3=");
           var filename = url.split("/").pop();

           if (confirm("Do you want to submit job " + filename + " ?")) {
              document.getElementById("HTMLOutput").innerHTML = "submitted job: " + saveurl1 + "\n";
              var request = new XMLHttpRequest();
              request.open('GET', saveurl1, true);
              request.onreadystatechange = function() {
                 if (this.readyState == 4 && this.status == 200) {
                  document.getElementById("HTMLOutput").innerHTML = this.responseText;
                 }
              };
              request.send();
           }
        }



        function deleteMoleculePick() {
           var anum = arguments[1].split("#")[1].split(" ")[0];
           //var anum = arguments[1].split("#")[0].trim();
           //var anum0 = arguments[1].split("#")[1].split(" ")[0];
           //var anum1 = parseInt(anum0) - 1;
           //var anum  = anum1.toString();
           var scpt = "select within(molecule,{*}[" + anum + "]); delete selected; unbind; set picking identify; set PickCallback \"\";";
           jms(scpt);
        }
        function jmdeletemolecule() {
           jms0("unbind; unbind \"DOUBLE\"; set picking off;set picking on; set atomPicking true;  set PickCallback \"deleteMoleculePick\";");
        }

        function minimizeMoleculePick() {
           var anum = arguments[1].split("#")[1].split(" ")[0];
           //var anum = arguments[1].split("#")[0].trim();
           //var anum0 = arguments[1].split("#")[1].split(" ")[0];
           //var anum1 = parseInt(anum0) - 1;
           //var anum  = anum1.toString();
           var scpt = "x = within(molecule,{*}[" + anum + "]); minimize select x only; unbind; set picking identify; set PickCallback \"\";";
           jms(scpt);
        }
        function jmminimizemolecule() {
           jms0("unbind; unbind \"DOUBLE\"; set picking off;set picking on; set atomPicking true;  set PickCallback \"minimizeMoleculePick\";");
        }


        function hcleanMoleculePick() {
           var anum = arguments[1].split("#")[1].split(" ")[0];
           //var anum = arguments[1].split("#")[0].trim();
           //var anum0 = arguments[1].split("#")[1].split(" ")[0];
           //alert(anum0);
           //var anum1 = parseInt(anum0) - 1;
           //var anum  = anum1.toString();
           var scpt = "x = within(molecule,{*}[" + anum + "]); delete hydrogens and x; calculate hydrogens x; unbind; set picking identify; set PickCallback \"\";";
           jms(scpt);
        }
        function jmhcleanmolecule() {
           jms0("unbind; unbind \"DOUBLE\"; set picking off;set picking on; set atomPicking true;  set PickCallback \"hcleanMoleculePick\";");
        }



        function centerAtomPick() {
           //var anum = arguments[1].split("#")[1].split(" ")[0];
           var anum = arguments[1].split("#")[0].split(" ")[0];
           var scpt = 'set picking off; unbind; set picking on; set picking identify; set pickingStyle toggle; set PickCallback \"\"; ';
               scpt += "select "+ anum + "; center selected; "
           jms0(scpt);
        }
        function jmcenteratom() {
           jms0("unbind; unbind \"DOUBLE\"; set picking off;set picking on; set atomPicking true;  set PickCallback \"centerAtomPick\";");
        }

        function jmcenterorigin() {
           var scpt = 'unbind; unbind \"DOUBLE\"; set picking off; set picking on; set picking identify; set pickingStyle toggle; center {0,0,0}';
           jms0(scpt);
        }



        function jmpickatom(symbol0) {
           var scpt  = "set picking off; set picking on; set atomPicking true; set picking assignatom_";
           var symbol = symbol0;
           if (symbol0=='X1'){
              if (document.getElementById("atomX1").value=="??") {
                 symbol = prompt("Please enter atom symbol:", "Fe");
                 document.getElementById("atomX1").value = symbol;
              } else {
                 symbol = document.getElementById("atomX1").value;
              }
           } 
           if (symbol0=='X2'){
              if (document.getElementById("atomX2").value=="??") {
                 symbol = prompt("Please enter atom symbol:", "Fe");
                 document.getElementById("atomX2").value = symbol;
              } else {
                 symbol = document.getElementById("atomX2").value;
              }
           } 
           if (symbol0=='X3'){
              if (document.getElementById("atomX3").value=="??") {
                 symbol = prompt("Please enter atom symbol:", "Fe");
                 document.getElementById("atomX3").value = symbol;
              } else {
                 symbol = document.getElementById("atomX3").value;
              }
           } 
           if (symbol0=='X4'){
              if (document.getElementById("atomX4").value=="??") {
                 symbol = prompt("Please enter atom symbol:", "Fe");
                 document.getElementById("atomX4").value = symbol;
              } else {
                 symbol = document.getElementById("atomX4").value;
              }
           } 
           if (symbol0=='X5'){
              if (document.getElementById("atomX5").value=="??") {
                 symbol = prompt("Please enter atom symbol:", "Fe");
                 document.getElementById("atomX5").value = symbol;
              } else {
                 symbol = document.getElementById("atomX5").value;
              }
           } 
           if (symbol0=='X6'){
              if (document.getElementById("atomX6").value=="??") {
                 symbol = prompt("Please enter atom symbol:", "Fe");
                 document.getElementById("atomX6").value = symbol;
              } else {
                 symbol = document.getElementById("atomX6").value;
              }
           } 
           if (symbol0=='X7'){
              if (document.getElementById("atomX7").value=="??") {
                 symbol = prompt("Please enter atom symbol:", "Fe");
                 document.getElementById("atomX7").value = symbol;
              } else {
                 symbol = document.getElementById("atomX7").value;
              }
           } 
           if (symbol0=='Xx'){
              symbol = prompt("Please enter atom symbol:", "Fe");
           } 
           
           if (document.getElementById("insertatom").value == "++") { 
              jmaddsmiles("["+symbol+"]",1);
              jminsertatom(false);
           } else {
              scpt += symbol;
              jms(scpt);
           }
        }
        //document.getElementById("atomX1").value = "??";
        //document.getElementById("atomX2").value = "??";
        //document.getElementById("atomX3").value = "??";
        //document.getElementById("atomX4").value = "??";
        //document.getElementById("atomX5").value = "??";
        //document.getElementById("atomX6").value = "??";
        //document.getElementById("atomX7").value = "??";

        function fetch_smilesprompt() {
           var smiles = prompt("Please enter smiles:", "CCO");
           if (smiles.includes("http")) {
              alert("Running OSRA for " + smiles);
              var url = "https://arrows.emsl.pnnl.gov/api/osra/'" + smiles + "'";
              var ajax = new XMLHttpRequest();
              ajax.onload = functionName;
              ajax.onerror = errorFunctionName;
              ajax.open("GET", url, false); // third parameter is async flag
              ajax.send();
              function functionName() {
                  console.log(this); // log the response
                  if (this.status == 200) { // request succeeded
                      // do something with this.responseText;
                      //alert(this.responseText);
                      if (this.responseText.includes("OSRA_RESULT:")) {
                         var allsmiles = this.responseText.split("OSRA_RESULT:")[1].split(":OSRA_RESULT")[0].trim().split("\n"); 
                         var i,j,tstr,smilesentry,smiles0;
                         tstr = 'SMILES generated by OSRA:\n';
                         for (i=0; i<allsmiles.length; ++i) {
                            j = i+1;
                            tstr += j.toString() + " " + allsmiles[i] + "\n";
                         }
                         smilesentry = prompt(tstr+"Please choose entry:", "1");
                         i = parseInt(smilesentry) - 1;
                         smiles0 = allsmiles[i];
                         smiles = prompt("Please enter smiles:", smiles0);
                      } else {
                         smiles = "CCO";
                      }
                  } else {
                      smiles = "CCO";
                  }
              }
              function errorFunctionName(e) {
                  console.log(this);
                  console.error(e);
                  // do something with this.status, this.statusText
              }
           }
           return smiles;
        }

        function jmaddsmiles(option0,opt) {
           var smiles,scpt;
           var trans = document.getElementById("translate_smiles").value;

           smiles = option0; //default to atom smiles

           if (option0=='H2O'){ 
              smiles = "O"; 
           }
           if (option0=='CH4'){ 
              smiles = "C"; 
           }
           if (option0=='SHE'){ 
              smiles = "[Mt]"; 
           }
           if (option0=='X1'){
              if (document.getElementById("smilesX1").value=="smiles?") {
                 //smiles = prompt("Please enter smiles:", "CCO");
                 smiles = fetch_smilesprompt();
                 document.getElementById("smilesX1").value = smiles;
              } else {
                 smiles = document.getElementById("smilesX1").value;
              }
           } 
           if (option0=='X2'){
              if (document.getElementById("smilesX2").value=="smiles?") {
                 //smiles = prompt("Please enter smiles:", "CCO");
                 smiles = fetch_smilesprompt();
                 document.getElementById("smilesX2").value = smiles;
              } else {
                 smiles = document.getElementById("smilesX2").value;
              }
           } 
           if (option0=='X3'){
              if (document.getElementById("smilesX3").value=="smiles?") {
                 //smiles = prompt("Please enter smiles:", "CCO");
                 smiles = fetch_smilesprompt();
                 document.getElementById("smilesX3").value = smiles;
              } else {
                 smiles = document.getElementById("smilesX3").value;
              }
           } 
           if (option0=='Xx'){
              smiles = fetch_smilesprompt();
           } 
           console.log("jmadd smiles = " + smiles);

           //var scpt = 'set appendNew false; load append smiles \"' + smiles + '\"; select all; select within(molecule,(*)[0]); minimize select selected; ';
           var scpt = 'set appendNew false; load append smiles \"' + smiles + '\"; select all; select within(molecule,(*)[0]); ';
           if (option0=='SHE'){ 
              var scpt = 'set appendNew false; '
              scpt += 'data \"append\"|1|testing|Mt 0.22 0.2 0.1|end \"append\"; ';
              scpt += 'select all; select within(molecule,(*)[0]); minimize select selected; ';
              scpt += 'select Meitnerium; color atoms TRANSLUCENT orange; label "e-"; color label cpk; ';
           } else {
              //scpt += 'select {*}[0]; ' 
              if (trans.trim().split(/[ ,]+/).length==3) {
                 scpt += 'translate {' + trans + '} selected;';
              }
           }
           if (opt==1) {
              scpt += 'set echoCallback \"hcleanaddsmiles\";';
           } else {
              scpt += 'set echoCallback \"hcleanaddsmiles2\";';
           }
           jms(scpt);
        }
        //document.getElementById("smilesX1").value = "smiles?";
        //document.getElementById("smilesX2").value = "smiles?";
        //document.getElementById("smilesX3").value = "smiles?";

        function jminsertatom(option0) {
           if (option0) {
              document.getElementById("insertatom").value = '++';
           } else {
              document.getElementById("insertatom").value = "^^";
           }
        }
        //document.getElementById("insertatom").value = "^^";

        function jmspin() {
           var scpt;
           var jjj = document.getElementById("jmolspin").value;
           if  (jjj == "Spin off") {
              scpt = "Spin off;";
              document.getElementById("jmolspin").value = "Spin on";
           } else {
              scpt = "Spin on;";
              document.getElementById("jmolspin").value = "Spin off";
           }
           jms0(scpt);
        }
        //document.getElementById("jmolspin").value = "Spin on";

        function jmlabel() {
           var scpt;
           var jjj = document.getElementById("jmollabel").value;
           if  (jjj == "Labels off") {
              scpt = "select all; label off";
              document.getElementById("jmollabel").value = "Labels on";
           } else {
              scpt = "select all; label %a; ";
              scpt += 'select Meitnerium; color atoms TRANSLUCENT orange; label "e-"; ';
              document.getElementById("jmollabel").value = "Labels off";
           }
           jms0(scpt);
        }
        //document.getElementById("jmollabel").value = "Labels on";

        function jmaxes() {
           var scpt;
           var jjj = document.getElementById("jmolaxes").value;
           if  (jjj == "Axes off") {
              scpt = "unitcell 0; axes 0"
              document.getElementById("jmolaxes").value = "Axes on";
           } else {
              scpt = "unitcell 1; axes 1"
              document.getElementById("jmolaxes").value = "Axes off";
           }
           jms0(scpt);
        }
        //document.getElementById("jmolaxes").value = "Axes on";


        function jmreactionplane() {
           var scpt;
           var jjj = document.getElementById("jmolreactionplane").value;
           if  (jjj == "Reaction off") {
              scpt = "draw \"reaction*\" delete;";
              document.getElementById("jmolreactionplane").value = "Reaction on";
              document.getElementById("jmolreactionplane2").value = "Reaction on";
              document.getElementById("jmolreactionplane3").value = "Reaction on";
              document.getElementById("jmolreactionplane4").value = "Reaction on";
              jsmenoreaction();
              Text2Speech0("reaction is off");
           } else {
              //scpt = "draw reactionarrow diameter 0.2  color red arrow {-2,0,0}, {2,0,0}; draw reactionplane \"reaction plane\" 2000 color translucent green plane {0,0,0} {0,1,0} {0,0,1};"
              scpt  = "draw reactionarrow diameter 0.2  color red arrow {-2,0,0}, {2,0,0}; ";
              //scpt += "set userColorScheme white blue yellow red green cyan orange magenta maroon lime grey;";
              //scpt += "set propertycolorscheme 'user';";
              scpt += "draw reactionplane \"reaction plane\" 1500 color translucent red plane {0,0,0} {0,1,0} {0,0,1};"
              document.getElementById("jmolreactionplane").value = "Reaction off";
              document.getElementById("jmolreactionplane2").value = "Reaction off";
              document.getElementById("jmolreactionplane3").value = "Reaction off";
              document.getElementById("jmolreactionplane4").value = "Reaction off";
              jsmereaction();
              Text2Speech0("reaction is on");
           }
           jms0(scpt);
        }
        //document.getElementById("jmolreactionplane").value = "Reaction on";
        //document.getElementById("jmolreactionplane2").value = "Reaction on";
        //document.getElementById("jmolreactionplane3").value = "Reaction on";
        //document.getElementById("jmolreactionplane4").value = "Reaction on";


        function jmbackground() {
           var scpt;
           var jjj = document.getElementById("jmbackcolor").value;
           if (jjj=="Bckgrnd black") {
              scpt="background black;";
              document.getElementById("jmbackcolor").value = "Bckgrnd default";
           } else {
              //scpt="background [xc6ed80];";
              scpt="background [x4286f4];";
              document.getElementById("jmbackcolor").value = "Bckgrnd black";
           }
           jms0(scpt);
        }
        //document.getElementById("jmbackcolor").value = "Bckgrnd black";

        function jmlabelcolor() {
           var scpt;
           var jjj = document.getElementById("jmlblcolor").value;
           if (jjj=="Label black") {
              scpt="select all; color label black;";
              document.getElementById("jmlblcolor").value = "Label CPK";
           } else {
              scpt="select all; color label cpk;";
              document.getElementById("jmlblcolor").value = "Label black";
           }
           jms0(scpt);
        }
        //document.getElementById("jmlblcolor").value = "Label black";


        function jmmodelkit() {
           var scpt;
           var jjj = document.getElementById("jmolmodelkit").value;
           if  (jjj == "ModelKit off") {
              scpt = "set modelkitMode = false;"
              document.getElementById("jmolmodelkit").value = "ModelKit on";
           } else {
              scpt = "set modelkitMode = true;"
              document.getElementById("jmolmodelkit").value = "ModelKit off";
           }
           jms0(scpt);
        }
        //document.getElementById("jmolmodelkit").value = "ModelKit off";

        function jmmovemolecule() {
           jms('unbind; unbind _wheelZoom; unbind "DOUBLE"; set picking off; set picking on; set allowRotateSelected false; set modelKitMode false;');
           jms('set picking off; set picking ON; set atomPicking true; set allowRotateSelected TRUE; set picking dragmolecule;bind "double" "javascript moveMol(2)";');
        }
        function jmmoveatom() {
           jms('unbind; unbind _wheelZoom; unbind "DOUBLE"; set picking off; set picking on; set allowRotateSelected false; set modelKitMode false;');
           jms('set picking off; set picking ON; set picking DRAGATOM; bind "double" "javascript moveMol(1)";');
        }
        function jmrotatebond() {
           jms('unbind; unbind _wheelZoom; unbind "DOUBLE"; set picking off; set picking on; set allowRotateSelected false; set modelKitMode false;');
           jms('set Picking OFF;set Picking ON;set Picking ROTATEBOND;unbind "LEFT-DRAG";bind "LEFT-DRAG" "_rotateBranch";hover off;unbind "WHEEL";bind "WHEEL" "select *;color cpk"');
        }
        function jmrotatemolecule() {
           jms('unbind; unbind _wheelZoom; unbind "DOUBLE"; set picking off; set picking on; set allowRotateSelected false; set modelKitMode false;');
           jms('set picking off; set picking ON;set atomPicking true;set picking dragmolecule;set allowRotateSelected TRUE;bind "drag" "_rotateselected";bind "double" "javascript moveMol(3)";');
        }

        function charge_arrowsdata() {
           var arrows_input = document.form.smi.value;
           //var charge  = eval(jmvar("{*}.formalCharge.sum"));
           var charge  = eval(jmvar("{thisModel}.formalCharge.sum"));
           var charge0 = document.getElementById("nwchemcharge").value;
           if (arrows_input.includes("^{")) {
              charge = eval(arrows_input.split("^{")[1].split("}")[0].trim());
           } else { 
              if (charge==0) { 
                 charge = charge0;
              }
           }
           return charge;
        }
        function mult_arrowsdata() {
           var arrows_input = document.form.smi.value;
           //var charge  = eval(jmvar("{*}.formalCharge.sum"));
           var charge  = eval(jmvar("{thisModel}.formalCharge.sum"));
           var charge0 = eval(document.getElementById("nwchemcharge").value);
           if (arrows_input.includes("^{")) {
              charge = eval(arrows_input.split("^{")[1].split("}")[0].trim());
           } else {
              if (charge==0) { 
                 charge = charge0;
              }
           }
           //var mult  = (eval(jmvar("{*}.elemno.sum")) + charge) % 2 + 1;
           var mult  = (eval(jmvar("{thisModel}.elemno.sum")) + charge) % 2 + 1;
           var odd0  = ((mult%2)==1);
           var mult0 = document.getElementById("nwchemmult").value;
           if (arrows_input.includes("mult{")) {
              mult = eval(arrows_input.split("mult{")[1].split("}")[0].trim());
           } else {
              if (mult0>mult) {
                 mult = mult0;
              }
           }
           var odd = ((mult%2)==1);
           if (odd != odd0) { 
              mult -= 1;
           }
          
           return mult;
        }
        function theory_arrowsdata() {
           var arrows_input = document.form.smi.value;
           var theory = "pspw";
           if (arrows_input.includes("theory{")) {
              theory = arrows_input.split("theory{")[1].split("}")[0].trim();
           } else {
              var ispspw = document.getElementById("bandpspw").value == "pspw";
              var ispspw4 = document.getElementById("bandpspw").value == "pspw4";
              var isband  = document.getElementById("bandpspw").value == "band";
              var ispspwband = document.getElementById("bandpspw").value == "pspw-band";
              var isdft  = document.getElementById("bandpspw").value == "dft";
              var isscf  = document.getElementById("bandpspw").value == "hf";
              var ismp2  = document.getElementById("bandpspw").value == "mp2";
              if (ispspw) {theory= "pspw"; }
              if (ispspw4) {theory= "pspw4"; }
              if (isband) {theory= "band"; }
              if (ispspwband) {theory= "pspw-band"; }
              if (isdft) {theory= "dft"; }
              if (isscf) {theory= "hf"; }
              if (ismp2) {theory= "mp2"; }
           }
           return theory;
        }

        function theory_arrowsdata2() {
           var pspw = theory_arrowsdata();
           if (pspw=="pspw4") {pspw="pspw";}
           if (pspw=="pspw-band") {pspw="band";}
           return pspw;
        }

        function theory_property_arrowsdata() {
           var arrows_input = document.form.smi.value;
           var theory = "pspw";
           if (arrows_input.includes("theory_property{")) {
              theory = arrows_input.split("theory_property{")[1].split("}")[0].trim();
           }
           return theory;
        }

        function basis_arrowsdata() {
           var arrows_input = document.form.smi.value;
           var basis = "default";
           if (arrows_input.includes("basis{")) {
              basis = arrows_input.split("basis{")[1].split("}")[0].trim();
           } else {
              basis = document.getElementById("basis_type").value;
           }
           basis = basis.replace("cartesian","").replace("spherical","");
           if ((theory_arrowsdata().includes("pspw")) || (theory_arrowsdata().includes("band"))) {
              if ((basis.includes("def2")) || (basis.includes("6-31"))) {
                 basis = "default";
              }
              if (basis.includes("Ry")) {
                 basis = parseFloat(basis.split("Ry")[0].trim())*0.5;
                 basis = basis.toFixed(1);
              }
           } else {
              if (basis.includes("Ry")) {
                 basis = "default";
              }
           }
           return basis;
        }
        function basis_property_arrowsdata() {
           var arrows_input = document.form.smi.value;
           var basis = "default";
           if (arrows_input.includes("basis_property{")) {
              basis = arrows_input.split("basis_property{")[1].split("}")[0].trim();
           }
           return basis;
        }
        function basisHZ_arrowsdata() {
           var arrows_input = document.form.smi.value;
           var basis = "default";
           if (arrows_input.includes("basisHZ{")) {
              basis = arrows_input.split("basisHZ{")[1].split("}")[0].trim();
           }
           return basis;
        }
        function basisHZ_property_arrowsdata() {
           var arrows_input = document.form.smi.value;
           var basis = "default";
           if (arrows_input.includes("basisHZ_property{")) {
              basis = arrows_input.split("basisHZ_property{")[1].split("}")[0].trim();
           }
           return basis;
        }
        function xc_arrowsdata() {
           var arrows_input = document.form.smi.value;
           var xc = "pbe";
           if (arrows_input.includes("theory{pspw")) {
              xc = "pbe";
           }
           if (arrows_input.includes("xc{")) {
              xc = arrows_input.split("xc{")[1].split("}")[0].trim();
           }
           return xc;
        }
        function xc_arrowsdata() {
           var arrows_input = document.form.smi.value;
           var xc = "default";
           if (arrows_input.includes("xc{")) {
              xc = arrows_input.split("xc{")[1].split("}")[0].trim();
           } else {
              xc = document.getElementById("xc_type").value;
           }
           if ((xc=="m06-2x") && ((theory_arrowsdata().includes("pspw")) || (theory_arrowsdata().includes("band")))) {
              xc = "default";
           }
           if (xc=="default") {
              xc = "b3lyp";
              if ((arrows_input.includes("pspw")) || ((theory_arrowsdata().includes("pspw")) || (theory_arrowsdata().includes("band")))) {
                 xc = "pbe";
              }
              if ((theory_arrowsdata().includes("mp2")) || (theory_arrowsdata().includes("hf"))) {
                 xc = "xxx";
              }
           }
           return xc;
        }
        function solvation_type_arrowsdata() {
           var arrows_input = document.form.smi.value;
           var solvation_type = "None";
           if (arrows_input.includes("theory{pspw")) {
              solvation_type = "None";
           }
           if (arrows_input.includes("solvation_type{")) {
              solvation_type = arrows_input.split("solvation_type{")[1].split("}")[0].trim();
           }
           return solvation_type;
        }
        function calculation_type_arrowsdata() {
           var arrows_input = document.form.smi.value;
           var calculation_type = "e";
           if (arrows_input.includes("theory{pspw")) {
              calculation_type = "e";
           }
           if (arrows_input.includes("calculation_type{")) {
              calculation_type = arrows_input.split("calculation_type{")[1].split("}")[0].trim();
           }
           return calculation_type;
        }



	function readMolecule() {
		var mol = exMod();
                jsmeApplet.reset();
                jsmeApplet.readMolFile(mol);
                Text2Speech0("Copying JSMol to JSME");
	}


        function loadreaction2dWindow(myid) { 
           var mol = document.form2.smi.value;
           if (!mol.contains(" --> ")) {
    	      mol =  jsmeApplet.smiles();
              var re = /\./g;
              mol = mol.replace(re, " + ");
              mol = mol.replace(">>"," --> ");
           }
           document.getElementById(myid).value = mol;

           //appendreactants2jsmol(mol);
        } 

        function hcleanappendreactants2jsmol(xx,yy) {
           console.log("HELLLO: ", xx,yy);
           if (yy.contains("Step 100") ||  yy.contains("CONVERGED")) {
              document.getElementById('apirunning').value = document.getElementById('apirunning').value.replace("+ running appendreactants2jsmol\n","");
              document.getElementById('nwchemcharge').value = charge_arrowsdata();
              document.getElementById('nwchemmult').value   = mult_arrowsdata();
              jms0('set echoCallback ""');
           }
        }

        function hcleanappendreactants2jsmol2(xx,yy) {
           console.log(" hcleanappendreactants2jsmol2: ", xx,yy);
           if (yy.contains("Step 100") ||  yy.contains("CONVERGED")) {
              document.getElementById('apirunning').value = document.getElementById('apirunning').value.replace("+ running appendreactants2jsmol\n","");
              document.getElementById('nwchemcharge').value = charge_arrowsdata();
              document.getElementById('nwchemmult').value   = mult_arrowsdata();
              jms0('set echoCallback ""');
              finish_Thomas_command("Thomas appendreactants2jsmol");
           }
        }

        function hcleanappendreactants2jsmol3(xx,yy) {
           console.log("HELLLO: ", xx,yy);
           if (yy.contains("Step 100") ||  yy.contains("CONVERGED")) {
              document.getElementById('apirunning').value = document.getElementById('apirunning').value.replace("+ running appendreactants2jsmol\n","");
              document.getElementById('nwchemcharge').value = charge_arrowsdata();
              document.getElementById('nwchemmult').value   = mult_arrowsdata();
              jms0('set echoCallback ""');
              loadframe2jsmol(false,true,0);
           }
        }

        function hScriptCallback(xx,yy) {
           console.log("hScriptCallback: ", xx,yy);
           if (yy.contains("finished jmcellchange")) {
              document.getElementById('apirunning').value = document.getElementById('apirunning').value.replace("+ running jsmol script\n","");
              jms0('set echoCallback ""');
              finish_Thomas_command("Thomas jsmol script");
           }
        }


        function hcleanaddsmiles() {
           jms0('set echoCallback ""');
        }

        function hcleanaddsmiles2() {
           console.log("HCLEANADDSMILES2");
           jms0('set echoCallback ""');
           finish_Thomas_command("Thomas add smiles");
        }

        function hcleancutslab() {
           jms('set echoCallback ""');
        }

        function hcleancutslab2() {
           console.log("HCLEANCUTSLAB2");
           jms0('set echoCallback ""');
           finish_Thomas_command("Thomas generate surface");
        }



        function appendreactants2jsmol(reaction,opt,append) {
           var mol = reaction;
           document.getElementById('apirunning').value += "+ running appendreactants2jsmol\n";
           if (mol.contains("-->")) {
              var i,scpt;
              var rmol = mol.split("-->")[0].split(" + ");
              var nr = rmol.length;
              var trans = document.getElementById('translate_reactants').value;

              // save pre_appended geometry
              let pre_nion = 0;
              let pre_frame = window.xyzframes_cur;
              if (append) {
                 document.getElementById("bulk_atoms").value = "";
                 let molecule_str = exModXYZ();                                                                                                 
                 pre_nion = parseInt(molecule_str.split("\n")[0].trim());
                 loadframe2jsmol(true,false,0);
              }

              for (i=0; i<nr; ++i) {
                 smiles = rmol[i].trim();
                 if (i>0) {
                    scpt = 'set appendNew false; load append smiles \"' + smiles + '\"; select all; select within(molecule,(*)[0]); ';
                 } else {
                    scpt = 'load smiles \"' + smiles + '\"; select all; select within(molecule,(*)[0]); ';
                 }
                 if (trans.trim().split(/[ ,]+/).length==3) {
                    scpt += 'translate {' + trans + '} selected;';
                 }

                 jms(scpt); 
              }
              console.log("append reactant....OPT=",opt, "  append=",append);
              if ((opt==1) && (!append)) {
                 jms('select nonmetal;minimize steps 100; select *; wireframe 0.15; spacefill 23%; boundbox {*}; centerat boundbox; zoom 0; set echoCallback \"hcleanappendreactants2jsmol\"; javascript echo(globalVar);');
              } else if ((opt==1) && (append)) {
                 jms('select nonmetal;minimize steps 100; select *; wireframe 0.15; spacefill 23%; boundbox {*}; centerat boundbox; zoom 0; set echoCallback \"hcleanappendreactants2jsmol\"; javascript echo(globalVar);');
              }
              if ((opt==2) && (!append)) {
                 jms0('select nonmetal;minimize steps 100; select *; wireframe 0.15; spacefill 23%; boundbox {*}; centerat boundbox; zoom 0; set echoCallback \"hcleanappendreactants2jsmol2\"; javascript echo(globalVar);');
              } else if ((opt==2) && (append)) {
                 jms0('select nonmetal;minimize steps 100; select *; wireframe 0.15; spacefill 23%; boundbox {*}; centerat boundbox; zoom 0; set echoCallback \"hcleanappendreactants2jsmol2\"; javascript echo(globalVar);');
              }


           }
        }
          

        function redraw2dWindow() {
    	  //var jme =  jsmeApplet.jmeFile();
          //jsmeApplet.readMolecule(jme);
    	  var mol =  jsmeApplet.smiles();
          console.log("mol=" + mol);
          jsmeApplet.readGenericMolecularInput(mol);
    	}

        function arrows2dWindow() {
           var rmol,pmol;
           var mol    = document.form2.smi.value.split("~")[0];
           if (mol.contains("-->")) {
              rmol = mol.split("-->")[0].split(" + ");
              pmol = mol.split("-->")[1].split(" + ");
           } else {
              rmol = mol.split("-->")[0].split(" + ");
              pmol = [];
           }
           console.log("RMOL=",rmol);
           console.log("PMOL=",pmol);
           var nr = rmol.length;
           var np = pmol.length;

           var i,j;
           var smiles = "";
           for (i=0; i<nr; ++i) {
              smiles += arrows_fetchsmiles(rmol[i]);
              if (i<(nr-1)) {
                 smiles += ".";
              }
           }

           if (np>0) {
              smiles += ">>";
              for (j=0; j<np; ++j) {
                 smiles += arrows_fetchsmiles(pmol[j]);
                 if (j<(np-1)) {
                    smiles += ".";
                 }
              }

           }

           console.log("smiles=" + smiles);

/*
           var re = /\+/g;
           var re2 = / /g;
           mol = mol.split("~")[0]
           mollist = mol.trim().split(/[ ,]+/)[1]);
           for (int i=0; i<mollist.length; ++i) {
           }

           mol = mol.replace(re, ".");
           mol = mol.replace("-->",">>");

           mol = mol.replace(re2,"");
           console.log("mol2=" + mol);
*/

          jsmeApplet.readGenericMolecularInput(smiles);
    	}

        function esmiles2dWindow() {
           
           var mol    = document.form2.smi.value.split("~")[0];
           var re = /\+/g;
           var re2 = / /g;
           mol = mol.split("~")[0];

           mol = mol.replace(re, ".");
           mol = mol.replace("-->",">>");

           var smiles = mol.replace(re2,"");
           
           jsmeApplet.readGenericMolecularInput(smiles,false);
        }


	function appendMolecule() {
		var mol = exMod();
                jsmeApplet.readMolFile(mol);
                Text2Speech0("Appending JSMol to JSME");
	}

	function readMultipart() {
		var jme = "9 9 C 6.68 -7.15 C 5.47 -6.45 C 4.26 -7.15 C 4.26 -8.55 C 5.47 -9.25 C 6.68 -8.55 C 5.47 -5.05 O- 6.68 -4.35 O 4.26 -4.35 1 2 1 2 3 2 3 4 1 4 5 2 5 6 1 6 1 2 2 7 1 7 8 1 7 9 2|1 0 Na+ 12.21 -6.61";
		jsmeApplet.readMolecule(jme) // or document.JME.readMolecule(jme
	}

	function readReaction() {
		var jme = "3 2 C:1 1.41 -7.12 O:2 1.41 -5.72 Cl 2.63 -7.82 1 2 2 1 3 1|3 2 N:3 5.72 -6.78 C:4 7.12 -6.78 H:5 5.02 -7.99 1 2 1 1 3 1 >> 5 4 C:1 13.51 -6.40 O:2 13.51 -5.00 N:3 14.72 -7.10 C:4 15.94 -6.40 H:5 14.71 -8.50 1 2 2 1 3 1 3 4 1 3 5 1";
		jsmeApplet.readMolecule(jme);
	}

	function getMolfile() {
		var data = document.JME.molFile();
		document.getElementById("jme_output").value = data;

	}
	function getSmiles() {
                var drawing = document.JME.smiles();
                document.form.smi.value = drawing;
	}
	function appendSmiles() {
                var drawing = document.JME.smiles();
                var re = /\./g;
                drawing = drawing.replace(re, " + ");
                drawing = drawing.replace(">>"," --> ");
                document.form2.smi.value += drawing;
	}

	function appendSmiles2() {
                //jms("xxsmiles = {1.1}.find(\"SMILES\");");
                //var drawing = jmvar("xxsmiles");
                //var drawing = jmvar("{1.1}.find(\"SMILES\")");
                var drawing = jmvar("{thisModel}.find(\"SMILES\")");
                //var re = /\./g;
                //drawing = drawing.replace(re, " + ");
                drawing = drawing.replace(">>"," --> ");
                document.form.smi.value += drawing;
	}

	function appendXYZ2() {
           var hasreaction = document.getElementById("jmolreactionplane").value == "Reaction off";
           if (hasreaction) {
              var i,ii,jj,kk,tmp,xyz,q,reactants,products;
              var mol = exMod();
              var header = mol.split("V2000")[0];
              var geombonds = mol.split("V2000")[1].trim();
              var nion  = eval(header.split("\n").pop().trim().split(" ")[0]);
              var nbond = eval(header.split("\n").pop().trim().split(/[ ,]+/)[1]);
              var geom0 = geombonds.trim().split("\n").slice(0,nion);
              var bond0 = geombonds.trim().split("\n").slice(nion,nion+nbond);
              var graph0 = Array.apply(null, Array(nion*nion)).map(Number.prototype.valueOf,0);
              //var charge0 =  jmvar("{*}.formalCharge.all");
              var charge0 =  jmvar("{thisModel}.formalCharge.all");
              for (i=0; i<bond0.length; ++i) {
                 tmp = bond0[i].trim().split(/[ ,]+/);
                 ii = eval(tmp[0])-1;
                 jj = eval(tmp[1])-1;
                 kk = eval(tmp[2]);
                 graph0[ii+jj*nion] = kk;
                 graph0[jj+ii*nion] = kk;
              }
              var molecules0 = Array.apply(null, Array(nion)).map(Number.prototype.valueOf,0);
              var mc = 0;
              var foundlink;
              for (ii=0; ii<nion; ++ii) {
                 foundlink = 0;
                 for (jj=0; jj<ii; ++jj) {
                    if ((graph0[ii+jj*nion]>0) && (molecules0[jj]>0)) {
                       foundlink = molecules0[jj];
                    }
                 }
                 if (foundlink==0) {
                    mc += 1;
                    foundlink = mc;
                 }
                 molecules0[ii] = foundlink;
              }
              var signx0;
              reactants = [];
              products  = [];
              for (i=0; i<mc; ++i) {
                 xyz = '';
                 q = 0;
                 signx0 = -1;
                 for (ii=0; ii<nion; ++ii) {
                    if (molecules0[ii]==(i+1)) {
                       if (eval(geom0[ii].trim().split(/[ ,]+/)[0])>0.0) {
                          signx0 = 1;
                       }
                       xyz += geom0[ii].trim().split(/[ ,]+/)[3] + " ";
                       xyz += geom0[ii].trim().split(/[ ,]+/)[0] + " ";
                       xyz += geom0[ii].trim().split(/[ ,]+/)[1] + " ";
                       xyz += geom0[ii].trim().split(/[ ,]+/)[2] + "\n";
                       q += charge0[ii];
                    }
                 }
                 if (xyz.includes("Mt")) {
                    xyz = " SHE ";
                 } else {
                    xyz = " xyzdata{" + xyz.trim().replace(/\n/g,' | ') + "}";
                    if (q!=0.0) {
                       xyz += " ^{" + q.toString() + "} "
                    }
                 }
                 if (signx0<0) {
                    reactants.push(xyz);
                 } else {
                    products.push(xyz);
                 }
              }
              if (document.form.smi.value.includes("~")) {
                 tmp = document.form.smi.value.split("~")[1].trim();
              } else {
                 tmp = '';
              }
              document.form.smi.value = reactants.join(" + ")  + " --> " + products.join(" + ");
              if (tmp!='') {
                 document.form.smi.value += " ~ " + tmp;
              }
           } else {
                var charge  = charge_arrowsdata();
                //var xyzdat  = jmvar("data({1.1},\"xyz\")");
                var xyzdat  = jmvar("data({thisModel},\"xyz\")");
                if (xyzdat.includes('Mt')) {
                   var ss = xyzdat.split('\n');
                   xyzdat = ''
                   for (var i=0; i<ss.length; ++i) {
                      if (!ss[i].includes('Mt')) {
                         xyzdat += ss[i] + '\n';
                      }
                   }
                }
                var drawing = " xyzdata{" + xyzdat.trim().replace(/\n/g,' | ') + "}";
                if (charge!=0.0) {
                   drawing += " ^{" + charge.toString() + "}"
                }
                document.form.smi.value += drawing;
	   }

           // Add unit cell info
           var isshowing = document.getElementById("showcell").value =="Unit cell off";
           if (isshowing) {
              document.form.smi.value += " unitcell{lattice_vectors | ";
              document.form.smi.value += document.getElementById("lattice_a1").value + " | ";
              document.form.smi.value += document.getElementById("lattice_a2").value + " | ";
              document.form.smi.value += document.getElementById("lattice_a3").value + "}";
           }

	}
        // ****************************
        // *                          *
        // *     latblock_a1a2a3      *
        // *                          *
        // ****************************
        function latblock_a1a2a3(latblock) {
           var a1,a2,a3;
           if (latblock.includes("lat_a")) {
              var a = eval(latblock.split("lat_a")[1].trim().split("\n")[0]);
              var b = eval(latblock.split("lat_b")[1].trim().split("\n")[0]);
              var c = eval(latblock.split("lat_c")[1].trim().split("\n")[0]);
              var alpha = eval(latblock.split("alpha")[1].trim().split("\n")[0]);
              var beta  = eval(latblock.split("beta")[1].trim().split("\n")[0]);
              var gamma = eval(latblock.split("gamma")[1].trim().split("\n")[0]);
              var lat = abcabg_to_lattice(a,b,c,alpha,beta,gamma);
              a1 = lat[0];
              a2 = lat[1];
              a3 = lat[2];
               
           } else {
              var ll = latblock.split("lattice_vectors")[1].trim().split("\n");
              a1 = [eval(ll[0].trim().split(/[ ,]+/)[0]),
                    eval(ll[0].trim().split(/[ ,]+/)[1]),
                    eval(ll[0].trim().split(/[ ,]+/)[2])];
              a2 = [eval(ll[1].trim().split(/[ ,]+/)[0]),
                    eval(ll[1].trim().split(/[ ,]+/)[1]),
                    eval(ll[1].trim().split(/[ ,]+/)[2])];
              a3 = [eval(ll[2].trim().split(/[ ,]+/)[0]),
                    eval(ll[2].trim().split(/[ ,]+/)[1]),
                    eval(ll[2].trim().split(/[ ,]+/)[2])];
           }
           return [a1,a2,a3];
        }
        
        // ****************************
        // *                          *
        // *     convert2XYZ          *
        // *                          *
        // ****************************
	function convert2XYZ() {
           var i,n,x,y,m,latblock,isfrac,isgeom;
           var data = editor.getValue(); // or session.getValue
           var lines = data.split("\n");
           if (data.includes("V2000")) {
              data = lines[3].trim().split(" ")[0];
              n = eval(data);
              data += "\n\n";
              n += 4;
              for (i=4; i<n; i++) {
                 x = lines[i].trim().split(/[ ,]+/);
                 data += x[3] + " "; 
                 data += x[0] + " ";
                 data += x[1] + " ";
                 data += x[2] + "\n";
              }
              editor.setValue(data,1);
           } 

           if (data.includes("geometry") && data.includes("end")) {
              n = lines.length;
              m = 0;
              x = false;
              y = false;
              isfrac = false;
              isgeom = false;
              data = "";
              latblock = "";
              for (i=0; i<n; i++) {
                 if (lines[i].includes("geometry ")) {
                    x = true;
                 } else if (lines[i].includes("system crystal")) {
                    y = true;
                    isfrac = true;
                 } else if (lines[i].includes("end") && (y)) {
                    y = false;
                 } else if (y) {
                    latblock += lines[i] + "\n";
                 } else if (lines[i].includes("end") && (x)) {
                    x = false;
                 } else if (x) {
                    if (lines[i].trim().length>0) {
                       if (isfrac) {
                           var sym = lines[i].trim().split(/[ ,]+/)[0];
                           var f1  = eval(lines[i].trim().split(/[ ,]+/)[1]);
                           var f2  = eval(lines[i].trim().split(/[ ,]+/)[2]);
                           var f3  = eval(lines[i].trim().split(/[ ,]+/)[3]);
                           var [a1,a2,a3] = latblock_a1a2a3(latblock);
                           var xx = f1*a1[0] + f2*a2[0] + f3*a3[0];
                           var yy = f1*a1[1] + f2*a2[1] + f3*a3[1];
                           var zz = f1*a1[2] + f2*a2[2] + f3*a3[2];
                           data += sym + " " + xx.toFixed(6) + " " + yy.toFixed(6) + " " + zz.toFixed(6) + "\n";
                       } else {
                          data += lines[i] + "\n";
                       }
                       m += 1;
                    }
                 }
              }
              if (latblock != "") {
                 var a1a2a3 = latblock_a1a2a3(latblock);
                 latblock  = a1a2a3[0][0].toFixed(6) + " " + a1a2a3[0][1].toFixed(6) + " " + a1a2a3[0][2].toFixed(6) + " ";
                 latblock += a1a2a3[1][0].toFixed(6) + " " + a1a2a3[1][1].toFixed(6) + " " + a1a2a3[1][2].toFixed(6) + " ";
                 latblock += a1a2a3[2][0].toFixed(6) + " " + a1a2a3[2][1].toFixed(6) + " " + a1a2a3[2][2].toFixed(6);
              } else {
                 latblock = ""
              }
              data = m.toString() + "\n" + latblock + "\n" + data;
              editor.setValue(data,1);
           }
        } 


        function symbols_ncharge(symbols,q) {
           var periodic_table_charge = { 'H'  : 1, 'He' : 2, 'Li' : 3, 'Be' : 4, 'B'  : 5, 'C'  : 6, 'N'  : 7, 'O'  : 8, 'F'  : 9, 'Ne' : 10, 'Na' : 11, 'Mg' : 12, 'Al' : 13, 'Si' : 14, 'P'  : 15, 'S'  : 16, 'Cl' : 17, 'Ar' : 18, 'K'  : 19, 'Ca' : 20, 'Sc' : 21, 'Ti' : 22, 'V'  : 23, 'Cr' : 24, 'Mn' : 25, 'Fe' : 26, 'Co' : 27, 'Ni' : 28, 'Cu' : 29, 'Zn' : 30, 'Ga' : 31, 'Ge' : 32, 'As' : 33, 'Se' : 34, 'Br' : 35, 'Kr' : 36, 'Rb' : 37, 'Sr' : 38, 'Y'  : 39, 'Zr' : 40, 'Nb' : 41, 'Mo' : 42, 'Tc' : 43, 'Ru' : 44, 'Rh' : 45, 'Pd' : 46, 'Ag' : 47, 'Cd' : 48, 'In' : 49, 'Sn' : 50, 'Sb' : 51, 'Te' : 52, 'I'  : 53, 'Xe' : 54, 'Cs' : 55, 'Ba' : 56, 'La' : 57, 'Ce' : 58, 'Pr' : 59, 'Nd' : 60, 'Pm' : 61, 'Sm' : 62, 'Eu' : 63, 'Gd' : 64, 'Tb' : 65, 'Dy' : 66, 'Ho' : 67, 'Er' : 68, 'Tm' : 69, 'Yb' : 70, 'Lu' : 71, 'Hf' : 72, 'Ta' : 73, 'W'  : 74, 'Re' : 75, 'Os' : 76, 'Ir' : 77, 'Pt' : 78, 'Au' : 79, 'Hg' : 80, 'Tl' : 81, 'Pb' : 82, 'Bi' : 83, 'Po' : 84, 'At' : 85, 'Rn' : 86, 'Fr' : 87, 'Ra' : 88, 'Ac' : 89, 'Th' : 90, 'Pa' : 91, 'U'  : 92, 'Np' : 93, 'Pu' : 94, 'Am' : 95, 'Cm' : 96, 'Bk' : 97, 'Cf' : 98, 'Es' : 99, 'Fm' : 100, 'Md' : 101, 'No' : 102, 'Lr' : 103, 'Rf' : 104, 'Ha' : 105, 'Sg' : 106, 'Bh' : 107, 'Hs' : 108, 'Mt' : 109 };
           var i;
           var ncharge = -q;
           for (i=0; i<symbols.length; i++) {
               ncharge += periodic_table_charge[symbols[i]];
           }
           return ncharge;
        }

        function makegaussianbasis(basis,basisHZ,katom) {
           var i,aa;
           var periodic_table_charge = { 'H'  : 1, 'He' : 2, 'Li' : 3, 'Be' : 4, 'B'  : 5, 'C'  : 6, 'N'  : 7, 'O'  : 8, 'F'  : 9, 'Ne' : 10, 'Na' : 11, 'Mg' : 12, 'Al' : 13, 'Si' : 14, 'P'  : 15, 'S'  : 16, 'Cl' : 17, 'Ar' : 18, 'K'  : 19, 'Ca' : 20, 'Sc' : 21, 'Ti' : 22, 'V'  : 23, 'Cr' : 24, 'Mn' : 25, 'Fe' : 26, 'Co' : 27, 'Ni' : 28, 'Cu' : 29, 'Zn' : 30, 'Ga' : 31, 'Ge' : 32, 'As' : 33, 'Se' : 34, 'Br' : 35, 'Kr' : 36, 'Rb' : 37, 'Sr' : 38, 'Y'  : 39, 'Zr' : 40, 'Nb' : 41, 'Mo' : 42, 'Tc' : 43, 'Ru' : 44, 'Rh' : 45, 'Pd' : 46, 'Ag' : 47, 'Cd' : 48, 'In' : 49, 'Sn' : 50, 'Sb' : 51, 'Te' : 52, 'I'  : 53, 'Xe' : 54, 'Cs' : 55, 'Ba' : 56, 'La' : 57, 'Ce' : 58, 'Pr' : 59, 'Nd' : 60, 'Pm' : 61, 'Sm' : 62, 'Eu' : 63, 'Gd' : 64, 'Tb' : 65, 'Dy' : 66, 'Ho' : 67, 'Er' : 68, 'Tm' : 69, 'Yb' : 70, 'Lu' : 71, 'Hf' : 72, 'Ta' : 73, 'W'  : 74, 'Re' : 75, 'Os' : 76, 'Ir' : 77, 'Pt' : 78, 'Au' : 79, 'Hg' : 80, 'Tl' : 81, 'Pb' : 82, 'Bi' : 83, 'Po' : 84, 'At' : 85, 'Rn' : 86, 'Fr' : 87, 'Ra' : 88, 'Ac' : 89, 'Th' : 90, 'Pa' : 91, 'U'  : 92, 'Np' : 93, 'Pu' : 94, 'Am' : 95, 'Cm' : 96, 'Bk' : 97, 'Cf' : 98, 'Es' : 99, 'Fm' : 100, 'Md' : 101, 'No' : 102, 'Lr' : 103, 'Rf' : 104, 'Ha' : 105, 'Sg' : 106, 'Bh' : 107, 'Hs' : 108, 'Mt' : 109 };
           var foundHZ = false;
           var str = "basis \"ao basis\" cartesian print\n";

           for (i=0; i<katom.length; i++) {
              aa = katom[i];
              if (periodic_table_charge[aa]<21) {
                 if (basis=='default') { 
                    str += " " + aa + " library \"6-311++G(2d,2p)\"" + "\n";
                 } else {
                    str += " " + aa + " library " + basis + "\n";
                 }
              } else {
                 if (basisHZ=='default') {
                    if (periodic_table_charge[aa]<37) {
                       str += " " + aa + " library aug-cc-pVTZ" + "\n";
                    } else if (periodic_table_charge[aa]<87) {
                       str += " " + aa + " library Def2-TZVPD" + "\n";
                       foundHZ = true;
                    } else {
                       str += " " + aa + " library crenbl_ecp" + "\n";
                       foundHZ = true;
                    }
                 } else {
                    str += " " + aa + " library " + basisHZ + "\n";
                    if (periodic_table_charge[aa]>=37) {
                       foundHZ = true;
                    }
                 } 
              } 
           }
           str += "end\n";

           if (foundHZ) { 
              str += "ecp\n"
              for (i=0; i<katom.length; i++) {
                 aa = katom[i];
                 if (periodic_table_charge[aa]>=37) {
                    if (basisHZ=='default') { 
                       if (periodic_table_charge[aa]<87) {
                          str += " " + aa + " library Def2-TZVPD" + "\n";
                       } else {
                          str += " " + aa + " library crenbl_ecp" + "\n";
                       }
                    } else {
                       str += " " + aa + " library " + basisHZ + "\n";
                    }
                 }
              }
              str += "end\n";
           }
           str += "\n";
           return str;
        }

        function makegeom_neb(periodic) {
           var models = prompt("Please reaction and product model numbers:", "1 2");
           var amodel1 = parseInt(models.split(/[ ,]+/)[0])-1;
           var amodel2 = parseInt(models.split(/[ ,]+/)[1])-1;
           console.log("model1=",amodel1);
           console.log("model2=",amodel2);

           //*** generate neb_start geometry input ***
           var eoln = "\n";
           var tstr = '';
           tstr += eoln+eoln+eoln;
           if (periodic) {
              tstr += "nwpw\n";
              tstr += fetchframelat(amodel1);
              tstr += "end\n\n";
           }
           tstr += "geometry units angstroms print xyz noautosym noautoz nocenter"+eoln;
           tstr += fetchframexyz(amodel1);
           tstr += "end"+eoln;

           //*** generate neb_end geometry input ***
           tstr += eoln+eoln+eoln;
           tstr += "geometry neb_end units angstroms print xyz noautosym noautoz nocenter"+eoln;
           tstr += fetchframexyz(amodel2);
           tstr += "end"+eoln;

           return tstr;
        }

        // ****************************
        // *                          *
        // *     setQueueLabel        *
        // *                          *
        // ****************************
        function setQueueLabel() {
           var data  = editor.getValue(); // or session.getValue
           if (data.includes("nwchem_output")) {
              var oldlabel = document.getElementById("queue_nwchem_label").value;
              var nwoutput = data.split("nwchem_output")[1].split("\n")[0].trim();
              if ((oldlabel.length==0) || (oldlabel.includes(".out"))) {
                 document.getElementById("queue_nwchem_label").value = nwoutput;
              }
           }
        }


        // ****************************
        // *                          *
        // *     convert2geometry     *
        // *                          *
        // ****************************
	function convert2geometry(iscif) {
           var i,n,x,y,z,a1,a2,a3,b1,b2,b3,lat,fdata,cifdata,cifdata2,tt,haslattice,symbol;
           var symbols = [];
           var xyz     = [];
           var data  = editor.getValue(); // or session.getValue
           var lines = data.split("\n");
           var machine = document.getElementById("machine").value;
           var queue   = document.getElementById("queue").value;
           var qtime   = document.getElementById("queue_time").value;
           var ncpus   = document.getElementById("queue_ncpus").value;
           var account = document.getElementById("queue_account").value;
            

           var today = new Date();
           var date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
           var time = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
           var dateTime = date+' '+time;
           var geomlattice =  (document.getElementById("latticelocation").value == "Lattice in geometry block") ||  
                              (document.getElementById("latticelocation").value == "default");
           var lattice_type=  document.getElementById("latticelocation").value;
           var reading = 0;

           if (data.includes("_cell_length_a")) { //read cif data
              reading = 1;
              var [fracgeom,lattice,symmetry] = parse_cif(data);
              lat = lattice[6];
              a1 = lattice[0];
              a2 = lattice[1];
              a3 = lattice[2];

              data  = "geometry\n";
              fdata = "geometry noautoz nocenter noautosym\n";
              if (geomlattice) {
                 fdata += "system crystal\n";
                 fdata += "   lattice_vectors\n";
                 fdata += "     " + vec3_to_string3(a1) + "\n";
                 fdata += "     " + vec3_to_string3(a2) + "\n";
                 fdata += "     " + vec3_to_string3(a3) + "\n";
                 fdata += "end\n\n";
              }
              cifdata = "data_emsl_arrows\n\n";
              cifdata += "_audit_creation_date " + dateTime + "\n";
              cifdata += "_audit_creation_method generated by Tiny Arrows\n";
              cifdata += "\n\n";
              cifdata += "_cell_length_a     " + lat[0].toFixed(4) + "\n";
              cifdata += "_cell_length_b     " + lat[1].toFixed(4) + "\n";
              cifdata += "_cell_length_c     " + lat[2].toFixed(4) + "\n";
              cifdata += "_cell_angle_alpha " + lat[3].toFixed(4) + "\n";
              cifdata += "_cell_angle_beta  " + lat[4].toFixed(4) + "\n";
              cifdata += "_cell_angle_gamma " + lat[5].toFixed(4) + "\n\n";
              cifdata += "_symmetry_space_group_name_H-M     P1\n\n";

              cifdata += "loop_\n";
              cifdata += "_atom_site_type_symbol\n";
              cifdata += "_atom_site_fract_x\n";
              cifdata += "_atom_site_fract_y\n";
              cifdata += "_atom_site_fract_z\n";
              for (i=0; i<fracgeom.length; ++i) {
                 var symb = fracgeom[i][0];
                 var f1   = fracgeom[i][1];
                 var f2   = fracgeom[i][2];
                 var f3   = fracgeom[i][3];
                 x = f1*a1[0] + f2*a2[0] + f3*a3[0];
                 y = f1*a1[1] + f2*a2[1] + f3*a3[1];
                 z = f1*a1[2] + f2*a2[2] + f3*a3[2];
                 cifdata += symb + " " + f1.toFixed(6) + " " + f2.toFixed(6) + " " + f3.toFixed(6) + "\n";
                 fdata   += symb + " " + f1.toFixed(6) + " " + f2.toFixed(6) + " " + f3.toFixed(6) + "\n";
                 data    += symb + " " + x.toFixed(6) + " " + y.toFixed(6) + " " + z.toFixed(6) + "\n";
              }
              data  = data.trim() + "\n";
              fdata = fdata.trim() + "\n";
              data  += "end\n";
              fdata += "end\n";

           } else if (data.includes("geometry") && data.includes("end")) { //read nwchem data
              reading = 2;
              n = lines.length;
              x = false;
              y = false;
              z = 999;
              data  = "";
              fdata = "";
              cifdata2 = "";
              cifdata = "data_emsl_arrows\n\n";
              cifdata += "_audit_creation_date " + dateTime + "\n";
              cifdata += "_audit_creation_method generated by Tiny Arrows\n";
              cifdata += "\n\n";
              for (i=0; i<n; i++) {
                 if (lines[i].includes("geometry")) {
                    x = true;
                    data += lines[i] + "\n";
                    fdata += lines[i] + "\n";
                 } else if (lines[i].includes("lattice_vectors")) {
                    fdata += lines[i] + "\n";
                    z = 1;
                 } else if (z==1) {
                    fdata += lines[i] + "\n";
                    tt = lines[i];
                    z = 2;
                 } else if (z==2) {
                    fdata += lines[i] + "\n";
                    tt +=  " " + lines[i];
                    z = 3;
                 } else if (z==3) {
                    fdata += lines[i] + "\n";
                    tt +=  " " + lines[i];
                    [[a1,a2,a3,b1,b2,b3,lat],haslattice]  =  xyzrow2_to_lattice(tt.trim().split(/[ ,]+/));
                    cifdata += "_cell_length_a     " + lat[0].toFixed(4) + "\n";
                    cifdata += "_cell_length_b     " + lat[1].toFixed(4) + "\n";
                    cifdata += "_cell_length_c     " + lat[2].toFixed(4) + "\n";
                    cifdata += "_cell_angle_alpha " + lat[3].toFixed(4) + "\n";
                    cifdata += "_cell_angle_beta  " + lat[4].toFixed(4) + "\n";
                    cifdata += "_cell_angle_gamma " + lat[5].toFixed(4) + "\n\n";
                    cifdata += "_symmetry_space_group_name_H-M     P1\n\n";

                    cifdata += "loop_\n";
                    cifdata += "_atom_site_type_symbol\n";
                    cifdata += "_atom_site_fract_x\n";
                    cifdata += "_atom_site_fract_y\n";
                    cifdata += "_atom_site_fract_z\n";
                    z = 4;
                 } else if (lines[i].includes("system crystal")) {
                    fdata += lines[i] + "\n";
                    y = true;
                 } else if ((lines[i].includes("end")) && (y) ) {
                    y = false;
                    fdata += lines[i] + "\n";
                 } else if (y) {
                    fdata += lines[i] + "\n";
                 } else if ((lines[i].includes("end")) && (x) ) {
                    x = false;
                    data += lines[i] + "\n";
                    fdata += lines[i] + "\n";
                 } else if (x) {
                    fdata += lines[i] + "\n";
                    if (lines[i].trim().length>0) {
                       data += lines[i] + "\n";
                       cifdata2 += lines[i] + "\n";
                       symbols.push(lines[i].trim().split(/[ ,]+/)[0]);
                       xyz.push(lines[i].trim().split(/[ ,]+/)[1]);
                       xyz.push(lines[i].trim().split(/[ ,]+/)[2]);
                       xyz.push(lines[i].trim().split(/[ ,]+/)[3]);
                    }
                 }
              }
           } else { // read xyz data 
              reading = 3;
              [[a1,a2,a3,b1,b2,b3,lat],haslattice] =  xyzrow2_to_lattice(lines[1].trim().split(/[ ,]+/));
              n = eval(lines[0].trim().split(" ")[0]);
              cifdata2 = "";
              cifdata = "data_emsl_arrows\n\n";
              cifdata += "_audit_creation_date " + dateTime + "\n";
              cifdata += "_audit_creation_method generated by Tiny Arrows\n";
              cifdata += "\n\n";
              cifdata += "_cell_length_a     " + lat[0].toFixed(4) + "\n";
              cifdata += "_cell_length_b     " + lat[1].toFixed(4) + "\n";
              cifdata += "_cell_length_c     " + lat[2].toFixed(4) + "\n";
              cifdata += "_cell_angle_alpha " + lat[3].toFixed(4) + "\n";
              cifdata += "_cell_angle_beta  " + lat[4].toFixed(4) + "\n";
              cifdata += "_cell_angle_gamma " + lat[5].toFixed(4) + "\n\n";
              cifdata += "_symmetry_space_group_name_H-M     P1\n\n";

              cifdata += "loop_\n";
              cifdata += "_atom_site_type_symbol\n";
              cifdata += "_atom_site_fract_x\n";
              cifdata += "_atom_site_fract_y\n";
              cifdata += "_atom_site_fract_z\n";
     
              fdata = "geometry noautoz nocenter noautosym\n";
              if ((haslattice) && (geomlattice)) {
                 fdata += "system crystal\n"
                 fdata += "   lattice_vectors\n";
                 fdata += "     " + a1[0].toFixed(6) + " " + a1[1].toFixed(6) + " " + a1[2].toFixed(6) + "\n";
                 fdata += "     " + a2[0].toFixed(6) + " " + a2[1].toFixed(6) + " " + a2[2].toFixed(6) + "\n";
                 fdata += "     " + a3[0].toFixed(6) + " " + a3[1].toFixed(6) + " " + a3[2].toFixed(6) + "\n";
                 fdata += "end\n\n";
              }
              data = "geometry\n";
              n += 2;
              for (i=2; i<n; i++) {
                 data += lines[i] + "\n";
                 if ((haslattice) && (geomlattice)) {
                    symbol = lines[i].trim().split(/[ ,]+/)[0];
                    x = eval(lines[i].trim().split(/[ ,]+/)[1]);
                    y = eval(lines[i].trim().split(/[ ,]+/)[2]);
                    z = eval(lines[i].trim().split(/[ ,]+/)[3]);
                    var f1 = x*b1[0] + y*b1[1] + z*b1[2];
                    var f2 = x*b2[0] + y*b2[1] + z*b2[2];
                    var f3 = x*b3[0] + y*b3[1] + z*b3[2];
                    fdata += symbol + " " + f1.toFixed(6) + " " + f2.toFixed(6) + " " + f3.toFixed(6) + "\n";
                 } else {
                    fdata += lines[i] + "\n";
                 }
                 cifdata2 += lines[i] + "\n";
                 symbols.push(lines[i].trim().split(/[ ,]+/)[0]);
                 xyz.push(lines[i].trim().split(/[ ,]+/)[1]);
                 xyz.push(lines[i].trim().split(/[ ,]+/)[2]);
                 xyz.push(lines[i].trim().split(/[ ,]+/)[3]);
              }
              data  = data.trim() + "\n";
              fdata = fdata.trim() + "\n";
              data  += "end\n";
              fdata += "end\n";
           }

 
           
           // Add Header
           //var katom    = jmvar("{*}.find(\"MF\")").replace(/[0-9]/g,'').trim().split(/[ ,]+/);
           //var mformula = jmvar("{*}.find(\"MF\")").replace(/ /g,'');
           var katom    = jmvar("{thisModel}.find(\"MF\")").replace(/[0-9]/g,'').trim().split(/[ ,]+/);
           var mformula = jmvar("{thisModel}.find(\"MF\")").replace(/ /g,'');
           var theory  = theory_arrowsdata();
           var basis   = basis_arrowsdata();
           var basisHZ = basisHZ_arrowsdata();
           var xc      = xc_arrowsdata();
           var charge  = charge_arrowsdata();
           var mult    = mult_arrowsdata();
           var calculation_type = calculation_type_arrowsdata();
           var solvation_type   = solvation_type_arrowsdata();
           var jobname = theory + "-" + xc + "-" + mformula;
           var mformula0 = mformula;

           if (calculation_type.includes("a")) {
               data = "";
               fdata = "";
               mformula += "-neb";
           }

           x =  "#nwchem_input  " + mformula + ".nw\n";
           x += "#nwchem_output " + mformula + ".out00\n";
           x += "#nwchem_done   " + mformula + ".done\n";
           x += "#\n";
           x += "#mformula = " + mformula0 + "\n";
           x += "#\n";
           x += "#mformula_off\n";
           x += "#\n";
           x += "#transfer_files *.nw *.xyz *.ion_motion *.emotion *.fei *.cif *.hist *.gr meta_*.dat meta.dat *.meta_gaussians *.cube *_epath *_final_epath POWER_SPECTRUM VELOCITY_SPECTRUM VEL_CORRELATION PAIR_DISTRIBUTION *.dipole_powerspectrum *.dipole_correlation\n";
           x += "#bad_files md_xs\n";
           x += "#\n";
           if ((document.getElementById("queue_nwchem_jobname").value.trim().length) > 0) {
              jobname += "-" + document.getElementById("queue_nwchem_jobname").value.trim();
           }
           var projectname = document.getElementById("queue_nwchem_projectname").value;
           var curdir0 = document.getElementById("queue_nwchem_curdir0").value;
           var permdir = document.getElementById("queue_nwchem_permdir").value;
           var curdir  = document.getElementById("queue_nwchem_curdir").value;
           i =  window.xyzframes_cur + 1;

           if (permdir.length<=0) {
              permdir = jobname;
              if (document.getElementById("queue_nwchem_jobmodel").checked) {
                 permdir += "-m-"+i.toString();
              }
              if (document.getElementById("queue_nwchem_jobdate").checked) {
                 var today = new Date();
                 var date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
                 permdir += "-d-"+date;
              }
              permdir = prompt("Please enter Bulk Atoms :", permdir);
              document.getElementById("queue_nwchem_permdir").value = permdir;
           }

           if (curdir.length<=0) {
              if (projectname.length<=0) {
                 curdir  = curdir0 +"/" + permdir;
              } else {
                 curdir  = curdir0 + "/" + projectname + "/" + permdir;
              }
              if (curdir0.length<=0) {
                 if (!iscif) {
                    curdir  = prompt("Please enter curdir:", curdir);
                 }
              }
              document.getElementById("queue_nwchem_curdir").value = curdir;
           }
           document.getElementById("nwchemcharge").value = charge;
           document.getElementById("nwchemmult").value   = mult;

           x += "#curdir " + curdir +"\n";
           x += "#\n";
           x += "#permdir " + permdir + "\n";
           if (document.getElementById("queue_nwchem_jobdeletescratch").checked) {
              x += "#deletescratch yes\n";
           } else {
              x += "#deletescratch no\n";
           }
           x += "#queuesave no\n"
           x += "#\n";
           x += "#machine " + machine + "\n";
           if (queue.length<4) { queue = "regular"; }
           if (qtime.length<3) {
            
              if (machine.includes("theta")) {
                 if (queue.includes("debug")) {
                    qtime = "0:58:00";
                 } else {
                    qtime = "3:00:00";
                 }
              } else {
                 if (queue.includes("debug")) {
                    qtime = "00:30:00";
                 } else {
                    qtime = "18:05:00";
                 }
              }
           }
           x += "#cputime " + qtime + "\n"
           x += "#ncpus " + ncpus + "\n";
           x += "#queue " + queue + "\n"
           if (account.length>1) {
              x += "#account " + account + "\n"
           }
           x += "#\n";

           x += "title \"swnc: " + calculation_type;
           x += " theory=" + theory;
           x += " xc=" + xc;
           x += " formula=" + mformula;
           x += " charge=" + charge.toString();
           x += " mult=" + mult.toString();
           x += "\"";
           x += "\n#machinejob:expert";
           x +=  "\n\n";
           x += "echo\n\n";
           x += "start " + jobname + "\n\n";
           if (machine.includes("ccs-knl0")) {
              x += "memory heap 500 mb stack 350 mb global 10 mb\n\n"
           } else {
              x += "memory 1900 mb\n\n"
           }

           x += "charge " + charge.toString() + "\n\n";
           if ((theory=="pspw") || (theory=="paw") || (theory=="band") || (theory=="pspw-band")) {
              data = x + fdata + "\n\n";
           } else {
              data = x + data + "\n\n";
           }

           // Add theory
           x = "";
           if ((theory=="pspw") || (theory=="pspw4") || (theory=="paw") || (theory=="paw4") || (theory=="band") || (theory=="pspw-band")) {
              x = "nwpw\n";
              x += "  ### pseudopotential block begin ###\n";
              x += "  ### pseudopotential block end   ###\n";
              if (!geomlattice) {
                 if (lattice_type=="FCC 38") {
                    x += "  simulation_cell\n     FCC 38\n  end\n\n";
                 } else if  (lattice_type=="SC 26") {
                    x += "  simulation_cell\n     SC 26\n  end\n\n";
                 } else {
                    x += "  simulation_cell units angstroms\n"
                    x += "     lattice_vectors\n";
                    x += "       " + a1[0].toFixed(6) + " " + a1[1].toFixed(6) + " " + a1[2].toFixed(6) + "\n";
                    x += "       " + a2[0].toFixed(6) + " " + a2[1].toFixed(6) + " " + a2[2].toFixed(6) + "\n";
                    x += "       " + a3[0].toFixed(6) + " " + a3[1].toFixed(6) + " " + a3[2].toFixed(6) + "\n";
                    x += "  end\n\n";
                 }

              }
              if (basis=="default") {
                 x += "  cutoff 50.0\n";
              }
              else {
                 x += "  cutoff " + basis + "\n";
              }
              x += "  mult " + mult.toString() + "\n";
              if (xc=="lda")    {x += "  xc vosko";}
              if (xc=="pbe")    {x += "  xc pbe96";}
              if (xc=="blyp")   {x += "  xc blyp";}
              if (xc=="b3lyp")  {x += "  xc b3lyp";}
              if (xc=="pbe0")   {x += "  xc pbe0";}
              if (xc=="single-pbe0")   {x += "  xc pbe0\n   single_precision_hfx";}
              if (xc=="tpss03")   {x += "  xc tpss03";}
              if (xc=="scan")   {x += "  xc scan";}
              if (xc=="vs98")   {x += "  xc vs98";}
              if (xc=="m06-2x") {x += "  xc m06-2x";}
              if (xc=="revpbe")    {x += "  xc revpbe";}
              if (xc=="pbesol")    {x += "  xc pbesol";}
              if (xc=="pbe-grimme2")    {x += "  xc pbe96-grimme2";}
              if (xc=="pbe-grimme3")    {x += "  xc pbe96-grimme3";}
              if (xc=="beef")    {x += "  xc beef";}
              if (xc=="xbeef-cpbe")    {x += "  xc xbeef-cpbe";}
              if (xc=="beef-vdw2")    {x += "  xc beef-vdw2";}
              x += "\n";

              if (document.getElementById("nwchemvirt").value>0) {
                 x += "  virtual " + document.getElementById("nwchemvirt").value.toString() + "\n";;
              }
              if (document.getElementById("nwchemewald_rcut").value>0) {
                 x += "  ewald_rcut " + document.getElementById("nwchemewald_rcut").value.toString() + "\n";
              }
              if (document.getElementById("nwchemewald_ncut").value>0) {
                 x += "  ewald_ncut " + document.getElementById("nwchemewald_ncut").value.toString() + "\n";
              }

              if (document.getElementById("nwchemoptimizer").value.includes("scf")) {
                 x += "  lmbfgs\n\n";
              } else {
                 x += "  " + document.getElementById("nwchemoptimizer").value + " \n\n";
              }
              if ((document.getElementById("nwchemnp_dim1").value>0) ||
                  (document.getElementById("nwchemnp_dim2").value>0)) {
                 let dim1 = document.getElementById("nwchemnp_dim1").value; if (dim1<=0) {dim1=-1;}
                 let dim2 = document.getElementById("nwchemnp_dim2").value; if (dim2<=0) {dim2=-1;}
                 x += "  np_dimensions";
                 x += " " + dim1.toString();
                 x += " " + dim2.toString();
                 x += "\n";
              }
              if (!document.getElementById("parallelmapping3").value.includes("default")) {
                 x += "  " + document.getElementById("parallelmapping3").value + "\n";
              }
              if (document.getElementById("nwchem_born").checked) {
                 x += "  born on\n";
              }

 

              x += gen_spin_penalty("atomlist1","penalty1a","penalty1b","penalty1c");
              x += gen_spin_penalty("atomlist2","penalty2a","penalty2b","penalty2c");
              x += gen_spin_penalty("atomlist3","penalty3a","penalty3b","penalty3c");
              x += gen_spin_penalty("atomlist4","penalty4a","penalty4b","penalty4c");
              x += "end\n";
              x += "set nwpw:kbpp_ray    .true.\n";
              x += "set nwpw:kbpp_filter .true.\n";

              // Adding Monkhorst Pack input
              if (theory.includes("band")) {
                 if (theory.includes("pspw")) {
                    x += "task pspw energy ignore\n\n";
                 } else {
                    x += "task band energy ignore\n\n";
                 }
                 x += "nwpw\n";
                 if ((document.getElementById("nwchemnp_dim1").value>0) ||
                     (document.getElementById("nwchemnp_dim2").value>0) ||
                     (document.getElementById("nwchemnp_dim3").value>0)) {
                    let dim1 = document.getElementById("nwchemnp_dim1").value; if (dim1<=0) {dim1=-1;}
                    let dim2 = document.getElementById("nwchemnp_dim2").value; if (dim2<=0) {dim2=-1;}
                    let dim3 = document.getElementById("nwchemnp_dim3").value; if (dim3<=0) {dim3=-1;}
                    x += "  np_dimensions";
                    x += " " + dim1.toString();
                    x += " " + dim2.toString();
                    x += " " + dim3.toString();
                    x += "\n";
                 }

                 if ((document.getElementById("nwchemmp1").value>0) &&
                     (document.getElementById("nwchemmp2").value>0) &&
                     (document.getElementById("nwchemmp3").value>0)) {
                    x += "  monkhorst-pack";
                    x += " " + document.getElementById("nwchemmp1").value.toString();
                    x += " " + document.getElementById("nwchemmp2").value.toString();
                    x += " " + document.getElementById("nwchemmp3").value.toString();
                    x += "\n";
                 }
                 x += "end\n";
              }

              // Adding SCF and Fractional input
              if (document.getElementById("nwchemoptimizer").value.includes("scf")) {
                 if (theory.includes("band")) {
                    x += "task band energy ignore\n\n";
                 } else {
                    x += "task pspw energy ignore\n\n";
                 }
                 x += "nwpw\n";
                 x += "   scf";
                 x += " " + document.getElementById("nwchemscfopt").value.toString();
                 x += " " + document.getElementById("nwchemscfmixingtype").value.toString();
                 x += " " + document.getElementById("nwchemscfmixing").value.toString();
                 x += " alpha " + document.getElementById("nwchemks_alpha").value.toString();
                 if (document.getElementById("nwchemouter_ksit").value>0) {
                    x += " outer_iterations " + document.getElementById("nwchemouter_ksit").value.toString();
                 }
                 if (document.getElementById("nwcheminner_ksit").value>0) {
                    x += " iterations " + document.getElementById("nwcheminner_ksit").value.toString();
                 }

                 if (document.getElementById("nwchemkerker").value>0.0) {
                    x += " kerker " + document.getElementById("nwchemkerker").value.toString();
                 }
                 x += "\n";
                 if (!document.getElementById("nwchemfractional").value.includes("No")) {
                    x += "   smear";
                    x += " " + document.getElementById("nwchemfractional").value.toString();
                    x += " temperature " + document.getElementById("nwchemfractional_temperature").value.toString();
                    x += " alpha " + document.getElementById("nwchemfractional_alpha").value.toString();
                    x += " orbitals " + document.getElementById("nwchemfractional_orbitals").value.toString();
                    x += "\n";
                 }
                 x += "end\n";
              }

              if ((theory=="pspw4")||(theory=="paw4")) {
                 x += "nwpw\n";
                 x += "  simulation_cell\n";
                 //x += "    fcc 38.0\n";
                 x += "    boundary_conditions aperiodic\n";
                 x += "  end\n";
                 x += "end\n"; 
              }

              x += "set nwpw:cif_filename " + mformula + "\n\n";

              data += x;
      
           } else if (theory=="dft") {

              x = makegaussianbasis(basis,basisHZ,katom);

              x += "dft\n";
              x += "  direct\n";
              x += "  noio\n"; 
              x += "  grid nodisk\n";
              x += "  mult " + mult.toString() + "\n";
              if (xc.includes("pbe0")) { 
                 x += "  xc pbe0";
              } else if (xc.includes("pbe")) {
                 x += "  xc xpbe96 cpbe96";
              }
              if (xc.includes("blyp"))   {x += "  xc becke88 lyp";}
              if (xc.includes("b3lyp"))  {x += "  xc b3lyp";}
              if (xc.includes("m06-2x")) {x += "  xc m06-2x";}
              x += "\n";
              if (xc.includes("coarse")) {x += "  grid coarse";}
              if (xc.includes("fine"))   {x += "  grid fine";}
              if (xc.includes("xfine"))  {x += "  grid xfine";}
              x += "\n";
              x += "  iterations 5001\n";
              x += "end\n";

              data += x;

           } else if ((theory=="hf") || (theory=="uhf")) {
              x  = makegaussianbasis(basis,basisHZ,katom);
              if (mult==1) { 
                 x += "scf\n";
                 if (theory=='uhf') {x += "   uhf\n";}
                 x += "   maxiter 501\n";
                 x += "end\n";
              }
              if (mult==2) { 
                 x += "scf\n";
                 if (theory=='uhf') {x += "   uhf\n";}
                 x += "   doublet\n";
                 x += "   maxiter 501\n";
                 x += "end\n";
              }
              if (mult==3) { 
                 x += "scf\n";
                 if (theory=='uhf') {x += "   uhf\n";}
                 x += "   triplet\n";
                 x += "   maxiter 501\n";
                 x += "end\n";
              }
              if (mult==4) { 
                 x += "scf\n";
                 if (theory=='uhf') {x += "   uhf\n";}
                 x += "   quartet\n";
                 x += "   maxiter 501\n";
                 x += "end\n";
              }
              if (mult==5) { 
                 x += "scf\n";
                 if (theory=='uhf') {x += "   uhf\n";}
                 x += "   quintet\n";
                 x += "   maxiter 501\n";
                 x += "end\n";
              }

              data += x;

           } else if (theory=="mp2") {
              x  = makegaussianbasis(basis,basisHZ,katom);
              if (mult==1) { 
                 x += "scf\n";
                 x += "   maxiter 501\n";
                 x += "end\n";
              }
              if (mult==2) { 
                 x += "scf\n";
                 x += "   uhf\n";
                 x += "   doublet\n";
                 x += "   maxiter 501\n";
                 x += "end\n";
              }
              if (mult==3) { 
                 x += "scf\n";
                 x += "   uhf\n";
                 x += "   triplet\n";
                 x += "   maxiter 501\n";
                 x += "end\n";
              }
              if (mult==4) { 
                 x += "scf\n";
                 x += "   uhf\n";
                 x += "   quartet\n";
                 x += "   maxiter 501\n";
                 x += "end\n";
              }
              if (mult==5) { 
                 x += "scf\n";
                 x += "   uhf\n";
                 x += "   quintet\n";
                 x += "   maxiter 501\n";
                 x += "end\n";
              }
              x += "mp2\n"; 
              x += "   freeze atomic\n"; 
              x += "end\n";
              x += "set cphf:maxiter 1500\n";

              data += x;

           } else if (theory=="ccsd(t)") {
              x  = makegaussianbasis(basis,basisHZ,katom);
              if (mult==1) {
                 x += "scf\n";
                 x += "   maxiter 501\n";
                 x += "end\n";
              }
              if (mult==2) {
                 x += "scf\n";
                 x += "   rohf\n";
                 x += "   doublet\n";
                 x += "   maxiter 501\n";
                 x += "end\n";
              }
              if (mult==3) {
                 x += "scf\n";
                 x += "   rohf\n";
                 x += "   triplet\n";
                 x += "   maxiter 501\n";
                 x += "end\n";
              }
              if (mult==4) {
                 x += "scf\n";
                 x += "   rohf\n";
                 x += "   quartet\n";
                 x += "   maxiter 501\n";
                 x += "end\n";
              }
              if (mult==5) {
                 x += "scf\n";
                 x += "   rohf\n";
                 x += "   quintet\n";
                 x += "   maxiter 501\n";
                 x += "end\n";
              }
              if (mult>1) { 
                 x += "tce\n";
                 x += "   freeze atomic\n"; 
                 x += "   ccsd(t)\n"; 
                 x += "   io ga\n"; 
                 x += "   2eorb\n"; 
                 x += "   2emet 13\n"; 
                 x += "   tilesize 20\n"; 
                 x += "end\n";
              } else {
                 x += "ccsd\n"; 
                 x += "   freeze atomic\n";
                 x += "   maxiter 51\n";
                 x += "end\n";
              } 

              data += x;
           }

           // define cosmo radii
           var radii=[];
           var j,xx,yy,zz,r,dsigma;
           for (i=0; i<symbols.length; i++) {radii.push(0.0); }
           for (i=0; i<symbols.length; i++) {
              if (symbols[i]=='H') {radii[i] = 1.172; } 
              else if (symbols[i]=='N') {radii[i] = 2.126;}
              else if (symbols[i]=='O') {radii[i] = 1.576;}
              else if (symbols[i]=='F') {radii[i] = 1.28;}
              else if (symbols[i]=='P') {radii[i] = 2.279;}
              else if (symbols[i]=='S') {radii[i] = 2.023;}
              else if (symbols[i]=='Cl'){radii[i] = 1.75;}
              else if (symbols[i]=='Al'){radii[i] = 1.404;}
              else if (symbols[i]=='Si'){radii[i] = 2.457;}
              else if (symbols[i]=='Br'){radii[i] = 2.16;}
              else if (symbols[i]=='I') {radii[i] = 2.32;}
              else if (symbols[i]=='C') { 
                dsigma = true;
                for (j=0; j<symbols.length; j++) {
                   if ((symbols[j]=='C') && (j!=i)) {
                     xx=xyz[3*i]-xyz[3*j]; yy=xyz[3*i+1]-xyz[3*j+1]; zz=xyz[3*i+2]-xyz[3*j+2];
                     r = Math.sqrt(xx*xx + yy*yy + zz*zz);
                     if (r<=1.46) {dsigma = false;}
                   }
                }
                if (dsigma) {
                   radii[i] = 2.096;
                } else {
                   radii[i] = 1.635;
                }
              } else {
                radii[i] = 2.223;
              }
           }


           // Add tasks
           var svnt,nup,ndn;
           var ncharge = symbols_ncharge(symbols,charge);
           var tasks = calculation_type.split("");
           if ((theory=="pspw4") || (theory=="paw") || (theory=="paw4")) {theory="pspw";}
           if (theory=="pspw-band") {theory="band";}
           x = "";
           for (i=0; i<tasks.length; i++) {
              if (tasks[i]=="e") {x += "task "+ theory + " energy ignore\n";}
              if (tasks[i]=="g") {x += "task "+ theory + " gradient\n";}
              if (tasks[i]=="o") {
                 x += "\ndriver; default; maxiter 50; clear; end\n";
                 x += "task "+ theory + " optimize ignore\n";
              }
              if (tasks[i]=="v") {x += "task "+ theory + " freq numerical\n";}
              if (tasks[i]=="w") {x += "task "+ theory + " freq\n";}
              if (tasks[i]=="a") {
                 x += makegeom_neb((theory=="pspw") || (theory=="paw") || (theory=="band"));
                 x += "neb\n";
                 x += "   impose\n";
                 x += "   algorithm 0\n";
                 x += "   maxiter 10\n";
                 x += "   nbeads 10\n";
                 x += "   stepsize 1.0\n";
                 x += "   kbeads 0.001\n";
                 x += "end\n";
                 x += "task " + theory + " neb ignore\n";
              }

              if (tasks[i]=="c") { 
                 if (solvation_type.includes("COSMO-SMD")) { 
                    if (solvation_type.includes(":")) { 
                       svnt = solvation_type.split(":")[1];
                    } else {
                       svnt = "h2o";
                    }
                    x += "cosmo\n"
                    x += "   do_cosmo_smd .true.\n";
                    x += "   solvent " + svnt + "\n";
                    x += "\nend\n"
                    x += "task " + theory + " energy ignore\n";
                 } else if (solvation_type=='COSMO') { 
                    x += "unset dft:converged\n";
                    x += "unset scf:converged\n";
                    x += "cosmo\n";
                    x += "   do_gasphase .true.\n";
                    x += "   rsolv  0.0\n";
                    x += "   ifscrn 2\n";
                    x += "   minbem 3\n";
                    x += "   maxbem 3\n";
                    x += "   radius ";
                    for (j=0; j<radii.length; j++) {
                      x +=  radii[j].toString() + " ";
                    }
                    x += "\nend\n";
                    x += "task " + theory + " energy ignore\n";
                 }
              }
              if (tasks[i]=="b") { 
                 if ((theory=="pspw") && (mult==1)) {
                    x += "\n\n### Generating HOMO and LUMO Gaussian cube files ###\n";
                    x += "nwpw\n";
                    x += "   virtual 8\n";
                    x += "   dplot\n";
                    x += "      orbital 1 homo-restricted.cube\n";
                    x += "      density total density.cube\n";
                    x += "   end\n";
                    x += "end\n";
                    x += "task pspw energy ignore\n";
                    x += "task pspw pspw_dplot\n\n";
                    x +=  "nwpw\n";
                    x += "   dplot\n";
                    x += "      vectors " + jobname + ".emovecs\n";
                    x += "      orbital 1 lumo-restricted.cube\n";
                    x += "   end\n";
                    x += "end\n";
                    x += "task pspw pspw_dplot\n\n";
                 }
                 if ((theory=="pspw") && (mult>1)) {
                    ndn = (ncharge-mult+1)/2;
                    nup = ndn + mult - 1;
                    x += "\n\n### Generating HOMO and LUMO Gaussian cube files ###\n";
                    x +=  "nwpw\n";
                    x += "   virtual 8\n";
                    x += "   dplot\n";
                    x += "      orbital 1         homo-alpha.cube\n";
                    if (ndn>0) {
                       x += "      orbital 123456789 homo-beta.cube\n";
                    } else {
                       x += "      orbital 1 homo-beta.cube\n";
                    }
                    x += "      density total density.cube\n";
                    x += "   end\n";
                    x += "end\n";
                    x += "task pspw energy ignore\n";
                    x += "task pspw pspw_dplot\n\n";
                    x +=  "nwpw\n";
                    x += "   dplot\n";
                    x += "      vectors " + jobname + ".emovecs\n";
                    x += "      orbital 1 lumo-alpha.cube\n";
                    x += "      orbital 123456789 lumo-beta.cube\n";
                    x += "   end\n";
                    x += "end\n";
                    x += "task pspw pspw_dplot\n\n";
                 }
                 if (((theory=="dft")||(theory=="hf")) && (mult==1)) {
                    nup = ncharge/2;
                    ndn = nup+1;
                    x += "\n\n### Generating HOMO and LUMO Gaussian cube files ###\n";
                    x += "dplot\n";
                    x += "   TITLE HOMO_Orbital\n";
                    x += "   vectors " + jobname + ".movecs\n" 
                    x += "   LimitXYZ\n";
                    x += "   -15.0 15.0 96\n";
                    x += "   -15.0 15.0 96\n";
                    x += "   -15.0 15.0 96\n";
                    x += "   spin total\n";
                    x += "   orbitals view\n";
                    x += "   1\n";
                    x += "  " +  nup.toString() + "\n";
                    x += "   gaussian\n";
                    x += "   output homo-restricted.cube\n";
                    x += "end\n";
                    x += "task dplot\n";
                    x += "dplot\n";
                    x += "   TITLE LUMO_Orbital\n";
                    x += "   vectors " + jobname + ".movecs\n" 
                    x += "   LimitXYZ\n";
                    x += "   -15.0 15.0 96\n";
                    x += "   -15.0 15.0 96\n";
                    x += "   -15.0 15.0 96\n";
                    x += "   spin total\n";
                    x += "   orbitals view\n";
                    x += "   1\n";
                    x += "   " + ndn.toString() + "\n";
                    x += "   gaussian\n";
                    x += "   output lumo-restricted.cube\n";
                    x += "end\n";
                    x += "task dplot\n";
                 }
                 if (((theory=="dft")||(theory=="hf")) && (mult>1)) {
                    ndn = (ncharge-mult+1)/2;
                    nup = ndn + mult - 1;
                    var nup1 = nup + 1;
                    var ndn1 = ndn + 1;
                    x += "\n\n### Generating HOMO and LUMO Gaussian cube files ###\n";
                    x += "dplot\n";
                    x += "   TITLE HOMO_Alpha_Orbital\n";
                    x += "   vectors " + jobname + ".movecs\n" ;
                    x += "   LimitXYZ\n";
                    x += "   -15.0 15.0 96\n";
                    x += "   -15.0 15.0 96\n";
                    x += "   -15.0 15.0 96\n";
                    x += "   spin alpha\n";
                    x += "   orbitals view\n";
                    x += "   1\n";
                    x += "   " + nup.toString() + "\n";
                    x += "   gaussian\n";
                    x += "   output homo-alpha.cube\n";
                    x += "end\n";
                    x += "task dplot\n";
                    x += "dplot\n";
                    x += "   TITLE LUMO_Alpha_Orbital\n";
                    x += "   vectors " + jobname + ".movecs\n" ;
                    x += "   LimitXYZ\n";
                    x += "   -15.0 15.0 96\n";
                    x += "   -15.0 15.0 96\n";
                    x += "   -15.0 15.0 96\n";
                    x += "   spin alpha\n";
                    x += "   orbitals view\n";
                    x += "   1\n";
                    x += "   " + nup1.toString() + "\n";
                    x += "   gaussian\n";
                    x += "   output lumo-alpha.cube\n";
                    x += "end\n";
                    x += "task dplot\n";
                    x += "dplot\n";
                    x += "   TITLE HOMO_Beta_Orbital\n";
                    x += "   vectors " + jobname + ".movecs\n";
                    x += "   LimitXYZ\n";
                    x += "   -15.0 15.0 96\n";
                    x += "   -15.0 15.0 96\n";
                    x += "   -15.0 15.0 96\n";
                    x += "   spin beta\n";
                    x += "   orbitals view\n";
                    x += "   1\n";
                    if (ndn>0) {
                       x += "   " + ndn.toString() + "\n";
                    } else {
                       x += "   " + ndn1.toString() + "\n";
                    }
                    x += "   gaussian\n";
                    x += "   output homo-beta.cube\n";
                    x += "end\n";
                    x += "task dplot\n";
                    x += "dplot\n";
                    x += "   TITLE LUMO_Beta_Orbital\n";
                    x += "   vectors " + jobname + ".movecs\n";
                    x += "   LimitXYZ\n";
                    x += "   -15.0 15.0 96\n";
                    x += "   -15.0 15.0 96\n";
                    x += "   -15.0 15.0 96\n";
                    x += "   spin beta\n";
                    x += "   orbitals view\n";
                    x += "   1\n";
                    x += "   " + ndn1.toString() + "\n";
                    x += "   gaussian\n";
                    x += "   output lumo-beta.cube\n";
                    x += "end\n";
                    x += "task dplot\n";
                 }

              }
           }
           data += x;

           if (iscif) {
              for (i=0; i<symbols.length; ++i) {
                 x = parseFloat(xyz[3*i]);
                 y = parseFloat(xyz[3*i+1]);
                 z = parseFloat(xyz[3*i+2]);
                 if (reading==2) {
                    var xx = x*a1[0] + y*a2[0] + z*a3[0];
                    var yy = x*a1[1] + y*a2[1] + z*a3[1];
                    var zz = x*a1[2] + y*a2[2] + z*a3[2];
                    x = xx;
                    y = zz;
                    z = zz;
                 } 
                 var f1 = x*b1[0] + y*b1[1] + z*b1[2];
                 var f2 = x*b2[0] + y*b2[1] + z*b2[2];
                 var f3 = x*b3[0] + y*b3[1] + z*b3[2];
                 cifdata += symbols[i] + " " + f1.toFixed(6) + " " + f2.toFixed(6) + " " + f3.toFixed(6) + "\n";
              }
              editor.setValue(cifdata,1);
           } else {
              editor.setValue(data,1);
              //setQueueLabel();
              if ((theory.includes("pspw")) || (theory.includes("paw")) || (theory.includes("band"))) { addpawatoms(); changenwchemmpmin();}
           }

        }

        // ****************************
        // *                          *
        // *   generatereactionjob    *
        // *                          *
        // ****************************
	function generatereactionjob() {
           //var katom    = jmvar("{*}.find(\"MF\")").replace(/[0-9]/g,'').trim().split(/[ ,]+/);
           //var mformula = jmvar("{*}.find(\"MF\")").replace(/ /g,'');
           var katom    = jmvar("{thisModel}.find(\"MF\")").replace(/[0-9]/g,'').trim().split(/[ ,]+/);
           var mformula = jmvar("{thisModel}.find(\"MF\")").replace(/ /g,'');
           var theory  = theory_arrowsdata();
           var basis   = basis_arrowsdata();
           var basisHZ = basisHZ_arrowsdata();
           var xc      = xc_arrowsdata();
           var charge  = charge_arrowsdata();
           var mult    = mult_arrowsdata();
           var calculation_type = calculation_type_arrowsdata();
           var solvation_type   = solvation_type_arrowsdata();
           var jobname = theory + "_" + xc + "_" + mformula;
       
           var rtype    = document.getElementById("reaction_type").value;
           var rindexes = document.getElementById("reaction_indexes").value;
           var rgamma   = document.getElementById("reaction_gamma").value;
           var z = parseFloat(rgamma)
           if (z<0.0) { 
              z = Math.abs(z);
              rgamma = "m"+z.toFixed(3);
           } else {
              rgamma = z.toFixed(3);
           }
           document.getElementById("queue_nwchem_permdir").value = jobname + "-rxn-g="+rgamma;
           convert2geometry(false);
           addreactionconstraint(false);
           addoptimization(true);
        }




	function clearSmiles() {
                document.form.smi.value = ""
	}

        function clearSmiles2() {
                document.form2.smi.value = ""
        }

        function emailSmiles() {
                var email=('arrows@emsl.pnnl.gov');
                var subject = (document.form.smi.value);
                var subjectEncoded = encodeURIComponent(subject);
                var body = ('I am the body of the feedback that you are sending.');
                var link = 'mailto:'+email+'?subject='+subjectEncoded;
                window.location.href = link;
                //document.write( '<a href="mailto:' + email +
                //                '?subject=' +subject+
                //                '">' + 'Click here to send email to arrows' + '<' + '/a>');
        }

	function getJMEstring() {
		var data = document.JME.jmeFile();
		document.getElementById("jme_output").value = data;
	}


        function entermult(smi) {
           var rr;
           var mult0 = mult_arrowsdata();
           var mult = prompt("Please enter multiplicity:", mult0);
           if (smi.value.includes("mult{")) {
              rr = smi.value.split("mult{")[1].split("}")[0];
              rr = "mult{" + rr + "}";
              smi.value = smi.value.replace(rr,"");
           }
           smi.value += " mult{"+mult+"}";
        }
        function entercharge(smi) {
           var rr;
           var charge0 = charge_arrowsdata();
           var charge = prompt("Please enter charge:", charge0);
           if (smi.value.includes("^{")) {
              rr = smi.value.split("^{")[1].split("}")[0];
              rr = "^{" + rr + "}";
              smi.value = smi.value.replace(rr,"");
           }
           smi.value += " ^{"+charge+"}";
        }


        function sleep(milliseconds) {
            var start = new Date().getTime();
            for (var i = 0; i < 1e7; i++) {
               if ((new Date().getTime() - start) > milliseconds){
                  break;
               }
            }
        }

        function Confirm0(form,mystr){
            console.log(form);
            //alert("Record insert successfully!");
            var mytext = "Your Arrows job for " + mystr + " is running. Please be patient for it to finish.";
            //var mytext = "Your Arrows job is running. Please be patient for it to finish.";
            document.getElementById('runmebanner').innerHTML=mytext;
            document.getElementById('runmebanner2').innerHTML=mytext;
            var doc = document.getElementsByName('iframe_output')[0].contentWindow.document;
            doc.open();
            doc.write("<html><body>"+mytext+"</body></html>");
            doc.close();


            //var node = document.getElementById('runmebanner');
            //while (node.firstChild) node.removeChild( node.firstChild);
            //node.appendChild(document.createTextNode(mytext));
            sleep(250);
            form.submit();
        }

        function Confirm(form,num){
            console.log(form);
            console.log(num);
            if (num==1) {
               var mystr = document.form.smi.value;
            } else {
               var mystr = document.form2.smi.value;
            }
            //alert("Record insert successfully!");
            var mytext = "Your Arrows job for " + mystr + " is running. Please be patient for it to finish.";
            //var mytext = "Your Arrows job is running. Please be patient for it to finish.";
            console.log(mytext);
            document.getElementById('runmebanner').innerHTML=mytext;
            document.getElementById('runmebanner2').innerHTML=mytext;
            var doc = document.getElementsByName('iframe_output')[0].contentWindow.document;
            doc.open();
            doc.write("<html><body>"+mytext+"</body></html>");
            doc.close();
            console.log("after doc=",form);


            //var node = document.getElementById('runmebanner');
            //while (node.firstChild) node.removeChild( node.firstChild);
            //node.appendChild(document.createTextNode(mytext)); 
            sleep(250);
            form.submit();
        }


        function txspressed(button0,num) {
           if (num==1) {
              var mystr = document.form.smi.value;
           } else {
              var mystr = document.form2.smi.value;
           }
           
           var headstr   = "";
           var tailstr   = "";
           var theorystr = "";
           var xcstr     = "";
           var solvstr   = "";
           var basisstr  = "";
           var monkhorststr = "";

           if (mystr.includes("theory{") || mystr.includes("xc{") || mystr.includes("solvation_type{") || mystr.includes("basis{")) {
              ss = mystr.trim().split(" ");
              sslen = ss.length;
              for (var i=0; i<sslen; ++i) {
                 if (ss[i].includes("theory{") || ss[i].includes("xc{") || ss[i].includes("solvation_type{") || ss[i].includes("basis{")) {
                    tailstr += ss[i] + " "
                 } 
                 else {
                    headstr += ss[i] + " "
                 }
              }
              headstr = headstr.trim();
              tailstr = tailstr.trim();
           }
           else {
              headstr = mystr.trim();
           }

           if (tailstr.includes("theory{")) {
              theorystr = tailstr.split("theory{")[1].split("}")[0].trim();
           }

           if (tailstr.includes("xc{")) {
              xcstr = tailstr.split("xc{")[1].split("}")[0].trim();
           }

           if (tailstr.includes("solvation_type{")) {
              solvstr = tailstr.split("solvation_type{")[1].split("}")[0].trim();
           }

           if (tailstr.includes("basis{")) {
               basisstr = tailstr.split("basis{")[1].split("}")[0].trim();
           }

           if (button0=="band")    { 
               theorystr = "band"; 
               monkhorststr = prompt("Please Enter Monk-Horst pack gridding:", "1 1 1");
           }
           if (button0=="pspw")    { theorystr = "pspw"; }
           if (button0=="pspw4")   { theorystr = "pspw4"; }
           if (button0=="dft")     { theorystr = "dft"; }
           if (button0=="mp2")     { theorystr = "mp2"; }
           if (button0=="ccsd(t)") { theorystr = "ccsd(t)"; }
           if (button0=="pm3")     { theorystr = "pm3"; }

           if (button0=="6-31G*")          { basisstr = "6-31G*"; }
           if (button0=="6-311++G(2d,2p)") { basisstr = "6-311++G(2d,2p)"; }

           if (button0=="lda")    { xcstr = "lda"; }
           if (button0=="pbe")    { xcstr = "pbe"; }
           if (button0=="pbe0")   { xcstr = "pbe0"; }
           if (button0=="blyp")   { xcstr = "blyp"; }
           if (button0=="b3lyp")  { xcstr = "b3lyp"; }
           if (button0=="tpss03")  { xcstr = "tpss03"; }
           if (button0=="scan")  { xcstr = "scan"; }
           if (button0=="vs98")  { xcstr = "vs98"; }
           if (button0=="m06-2x") { xcstr = "m06-2x"; }
           if (button0=="revpbe")    { xcstr = "revpbe"; }
           if (button0=="pbesol")    { xcstr = "pbesol"; }
           if (button0=="pbe-grimme2")    { xcstr = "pbe96-grimme2"; }
           if (button0=="pbe-grimme3")    { xcstr = "pbe96-grimme3"; }
           if (button0=="beef")          { xcstr = "beef"; }
           if (button0=="xbeef-cpbe")    { xcstr = "xbeef-cpbe"; }
           if (button0=="beef-vdw2")    { xcstr = "beef-vdw2"; }

           if (button0=="COSMO")     { solvstr = "COSMO"; }
           if (button0=="COSMO-SMD") { 
              if (num==1) {
                 solvstr = document.getElementById("COSMO-SMD").value.split("{")[1].split("}")[0]; 
              } else {
                 solvstr = document.getElementById("SMD_solvent_2").value.split("{")[1].split("}")[0]; 
              }
           }
           if (button0=="None")      { solvstr = "None"; }

           // remove conflicting options
           if ((theorystr=="mp2") || (theorystr=="ccsd(t)"))  { xcstr = ""; }
           if (((theorystr=="band")||(theorystr=="pspw") || (theorystr=="pspw4")) && (xcstr=="m06-2x")) { xcstr = ""; }
           if (((theorystr=="band")||(theorystr=="pspw")                        ) && (solvstr=="COSMO")) { solvstr = ""; }
           if (((theorystr=="band")||(theorystr=="pspw")                                              ) && (solvstr.includes("COSMO-SMD"))) { solvstr = ""; }
           if (((theorystr=="band")||(theorystr=="pspw") || (theorystr=="pspw4")) && (basisstr=="6-31G*")) { basisstr = ""; }
           if (((theorystr=="band")||(theorystr=="pspw") || (theorystr=="pspw4")) && (basisstr=="6-311++G(2d,2p)")) { basisstr = ""; }
           if (theorystr=="pm3") { 
              xcstr = ""; 
              basisstr = ""; 
              if (solvstr=="COSMO-SMD") { solvstr="";}
           }


           if (num==1) {
              // set the button colors
              var color1="background-color:#f8f8ff; color:#298DB4;";
              var color2="background-color:#f8f8ff; color:#74A52B;";
              if (theorystr=="dft") {
                  document.getElementById("lda").style     = color1;
                  document.getElementById("pbe").style     = color1;
                  document.getElementById("pbe0").style    = color1;
                  document.getElementById("blyp").style    = color1;
                  document.getElementById("b3lyp").style   = color1;
                  document.getElementById("tpss03").style   = color1;
                  document.getElementById("scan").style   = color1;
                  document.getElementById("vs98").style   = color1;
                  document.getElementById("m06-2x").style  = color1;
                  document.getElementById("COSMO").style     = color1;
                  document.getElementById("COSMO-SMD").style = color1;
                  document.getElementById("None").style      = color1;
                  document.getElementById("6-31G*").style          = color1;
                  document.getElementById("6-311++G(2d,2p)").style = color1;
              } else if ((theorystr=="band")||(theorystr=="pspw")||(theorystr=="pspw4")) {
                  document.getElementById("lda").style     = color1;
                  document.getElementById("pbe").style     = color1;
                  document.getElementById("pbe0").style    = color1;
                  document.getElementById("blyp").style   = color1;
                  document.getElementById("b3lyp").style   = color1;
                  document.getElementById("tpss03").style   = color1;
                  document.getElementById("scan").style   = color1;
                  document.getElementById("vs98").style   = color1;
                  document.getElementById("m06-2x").style  = color2;
                  document.getElementById("revpbe").style     = color1;
                  document.getElementById("pbesol").style     = color1;
                  document.getElementById("pbe-grimme2").style     = color1;
                  document.getElementById("pbe-grimme3").style     = color1;
                  document.getElementById("beef").style     = color1;
                  document.getElementById("xbeef-cpbe").style     = color1;
                  document.getElementById("beef-vdw2").style     = color1;
                  document.getElementById("COSMO").style     = color2;
                  document.getElementById("COSMO-SMD").style = color2;
                  document.getElementById("None").style      = color1;
                  document.getElementById("6-31G*").style          = color2;
                  document.getElementById("6-311++G(2d,2p)").style = color2;
              } else if ((theorystr=="mp2")||(theorystr=="ccsd(t)")) {
                  document.getElementById("lda").style     = color2;
                  document.getElementById("pbe").style     = color2;
                  document.getElementById("pbe0").style    = color2;
                  document.getElementById("blyp").style   = color2;
                  document.getElementById("b3lyp").style   = color2;
                  document.getElementById("tpss03").style   = color2;
                  document.getElementById("scan").style   = color2;
                  document.getElementById("vs98").style   = color2;
                  document.getElementById("m06-2x").style  = color2;
                  document.getElementById("revpbe").style     = color2;
                  document.getElementById("pbesol").style     = color2;
                  document.getElementById("pbe-grimme2").style     = color2;
                  document.getElementById("pbe-grimme3").style     = color2;
                  document.getElementById("beef").style     = color2;
                  document.getElementById("xbeef-cpbe").style     = color2;
                  document.getElementById("beef-vdw2").style     = color2;
                  document.getElementById("COSMO").style     = color1;
                  document.getElementById("COSMO-SMD").style = color1;
                  document.getElementById("None").style      = color1;
                  document.getElementById("6-31G*").style          = color1;
                  document.getElementById("6-311++G(2d,2p)").style = color1;
              } else if (theorystr=="pm3") {
                  document.getElementById("lda").style     = color2;
                  document.getElementById("pbe").style     = color2;
                  document.getElementById("pbe0").style    = color2;
                  document.getElementById("blyp").style   = color2;
                  document.getElementById("b3lyp").style   = color2;
                  document.getElementById("tpss03").style   = color2;
                  document.getElementById("scan").style   = color2;
                  document.getElementById("vs98").style   = color2;
                  document.getElementById("m06-2x").style  = color2;
                  document.getElementById("revpbe").style     = color2;
                  document.getElementById("pbesol").style     = color2;
                  document.getElementById("pbe-grimme2").style     = color2;
                  document.getElementById("pbe-grimme3").style     = color2;
                  document.getElementById("beef").style     = color2;
                  document.getElementById("xbeef-cpbe").style     = color2;
                  document.getElementById("beef-vdw2").style     = color2;
                  document.getElementById("COSMO").style     = color1;
                  document.getElementById("COSMO-SMD").style = color2;
                  //document.getElementById("None").style      = color2;
                  document.getElementById("6-31G*").style          = color2;
                  document.getElementById("6-311++G(2d,2p)").style = color2;
              }
           } else {
              // set the button colors
              var color1="background-color:#f8f8ff; color:#298DB4;";
              var color2="background-color:#f8f8ff; color:#74A52B;";
              if (theorystr=="dft") {
                  document.getElementById("lda_2").style     = color1;
                  document.getElementById("pbe_2").style     = color1;
                  document.getElementById("pbe0_2").style    = color1;
                  document.getElementById("blyp_2").style    = color1;
                  document.getElementById("b3lyp_2").style   = color1;
                  document.getElementById("tpss03_2").style   = color1;
                  document.getElementById("scan_2").style   = color1;
                  document.getElementById("m06-2x_2").style  = color1;
                  document.getElementById("6-31G*_2").style          = color1;
                  document.getElementById("6-311++G(2d,2p)_2").style = color1;
              } else if ((theorystr=="band")||(theorystr=="pspw")||(theorystr=="pspw4")) {
                  document.getElementById("lda_2").style     = color1;
                  document.getElementById("pbe_2").style     = color1;
                  document.getElementById("pbe0_2").style    = color1;
                  document.getElementById("blyp_2").style   = color1;
                  document.getElementById("b3lyp_2").style   = color1;
                  document.getElementById("tpss03_2").style   = color1;
                  document.getElementById("scan_2").style   = color1;
                  document.getElementById("m06-2x_2").style  = color2;
                  document.getElementById("6-31G*_2").style          = color2;
                  document.getElementById("6-311++G(2d,2p)_2").style = color2;
              } else if ((theorystr=="mp2")||(theorystr=="ccsd(t)")) {
                  document.getElementById("lda_2").style     = color2;
                  document.getElementById("pbe_2").style     = color2;
                  document.getElementById("pbe0_2").style    = color2;
                  document.getElementById("blyp_2").style   = color2;
                  document.getElementById("b3lyp_2").style   = color2;
                  document.getElementById("tpss03_2").style   = color2;
                  document.getElementById("scan_2").style   = color2;
                  document.getElementById("m06-2x_2").style  = color2;
                  document.getElementById("6-31G*_2").style          = color1;
                  document.getElementById("6-311++G(2d,2p)_2").style = color1;
              } else if (theorystr=="pm3") {
                  document.getElementById("lda_2").style     = color2;
                  document.getElementById("pbe_2").style     = color2;
                  document.getElementById("pbe0_2").style    = color2;
                  document.getElementById("blyp_2").style   = color2;
                  document.getElementById("b3lyp_2").style   = color2;
                  document.getElementById("tpss03_2").style   = color2;
                  document.getElementById("scan_2").style   = color2;
                  document.getElementById("m06-2x_2").style  = color2;
                  document.getElementById("6-31G*_2").style          = color2;
                  document.getElementById("6-311++G(2d,2p)_2").style = color2;
              }
           }

           // set the esmiles string
           if (num==1) {
              document.form.smi.value  = headstr;
              //if ((theorystr!="") || (xcstr!="") || (solvstr!="")) {document.form.smi.value += " ~ "; }
              if ((headstr.includes("-->") || headstr.includes("==>"))  && (!headstr.includes("~"))) {document.form.smi.value += " ~ "; }
              if (theorystr!="") {document.form.smi.value += " theory{" + theorystr + "}"; }
              if (xcstr!="")     {document.form.smi.value += " xc{" + xcstr + "}"; }
              if (solvstr!="")   {document.form.smi.value += " solvation_type{" + solvstr + "}"; }
              if (basisstr!="")  {document.form.smi.value += " basis{" + basisstr + "}"; }
              if (monkhorststr!="")  {document.form.smi.value += " monkhorst_pack{" + monkhorststr + "}"; }
           } else {
              document.form2.smi.value  = headstr;
              //if ((theorystr!="") || (xcstr!="") || (solvstr!="")) {document.form2.smi.value += " ~ "; }
              if ((headstr.includes("-->") || headstr.includes("==>"))  && (!headstr.includes("~"))) {document.form2.smi.value += " ~ "; }
              if (theorystr!="") {document.form2.smi.value += " theory{" + theorystr + "}"; }
              if (xcstr!="")     {document.form2.smi.value += " xc{" + xcstr + "}"; }
              if (solvstr!="")   {document.form2.smi.value += " solvation_type{" + solvstr + "}"; }
              if (basisstr!="")  {document.form2.smi.value += " basis{" + basisstr + "}"; }
              if (monkhorststr!="")  {document.form2.smi.value += " monkhorst_pack{" + monkhorststr + "}"; }
           }

        }




        // ****************************
        // *                          *
        // *     changebandpspw       *
        // *                          *
        // ****************************
        function changebandpspw() {
           let newtheory = document.getElementById("bandpspw").value;
           if (newtheory.includes("band")) {
              document.getElementById("monkhorst_input_on").style.display = "inline";
              document.getElementById("nwchemewald_rcut").value  = 3.0;
              document.getElementById("nwchemewald_ncut").value  = 8;
           } else {
              document.getElementById("monkhorst_input_on").style.display = "none";
              document.getElementById("nwchemewald_rcut").value  = 0;
              document.getElementById("nwchemewald_ncut").value  = 0;
           }
           for (const bb of ["queue_nwchem_permdir","queue_nwchem_curdir"]) {
              let oldbb = document.getElementById(bb).value;
              if (oldbb.includes("hf"))             { document.getElementById(bb).value = oldbb.replace("hf",newtheory); }
              else if (oldbb.includes("mp2"))       { document.getElementById(bb).value = oldbb.replace("mp2",newtheory); }
              else if (oldbb.includes("dft"))       { document.getElementById(bb).value = oldbb.replace("dft",newtheory); }
              else if (oldbb.includes("pspw-band")) { document.getElementById(bb).value = oldbb.replace("pspw-band",newtheory); }
              else if (oldbb.includes("band"))      { document.getElementById(bb).value = oldbb.replace("band",newtheory); }
              else if (oldbb.includes("pspw4"))     { document.getElementById(bb).value = oldbb.replace("pspw4",newtheory); }
              else if (oldbb.includes("pspw"))      { document.getElementById(bb).value = oldbb.replace("pspw",newtheory); }
           }
           convert2geometry(false);
        }


        // ********************************
        // *                              *
        // *     changelatticelocation    *
        // *                              *
        // ********************************
        function changelatticelocation() {
           var ispspw = document.getElementById("latticelocation").value == "Lattice in geometry block";
           if (ispspw) {
              document.getElementById("latticelocation").value = "Lattice in NWPW block";
           } else {
              document.getElementById("latticelocation").value = "Lattice in geometry block";
           }
        }
        // ********************************
        // *                              *
        // *       changenwchemcharge     *
        // *                              *
        // ********************************
        function changenwchemcharge() {
           var charge = document.getElementById("nwchemcharge").value;
           var data   = editor.getValue(); // or session.getValue
           var oldblk  = "charge " + data.split("charge ")[1].split("\n")[0];
           var oldblk2 = "charge=" + data.split("charge=")[1].split(" mult")[0];

           var data   = editor.getValue(); // or session.getValue
           data = data.replace(oldblk,"charge " + charge.toString());
           data = data.replace(oldblk2,"charge=" + charge.toString());
           editor.setValue(data,1);
        }

        // ********************************
        // *                              *
        // *       changenwchemmult       *
        // *                              *
        // ********************************
        function changenwchemmult() {
           var mult   = document.getElementById("nwchemmult").value;
           var data   = editor.getValue(); // or session.getValue
           var oldblk  = "mult " + data.split("mult ")[1].split("\n")[0];
           var oldblk2 = "mult=" + data.split("mult=")[1].split("\"")[0];

           var data   = editor.getValue(); // or session.getValue
           data = data.replace(oldblk,"mult " + mult.toString());
           data = data.replace(oldblk2,"mult=" + mult.toString());
           editor.setValue(data,1);
        }

        // ********************************
        // *                              *
        // *       changenwchemvirt       *
        // *                              *
        // ********************************
        function changenwchemvirt() {
           var virt   = document.getElementById("nwchemvirt").value;
           var data   = editor.getValue(); // or session.getValue
           if (data.includes("virtual")) {
              var oldblk  = "virtual " + data.split("virtual ")[1].split("\n")[0];
              if (virt>0) {
                 data = data.replace(oldblk,"virtual " + virt.toString());
              } else {
                 data = data.replace("  " + oldblk+"\n","");
              }
           } else if (virt>0) {
              var beforeline = data.split("  ### pseudopotential block end   ###\n")[0];
              var afterline = data.split("  ### pseudopotential block end   ###\n")[1];
              data = beforeline;
              data += "  ### pseudopotential block end   ###\n";
              data += "  virtual " + virt.toString() + "\n";
              data += afterline;
           }
           editor.setValue(data,1);
        }

        // ********************************
        // *                              *
        // *    changenwchemewald_rcut    *
        // *                              *
        // ********************************
        function changenwchemewald_rcut() {
           var rcut   = document.getElementById("nwchemewald_rcut").value;
           var data   = editor.getValue(); // or session.getValue
           if (data.includes("ewald_rcut")) {
              var oldblk  = "ewald_rcut " + data.split("ewald_rcut ")[1].split("\n")[0];
              if (rcut>0) {
                 data = data.replace(oldblk,"ewald_rcut " + rcut.toString());
              } else {
                 data = data.replace("  " + oldblk+"\n","");
              }
           } else if (rcut>0) {
              var beforeline = data.split("  ### pseudopotential block end   ###\n")[0];
              var afterline  = data.split("  ### pseudopotential block end   ###\n")[1];
              data = beforeline;
              data += "  ### pseudopotential block end   ###\n";
              data += "  ewald_rcut " + rcut.toString() + "\n";
              data += afterline;
           }
           editor.setValue(data,1);
        }

        // ********************************
        // *                              *
        // *    changenwchemewald_ncut    *
        // *                              *
        // ********************************
        function changenwchemewald_ncut() {
           var ncut   = document.getElementById("nwchemewald_ncut").value;
           var data   = editor.getValue(); // or session.getValue
           if (data.includes("ewald_ncut")) {
              var oldblk  = "ewald_ncut " + data.split("ewald_ncut ")[1].split("\n")[0];
              if (ncut>0) {
                 data = data.replace(oldblk,"ewald_ncut " + ncut.toString());
              } else {
                 data = data.replace("  " + oldblk+"\n","");
              }
           } else if (ncut>0) {
              var beforeline = data.split("  ### pseudopotential block end   ###\n")[0];
              var afterline  = data.split("  ### pseudopotential block end   ###\n")[1];
              data = beforeline;
              data += "  ### pseudopotential block end   ###\n";
              data += "  ewald_ncut " + ncut.toString() + "\n";
              data += afterline;
           }
           editor.setValue(data,1);
        }

        // ********************************
        // *                              *
        // *      changenwchemcutoff      *
        // *                              *
        // ********************************
        function changenwchemcutoff() {
           var cutoff = basis_arrowsdata();
           if (isNaN(cutoff)) { cutoff = 0.0; }
           var data   = editor.getValue(); // or session.getValue
           if (data.includes("cutoff")) {
              var newdata = "";
              for (let ll of data.split("\n")) {
                 if (ll.includes("cutoff ") && (!ll.includes("#keep for setup of qmmm"))) {
                    if (cutoff>0) {
                       newdata += "   cutoff " + cutoff.toString() + "\n";
                    }
                 } else {
                    newdata += ll + "\n";
                 }
              }
              editor.setValue(newdata,1);
           } else if (cutoff>0) {
              var beforeline = data.split("  ### pseudopotential block end   ###\n")[0];
              var afterline  = data.split("  ### pseudopotential block end   ###\n")[1];
              data = beforeline;
              data += "  ### pseudopotential block end   ###\n";
              data += "  cutoff " + cutoff.toString() + "\n";
              data += afterline;
              editor.setValue(data,1);
           }
        }



        // ********************************
        // *                              *
        // *    changeparallelmapping3    *
        // *                              *
        // ********************************
        function changeparallelmapping3() {
           var pmap = document.getElementById("parallelmapping3").value;
           var data = editor.getValue(); // or session.getValue
           if (data.includes("1d-slab")) {
              if (pmap.includes("default")) {
                 data = data.replace("  1d-slab\n","");
              } else {
                 data = data.replace("1d-slab",pmap);
              }
           } else if (data.includes("2d-hilbert")) {
              if (pmap.includes("default")) {
                 data = data.replace("  2d-hilbert\n","");
              } else {
                 data = data.replace("2d-hilbert",pmap);
              }
           } else if (data.includes("2d-hcurve")) {
              if (pmap.includes("default")) {
                 data = data.replace("  2d-hcurve\n","");
              } else {
                 data = data.replace("2d-hcurve",pmap);
              }
           } else if (!pmap.includes("default")) {
              var beforeline = data.split("  ### pseudopotential block end   ###\n")[0];
              var afterline  = data.split("  ### pseudopotential block end   ###\n")[1];
              data = beforeline;
              data += "  ### pseudopotential block end   ###\n";
              data += "  " + pmap + "\n";
              data += afterline;
           }
           editor.setValue(data,1);
        }



        // ********************************
        // *                              *
        // *          addpawatoms         *
        // *                              *
        // ********************************
        function addpawatoms() {
           var natoms = 0;
           var pawatomstr = document.getElementById("pawatoms").value;
           if (pawatomstr.length>0) { 
              pawatomlist =  pawatomstr.split(/[ ,]+/);
              natoms = pawatomlist.length;
           }
           var natoms2 = 0;
           var pawatomstr2 = document.getElementById("pspatoms").value;
           if (pawatomstr2.length>0) { 
              pawatomlist2 =  pawatomstr2.split(/[ ,]+/);
              natoms2 = pawatomlist2.length;
           }
         
           var basisblk = "  ### pseudopotential block begin ###\n";
           if ((natoms>0) || (natoms2>0)) {
              basisblk += "  pseudopotentials\n";
              for (var i=0; i<natoms; ++i) {
                 basisblk += "    " + pawatomlist[i] + " library paw_default\n";
              }
              for (var i=0; i<natoms2; ++i) {
                 basisblk += "    " + pawatomlist2[i] + " library " + document.getElementById("pspatomslibrary").value + "\n";
              }
              basisblk += "  end\n";
           }
           basisblk += "  ### pseudopotential block end   ###\n";

           var data   = editor.getValue(); // or session.getValue
           var oldblk = "  ### pseudopotential block begin ###\n";
           oldblk    += data.split("  ### pseudopotential block begin ###\n")[1].split("  ### pseudopotential block end   ###\n")[0];
           oldblk    += "  ### pseudopotential block end   ###\n";
           data = data.replace(oldblk,basisblk);
           editor.setValue(data,1);
        }

        function changenwchemnp_dim() {
           if ((document.getElementById("nwchemnp_dim1").value > 0) ||
               (document.getElementById("nwchemnp_dim2").value > 0) ||
               (document.getElementById("nwchemnp_dim3").value > 0) ) {

              let dim1 = document.getElementById("nwchemnp_dim1").value; if (dim1<=0) {dim1=-1;}
              let dim2 = document.getElementById("nwchemnp_dim2").value; if (dim2<=0) {dim2=-1;}
              let dim3 = document.getElementById("nwchemnp_dim3").value; if (dim3<=0) {dim3=-1;}

              var newblk = "np_dimensions ";
              newblk += " " + dim1.toString();
              newblk += " " + dim2.toString();

              if ((document.getElementById("nwchemnp_dim3").value > 0) &&
                  (document.getElementById("bandpspw").value.includes("band"))) {
                 newblk += " " + dim3.toString();
              }

              var data   = editor.getValue(); // or session.getValue
              if (data.includes("np_dimensions")) {
                 var oldblk = "np_dimensions " + data.split("np_dimensions ")[1].split("\n")[0];
                 data = data.replace(oldblk,newblk);
                 editor.setValue(data,1);
              } else {
                 convert2geometry(false);
              }
           }  else {
              convert2geometry(false);
           }
        }

        function changenwchemmp() {
           if ((document.getElementById("nwchemmp1").value > 0) ||
               (document.getElementById("nwchemmp2").value > 0) ||
               (document.getElementById("nwchemmp3").value > 0) ) {

              var newblk = "monkhorst-pack ";
              newblk += " " + document.getElementById("nwchemmp1").value.toString();
              newblk += " " + document.getElementById("nwchemmp2").value.toString();
              newblk += " " + document.getElementById("nwchemmp3").value.toString();

              var data   = editor.getValue(); // or session.getValue
              if (data.includes("monkhorst-pack")) {
                 var oldblk = "monkhorst-pack " + data.split("monkhorst-pack ")[1].split("\n")[0];
                 data = data.replace(oldblk,newblk);
                 editor.setValue(data,1);
              }
           }
        }

        function changenwchemmpmin() {
           let dbz_min = document.getElementById("nwchemmpmin").value;
           if (dbz_min > 0) {
              var data   = editor.getValue(); // or session.getValue
              if (data.includes("lattice_vectors")) {

                 let a1 = string3_to_vec3(data.split("lattice_vectors")[1].split("end")[0].trim().split("\n")[0].trim());
                 let a2 = string3_to_vec3(data.split("lattice_vectors")[1].split("end")[0].trim().split("\n")[1].trim());
                 let a3 = string3_to_vec3(data.split("lattice_vectors")[1].split("end")[0].trim().split("\n")[2].trim());
                 a1[0] /= 0.529177; a1[1] /= 0.529177; a1[2] /= 0.529177;
                 a2[0] /= 0.529177; a2[1] /= 0.529177; a2[2] /= 0.529177;
                 a3[0] /= 0.529177; a3[1] /= 0.529177; a3[2] /= 0.529177;
                 let [b1,b2,b3] = a1a2a3_to_b1b2b3(a1,a2,a3);
                 b1[0] *= 2*Math.PI; b1[1] *= 2*Math.PI; b1[2] *= 2*Math.PI;
                 b2[0] *= 2*Math.PI; b2[1] *= 2*Math.PI; b2[2] *= 2*Math.PI;
                 b3[0] *= 2*Math.PI; b3[1] *= 2*Math.PI; b3[2] *= 2*Math.PI;
                 

                 let mp1 = document.getElementById("nwchemmp1").value;
                 let mp2 = document.getElementById("nwchemmp2").value;
                 let mp3 = document.getElementById("nwchemmp3").value;

                 let dist1 = Math.sqrt(b1[0]*b1[0] + b1[1]*b1[1] + b1[2]*b1[2]);
                 let dist2 = Math.sqrt(b2[0]*b2[0] + b2[1]*b2[1] + b2[2]*b2[2]);
                 let dist3 = Math.sqrt(b3[0]*b3[0] + b3[1]*b3[1] + b3[2]*b3[2]);
                 mp1 = Math.ceil(dist1/dbz_min);
                 mp2 = Math.ceil(dist2/dbz_min);
                 mp3 = Math.ceil(dist3/dbz_min);

                 document.getElementById("nwchemmp1").value = mp1;
                 document.getElementById("nwchemmp2").value = mp2;
                 document.getElementById("nwchemmp3").value = mp3;
                 changenwchemmp();
              }
           } else {
              document.getElementById("nwchemmp1").value = 1;
              document.getElementById("nwchemmp2").value = 1;
              document.getElementById("nwchemmp3").value = 1;
              changenwchemmp();
           }
        }


        function changenwchemfractional() {
           if (document.getElementById("nwchemfractional").value.includes("No")) {
              document.getElementById("fractional_input_on").style.display = "none";
           } else {
              document.getElementById("fractional_input_on").style.display = "inline";
              if (document.getElementById("nwchemfractional_orbitals").value > document.getElementById("nwchemvirt").value) {
                 document.getElementById("nwchemvirt").value = document.getElementById("nwchemfractional_orbitals").value;
                 changenwchemvirt();
              }
           }
        }

        function changenwchemfractional_orbitals() {
           if (document.getElementById("nwchemfractional_orbitals").value > document.getElementById("nwchemvirt").value) {
              document.getElementById("nwchemvirt").value = document.getElementById("nwchemfractional_orbitals").value;
              changenwchemvirt();
           }
           var virt   = document.getElementById("nwchemfractional_orbitals").value;
           var data   = editor.getValue(); // or session.getValue
           if (data.includes("orbitals ")) {
              var oldblk  = "orbitals " + data.split("orbitals ")[1].split("\n")[0];
              if (virt>0) {
                 data = data.replace(oldblk,"orbitals " + virt.toString());
              } else {
                 data = data.replace(oldblk,"");
              }
              editor.setValue(data,1);
           } 
        }

        function changenwchemoptimizer() {
           if (document.getElementById("nwchemoptimizer").value.includes("scf")) {
              document.getElementById("scf_input_on").style.display = "inline";
           } else {
              document.getElementById("scf_input_on").style.display = "none";
           }
        }

        function changenwchemefieldtype() {
           if (document.getElementById("nwchemefieldtype").value.includes("No")) {
              document.getElementById("efield_input_on").style.display = "none";
           } else {
              document.getElementById("efield_input_on").style.display = "inline";
           }
        }

        function centercoords(data) {
           let datalines = data.trim().split("\n");
           nion = 0;
           let symb = [];
           let rion = [];
           for (const ll of datalines) {
              let ss = ll.split(/\s+/);
              symb.push(ss[0]);
              rion.push(eval(ss[1]));
              rion.push(eval(ss[2]));
              rion.push(eval(ss[3]));
              nion += 1;
           }
           let xcm = 0.0;
           let ycm = 0.0;
           let zcm = 0.0;
           for (let ii=0; ii<nion; ++ii) {
              xcm += rion[3*ii];
              ycm += rion[3*ii+1];
              zcm += rion[3*ii+2];
           }
           xcm /= nion;
           ycm /= nion;
           zcm /= nion;
           for (let ii=0; ii<nion; ++ii) {
              rion[3*ii]   -= xcm;
              rion[3*ii+1] -= ycm;
              rion[3*ii+2] -= zcm;
           }
           var data2 = "";
           for (let ii=0; ii<nion; ++ii) {
              data2 += symb[ii] + " " + rion[3*ii].toFixed(6)
                                + " " + rion[3*ii+1].toFixed(6)
                                + " " + rion[3*ii+2].toFixed(6) + "\n";
           }
           return data2;
        }


        // ****************************
        // *                          *
        // *        addenergy         *
        // *                          *
        // ****************************
        function addenergy(params) {

           var restart = true;
           if (params.contains("no restart")) {
              restart = false;
           }

           var data  = editor.getValue(); // or session.getValue
           data += "\n\n";
           if (restart) { 
              data += "### restart here ###\n";
           }
           if (data.includes("pspspin") && (!data.includes("pspspin off"))) {
              data += "nwpw\n   pspspin off\nend\n";
           }

           var pspw = theory_arrowsdata2();
           if (pspw=="band") {
              var monkhorststr = prompt("Please Enter Monk-Horst pack gridding:", "1 1 1");
              data += "nwpw\n";
              data += "  monkhorst-pack " + monkhorststr + "\n";
              data += "end\n";
           }
           data += "task " + pspw + " energy\n";

           editor.setValue(data,1);
        }

        // ****************************
        // *                          *
        // *      addoptimization     *
        // *                          *
        // ****************************
        function addoptimization(promptiter) {
           var data  = editor.getValue(); // or session.getValue
           var maxiter       =  10;
           var total_maxiter =  60;
           if (promptiter) {
              maxiter       =  parseInt(prompt("Geometry Optimization - Please enter iterations per job:", 10));
              total_maxiter =  parseInt(prompt("Geometry Optimization - Please enter total maximum iterations:", 60));
           }

           data += "\n\n";
           data += "### restart here ###\n";
           
           var pspw = theory_arrowsdata2();
           data += "driver\n";
           data += "   clear\n";
           data += "   maxiter " + maxiter.toString() + "\n";
           data += "end\n";
           data += "task " + pspw + " optimize ignore\n";

           var curcount = maxiter;
           while (curcount<total_maxiter) {
              data += "\n\n";
              data += "### restart here ###\n";
              data += "task " + pspw + " optimize ignore\n";
              curcount += maxiter;
           }
           
           editor.setValue(data,1);
        }

        // ****************************
        // *                          *
        // *      addfrequency        *
        // *                          *
        // ****************************
        function addfrequency() {
           var data  = editor.getValue(); // or session.getValue
           data += "\n\n";
           data += "### restart here ###\n";
           var pspw = theory_arrowsdata2();
           data += "task " + pspw + " freq numerical\n"

           editor.setValue(data,1);
        }


        // ****************************
        // *                          *
        // *        addborn           *
        // *                          *
        // ****************************
        function addborn() {
           var data  = editor.getValue(); // or session.getValue

           data += "\n\n";
           data += "### restart here ###\n";

           var pspw = theory_arrowsdata2();
           data += "nwpw\n";
           data += "   born on\n";
           data += "end\n";
           data += "task " + pspw + " energy\n"
           editor.setValue(data,1);
        }
        

        // ****************************
        // *                          *
        // *        addcosmo          *
        // *                          *
        // ****************************
        function addcosmo() {
           var data  = editor.getValue(); // or session.getValue

           data += "\n\n";
           data += "### restart here ###\n";

           var pspw = theory_arrowsdata2();
           data += "cosmo\n";
           data += "   do_cosmo_smd .true.\n";
           data += "   solvent " + document.getElementById('SMD_solvent_3').value + "\n";
           data += "end\n";
           if (pspw.contains('pspw')) {
              data += "set nwpw:cosmo2 .true.\n";
           }
           data += "task " + pspw + " energy\n"

           editor.setValue(data,1);
        }



        // ****************************
        // *                          *
        // *      addcosmo_smd        *
        // *                          *
        // ****************************
        function addcosmo_smd() {
           var data  = editor.getValue(); // or session.getValue

           data += "\n\n";
           data += "### restart here ###\n";
           
           var pspw = theory_arrowsdata2();
           data += "cosmo\n";
           data += "   do_cosmo_smd .true.\n";
           data += "   solvent " + document.getElementById('SMD_solvent_3').value + "\n";
           data += "end\n";
           if (pspw.contains('pspw')) {
              data += "set nwpw:cosmo2 .true.\n";
           }
           data += "task " + pspw + " energy\n"
           editor.setValue(data,1);
        }




        // *******************************
        // *                             *
        // *       xyzcelltogeometry     *
        // *                             *
        // *******************************

        function xyzcelltogeometry(includelattice,xyzcell,name) {
           var a1,a2,a3,b1,b2,b3,lat,haslattice;
           var nion  = parseInt(xyzcell[0].split("\n")[0]);
           var lines = xyzcell[0].split("\n").slice(2,nion+2);
           var a1a2a3 = xyzcell[1] + " " + xyzcell[2] + " " + xyzcell[3];
           [[a1,a2,a3,b1,b2,b3,lat],haslattice]  =  xyzrow2_to_lattice(a1a2a3.trim().split(/[ ,]+/));

           //fdata = "geometry noautoz nocenter noautosym\n";
           fdata = "geometry " + name + " noautosym noautoz nocenter\n"
           if (includelattice && haslattice) {
              fdata += "system crystal\n"
              fdata += "   lattice_vectors\n";
              fdata += "     " + a1[0].toFixed(6) + " " + a1[1].toFixed(6) + " " + a1[2].toFixed(6) + "\n";
              fdata += "     " + a2[0].toFixed(6) + " " + a2[1].toFixed(6) + " " + a2[2].toFixed(6) + "\n";
              fdata += "     " + a3[0].toFixed(6) + " " + a3[1].toFixed(6) + " " + a3[2].toFixed(6) + "\n";
              fdata += "end\n\n";
           }
           for (i=0; i<nion; i++) {
              if ((haslattice) && (includelattice)) {
                 symbol = lines[i].trim().split(/[ ,]+/)[0];
                 x = eval(lines[i].trim().split(/[ ,]+/)[1]);
                 y = eval(lines[i].trim().split(/[ ,]+/)[2]);
                 z = eval(lines[i].trim().split(/[ ,]+/)[3]);
                 var f1 = x*b1[0] + y*b1[1] + z*b1[2];
                 var f2 = x*b2[0] + y*b2[1] + z*b2[2];
                 var f3 = x*b3[0] + y*b3[1] + z*b3[2];
                 fdata += symbol + " " + f1.toFixed(6) + " " + f2.toFixed(6) + " " + f3.toFixed(6) + "\n";
              } else {
                 fdata += lines[i] + "\n";
              }
           }
           fdata = fdata.trim() + "\n";
           fdata += "end\n\n";

           return fdata;
        }




        // ****************************
        // *                          *
        // *         addneb           *
        // *                          *
        // ****************************
        function addneb() {
           var pspw = theory_arrowsdata2();
           var geomlattice =  document.getElementById("latticelocation").value == "Lattice in geometry block";

           var data  = editor.getValue(); // or session.getValue
           var nebexists = (data.includes("bead_000001:geom") || data.includes("neb_end") || data.includes("endgeom"));

           data += "\n\n";
           data += "### restart here ###\n";

           var newnebblock = true;
           var morph = false;
           var nbeads;
           if (nebexists) {
                if (confirm("NEB Optimization - Generate a new NEB block?")) {
                   nbeads = parseInt(data.split("nbeads ").pop().split("\n")[0]);
                   nbeads =  parseInt(prompt("NEB Optimization - Please enter number of NEB images:", nbeads));
                   morph  = false;
                } else {
                   newnebblock = false;
                }
           } else {
              if (confirm('NEB Optimization - Do you want to generate initial path using morphing?')) {
                 var definegeom  = !(data.includes("neb_end") || data.includes("endgeom"));
                 if (definegeom) {
                    var geom2  =  parseInt(prompt("NEB Optimization - Please enter product model number:", 2));
                    var xyzcell = window.xyzframes[geom2-1];
                    data +=  xyzcelltogeometry(geomlattice,xyzcell,"endgeom")
                }
                nbeads =  parseInt(prompt("NEB Optimization - Please enter number of NEB images:", 5));
                morph = true;

              } else {
                 var geoms  = prompt("NEB Optimization - Please enter path model numbers:", "1 2 3 4 5");
                 data += "\n### Custom path geometries for NEB ###\n"
                 data += "set neb:custom_path .true.\n\n";
                 nbeads = geoms.trim().split(/[ ,]+/).length;
                 for (var i=0; i<nbeads; ++i) {
                    var geom2   = parseInt(geoms.trim().split(/[ ,]+/)[i]);
                    var xyzcell = window.xyzframes[geom2-1];

                    var name = "bead_" + String(i+1).padStart(6, '0') + ":geom";
                    data +=  xyzcelltogeometry(geomlattice,xyzcell,name)

                 }
                morph = false;
              }
           }
           if (newnebblock) {
              var kbeads   =  parseFloat(prompt("NEB Optimization - Please enter number of NEB spring constant:", 0.1));
              var stepsize =  parseFloat(prompt("NEB Optimization - Please enter number of NEB stepsize:", 1.0));
              var maxiter =  parseInt(prompt("NEB Optimization - Please enter maximum iterations:", 10));
              var nhist    =  parseInt(prompt("NEB Optimization - Please enter number of quasinewton histories:", 5));
           
              data += "neb\n";
              if (morph) {
                 data += "   impose\n";
              }
              data += "   print_shift 1\n";
              data += "   nhist    " + nhist.toString() + "\n";
              data += "   nbeads   " + nbeads.toString() + "\n";
              data += "   maxiter  " + maxiter.toString() + "\n";
              data += "   stepsize " + stepsize.toFixed(6) + "\n";
              data += "   kbeads   " + kbeads.toFixed(6) + "\n";
              data += "end\n";
           }

           if (confirm("NEB Optimization - Optimize end points?")) {
              const zeroPad = (num, places) => String(num).padStart(places, '0');
              var nbeads0 = parseInt(data.split("nbeads ")[1].split("\n"));
              data += "\n";
              data += "### restart here ###\n";
              data += "### optimize first bead###\n";
              data += "set geometry bead_000001:geom\n";
              data += "nwpw\n";
              data += "   vectors input bead_000001.movecs output bead_000001.movecs\n";
              data += "end\n";
              data += "driver\n";
              data += "   maxiter 30\n";
              data += "   clear 30\n";
              data += "end\n";
              data += "task pspw optimize ignore\n\n";

              data += "### restart here ###\n";
              data += "### optimize last bead ###\n";
              data += "set geometry bead_" + zeroPad(nbeads0,6) + ":geom\n";
              data += "nwpw\n";
              data += "   vectors input bead_" + zeroPad(nbeads0,6) + ".movecs output bead_" + zeroPad(nbeads0,6)+".movecs\n";
              data += "end\n";
              data += "driver\n";
              data += "   maxiter 30\n";
              data += "   clear 30\n";
              data += "end\n";
              data += "task pspw optimize ignore\n\n";

              data += "unset geometry\n";
              mname = data.split("start")[1].split("\n")[0].trim() + ".movecs"; 
              data += "nwpw\n";
              data += "   vectors input " + mname + " output " + mname + "\n";
              data += "end\n";
           }

           data += "task " + pspw + " neb ignore\n";
           data = data.replace("*.xyz","*.neb_final.xyz *.neb_initial.xyz");

           editor.setValue(data,1);
        }

        // ****************************
        // *                          *
        // *         addstring        *
        // *                          *
        // ****************************
        function addstring() {
           var pspw = theory_arrowsdata2();
           var geomlattice =  document.getElementById("latticelocation").value == "Lattice in geometry block";

           var data  = editor.getValue(); // or session.getValue
           var nebexists = (data.includes("bead_000001:geom") || data.includes("neb_end") || data.includes("endgeom"));

           data += "\n\n";
           data += "### restart here ###\n";

           var newnebblock = true;
           var morph = false;
           var nbeads;
           if (nebexists) {
                if (confirm("String ptimization - Generate a new String block?")) {
                   nbeads = parseInt(data.split("nbeads ").pop().split("\n")[0]);
                   nbeads =  parseInt(prompt("String Optimization - Please enter number of images in path:", nbeads));
                   morph  = false;
                } else {
                   newnebblock = false;
                }
           } else {
              if (confirm('String Optimization - Do you want to generate initial path using morphing?')) {
                 var definegeom  = !(data.includes("neb_end") || data.includes("endgeom"));
                 if (definegeom) {
                    var geom2  =  parseInt(prompt("String Optimization - Please enter product model number:", 2));
                    var xyzcell = window.xyzframes[geom2-1];
                    data +=  xyzcelltogeometry(geomlattice,xyzcell,"endgeom")
                }
                nbeads =  parseInt(prompt("String Optimization - Please enter number of images in path:", 5));
                morph = true;

              } else {
                 var geoms  = prompt("String Optimization - Please enter path model numbers:", "1 2 3 4 5");
                 data += "\n### Custom path geometries for String/NEB ###\n"
                 data += "set neb:custom_path .true.\n\n";
                 nbeads = geoms.trim().split(/[ ,]+/).length;
                 for (var i=0; i<nbeads; ++i) {
                    var geom2   = parseInt(geoms.trim().split(/[ ,]+/)[i]);
                    var xyzcell = window.xyzframes[geom2-1];

                    var name = "bead_" + String(i+1).padStart(6, '0') + ":geom";
                    data +=  xyzcelltogeometry(geomlattice,xyzcell,name)

                 }
                morph = false;
              }
           }
           if (newnebblock) {
              var stepsize =  parseFloat(prompt("String Optimization - Please enter stepsize:", 1.0));
              var maxiter  =  parseInt(prompt("String Optimization - Please enter maximum iterations:", 30));
              var nhist    =  parseInt(prompt("String Optimization - Please enter number of quasinewton histories:", 5));
              var freeze   =  confirm("String Optimization - Freeze endpoints?:");

              data += "string\n";
              if (morph) {
                 data += "   impose\n";
              }
              data += "   print_shift 1\n";
              data += "   nhist    " + nhist.toString() + "\n";
              data += "   nbeads   " + nbeads.toString() + "\n";
              data += "   maxiter  " + maxiter.toString() + "\n";
              data += "   stepsize " + stepsize.toFixed(6) + "\n\n";
              if (freeze) {
                 data += "   # do not allow the end points of the path to move\n";
                 data += "   freeze1 .true.\n";
                 data += "   freezeN .true.\n";
              } else {
                 data += "   # allow the end points of the path to move\n";
                 data += "   freeze1 .false.\n";
                 data += "   freezeN .false.\n";
              }
              data += "end\n";
           }

           data += "task " + pspw + " string ignore\n";
           data = data.replace("*.xyz","*.string_final.xyz *.string_initial.xyz")

           editor.setValue(data,1);
        }


        // ****************************
        // *                          *
        // *       gen_whamdata       *
        // *                          *
        // ****************************
        function gen_whamdata(tdata,ion_motion) {

           var data  = "";

           if (tdata.includes("bondings")                        &&
               tdata.includes("nonfragment")                     &&
               tdata.includes("### Adding reaction ###")         &&
               document.getElementById("wham_posteriori").checked)   {

              var bondings = "bondings " + tdata.split("bondings")[1].split("\n")[0].trim();

              var rgamma   = parseFloat(document.getElementById("umbrella_gamma").value).toFixed(2);
              var rkappa   = parseFloat(document.getElementById("umbrella_spring").value);

              var projectname = document.getElementById("queue_nwchem_projectname").value.trim();
              if (projectname.contains("myproject")) {
                 projectname = prompt("Please enter projectname:", projectname);
              }

              var  mformula = tdata.split("#mformula = ")[1].split("\n")[0].trim();
              var jobname   = mformula+"-wham" + rgamma;

              var curdir0 = document.getElementById("queue_nwchem_curdir0").value;
              var curdir  = curdir0 + "/"+projectname+"/"+jobname

              var winp        = curdir0 + "/"+projectname+"/" + mformula+"-wham.winp";
              var wbias       = curdir0 + "/"+projectname+"/" + mformula+"-wham.bias_simulations";
              var warchive    = curdir0 + "/"+projectname+"/" + mformula+"-wham.warchive";
              var wion_motion = curdir  + "/" + ion_motion;

              data += "\n";
              data += "################### Posteriori WHAM Analysis ###################\n";
              data += "#posteriori_add_window_wham  \n";
              data += "#    " + winp        + "\n";
              data += "#    " + wbias       + "\n";
              data += "#    " + warchive    + "\n";
              data += "#    " + wion_motion + "\n";
              data += "#    " + bondings    + "\n";
              data += "#end_posteriori_add_window_wham\n\n"
           }

           return data;
        }




        // ****************************
        // *                          *
        // *        genexafs          *
        // *                          *
        // ****************************
        function genexafs(tag,feff9,ion_motion) {
           var ion_motion = "tequil.ion_motion";
           var feffdic  = {'K':1, 'L1':2, 'L2':3, 'L3':4};
           var absorber =  editor.getValue().split("geometry")[1].split("\n")[1].trim().split(/[ ,]+/)[0];
           var absorber =  prompt(tag+"EXAFS Input - Please enter absorber atom:", absorber);
           var edge     =  prompt(tag+"EXAFS Input - Please enter absorber edge:", "K");
           var rmax     =  parseFloat(prompt(tag+"EXAFS Input - Please enter absorber rmax (au):", 8.5));
           var e0       =  parseFloat(prompt(tag+"EXAFS Input - Please enter e0:", 0.0));
           var s0       =  parseFloat(prompt(tag+"EXAFS Input - Please enter s0:", 1.0));
           var start    =  parseInt(prompt(tag+"EXAFS Input - Please enter start:", 1));
           var stride   =  parseInt(prompt(tag+"EXAFS Input - Please enter stride:", 25));
           var center = 1;
           var rcut = 6.0;

           var data  = "";
           if (!feff9) {
              var center   =  parseInt(prompt(tag+"EXAFS Input - Please enter cluster center:", center));
              var rcut     =  parseFloat(prompt(tag+"EXAFS Input - Please enter cluster rcut (angstroms):", rcut));
           }

           if (feff9) {
              data += "#submit_exafs -a " + absorber + " -i " + feffdic[edge] + " -e " + e0.toFixed(1);
              data += " -s " + s0.toFixed(1);
              data += " -r " + rmax.toFixed(1);
              data += " -m " + start.toString();
              data += " -n " + stride.toString();
              data += " " + ion_motion + "\n";
           } else {
              var fname = "chi_avg_"+absorber+"_h_"+edge+"_de_"+e0.toFixed(1)+"_s02_"+s0.toFixed(1)+"_rc_"+rmax.toFixed(1)+".dat"
              var fnamer = "chir_avg_"+absorber+"_h_"+edge+"_de_"+e0.toFixed(1)+"_s02_"+s0.toFixed(1)+"_rc_"+rmax.toFixed(1)+".dat"
              data += "\n\n";
              data += "set md_xs:chi_filename " + fname + "\n";
              data += "set md_xs:chi_r_filename " + fnamer + "\n";
              data += "nwpw\n";
              data += "   md_xs\n";
              data += "      absorber " + absorber + "\n";
                 data += "      edge     " + edge + "\n";
              data += "      rmax     " + rmax.toFixed(3) + "\n";
              data += "      e0       " + e0.toFixed(3) + "\n";
              data += "      s0       " + s0.toFixed(3) + "\n";
              data += "      center   " + center.toString() + "\n";
              data += "      rcut     " + rcut.toFixed(3) + "\n";
              data += "      stride   " + stride.toString() + "\n";
              data += "   end\n";
              data += "   cpmd_properties on\n";
              data += "end\n\n";
           }
           return data;
        }


        // ****************************
        // *                          *
        // *        addcpsd           *
        // *                          *
        // ****************************
        function addcpsd(params) {
           var pspw = theory_arrowsdata2();

           var restart = true;
           if (params.contains("no restart")) {
              restart = false;
           }

           var geometry_optimize = true;
           if (params.contains("geometry_optimize")) {
              geometry_optimize = true;
           } else {
              geometry_optimize = confirm("Add geometry optimization?");
           }

           var time_step = 5.8;
           if (params.contains("time_step{")) {
              time_step = parseFloat(params.split("time_step{")[1].split("}")[0]);
           } else {
              time_step = parseFloat(prompt("CPSD Input - Please enter time_step:", time_step));
           }

           var iloop = 10;
           if (params.contains("iloop{")) {
              iloop = parseInt(params.split("iloop{")[1].split("}")[0]);
           } else {
              iloop = parseInt(prompt("CPSD Input - Please enter inner loop:", iloop));
           }

           var oloop = 1000;
           if (params.contains("oloop{")) {
              oloop = parseInt(params.split("oloop{")[1].split("}")[0]);
           } else {
              oloop = parseInt(prompt("CPSD Input - Please enter outer loop:", oloop));
           }

           var data  = editor.getValue(); // or session.getValue

           data += "\n\n";
           if (restart) {
              data += "### restart here ###\n";
           }
           
           data += "\n#### steepest_descent ####\n";
           data += "nwpw\n";
           data += "   steepest_descent\n";
           if (geometry_optimize) {
              data += "      geometry_optimize\n";
           }
           data += "      time_step " + time_step.toFixed(1) + "\n";
           data += "      loop " + iloop.toString() + " " + oloop.toString() + "\n";
           data += "   end\n";
            if (document.getElementById("nwchem_translation_off").checked) {
              data += "   translation off\n";
           }
           data += "end\n";
           data += "task " + pspw + " steepest_descent\n";

           editor.setValue(data,1);
        }



        // ****************************
        // *                          *
        // *        addbomd           *
        // *                          *
        // ****************************
        function addbomd(feff9,header,params) {
           var pspw = theory_arrowsdata2();

           var temp = 300.0;;
           if (params.contains("temperature{")) {
              temp = parseFloat(params.split("temperature{")[1].split("}")[0]);
           } else {
              temp =  parseFloat(prompt("BOMD Input - Please enter temperature:", temp));
           }

           var time_step = 15.0;
           if (params.contains("time_step{")) {
              time_step = parseFloat(params.split("time_step{")[1].split("}")[0]);
           } else {
              time_step = parseFloat(prompt("BOMD Input - Please enter time_step:", 15.0));
           }

           var iloop = 10;
           if (params.contains("iloop{")) {
              iloop = parseInt(params.split("iloop{")[1].split("}")[0]);
           } else {
              iloop = parseInt(prompt("BOMD Input - Please enter inner loop:", iloop));
           }

           var oloop = 1000;
           if (params.contains("oloop{")) {
              oloop = parseInt(params.split("oloop{")[1].split("}")[0]);
           } else {
              oloop = parseInt(prompt("BOMD Input - Please enter outer loop:", oloop));
           }


           var stime0 = 10.0;
           if (params.contains("stime0{")) {
              stime0 = parseFloat(params.split("stime0{")[1].split("}")[0]);
           } else {
              stime0 = parseFloat(prompt("CPMD Input - Please enter total simulation time (ps):", stime0));
           }

           var stime      =  1.0e-12*stime0;
           var itime      = iloop*oloop*time_step*2.41889e-17;
           var nsteps     = parseInt((stime/itime))+1;

           var tequil = "tequil";
           if (params.contains("motion_name{")) {
              tequil = params.split("motion_name{")[1].split("}")[0];
           } else {
              tequil = prompt("CPMD Input - Please enter motion files label:", tequil);
           }

           var xyz_filename = tequil + ".xyz";
           var emotion_filename = tequil + ".emotion";
           var ion_motion_filename = tequil + ".ion_motion";
           var fei_filename = tequil + ".fei";
           var data  = editor.getValue(); // or session.getValue

           var whamdata = gen_whamdata(data,ion_motion_filename);

           data += "\n\n";
           data += "### restart here ###\n";
           data += header;
           data += "\n#### equilibrating: temperature=" + temp.toFixed(1) + "K over " + stime0.toFixed(2) + " ps ####\n";
           data += "nwpw\n";
           if (temp>0.0) {
              data += "   temperature " + temp.toFixed(1) + " start\n";
           }
           data += "   bo_time_step " + time_step.toFixed(1) + "\n";
           data += "   bo_steps " + iloop.toString() + " " + oloop.toString() + "\n";
           data += "   xyz_filename        " + xyz_filename + "\n";
           data += "   emotion_filename    " + emotion_filename + "\n";
           data += "   ion_motion_filename " + ion_motion_filename + "\n";
           //data += "   fei                 " + fei_filename + "\n";
           if (document.getElementById("nwchem_translation_off").checked) {
              data += "   translation off\n";
           }
           if (document.getElementById("nwchem_rotation_off").checked) {
              data += "   rotation off\n";
           }
           data += "end\n";
           for (var i=0; i<nsteps; ++i) {
              data += "task " + pspw + " born-oppenheimer\n";
              if (i<(nsteps-1)) {
                 data += "\n### restart here ###\n";
                 data += whamdata
                 if (feff9) { data += header; }
              }
           }
           editor.setValue(data,1);
        }



        // ****************************
        // *                          *
        // *        addcpmd           *
        // *                          *
        // ****************************
        function addcpmd(feff9,header,params) {
           var pspw = theory_arrowsdata2();

           var temp = document.getElementById("nwchemmdtemperature").value;
           if (params.contains("temperature{")) {
              temp = parseFloat(params.split("temperature{")[1].split("}")[0]);
           } else {
              temp =  parseFloat(prompt("CPMD Input - Please enter temperature:", temp));
           }

           var fake_mass = document.getElementById("nwchemmdfakemass").value;
           if (params.contains("fake_mass{")) {
              fake_mass = parseFloat(params.split("fake_mass{")[1].split("}")[0]);
           } else {
              fake_mass = parseFloat(prompt("CPMD Input - Please enter fake_mass:", fake_mass));
           }
          
           var time_step = document.getElementById("nwchemmdtimestep").value;
           if (params.contains("time_step{")) {
              time_step = parseFloat(params.split("time_step{")[1].split("}")[0]);
           } else {
              time_step = parseFloat(prompt("CPMD Input - Please enter time_step:", 5.0));
           }

           var iloop = document.getElementById("nwchemmdinner_loop").value;
           if (params.contains("iloop{")) {
              iloop = parseInt(params.split("iloop{")[1].split("}")[0]);
           } else {
              iloop = parseInt(prompt("CPMD Input - Please enter inner loop:", iloop));
           }

           var oloop = document.getElementById("nwchemmdouter_loop").value;
           if (params.contains("oloop{")) {
              oloop = parseInt(params.split("oloop{")[1].split("}")[0]);
           } else {
              oloop = parseInt(prompt("CPMD Input - Please enter outer loop:", oloop));
           }

           var stime0 = document.getElementById("nwchemmdtime").value;
           if (params.contains("stime0{")) {
              stime0 = parseFloat(params.split("stime0{")[1].split("}")[0]);
           } else {
              stime0 = parseFloat(prompt("CPMD Input - Please enter total simulation time (ps):", stime0));
           }

           var stime      =  1.0e-12*stime0;
           var itime      = iloop*oloop*time_step*2.41889e-17;
           var nsteps     = parseInt((stime/itime))+1;

           var tequil = document.getElementById("nwchemmdlabel").value;
           if (params.contains("motion_name{")) {
              tequil = params.split("motion_name{")[1].split("}")[0];
           } else { 
              tequil = prompt("CPMD Input - Please enter motion files label:", tequil);
           }

           var xyz_filename = tequil + ".xyz";
           var emotion_filename = tequil + ".emotion";
           var ion_motion_filename = tequil + ".ion_motion";
           var fei_filename = tequil + ".fei";
           var data  = editor.getValue(); // or session.getValue

           var whamdata = gen_whamdata(data,ion_motion_filename);

           data += "\n\n";
           data += "### restart here ###\n";
           data += header;
           data += "\n#### equilibrating: temperature=" + temp.toFixed(1) + "K over " + stime0.toFixed(2) + " ps ####\n";
           data += "nwpw\n";
           data += "   Car-Parrinello\n";
           if (temp>0.0) {
              data += "      temperature " + temp.toFixed(1) + " start\n";
           }
           data += "      time_step " + time_step.toFixed(1) + "\n";
           data += "      fake_mass " + fake_mass.toFixed(1) + "\n";
           data += "      loop " + iloop.toString() + " " + oloop.toString() + "\n";
           data += "      xyz_filename        " + xyz_filename + "\n";
           data += "      emotion_filename    " + emotion_filename + "\n";
           data += "      ion_motion_filename " + ion_motion_filename + "\n";
           data += "      fei                 " + fei_filename + "\n";
           data += "   end\n";
           if (document.getElementById("nwchem_translation_off").checked) {
              data += "   translation off\n";
           }
           if (document.getElementById("nwchem_rotation_off").checked) {
              data += "   rotation off\n";
           }
           data += "end\n";
           for (var i=0; i<nsteps; ++i) {
              data += "task " + pspw + " car-parrinello\n";
              if (i<(nsteps-1)) {
                 data += "\n### restart here ###\n";
                 data += whamdata
                 if (feff9) { data += header; }
              }
           }
           editor.setValue(data,1);
        }


        // ****************************
        // *                          *
        // *         addexafs         *
        // *                          *
        // ****************************
        function addexafs(iscpmd) {
           var feff9      =  prompt("EXAFS Input - Please feff6 or feff9:", "feff6").includes("feff9");
           var ion_motion = "";
           var nfeff = 1;
           if (feff9) {
              ion_motion =  prompt("EXAFS Input - Please ion_motion filename:", "tequil.ion_motion");
              nfeff      =  parseInt(prompt("EXAFS Input - Please enter number of feff analysis:", 1));
           } 
           var header = "";
           for (var i=1; i<=nfeff; ++i) {
              alert("Now adding feff analysis " + i.toString());
              header += genexafs("Analysis " + i.toString() + ": ",feff9,ion_motion);
           }
           if (iscpmd) {
              addcpmd(feff9,header,'');
           } else {
              var data = editor.getValue();
              data += header;
              editor.setValue(data,1);
           }
        }


        // ****************************
        // *                          *
        // *        addannealing      *
        // *                          *
        // ****************************
        function addannealing() {
           var pspw = theory_arrowsdata2();

           var temp   =  parseFloat(prompt("Simulated Annealing - Please enter initial (maximum) temperature:", 2500.0));
           var mintemp   =  parseFloat(prompt("Simulated Annealing - Please enter final (minimum) temperature:", 300.0));
           var fake_mass  =  parseFloat(prompt("Simulated Annealing - Please enter fake_mass:", 750.0));
           var time_step  =  parseFloat(prompt("Simulated Annealing - Please enter time_step:", 5.0));
           var iloop      =  parseInt(prompt("Simulated Annealing - Please enter inner loop:", 10));
           var oloop      =  parseInt(prompt("Simulated Annealing - Please enter outer loop:", 1000));
           var itime      = iloop*oloop*time_step*2.41889e-17;
          
           var data  = editor.getValue(); // or session.getValue

           var stime0 = parseFloat(prompt("Simulated Annealing - Please enter cooling simulation time (ps):", 10.0));
           var stime  = 1.0e-12*stime0;
           var nsteps = parseInt((stime/itime))+1;
           var tau    = -(stime/2.41889e-17)/Math.log(mintemp/temp);
           var tequil     =  prompt("Simulated Annealing - Please enter annealing motion files label:", "annealing");
           var xyz_filename = tequil + ".xyz";
           var emotion_filename = tequil + ".emotion";
           var ion_motion_filename = tequil + ".ion_motion";
           var fei_filename = tequil + ".fei";

           data += "\n\n";
           data += "### restart here ###\n";
           data += "\n#### cooling schedule: intial temperature=" + temp.toFixed(1) + "K, final temperature=" + mintemp.toFixed(1) + "K over " + stime0.toFixed(2) + " ps ####\n";
           data += "nwpw\n";
           data += "   Car-Parrinello\n";
           data += "      SA_decay "+ tau.toFixed(4) + " " + tau.toFixed(4) + "\n";
           if (temp>0.0) {   
              data += "      temperature " + temp.toFixed(1) + " start\n";
           }
           data += "      time_step " + time_step.toFixed(1) + "\n";
           data += "      fake_mass " + fake_mass.toFixed(1) + "\n";
           data += "      loop " + iloop.toString() + " " + oloop.toString() + "\n";
           data += "      xyz_filename        " + xyz_filename + "\n";
           data += "      emotion_filename    " + emotion_filename + "\n";
           data += "      ion_motion_filename " + ion_motion_filename + "\n";
           data += "      fei                 " + fei_filename + "\n";
           data += "   end\n";
           if (document.getElementById("nwchem_translation_off").checked) {
              data += "   translation off\n";
           }
           if (document.getElementById("nwchem_rotation_off").checked) {
              data += "   rotation off\n";
           }
           data += "end\n";
           for (var i=0; i<nsteps; ++i) {
              data += "task " + pspw + " car-parrinello\n";
              if (i<(nsteps-1)) {data += "\n### restart here ###\n";}
           }
           data += "\n\n#### unset cooling/heating decays ####\n";
           data += "unset cpmd:sa_decay\n\n";

           editor.setValue(data,1);
        }

       function lattice_min(a1,a2,a3,b1,b2,b3,x,y,z) {
          var c1 = x*b1[0] + y*b1[1] + z*b1[2];
          var c2 = x*b2[0] + y*b2[1] + z*b2[2];
          var c3 = x*b3[0] + y*b3[1] + z*b3[2];
          c1 = c1 - Math.round(c1);
          c2 = c2 - Math.round(c2);
          c3 = c3 - Math.round(c3);
          return [a1[0]*c1 + a2[0]*c2 + a3[0]*c3, a1[1]*c1 + a2[1]*c2 + a3[1]*c3, a1[2]*c1 + a2[2]*c2 + a3[2]*c3];
       }

       function evalcollective() {
           var i,j,ii,jj,kk,ll,n1,n2,n3,n,m,n12,index1,index2;
           var x1,y1,z1,r1,x2,y2,z2,r2,x3,y3,z3,r3,theta,x,y,z,r,r0;
           var ctype = document.getElementById("coordinate_type").value;
           console.log("ctype=",ctype);
           var f = "";

           //fetch current geometry
           var xyz = exModXYZ();
           var nion = parseInt(xyz.split("\n")[0].trim());
           var lats = xyz.split("\n")[1].trim().split(/[ ,]+/);
           var a1,a2,a3;
           if (lats.length>8) {
              a1 = [parseFloat(lats[0])/0.529177, parseFloat(lats[1])/0.529177, parseFloat(lats[2])/0.529177];
              a2 = [parseFloat(lats[3])/0.529177, parseFloat(lats[4])/0.529177, parseFloat(lats[5])/0.529177];
              a3 = [parseFloat(lats[6])/0.529177, parseFloat(lats[7])/0.529177, parseFloat(lats[8])/0.529177];
           } else {
              a1 = [1000.0, 0.0, 0.0];
              a2 = [0.0, 1000.0, 0.0];
              a3 = [0.0, 0.0, 1000.0];
           }
           var [b1,b2,b3] = a1a2a3_to_b1b2b3(a1,a2,a3);
           var xyzs = xyz.split("\n").slice(2,nion+2);
           var atom = [];
           for (ii=0; ii<nion; ++ii) {
              var x = xyzs[ii].trim().split(/[ ,]+/);
              atom.push([parseFloat(x[1])/0.529177,parseFloat(x[2])/0.529177,parseFloat(x[3])/0.529177]);
           }


           jms('select *; color cpk;');
           console.log("lats=",lats);
           console.log("evalxyz=",xyz);
           console.log("a1=",a1); console.log("a2=",a2); console.log("a3=",a3);
           console.log("atom=",atom);
           if (ctype=="bond") {
              ii = parseInt(document.getElementById("collective_bond_a1").value.trim());
              jj = parseInt(document.getElementById("collective_bond_a2").value.trim());
              set_color_alist('translucent red','collective_bond_a1')
              set_color_alist('translucent green','collective_bond_a2')

              if (!(isNaN(ii) || isNaN(jj))) {
                 ii -= 1; jj -= 1;
                 x1 = (atom[ii][0]-atom[jj][0]);
                 y1 = (atom[ii][1]-atom[jj][1]);
                 z1 = (atom[ii][2]-atom[jj][2]);
                 [x1,y1,z1]  = lattice_min(a1,a2,a3,b1,b2,b3,x1,y1,z1);
                 r1 = x1*x1 + y1*y1 + z1*z1;
                 f = Math.sqrt(r1).toFixed(6);
              }
           }
           if (ctype=="angle") {
              ii = parseInt(document.getElementById("collective_angle_a1").value.trim());
              jj = parseInt(document.getElementById("collective_angle_a2").value.trim());
              kk = parseInt(document.getElementById("collective_angle_a3").value.trim());
              set_color_alist('translucent red',  'collective_angle_a1')
              set_color_alist('translucent green','collective_angle_a2')
              set_color_alist('translucent blue', 'collective_angle_a3')

              if (!(isNaN(ii) || isNaN(jj) || isNaN(kk))) {
                 ii -= 1; jj -= 1; kk-=1;
                 x1 = (atom[ii][0]-atom[jj][0]);
                 y1 = (atom[ii][1]-atom[jj][1]);
                 z1 = (atom[ii][2]-atom[jj][2]);
                 [x1,y1,z1]  = lattice_min(a1,a2,a3,b1,b2,b3,x1,y1,z1);
                 r1  = Math.sqrt(x1*x1 + y1*y1 + z1*z1);

                 x2 = (atom[kk][0]-atom[jj][0]);
                 y2 = (atom[kk][1]-atom[jj][1]);
                 z2 = (atom[kk][2]-atom[jj][2]);
                 [x2,y2,z2]  = lattice_min(a1,a2,a3,b1,b2,b3,x2,y2,z2);
                 r2  = Math.sqrt(x2*x2 + y2*y2 + z2*z2);
                 theta = (x1*x2 + y1*y2 + z1*z2)/(r1*r2)
                 if (theta>1.0) {theta=1.0;}
                 if (theta<(-1.0)) {theta=-1.0;}
                 theta = Math.acos(theta)*180.0/Math.PI;
                 f = theta.toFixed(2)
              }
           }
           if (ctype=="dihedral") {
              ii = parseInt(document.getElementById("collective_dihedral_a1").value.trim());
              jj = parseInt(document.getElementById("collective_dihedral_a2").value.trim());
              kk = parseInt(document.getElementById("collective_dihedral_a3").value.trim());
              ll = parseInt(document.getElementById("collective_dihedral_a4").value.trim());
              set_color_alist('translucent red',   'collective_dihedral_a1')
              set_color_alist('translucent green', 'collective_dihedral_a2')
              set_color_alist('translucent blue',  'collective_dihedral_a3')
              set_color_alist('translucent yellow','collective_dihedral_a4')
              if (!(isNaN(ii) || isNaN(jj) || isNaN(kk) || isNaN(ll))) {
                 ii -= 1; jj -= 1; kk-=1; ll-=1;
                 x1 = (atom[jj][0]-atom[ii][0]);
                 y1 = (atom[jj][1]-atom[ii][1]);
                 z1 = (atom[jj][2]-atom[ii][2]);
                 [x1,y1,z1]  = lattice_min(a1,a2,a3,b1,b2,b3,x1,y1,z1);

                 x2 = (atom[kk][0]-atom[jj][0]);
                 y2 = (atom[kk][1]-atom[jj][1]);
                 z2 = (atom[kk][2]-atom[jj][2]);
                 [x2,y2,z2]  = lattice_min(a1,a2,a3,b1,b2,b3,x2,y2,z2);

                 x3 = (atom[ll][0]-atom[kk][0]);
                 y3 = (atom[ll][1]-atom[kk][1]);
                 z3 = (atom[ll][2]-atom[kk][2]);
                 [x3,y3,z3]  = lattice_min(a1,a2,a3,b1,b2,b3,x3,y3,z3);

                 y = x1*(y2*z3-y3*z2) + y1*(z2*x3-z3*x2) + z1*(x2*y3-x3*y2);
                 y = y*Math.sqrt(x2*x2 + y2*y2 + z2*z2);
                 x = (y2*z3 - y3*z2)*(y1*z2 - y2*z1) + (z2*x3 - z3*x2)*(z1*x2 - z2*x1) + (x2*y3 - x3*y2)*(x1*y2 - x2*y1);
                 console.log("x=",x,"  y=",y, "y/x=",y/x);
                 theta = Math.atan2(y,x)*180.0/Math.PI;
                 f = theta.toFixed(2)
              }
           }
           if (ctype=="coord_number") {
              var sprik = document.getElementById("collective_coord_number_sprik").checked;
              n12   = document.getElementById("collective_coord_number_n12").value;
              n     = document.getElementById("collective_coord_number_n").value;
              m     = document.getElementById("collective_coord_number_m").value;
              r0    = document.getElementById("collective_coord_number_r0").value;
              index1 = expand0_atomlist(document.getElementById("collective_coord_number_indexes1").value.trim()).split(/[ ,]+/);
              index2 = expand0_atomlist(document.getElementById("collective_coord_number_indexes2").value.trim()).split(/[ ,]+/);
              set_color_alist('translucent green','collective_coord_number_indexes1')
              set_color_alist('translucent blue', 'collective_coord_number_indexes2')
             
              z = 0.0;
              for (i=0; i<index1.length; ++i) {
              for (j=0; j<index2.length; ++j) {
                 ii = parseInt(index1[i]);
                 jj = parseInt(index2[j]);
                 if (!(isNaN(ii) || isNaN(jj))) {
                    ii -= 1; jj -= 1;
                    x1 = (atom[ii][0]-atom[jj][0]);
                    y1 = (atom[ii][1]-atom[jj][1]);
                    z1 = (atom[ii][2]-atom[jj][2]);
                    [x1,y1,z1]  = lattice_min(a1,a2,a3,b1,b2,b3,x1,y1,z1);
                    r1  = Math.sqrt(x1*x1 + y1*y1 + z1*z1);
                    if (sprik) {
                       z +=  1.0/(1.0+Math.exp(n*(r1-r0)));
                    } else {
                       z +=  (1.0-Math.pow(r1/r0,n))/(1.00-Math.pow(r1/r0,m));
                    }
                 }
              }}
              z = z/n12;
              f = z.toFixed(6);
           }
           if (ctype=="group_distance") {
              n      = document.getElementById("collective_group_distance_n").value;
              index1 = expand0_atomlist(document.getElementById("collective_group_distance_indexes1").value.trim()).split(/[ ,]+/);
              index2 = expand0_atomlist(document.getElementById("collective_group_distance_indexes2").value.trim()).split(/[ ,]+/);
              n12    = (index1.length)*(index2.length);
              set_color_alist('translucent orange','collective_group_distance_indexes1')
              set_color_alist('translucent aqua',  'collective_group_distance_indexes2')

              z = 0.0;
              for (i=0; i<index1.length; ++i) {
              for (j=0; j<index2.length; ++j) {
                 ii = parseInt(index1[i]);
                 jj = parseInt(index2[j]);
                 if (!(isNaN(ii) || isNaN(jj))) {
                    ii -= 1; jj -= 1;
                    x1 = (atom[ii][0]-atom[jj][0]);
                    y1 = (atom[ii][1]-atom[jj][1]);
                    z1 = (atom[ii][2]-atom[jj][2]);
                    [x1,y1,z1]  = lattice_min(a1,a2,a3,b1,b2,b3,x1,y1,z1);
                    r1  = Math.sqrt(x1*x1 + y1*y1 + z1*z1);
                    z += Math.pow(1.0/r1,n);
                 }
              }}
              z = Math.pow(z/n12,(-1.0/n));
              f = z.toFixed(6);
           }
           if (ctype=="X") {
              ii = parseInt(document.getElementById("collective_X_a1").value.trim());
              set_color_alist('translucent red','collective_X_a1')
              if (!isNaN(ii)) {
                 ii -= 1; 
                 x1 = atom[ii][0];
                 f = x1.toFixed(6);
              }
           }
           if (ctype=="Y") {
              ii = parseInt(document.getElementById("collective_Y_a1").value.trim());
              set_color_alist('translucent blue','collective_Y_a1');
              if (!isNaN(ii)) {
                 ii -= 1; 
                 y1 = atom[ii][1];
                 f = y1.toFixed(6);
              }
           }
           if (ctype=="Z") {
              ii = parseInt(document.getElementById("collective_Z_a1").value.trim());
              set_color_alist('translucent green','collective_Z_a1');
              if (!isNaN(ii)) {
                 ii -= 1; 
                 z1 = atom[ii][2];
                 f = z1.toFixed(6);
              }
           }
           if (ctype=="n-plane") {
              ii = parseInt(document.getElementById("collective_nplane_a1").value.trim());
              n = string3_to_vec3(document.getElementById("collective_nplane_normal").value);
              set_color_alist('translucent orange','collective_nplane_a1');
              set_color_alist('translucent yellow','collective_nplane_indexes');
              console.log("n=",n);
              console.log("ii=",ii);
              if (!isNaN(ii)) {
                 ii -= 1;
                 x1 = atom[ii][0];
                 y1 = atom[ii][1];
                 z1 = atom[ii][2];
                 console.log("x1,y1,z1=",x1,y1,z1);
                 index1 = expand0_atomlist(document.getElementById("collective_nplane_indexes").value.trim()).split(/[ ,]+/);
                 n12 = index1.length;
                 z = 0.0;
                 for (j=0; j<index1.length; ++j) {
                    jj = parseInt(index1[j]);
                    if (!isNaN(jj)) {
                       jj -= 1;
                       x2 = x1 - atom[jj][0];
                       y2 = y1 - atom[jj][1];
                       z2 = z1 - atom[jj][2];
                       [x2,y2,z2]  = lattice_min(a1,a2,a3,b1,b2,b3,x2,y2,z2);
                       console.log("jj,x2,y2,z2=",jj,x2,y2,z2);
                       r =  n[0]*x2 + n[1]*y2 + n[2]*z2;
                       console.log("r=",r);
                       z += Math.sqrt(r*r);
                    }
                 }
                 z = z/n12;
                 f = z.toFixed(6);
              }
           }
           if (ctype=="bond_difference2") {
              ii = parseInt(document.getElementById("collective_bond_difference2_a1").value.trim());
              jj = parseInt(document.getElementById("collective_bond_difference2_a2").value.trim());
              kk = parseInt(document.getElementById("collective_bond_difference2_a3").value.trim());
              set_color_alist('translucent red',  'collective_bond_difference2_a1');
              set_color_alist('translucent green','collective_bond_difference2_a2');
              set_color_alist('translucent blue', 'collective_bond_difference2_a3');
              if (!(isNaN(ii) || isNaN(jj) || isNaN(kk))) {
                 ii -= 1; jj -= 1; kk-=1;
                 x1 = (atom[jj][0]-atom[ii][0]);
                 y1 = (atom[jj][1]-atom[ii][1]);
                 z1 = (atom[jj][2]-atom[ii][2]);
                 [x1,y1,z1]  = lattice_min(a1,a2,a3,b1,b2,b3,x1,y1,z1);
                 r1  = (x1*x1 + y1*y1 + z1*z1);

                 x2 = (atom[kk][0]-atom[ii][0]);
                 y2 = (atom[kk][1]-atom[ii][1]);
                 z2 = (atom[kk][2]-atom[ii][2]);
                 [x2,y2,z2]  = lattice_min(a1,a2,a3,b1,b2,b3,x2,y2,z2);
                 r2  = (x2*x2 + y2*y2 + z2*z2);
                 z = r1 - r2; 
                 f = z.toFixed(6)
              }
           }
           if (ctype=="bondings") {
              index1 = document.getElementById("collective_bondings_coefindexes").value.trim().split(/[ ,]+/);
              set_color_bondings('collective_bondings_coefindexes');
              n = index1.length;
              z = 0.0;
              for (i=0; i<n; ++i) {
                 r  = parseFloat(index1[3*i]);
                 ii = parseInt(index1[3*i+1]);
                 jj = parseInt(index1[3*i+2]);
                 if (!(isNaN(ii) || isNaN(jj) || isNaN(r))) {
                    ii -= 1; jj -= 1;
                    x1 = (atom[jj][0]-atom[ii][0]);
                    y1 = (atom[jj][1]-atom[ii][1]);
                    z1 = (atom[jj][2]-atom[ii][2]);
                    [x1,y1,z1]  = lattice_min(a1,a2,a3,b1,b2,b3,x1,y1,z1);
                    r1  = Math.sqrt(x1*x1 + y1*y1 + z1*z1);
                    z += r*r1;
                 }
              }
              f = z.toFixed(6);
           }

           document.getElementById("collectivef").innerHTML = f;
           //return f;
        }




        function makemetacollective() {
           var ctype = document.getElementById("coordinate_type").value;
           var range = document.getElementById("meta_range").value.trim();
           var nrange = document.getElementById("meta_nrange").value;
           var meta_w = document.getElementById("meta_w").value;
           var meta_sigma = document.getElementById("meta_sigma").value;

           var data = "";
           
           if (ctype=="bond") {
              data += "      bond "     + document.getElementById("collective_bond_a1").value.trim() + " " 
                                        + document.getElementById("collective_bond_a2").value.trim() + " "
                            + "w "      + meta_w + " "
                            + "sigma "  + meta_sigma + " ";
              if (range!="") {
                 if (range.split(/[ ,]+/).length==2) {
                    data += "range " + range + " ";
                 }
              }
              if (nrange!="") {
                 data += "nrange " + nrange + " ";
              }
              data += "\n";
           }
           if (ctype=="angle") {
              data += "      angle "    + document.getElementById("collective_angle_a1").value.trim() + " " 
                                        + document.getElementById("collective_angle_a2").value.trim() + " "
                                        + document.getElementById("collective_angle_a3").value.trim() + " "
                            + "w "      + meta_w + " "
                            + "sigma "  + meta_sigma + " ";
              if (range!="") {
                 if (range.split(/[ ,]+/).length==2) {
                    data += "range " + range + " ";
                 }
              }
              if (nrange!="") {
                 data += "nrange " + nrange + " ";
              }
              data += "\n";
           }
           if (ctype=="dihedral") {
              data += "      dihedral " + document.getElementById("collective_dihedral_a1").value.trim() + " "    
                                        + document.getElementById("collective_dihedral_a2").value.trim() + " "
                                        + document.getElementById("collective_dihedral_a3").value.trim() + " "
                                        + document.getElementById("collective_dihedral_a4").value.trim() + " "
                            + "w "      + meta_w + " "
                            + "sigma "  + meta_sigma + " ";
              if (range!="") {
                 if (range.split(/[ ,]+/).length==2) {
                    data += "range " + range + " ";
                 }
              }
              if (nrange!="") {
                 data += "nrange " + nrange + " ";
              }                             
              data += "\n";
           }     
           if (ctype=="coord_number") {
              var checked = document.getElementById("collective_coord_number_sprik").checked;
              data += "      coord_number ";
              if (checked) {
                 data += "sprik ";
              }
              data += "index1 " + expand0_atomlist(document.getElementById("collective_coord_number_indexes1").value.trim()) + " "
                    + "index2 " + expand0_atomlist(document.getElementById("collective_coord_number_indexes2").value.trim()) + " "
                    + "n12 "     + document.getElementById("collective_coord_number_n12").value + " "
                    + "n "       + document.getElementById("collective_coord_number_n").value + " ";
              if (!checked) {
                   data += "m "       + document.getElementById("collective_coord_number_m").value + " ";
              }
              data += "r0 "     + document.getElementById("collective_coord_number_r0").value + " "
                    + "w "      + meta_w + " "
                    + "sigma "  + meta_sigma + " ";
              if (range!="") {
                 if (range.split(/[ ,]+/).length==2) {
                    data += "range " + range + " ";
                 }
              }
              if (nrange!="") {
                 data += "nrange " + nrange + " ";
              }
              data += "\n";
           }
           if (ctype=="group_distance") {
              data += "      group_distance "
                    + "index1 " + expand0_atomlist(document.getElementById("collective_group_distance_indexes1").value.trim()) + " "
                    + "index2 " + expand0_atomlist(document.getElementById("collective_group_distance_indexes2").value.trim()) + " "
                    + "n "      + document.getElementById("collective_group_distance_n").value + " " 
                    + "w "      + meta_w + " "
                    + "sigma "  + meta_sigma + " ";
              if (range!="") {
                 if (range.split(/[ ,]+/).length==2) {
                    data += "range " + range + " ";
                 }
              }
              if (nrange!="") {
                 data += "nrange " + nrange + " ";
              }
              data += "\n";
           }
           if (ctype=="X") {
              data += "      x " + document.getElementById("collective_X_a1").value.trim() + " "
                    + "w "      + meta_w + " "
                    + "sigma "  + meta_sigma + " ";

              if (range!="") {
                 if (range.split(/[ ,]+/).length==2) {
                    data += "range " + range + " ";
                 }
              }
              if (nrange!="") {
                 data += "nrange " + nrange + " ";
              }
              data += "\n";
           }
           if (ctype=="Y") {
              data += "      y " + document.getElementById("collective_Y_a1").value.trim() + " "
                    + "w "      + meta_w + " "
                    + "sigma "  + meta_sigma + " ";

              if (range!="") {
                 if (range.split(/[ ,]+/).length==2) {
                    data += "range " + range + " ";
                 }
              }
              if (nrange!="") {
                 data += "nrange " + nrange + " ";
              }
              data += "\n";
           }
           if (ctype=="Z") {
              data += "      z " + document.getElementById("collective_Z_a1").value.trim() + " "
                    + "w "      + meta_w + " "
                    + "sigma "  + meta_sigma + " ";

              if (range!="") {
                 if (range.split(/[ ,]+/).length==2) {
                    data += "range " + range + " ";
                 }
              }
              if (nrange!="") {
                 data += "nrange " + nrange + " ";
              }
              data += "\n";
           }
           if (ctype=="n-plane") {
              data += "      n-plane " + document.getElementById("collective_nplane_a1").value.trim() + " "
                    + expand0_atomlist(document.getElementById("collective_nplane_indexes").value.trim()) + " "
                    + "normal " + document.getElementById("collective_nplane_normal").value + " " 
                    + "w "      + meta_w + " "
                    + "sigma "  + meta_sigma + " ";
              if (range!="") {
                 if (range.split(/[ ,]+/).length==2) {
                    data += "range " + range + " ";
                 }
              }
              if (nrange!="") {
                 data += "nrange " + nrange + " ";
              }
              data += "\n";
           }
           if (ctype=="bond_difference2") {
              data += "      bond_difference2 " + document.getElementById("collective_bond_difference2_a1").value.trim() + " " 
                                                + document.getElementById("collective_bond_difference2_a2").value.trim() + " "
                                                + document.getElementById("collective_bond_difference2_a3").value.trim() + " "
                            + "w "      + meta_w + " "
                            + "sigma "  + meta_sigma + " ";
              if (range!="") {
                 if (range.split(/[ ,]+/).length==2) {
                    data += "range " + range + " ";
                 }
              }
              if (nrange!="") {
                 data += "nrange " + nrange + " ";
              }
              data += "\n";
           }
           if (ctype=="bondings") {
              data += "      bondings " + document.getElementById("collective_bondings_coefindexes").value.trim() + " " 
                            + "w "      + meta_w + " "
                            + "sigma "  + meta_sigma + " ";
              if (range!="") {
                 if (range.split(/[ ,]+/).length==2) {
                    data += "range " + range + " ";
                 }
              }
              if (nrange!="") {
                 data += "nrange " + nrange + " ";
              }
              data += "\n";
           }

           return data;
        }

        // ****************************
        // *                          *
        // *      addmetadynamics     *
        // *                          *
        // ****************************
        function addmetadynamics() {
           var ctype = document.getElementById("coordinate_type").value;
           var range = document.getElementById("meta_range").value.trim();
           var nrange = document.getElementById("meta_nrange").value;
           var temp  = document.getElementById("meta_tempered").value;
           var boundary_w      = parseFloat(document.getElementById("meta_boundary_w").value);
           var boundary_sigma  = parseFloat(document.getElementById("meta_boundary_sigma").value);

           var metacollect = makemetacollective();

           var data  = editor.getValue(); // or session.getValue
           var foundmeta = data.includes("metadynamics")

           if (foundmeta) {
              if (!data.includes(metacollect)) {
                 var dstart = data.split("      #start_collective_coordinates\n")[0];
                 var dmid   = data.split("      #start_collective_coordinates\n")[1].split("      #end_collective_coordinates\n")[0];
                 var dend   = data.split("      #end_collective_coordinates\n")[1];
                 data = dstart;
                 data += "      #start_collective_coordinates\n";
                 data += dmid;
                 data += metacollect;
                 data += "      #end_collective_coordinates\n";
                 data += dend;
              }

           } else {
              data += "\n### Adding Metadynamics ###\n";
              data += "# collective_variable_type    = " +ctype +"\n";

              data += "nwpw\n"
              data += "   metadynamics\n";
              data += "      update      " + document.getElementById("meta_update").value + "\n";
              data += "      print " + document.getElementById("meta_print").value + "\n";
              data += "      print_shift " + document.getElementById("meta_print_shift").value + "\n";
              if (temp>1.0e-3) {
                 data += "      tempered    " + temp + "\n";
              }
              if (boundary_w>1.0e-3) {
                 console.log("boundary_w=",boundary_w);
                 console.log("boundary_w=",boundary_w.toFixed(6));
                 data += "      boundary    " + boundary_w.toFixed(6) + " " +  boundary_sigma.toFixed(6) + "\n";
              }
              data += "      #start_collective_coordinates\n";
              data += metacollect;
              data += "      #end_collective_coordinates\n";
              data += "   end\n";
              data += "end\n";
           }

           editor.setValue(data,1);
        }



        function maketamdcollective() {
           var ctype = document.getElementById("coordinate_type").value;
           var range = document.getElementById("tamd_range").value.trim();
           var nrange = document.getElementById("tamd_nrange").value;
           var tamd_gamma = document.getElementById("tamd_gamma").value;
           var tamd_k = document.getElementById("tamd_k").value;
           var tamd_mass  = document.getElementById("tamd_mass").value;
           var tamd_ztemp  = document.getElementById("tamd_ztemp").value;
           var tamd_zinitial  = document.getElementById("tamd_zinitial").value;

           var data = "";
           
           if (ctype=="bond") {
              data += "      bond "     + document.getElementById("collective_bond_a1").value.trim() + " " 
                                        + document.getElementById("collective_bond_a2").value.trim() + " "
                            + "gamma "  + tamd_gamma + " "
                            + "k "      + tamd_k + " " 
                            + "mass "   + tamd_mass + " " 
                            + "ztemp "  + tamd_ztemp + " "
                            + "zinitial " + tamd_zinitial + " ";

              if (range!="") {
                 if (range.split(/[ ,]+/).length==2) {
                    data += "range " + range + " ";
                 }
              }
              if (nrange!="") {
                 data += "nrange " + nrange + " ";
              }
              data += "\n";
           }
           if (ctype=="angle") {
              data += "      angle "    + document.getElementById("collective_angle_a1").value.trim() + " " 
                                        + document.getElementById("collective_angle_a2").value.trim() + " "
                                        + document.getElementById("collective_angle_a3").value.trim() + " "
                            + "gamma "  + tamd_gamma + " "
                            + "k "      + tamd_k + " " 
                            + "mass "   + tamd_mass + " " 
                            + "ztemp "  + tamd_ztemp + " "
                            + "zinitial " + tamd_zinitial + " ";
              if (range!="") {
                 if (range.split(/[ ,]+/).length==2) {
                    data += "range " + range + " ";
                 }
              }
              if (nrange!="") {
                 data += "nrange " + nrange + " ";
              }
              data += "\n";
           }
           if (ctype=="dihedral") {
              data += "      dihedral " + document.getElementById("collective_dihedral_a1").value.trim() + " "    
                                        + document.getElementById("collective_dihedral_a2").value.trim() + " "
                                        + document.getElementById("collective_dihedral_a3").value.trim() + " "
                                        + document.getElementById("collective_dihedral_a4").value.trim() + " "
                            + "gamma "  + tamd_gamma + " "
                            + "k "      + tamd_k + " " 
                            + "mass "   + tamd_mass + " " 
                            + "ztemp "  + tamd_ztemp + " "
                            + "zinitial " + tamd_zinitial + " ";
              if (range!="") {
                 if (range.split(/[ ,]+/).length==2) {
                    data += "range " + range + " ";
                 }
              }
              if (nrange!="") {
                 data += "nrange " + nrange + " ";
              }                             
              data += "\n";
           }     
           if (ctype=="coord_number") {
              var checked = document.getElementById("collective_coord_number_sprik").checked;
              data += "      coord_number ";
              if (checked) {
                 data += "sprik ";
              }
              data += "index1 " + expand0_atomlist(document.getElementById("collective_coord_number_indexes1").value.trim()) + " "
                    + "index2 " + expand0_atomlist(document.getElementById("collective_coord_number_indexes2").value.trim()) + " "
                    + "n12 "     + document.getElementById("collective_coord_number_n12").value + " "
                    + "n "       + document.getElementById("collective_coord_number_n").value + " ";
              if (!checked) {
                   data += "m "       + document.getElementById("collective_coord_number_m").value + " ";
              }
              data += "r0 "     + document.getElementById("collective_coord_number_r0").value + " "
                    + "gamma "  + tamd_gamma + " "
                    + "k "      + tamd_k + " " 
                    + "mass "   + tamd_mass + " " 
                    + "ztemp "  + tamd_ztemp + " "
                    + "zinitial " + tamd_zinitial + " ";
              if (range!="") {
                 if (range.split(/[ ,]+/).length==2) {
                    data += "range " + range + " ";
                 }
              }
              if (nrange!="") {
                 data += "nrange " + nrange + " ";
              }
              data += "\n";
           }
           if (ctype=="group_distance") {
              data += "      group_distance "
                    + "index1 " + expand0_atomlist(document.getElementById("collective_group_distance_indexes1").value.trim()) + " "
                    + "index2 " + expand0_atomlist(document.getElementById("collective_group_distance_indexes2").value.trim()) + " "
                    + "n "      + document.getElementById("collective_group_distance_n").value + " " 
                    + "gamma "  + tamd_gamma + " "
                    + "k "      + tamd_k + " " 
                    + "mass "   + tamd_mass + " " 
                    + "ztemp "  + tamd_ztemp + " "
                    + "zinitial " + tamd_zinitial + " ";
              if (range!="") {
                 if (range.split(/[ ,]+/).length==2) {
                    data += "range " + range + " ";
                 }
              }
              if (nrange!="") {
                 data += "nrange " + nrange + " ";
              }
              data += "\n";
           }
           if (ctype=="X") {
              data += "      x " + document.getElementById("collective_X_a1").value.trim() + " "
                    + "gamma "  + tamd_gamma + " "
                    + "k "      + tamd_k + " " 
                    + "mass "   + tamd_mass + " " 
                    + "ztemp "  + tamd_ztemp + " "
                    + "zinitial " + tamd_zinitial + " ";

              if (range!="") {
                 if (range.split(/[ ,]+/).length==2) {
                    data += "range " + range + " ";
                 }
              }
              if (nrange!="") {
                 data += "nrange " + nrange + " ";
              }
              data += "\n";
           }
           if (ctype=="Y") {
              data += "      y " + document.getElementById("collective_Y_a1").value.trim() + " "
                    + "gamma "  + tamd_gamma + " "
                    + "k "      + tamd_k + " " 
                    + "mass "   + tamd_mass + " " 
                    + "ztemp "  + tamd_ztemp + " "
                    + "zinitial " + tamd_zinitial + " ";

              if (range!="") {
                 if (range.split(/[ ,]+/).length==2) {
                    data += "range " + range + " ";
                 }
              }
              if (nrange!="") {
                 data += "nrange " + nrange + " ";
              }
              data += "\n";
           }
           if (ctype=="Z") {
              data += "      z " + document.getElementById("collective_Z_a1").value.trim() + " "
                    + "gamma "  + tamd_gamma + " "
                    + "k "      + tamd_k + " " 
                    + "mass "   + tamd_mass + " " 
                    + "ztemp "  + tamd_ztemp + " "
                    + "zinitial " + tamd_zinitial + " ";

              if (range!="") {
                 if (range.split(/[ ,]+/).length==2) {
                    data += "range " + range + " ";
                 }
              }
              if (nrange!="") {
                 data += "nrange " + nrange + " ";
              }
              data += "\n";
           }
           if (ctype=="n-plane") {
              data += "      n-plane " + document.getElementById("collective_nplane_a1").value.trim() + " "
                    + expand0_atomlist(document.getElementById("collective_nplane_indexes").value.trim()) + " "
                    + "normal " + document.getElementById("collective_nplane_normal").value + " " 
                    + "gamma "  + tamd_gamma + " "
                    + "k "      + tamd_k + " " 
                    + "mass "   + tamd_mass + " " 
                    + "ztemp "  + tamd_ztemp + " "
                    + "zinitial " + tamd_zinitial + " ";
              if (range!="") {
                 if (range.split(/[ ,]+/).length==2) {
                    data += "range " + range + " ";
                 }
              }
              if (nrange!="") {
                 data += "nrange " + nrange + " ";
              }
              data += "\n";
           }
           if (ctype=="bond_difference2") {
              data += "      bond_difference2 " + document.getElementById("collective_bond_difference2_a1").value.trim() + " " 
                                                + document.getElementById("collective_bond_difference2_a2").value.trim() + " "
                                                + document.getElementById("collective_bond_difference2_a3").value.trim() + " "
                    + "gamma "  + tamd_gamma + " "
                    + "k "      + tamd_k + " " 
                    + "mass "   + tamd_mass + " " 
                    + "ztemp "  + tamd_ztemp + " "
                    + "zinitial " + tamd_zinitial + " ";
              if (range!="") {
                 if (range.split(/[ ,]+/).length==2) {
                    data += "range " + range + " ";
                 }
              }
              if (nrange!="") {
                 data += "nrange " + nrange + " ";
              }
              data += "\n";
           }
           if (ctype=="bondings") {
              data += "      bondings " + document.getElementById("collective_bondings_coefindexes").value.trim() + " " 
                    + "gamma "  + tamd_gamma + " "
                    + "k "      + tamd_k + " " 
                    + "mass "   + tamd_mass + " " 
                    + "ztemp "  + tamd_ztemp + " "
                    + "zinitial " + tamd_zinitial + " ";
              if (range!="") {
                 if (range.split(/[ ,]+/).length==2) {
                    data += "range " + range + " ";
                 }
              }
              if (nrange!="") {
                 data += "nrange " + nrange + " ";
              }
              data += "\n";
           }

           return data;
        }



        // ****************************
        // *                          *
        // *         addtamd          *
        // *                          *
        // ****************************
        function addtamd() {
           var ctype = document.getElementById("coordinate_type").value;

           var tamdcollect = maketamdcollective();

           var data  = editor.getValue(); // or session.getValue
           var foundmeta = data.includes("tamd")

           if (foundmeta) {
              if (!data.includes(tamdcollect)) {
                 var dstart = data.split("      #start_collective_coordinates\n")[0];
                 var dmid   = data.split("      #start_collective_coordinates\n")[1].split("      #end_collective_coordinates\n")[0];
                 var dend   = data.split("      #end_collective_coordinates\n")[1];
                 data = dstart;
                 data += "      #start_collective_coordinates\n";
                 data += dmid;
                 data += tamdcollect;
                 data += "      #end_collective_coordinates\n";
                 data += dend;
              }

           } else {
              data += "\n### Adding TAMD ###\n";
              data += "# collective_variable_type    = " +ctype +"\n";

              data += "nwpw\n"
              data += "   tamd\n";
              data += "      update      " + document.getElementById("tamd_update").value + "\n";
              data += "      print_shift " + document.getElementById("tamd_print_shift").value + "\n";
              data += "      print "       + document.getElementById("tamd_print").value + "\n";
              if (document.getElementById("tamd_zfixed").checked) {data += "      zfixed\n";}
              data += "      #start_collective_coordinates\n";
              data += tamdcollect;
              data += "      #end_collective_coordinates\n";
              data += "   end\n";
              data += "end\n";
           }
           editor.setValue(data,1);
        }

        // **********************************
        // *                                *
        // *        addshakeconstraint      *
        // *                                *
        // **********************************
        function addshakeconstraint() {
           var ctype = document.getElementById("coordinate_type").value;
           console.log("ctype=",ctype);
           var f = "";

           //fetch current geometry
           var xyz = exModXYZ();
           var nion = parseInt(xyz.split("\n")[0].trim());
           var lats = xyz.split("\n")[1].trim().split(/[ ,]+/);
           var a1,a2,a3;
           if (lats.length>8) {
              a1 = [parseFloat(lats[0])/0.529177, parseFloat(lats[1])/0.529177, parseFloat(lats[2])/0.529177];
              a2 = [parseFloat(lats[3])/0.529177, parseFloat(lats[4])/0.529177, parseFloat(lats[5])/0.529177];
              a3 = [parseFloat(lats[6])/0.529177, parseFloat(lats[7])/0.529177, parseFloat(lats[8])/0.529177];
           } else {
              a1 = [1000.0, 0.0, 0.0];
              a2 = [0.0, 1000.0, 0.0];
              a3 = [0.0, 0.0, 1000.0];
           }
           var [b1,b2,b3] = a1a2a3_to_b1b2b3(a1,a2,a3);
           var xyzs = xyz.split("\n").slice(2,nion+2);
           var atom = [];
           for (let ii=0; ii<nion; ++ii) {
              var x = xyzs[ii].trim().split(/[ ,]+/);
              atom.push([parseFloat(x[1])/0.529177,parseFloat(x[2])/0.529177,parseFloat(x[3])/0.529177]);
           }
           console.log("CTYPE=",ctype);

           if (ctype=="bond") {
              let ii = parseInt(document.getElementById("collective_bond_a1").value.trim());
              let jj = parseInt(document.getElementById("collective_bond_a2").value.trim());
             console.log("bond ii=",ii);
             console.log("bond jj=",jj);
              if (!(isNaN(ii) || isNaN(jj))) {
                 ii -= 1; jj -= 1;
                 let x1 = (atom[ii][0]-atom[jj][0]);
                 let y1 = (atom[ii][1]-atom[jj][1]);
                 let z1 = (atom[ii][2]-atom[jj][2]);
                 [x1,y1,z1]  = lattice_min(a1,a2,a3,b1,b2,b3,x1,y1,z1);
                 let r1 = x1*x1 + y1*y1 + z1*z1;
                 f = Math.sqrt(r1).toFixed(6);
                 let apstring = "set nwpw:shake_constraint \"" + (ii+1).toString() + " " + (jj+1).toString() + " l " + f +"\"";
                 console.log("apstring=",apstring);
                 var data  = editor.getValue(); // or session.getValue
                 data += "\n### Adding shake constraints ###\n";
                 data += "### reaction = AB --> A + B \n";
                 data += "###  A=" + (ii+1).toString() + " B=" + (jj+1).toString() + "\n"; 
                 data += apstring + "\n";
                 editor.setValue(data,1);
              }
           }
           if (ctype=="bond_difference2") {
              let ii = parseInt(document.getElementById("collective_bond_difference2_a1").value.trim());
              let jj = parseInt(document.getElementById("collective_bond_difference2_a2").value.trim());
              let kk = parseInt(document.getElementById("collective_bond_difference2_a3").value.trim());
              if (!(isNaN(ii) || isNaN(jj) || isNaN(kk))) {
                 ii -= 1; jj -= 1; kk-=1;
                 let x1 = (atom[jj][0]-atom[ii][0]);
                 let y1 = (atom[jj][1]-atom[ii][1]);
                 let z1 = (atom[jj][2]-atom[ii][2]);
                 [x1,y1,z1]  = lattice_min(a1,a2,a3,b1,b2,b3,x1,y1,z1);
                 let r1  = (x1*x1 + y1*y1 + z1*z1);

                 let x2 = (atom[kk][0]-atom[ii][0]);
                 let y2 = (atom[kk][1]-atom[ii][1]);
                 let z2 = (atom[kk][2]-atom[ii][2]);
                 [x2,y2,z2]  = lattice_min(a1,a2,a3,b1,b2,b3,x2,y2,z2);
                 let r2  = (x2*x2 + y2*y2 + z2*z2);
                 let z = r1 - r2; 
                 f = z.toFixed(6)
                 var apstring = "set nwpw:shake_constraint \"" + (jj+1).toString() + " " + (kk+1).toString() + " " + (ii+1).toString() + " d " + f + "\"";
                 console.log("apstring=",apstring);
                 var data  = editor.getValue(); // or session.getValue
                 data += "\n### Adding shake constraints ###\n";
                 data += "### reaction = AB + C --> AC + B \n";
                 data += "###  A=" + (ii+1).toString() + " B=" + (jj+1).toString() + " C=" + (kk+1).toString() + "\n"; 
                 data += apstring + "\n";
                 editor.setValue(data,1);
              }
           }
        }


        // **********************************
        // *                                *
        // *        addreactionconstraint   *
        // *                                *
        // **********************************
        function addreactionconstraint(qmmm) {
           var theory   = theory_arrowsdata2();
           var rtype    = document.getElementById("reaction_type").value;
           var rgamma   = document.getElementById("reaction_gamma").value;
           var rindexes = document.getElementById("reaction_indexes").value;
           var rkappa = 1.0;
           var bondings =  document.getElementById("reaction_bondings").value.split("gamma")[1].split("\n")[0].trim();
           var data  = editor.getValue(); // or session.getValue
           data += "\n### Adding reaction ###\n";
           data += "# reaction_type    = " +rtype +"\n";
           data += "# reaction_indexes = " +rindexes +"\n";
           data += "# reaction_gamma   = " +rgamma +"\n";
           data += "##### current gamma="+rgamma+" ######\n";

           if (qmmm) {
              data += "nwpw\n";
              data += "   auxiliary_potentials\n";
              data += "      nonfragment\n";
              data += "         bondings " + rkappa.toFixed(6) + " " + rgamma  + " " +  bondings + "\n";
              data += "      end\n";
              data += "   end\n";
              data += "end\n";
           } else {
              data += "constraints\n";
              data += "   clear\n";
              data += "   spring bondings " + rkappa.toFixed(6) + " " + rgamma  + " " +  bondings + "\n";
              data += "end\n";
           }

           editor.setValue(data,1);
        }


        // **********************************
        // *                                *
        // *    addreactionconstraintpath   *
        // *                                *
        // **********************************
        function addreactionconstraintpath(qmmm) {
           var maxiter = 50;

           var pspw = theory_arrowsdata2();
           var rtype    = document.getElementById("reaction_type").value;
           var rindexes = document.getElementById("reaction_indexes").value;
           var rgamma   = document.getElementById("reaction_gamma").value;
           var min_rgamma = parseFloat(document.getElementById("min_reaction_gamma").value);
           var max_rgamma = parseFloat(document.getElementById("max_reaction_gamma").value);
           var npath      = parseInt(document.getElementById("reaction_ngamma").value);
           var rkappa = 1.0;
           var bondings =  document.getElementById("reaction_bondings").value.split("gamma")[1].split("\n")[0].trim();
           var dx = (max_rgamma-min_rgamma)/(npath-1);

           var data  = editor.getValue(); // or session.getValue
           for (let i=0; i<npath; ++i) {
              let rgamma0 = min_rgamma + i*dx;

              data += "\n\n";
              data += "### restart here ###\n";
              data += "\n### Adding reaction ###\n";
              data += "# reaction_type    = " +rtype +"\n";
              data += "# reaction_indexes = " +rindexes +"\n";
              data += "# reaction_gamma   = " +rgamma0.toFixed(3) +"\n";
              data += "##### current gamma="+rgamma0.toFixed(3)+" ######\n";

              if (qmmm) {
                 data += "nwpw\n";
                 data += "   auxiliary_potentials\n";
                 data += "      nonfragment\n";
                 data += "         bondings " + rkappa.toFixed(6) + " " + rgamma0.toFixed(3)  + " " +  bondings + "\n";
                 data += "      end\n";
                 data += "   end\n";
                 data += "end\n";
              } else {
                 data += "constraints\n";
                 data += "   clear\n";
                 data += "   spring bondings " + rkappa.toFixed(6) + " " + rgamma0.toFixed(3)  + " " +  bondings + "\n";
                 data += "end\n";
              }
              data += "\n";
              data += "driver\n";
              data += "   clear\n";
              data += "   maxiter " + maxiter.toString() + "\n";
              data += "end\n";
              data += "task " + pspw + " optimize ignore\n";
           }

           editor.setValue(data,1);
        }



        function isPositiveInteger(n) {
            return n >>> 0 === parseFloat(n);
        } 

        function expand0_atomlist(atomlist) {
           if (atomlist.includes(":")) {return atomlist;}
           var atomlist1 = atomlist.trim().split(/[ ,]+/);
           //var xyzdat = jmvar("data({1.1},\"xyz\")");
           var xyzdat = jmvar("data({thisModel},\"xyz\")");
           var xyz = xyzdat.trim().split("\n");
           var nion = xyz.length;
           var symb = []
           var newlist = ''
           var line,i,k,x,nion,line,y,istart,iend,istride;
           for (i=0; i<nion; ++i) {
              line = xyz[i].trim().split(/[ ,]+/);
              symb.push(line[0]);
           }
           for (k=0; k<atomlist1.length; ++k) {
              x = atomlist1[k];
              if (isPositiveInteger(x)) {
                 newlist += x + " ";
              } else {
                 for (i=0; i<nion; ++i) {
                    if (symb[i]==x) {
                       newlist += (i+1).toString() + " ";
                    }
                 }
              }
           }
           return newlist;
        }

        function expand_atomlist(atomlist) {
           var atomlist1 = atomlist.trim().split(/[ ,]+/);
           //var xyzdat = jmvar("data({1.1},\"xyz\")");
           var xyzdat = jmvar("data({thisModel},\"xyz\")");
           var xyz = xyzdat.trim().split("\n");
           var nion = xyz.length;
           var symb = []
           var newlist = ''
           var line,i,k,x,nion,line,y,istart,iend,istride;
           for (i=0; i<nion; ++i) {
              line = xyz[i].trim().split(/[ ,]+/);
              symb.push(line[0]);
           }
           for (k=0; k<atomlist1.length; ++k) {
              x = atomlist1[k];
              if (isPositiveInteger(x)) {
                 newlist += x + " ";
              } else if (x.includes(":")) {
                 y = x.split(":");
                 istart = parseInt(y[0]);
                 iend   = parseInt(y[1]);
                 istride = 1;
                 if (y.length>2) {
                    istride= parseInt(y[2]);
                 } 
                 for (i=istart; i<=iend; i+=istride) {
                    newlist += i.toString() + " ";
                 }
              } else {
                 for (i=0; i<nion; ++i) {
                    if (symb[i]==x) {
                       newlist += (i+1).toString() + " ";
                    }
                 }
              }
           }
           return newlist;
        }


        function reset_color_penalty(atominfo,alist,ctype,pena,penb,penc) {
           //var atomlist = expand_atomlist(document.getElementById(alist).value).trim();
           var atomlist   = document.getElementById(alist).value.trim();
           if (atomlist.length>0) {
              var atomlistarray = atomlist.split(/[ ,]+/);
              var x = "";
              for (var i=0; i<atomlistarray.length; ++i) {
                 var indx = -1;
                 for (var j=0; j<atominfo.length; ++j) {
                    if (parseInt(atomlistarray[i])==(atominfo[j].atomIndex+1)) {
                       indx = j+1;
                    }
                 }
                 if (indx!=-1) {
                    x += " " + indx.toString();
                 }
                 console.log("x=",x," i=",i," indx=",indx);
              }
              document.getElementById(alist).value = x;
              //!if (x.length>0) {
              //   set_color_penalty(alist,ctype,pena,penb,penc);
              //}
           }
        }

        function set_color_penalty(alist,ctype,pena,penb,penc) {
           var atomlist1 = expand_atomlist(document.getElementById(alist).value).trim().split(/[ ,]+/);
           var color1    = document.getElementById(ctype).value;
           var penalty1a  = document.getElementById(pena).value;
           var penalty1b  = document.getElementById(penb).value;
           var penalty1c  = document.getElementById(penc).value;

           if (penalty1a.includes("polyhedra")) {
              jms0("delete $" + alist + "*;");
              set_polyhedra(alist,ctype,pena,penb,penc);
           } else {
              for (var i=0; i<atomlist1.length; ++i) {
                 jms0("select atomno="+atomlist1[i]+"; color " +color1 + ";");
              }
           }
        }
        function supercell_atomlist_color_penalty(alist,ctype,pena,penb,penc,nion,n1,n2,n3) {
           var ii,kk,newatomlist1;
           //var atomlist1 = expand_atomlist(document.getElementById(alist).value).trim();
           var atomlist1 = document.getElementById(alist).value.trim();
           console.log("atomlist1=",alist," : ", atomlist1,"  -- ",atomlist1.length);
           if (atomlist1.length>0) {
              atomlist1 = atomlist1.split(/[ ,]+/);
              console.log("atomlist1=",atomlist1.length);
              newatomlist1 = '';
              for (var i=0; i<atomlist1.length; ++i) {
                 if (isPositiveInteger(atomlist1[i])) { 
                    ii = parseInt(atomlist1[i]);
                    for (var j=0; j<(n1*n2*n3); ++j) {
                       kk = ii + j*nion;
                       newatomlist1 += kk.toString() + " ";
                    }
                 } else {
                    newatomlist1 += atomlist1[i] + " ";
                 }
              }
              document.getElementById(alist).value = newatomlist1.trim();
              set_color_penalty(alist,ctype,pena,penb,penc);
           }
        }

        function set_polyhedra(alist,ctype,pena,penb,penc) {
           var atomlist1 = expand_atomlist(document.getElementById(alist).value).trim().split(/[ ,]+/);
           console.log("ATOMlist1=",atomlist1);
           var color1    = document.getElementById(ctype).value;
           var penalty1a  = document.getElementById(pena).value;
           var penalty1b  = document.getElementById(penb).value;
           var penalty1c  = document.getElementById(penc).value;
           var num_neighbors = parseInt(penalty1c);

           var ucell = jmsfetchucell();
           //var xyzdat = jmvar("data({1.1},\"xyz\")");
           var xyzdat = jmvar("data({thisModel},\"xyz\")");
           var xyz = xyzdat.trim().split("\n");
           var nion = xyz.length;
           var symb = []
           var rion = []
           var line,x,y,z,i,j,ii,xcm,ycm,zcm,dist2,dist2b,r2,tstr,it;
           var n,r,i1,i2,i3;
           var tcount = 0;
           for (i=0; i<nion; ++i) {
              line = xyz[i].trim().split(/[ ,]+/);
              x = parseFloat(line[1]);
              y = parseFloat(line[2]);
              z = parseFloat(line[3]);
              symb.push(line[0]);
              rion.push(x);
              rion.push(y);
              rion.push(z);
           }
           
           console.log("atomlist1=",atomlist1);
           console.log("ucell=",ucell);
           console.log("xyzdat=",xyzdat);
           console.log("num_neighbbors=",num_neighbors);
           var istart = -1;
           var iend   =  1;
           var vol = a1a2a3_to_volume(ucell[1],ucell[2],ucell[3]);
           console.log("vol=",vol);
           if (vol<2.0) {
              istart = 0;
              iend   =  0;
           }
           console.log("rion=",rion);

           tstr = "";
           for (i=0; i<atomlist1.length; ++i) {
              j = parseInt(atomlist1[i])-1;
              console.log("i=",i,"  j=",j);
              xcm = rion[3*j];
              ycm = rion[3*j+1];
              zcm = rion[3*j+2];
              console.log("rcm=",xcm,ycm,zcm);
              
              dist2 =[];
              for (ii=0; ii<nion; ++ii) {
                 if ((!symb[ii].includes("H")) && (ii!=i)) {
                    for (i3=istart; i3<=iend; ++i3) {
                    for (i2=istart; i2<=iend; ++i2) {
                    for (i1=istart; i1<=iend; ++i1) {
                       x = rion[3*ii]   + i1*ucell[1][0] + i2*ucell[2][0] + i3*ucell[3][0];
                       y = rion[3*ii+1] + i1*ucell[1][1] + i2*ucell[2][1] + i3*ucell[3][1];
                       z = rion[3*ii+2] + i1*ucell[1][2] + i2*ucell[2][2] + i3*ucell[3][2];
                       r2 = (x-xcm)*(x-xcm) + (y-ycm)*(y-ycm) + (z-zcm)*(z-zcm);
                       r = Math.sqrt(r2);
                       n  = [(x-xcm)/r,(y-ycm)/r,(z-zcm)/r];
                       dist2.push([r2,ii,n,[x,y,z]]);
                    }}}
                 }
              }
              dist2.sort((a,b) => (a[0] > b[0]) ? 1 : -1);
              dist2b = dist2.slice(0,num_neighbors+1);
              console.log("dist2=",dist2);
              console.log("dist2b=",dist2b);
              triangles = generate_triangles(dist2b);

              console.log("triangles=",triangles);

              for (it=0; it<triangles.length; ++it) {
                 tstr += "draw ID " + alist + tcount.toString() + " polygon 3";
                 tstr += " {" + triangles[it][0][0].toString() + " "; 
                 tstr +=        triangles[it][0][1].toString() + " "; 
                 tstr +=        triangles[it][0][2].toString() + "} "; 
                 tstr += " {" + triangles[it][1][0].toString() + " "; 
                 tstr +=        triangles[it][1][1].toString() + " "; 
                 tstr +=        triangles[it][1][2].toString() + "} "; 
                 tstr += " {" + triangles[it][2][0].toString() + " "; 
                 tstr +=        triangles[it][2][1].toString() + " "; 
                 tstr +=        triangles[it][2][2].toString() + "} "; 
                 tstr += "  mesh " + color1 + "; ";
                 tcount += 1;
              }
           }
           if (tstr.length>1) { jms0(tstr);}
        }

        function generate_triangles(dist2) {
           var triangles = [];
           var num_neighbors = dist2.length;
           for (var i=0; i<num_neighbors; ++i) {
              for (var j=i+1; j<num_neighbors; ++j) {
                 for (var k=j+1; k<num_neighbors; ++k) {
                    vol = a1a2a3_to_volume(dist2[i][2],dist2[j][2],dist2[k][2]);
                    console.log("i,j,k,vol=",i,j,k,vol);
                    if (vol>0.4) {
                       triangles.push([dist2[i][3],dist2[j][3],dist2[k][3]]);
                    }
                 }
              }
           }
           return triangles;
        }

        function gen_spin_penalty(alist,pena,penb,penc) {
           var atominfo = jmarray("atomInfo");
           var atomlist = expand_atomlist(document.getElementById(alist).value).trim();
           var penaltya = document.getElementById(pena).value.trim();
           var penaltyb = document.getElementById(penb).value.trim();
           var penaltyc = document.getElementById(penc).value.trim();
           var x = "";
           if (atomlist.length>0) {
              var atomlistarray = atomlist.split(/\s+/);
              if (penaltya.includes("up") || penaltya.includes("down")) {
                 x += "   pspspin " + penaltya + " " + penaltyb + " " + penaltyc.toString() + " " + atomlist + "\n";
              }
           }
           return x;
        }



        function set_color_reaction(indx) {
           var colorlist = ['[xF75444]','[xF3C04E]','[xC3F058]','[x6FED62]','[x6BEAAC]','[x74D9E7]'];
           jms("select all; color cpk;");
           for (var i=0; i<indx.length; ++i) {
              jms("select atomno="+indx[i]+"; color translucent cpk;");
           }
        }

        function gen_reactions1(callback) {
           //var arrows_post_url = "https://arrows.emsl.pnnl.gov/api/upload/";
           //var arrows_get_url  = "https://arrows.emsl.pnnl.gov/api/genhash/";
           var arrows_post_url = '{{ arrows_api }}upload/';
           var arrows_get_url  = '{{ arrows_api }}genhash/';
           var mol = exMod().replace('{','').replace('}','');
           var reaction_hash0 = document.getElementById("reaction_hash").value;
           var mollist = mol.split("\n");
           mollist[2] = "reaction_hash{" + reaction_hash0 + "}";
           mol =  mollist.join("\n");
           if (reaction_hash0.trim().length>6) {
              document.getElementById('apirunning').value += "+ running gen_reactions1\n";
              document.getElementById('runmebanner4p').innerHTML= "Searching for reactions (may be slow!)";
              var textToSaveAsBlob = new Blob([mol], {type:"text/plain"});
              var textToSaveAsURL  = window.URL.createObjectURL(textToSaveAsBlob);

              var ii = Math.floor(Math.random() * 1000) + 1;
              var filenameguess = "nwchem-" + ii +".mol";
              var fileNameToSaveAs =  filenameguess;

              var formD = new FormData();
              formD.append('file', textToSaveAsBlob,fileNameToSaveAs);
              formD.append('title', fileNameToSaveAs);

              document.getElementById("reaction_hash2").value = "Processing request";
              document.getElementById('runmebanner4').innerHTML= "Processing request";
              set_color_reaction([]);
              var xhr = new XMLHttpRequest();
              xhr.open("POST", arrows_post_url, true);
              xhr.send(formD);
              sleep(2000.0);

              var request = new XMLHttpRequest();
              request.onreadystatechange = function() {
                 if (request.readyState == 4 && request.status == 200) {
                    var textFromUrl = request.responseText;
                    document.getElementById('runmebanner4').innerHTML= "";
                    document.getElementById("reaction_hash2").value = textFromUrl + "\n";
                    document.getElementById("reaction_type").value = textFromUrl.split("\n")[0];
                    var rlist = eval(textFromUrl.split("\n")[1]);
                    if (rlist.length>0) {
                       var irxn = rlist[0][0];
                       var grxn = rlist[0][2];
                       document.getElementById("reaction_gamma").value = grxn.toFixed(6);
                       //document.getElementById("umbrella_gamma").value = grxn.toFixed(1);
                       document.getElementById("reaction_indexes").value = irxn.join(" ");
                       set_color_reaction(irxn);
                       for (var j=0; j<rlist.length; ++j) {
                          document.getElementById("reaction_hash2").value += "reaction "+(j+1)+": \n";
                          document.getElementById("reaction_hash2").value += "   reaction_indexes = " + rlist[j][0].join(" ") + "\n";
                          document.getElementById("reaction_hash2").value += "   transition state=" + rlist[j][1].join("-") + "\n";
                          document.getElementById("reaction_hash2").value += "   reaction_gamma=" + rlist[j][2] + "\n";
                          document.getElementById("reaction_hash2").value += "   reaction_type = " + rlist[j][5] + "\n";
                          document.getElementById("reaction_hash2").value += "   redges=" + JSON.stringify(rlist[j][3]) + "\n";
                          document.getElementById("reaction_hash2").value += "   pedges=" + JSON.stringify(rlist[j][4]) + "\n\n";
                       }

                       document.getElementById("reaction_bondings").value = "spring  bondings K gamma ";
                       for (var j=0; j<rlist[0][3].length; ++j) {
                          document.getElementById("reaction_bondings").value += "1.0 " + rlist[0][0][rlist[0][3][j][0]-1].toString() + " " +
                                                                                         rlist[0][0][rlist[0][3][j][1]-1].toString() + " " ;
                       }
                       for (var j=0; j<rlist[0][4].length; ++j) {
                          document.getElementById("reaction_bondings").value += "-1.0 " + rlist[0][0][rlist[0][4][j][0]-1].toString() + " " +
                                                                                          rlist[0][0][rlist[0][4][j][1]-1].toString() + " " ;
                       }
                       document.getElementById("reaction_bondings").value += "\n\n";
                       document.getElementById("reaction_bondings").value += "reaction_type = " + rlist[0][5] + "\n";
                       document.getElementById("reaction_bondings").value += "reaction_indexes = " + rlist[0][0].join(" ") + "\n";
                       document.getElementById('runmebanner4p').innerHTML= "";
                       document.getElementById('apirunning').value = document.getElementById('apirunning').value.replace("+ running gen_reactions1\n","");
                       callback("gen_reactions1");
                    }
                  }
              };
              request.open('GET', arrows_get_url+fileNameToSaveAs, true);
              request.send();
           } else {
             document.getElementById('runmebanner4').innerHTML= "The reaction_hash is not defined!";
           }
        }


        // *****************************************
        // *                                       *
        // *              check_rgamma             *
        // *                                       *
        // ***************************************** 
        //
        // Calculate the bondings gamma for the reaction tab. This function should probably be simplified by
        // defining some generic functions that could be used by other functions
        //
        function check_rgamma() {
           var reaction_type0    = document.getElementById("reaction_type").value.trim();
           var reaction_indexes0 = document.getElementById("reaction_indexes").value.trim();
           var bondings          = document.getElementById("reaction_bondings").value;
           console.log("HERA");

           if ((bondings.contains("reaction_type =")) && (bondings.contains("reaction_indexes ="))) {
              console.log("HERB");
              var reaction_type    = bondings.split("reaction_type =")[1].split("\n")[0].trim();
              var reaction_indexes = bondings.split("reaction_indexes =")[1].split("\n")[0].trim();
              if ((reaction_type==reaction_type0) && (reaction_indexes==reaction_indexes0)) {
                 var xyz = exModXYZ();
                 var nion = parseInt(xyz.split("\n")[0].trim());
                 var lats = xyz.split("\n")[1].trim().split(/[ ,]+/);
                 console.log(" LATS=",lats);
                 var a1,a2,a3;
                 if (lats.length>8) {
                    a1 = [parseFloat(lats[0])/0.529177, parseFloat(lats[1])/0.529177, parseFloat(lats[2])/0.529177];
                    a2 = [parseFloat(lats[3])/0.529177, parseFloat(lats[4])/0.529177, parseFloat(lats[5])/0.529177];
                    a3 = [parseFloat(lats[6])/0.529177, parseFloat(lats[7])/0.529177, parseFloat(lats[8])/0.529177];
                 } else {
                    a1 = [1000.0, 0.0, 0.0];
                    a2 = [0.0, 1000.0, 0.0];
                    a3 = [0.0, 0.0, 1000.0];
                 }
                 var [b1,b2,b3] = a1a2a3_to_b1b2b3(a1,a2,a3);
                 var xyzs = xyz.split("\n").slice(2,nion+2);
                 var atom = [];
                 for (ii=0; ii<nion; ++ii) {
                    var x = xyzs[ii].trim().split(/[ ,]+/);
                    atom.push([parseFloat(x[1])/0.529177,parseFloat(x[2])/0.529177,parseFloat(x[3])/0.529177]);
                 }
                 console.log(" xyz=",xyz);
                 console.log(" atoms=",atom);
                 if (bondings.contains("spring  bondings K gamma")) {
                    var index1 = bondings.split("spring  bondings K gamma")[1].split("\n")[0].trim().split(/[ ,]+/);
                    var nb = index1.length/3;
                    var z,r,i,ii,jj,x1,y1,z1,r1;
                    z = 0.0;
                    for (i=0; i<nb; ++i) {
                       r  = parseFloat(index1[3*i]);
                       ii = parseInt(index1[3*i+1]);
                       jj = parseInt(index1[3*i+2]);
                       console.log("  - r,ii,jj=",r,ii,jj);
                       if (!(isNaN(ii) || isNaN(jj) || isNaN(r))) {
                          ii -= 1; jj -= 1;
                          x1 = (atom[jj][0]-atom[ii][0]);
                          y1 = (atom[jj][1]-atom[ii][1]);
                          z1 = (atom[jj][2]-atom[ii][2]);
                          [x1,y1,z1]  = lattice_min(a1,a2,a3,b1,b2,b3,x1,y1,z1);
                          r1  = Math.sqrt(x1*x1 + y1*y1 + z1*z1);
                          z += r*r1;
                          console.log("  - r,ii,jj,r1,z=",r,ii,jj,r1,z);
                       }
                    }
                    document.getElementById("reaction_gamma").value = z.toFixed(6);
                    //document.getElementById("umbrella_gamma").value = z.toFixed(1);

                    if (z < document.getElementById("min_reaction_gamma").value) {
                       document.getElementById("min_reaction_gamma").value = z.toFixed(4);
                    }
                    if (z > document.getElementById("max_reaction_gamma").value) {
                       document.getElementById("max_reaction_gamma").value = z.toFixed(4);
                    }
                 }
              }
           }
        }

        // *****************************************
        // *                                       *
        // *          calculate_rgamma             *
        // *                                       *
        // ***************************************** 
        //
        function calculate_rgamma(xyzcell0) {
           var reaction_type0    = document.getElementById("reaction_type").value.trim();
           var reaction_indexes0 = document.getElementById("reaction_indexes").value.trim();
           var bondings          = document.getElementById("reaction_bondings").value;
           var z = -9.9e9

           if ((bondings.contains("reaction_type =")) && (bondings.contains("reaction_indexes ="))) {
              console.log("HERB");
              var reaction_type    = bondings.split("reaction_type =")[1].split("\n")[0].trim();
              var reaction_indexes = bondings.split("reaction_indexes =")[1].split("\n")[0].trim();
              if ((reaction_type==reaction_type0) && (reaction_indexes==reaction_indexes0)) {
                 var xyz = xyzcell0[0];
                 var nion = parseInt(xyz.split("\n")[0].trim());


                 var a1 = string3_to_vec3(xyzcell0[1]); a1[0] /= 0.529177; a1[1] /= 0.529177; a1[2] /= 0.529177;
                 var a2 = string3_to_vec3(xyzcell0[2]); a2[0] /= 0.529177; a2[1] /= 0.529177; a2[2] /= 0.529177;
                 var a3 = string3_to_vec3(xyzcell0[3]); a3[0] /= 0.529177; a3[1] /= 0.529177; a3[2] /= 0.529177;
                 var [b1,b2,b3] = a1a2a3_to_b1b2b3(a1,a2,a3);
                 var xyzs = xyz.split("\n").slice(2,nion+2);
                 var atom = [];
                 for (ii=0; ii<nion; ++ii) {
                    var x = xyzs[ii].trim().split(/[ ,]+/);
                    atom.push([parseFloat(x[1])/0.529177,parseFloat(x[2])/0.529177,parseFloat(x[3])/0.529177]);
                 }

                 if (bondings.contains("spring  bondings K gamma")) {
                    var index1 = bondings.split("spring  bondings K gamma")[1].split("\n")[0].trim().split(/[ ,]+/);
                    console.log("HERC, index1=",index1);
                    var nb = index1.length/3;
                    var r,i,ii,jj,x1,y1,z1,r1;
                    z = 0.0;
                    for (i=0; i<nb; ++i) {
                       r  = parseFloat(index1[3*i]);
                       ii = parseInt(index1[3*i+1]);
                       jj = parseInt(index1[3*i+2]);
                       console.log("  - r,ii,jj=",r,ii,jj);
                       if (!(isNaN(ii) || isNaN(jj) || isNaN(r))) {
                          ii -= 1; jj -= 1;
                          x1 = (atom[jj][0]-atom[ii][0]);
                          y1 = (atom[jj][1]-atom[ii][1]);
                          z1 = (atom[jj][2]-atom[ii][2]);
                          [x1,y1,z1]  = lattice_min(a1,a2,a3,b1,b2,b3,x1,y1,z1);
                          r1  = Math.sqrt(x1*x1 + y1*y1 + z1*z1);
                          z += r*r1;
                          console.log("  - r,ii,jj,r1,z=",r,ii,jj,r1,z);
                       }
                    }
                 }
              }
           }
           return z;
        }


        function gen_rhash1(callback) {
           //var arrows_post_url = "https://arrows.emsl.pnnl.gov/api/upload/";
           //var arrows_get_url  = "https://arrows.emsl.pnnl.gov/api/genhash/";
           var arrows_post_url = '{{ arrows_api }}upload/';
           var arrows_get_url  = '{{ arrows_api }}genhash/';

           var reaction_type = document.getElementById("reaction_type").value;
           var reaction_indexes = document.getElementById("reaction_indexes").value;
           var cellon = document.getElementById("showcell").value == "Unit cell off";

           var mol,molist;
           if (cellon) {
              mol = exModXYZ().replace('{','').replace('}','');
              mollist = mol.split("\n");
              mollist[1]  += " reaction_genhash reaction_type{" + reaction_type + "} reaction_indexes{" + reaction_indexes + "}";
           } else {
              mol     = exMod().replace('{','').replace('}','');
              mollist = mol.split("\n");
              mollist[2]  = "reaction_genhash reaction_type{" + reaction_type + "} reaction_indexes{" + reaction_indexes + "}";
           }
           mol =  mollist.join("\n");
           if ((reaction_type!="None") && (reaction_indexes.trim().length>2)) {
              document.getElementById('apirunning').value += "+ running geh_rhash1\n";
              document.getElementById('runmebanner4p').innerHTML= "Generating reaction_hash";
              var textToSaveAsBlob = new Blob([mol], {type:"text/plain"});
              var textToSaveAsURL  = window.URL.createObjectURL(textToSaveAsBlob);

              var ii = Math.floor(Math.random() * 1000) + 1;
              var filenameguess = "nwchem-" + ii +".mol";
              var fileNameToSaveAs =  filenameguess;

              var formD = new FormData();
              formD.append('file', textToSaveAsBlob,fileNameToSaveAs);
              formD.append('title', fileNameToSaveAs);

              document.getElementById("reaction_hash").value = "Processing request";
              set_color_reaction([]);
              var xhr = new XMLHttpRequest();
              xhr.open("POST", arrows_post_url, true);
              xhr.send(formD);
              sleep(2000.0);

              var request = new XMLHttpRequest();
              request.onreadystatechange = function() {
                 if (request.readyState == 4 && request.status == 200) {
                    var textFromUrl = request.responseText;
                    document.getElementById("reaction_hash").value = textFromUrl.split("rhash =")[1].split("\n")[0].trim();
                    document.getElementById("reaction_hash2").value = textFromUrl.split("reaction type =")[1].split("\n")[0].trim() + "\n";
                    document.getElementById("reaction_hash2").value += textFromUrl.split("reaction regular indexes=")[1].split("\n")[0].trim() + "\n\n";
                    var rlist = eval(textFromUrl.split("reaction regular indexes=")[1].split("\n")[0].trim())
                    var check_indexes  = document.getElementById("reaction_indexes").value.split(" ");
                    for (var i=0; i<rlist.length; ++i) {
                       var irxn = rlist[i][0];
                       var grxn = rlist[i][2];
                       var same = false;
                       if (irxn.length==check_indexes.length) {
                          same = true;
                          for (var j=0; j<irxn.length; ++j) {
                             if (irxn[j]!=check_indexes[j]) { same = false;}
                          }
                       }
                       if (same) { 
                          document.getElementById("reaction_gamma").value = grxn.toFixed(6);
                          //document.getElementById("umbrella_gamma").value = grxn.toFixed(1);
                       }
                       if (same) { set_color_reaction(check_indexes); }
                       if (same) {
                          document.getElementById("reaction_hash2").value += "reaction "+(i+1)+":\n";
                          document.getElementById("reaction_hash2").value += "   reaction_indexes = " + rlist[i][0].join(" ") + "\n";
                          document.getElementById("reaction_hash2").value += "   transition state=" + rlist[i][1].join("-") + "\n";
                          document.getElementById("reaction_hash2").value += "   reaction_gamma=" + rlist[i][2] + "\n";
                          document.getElementById("reaction_hash2").value += "   reaction_type = " + rlist[i][5] + "\n";
                          document.getElementById("reaction_hash2").value += "   redges=" + JSON.stringify(rlist[i][3]) + "\n";
                          document.getElementById("reaction_hash2").value += "   pedges=" + JSON.stringify(rlist[i][4]) + "\n\n";
                          document.getElementById("reaction_bondings").value = "spring  bondings K gamma ";
                          for (var j=0; j<rlist[i][3].length; ++j) {
                             document.getElementById("reaction_bondings").value += "1.0 " + rlist[i][0][rlist[i][3][j][0]-1].toString() + " " +
                                                                                            rlist[i][0][rlist[i][3][j][1]-1].toString() + " " ;
                          }
                          for (var j=0; j<rlist[i][4].length; ++j) {
                             document.getElementById("reaction_bondings").value += "-1.0 " + rlist[i][0][rlist[i][4][j][0]-1].toString() + " " +
                                                                                             rlist[i][0][rlist[i][4][j][1]-1].toString() + " " ;
                          }
                          document.getElementById("reaction_bondings").value += "\n\n";
                          document.getElementById("reaction_bondings").value += "reaction_type = " + rlist[i][5] + "\n";
                          document.getElementById("reaction_bondings").value += "reaction_indexes = " + rlist[i][0].join(" ") + "\n";
                          document.getElementById('runmebanner4p').innerHTML= "";
                          document.getElementById('apirunning').value = document.getElementById('apirunning').value.replace("+ running geh_rhash1\n","");
                          callback("gen_rhash1");
                       }
                    }
                  }
              };
              request.open('GET', arrows_get_url+fileNameToSaveAs, true);
              request.send();
           }
        }

        function gen_rhash2(callback) {
           //var arrows_post_url0 = "https://arrows.emsl.pnnl.gov/api/upload/";
           //var arrows_get_url  = "https://arrows.emsl.pnnl.gov/api/genhash/";
           //var arrows_post_url0 = '{{ arrows_api }}upload/';
           //var arrows_get_url  = '{{ arrows_api }}genhash/';
           var calc_url        = document.getElementById("arrows_url").value;
           var arrows_post_url0 = calc_url + 'upload/';
           var arrows_get_url   = calc_url + 'genhash/';



           var reaction = document.getElementById("reaction_genhash00").value;
           if (reaction.trim().length>5) {
              document.getElementById('apirunning').value += "+ running gen_rhash2\n";
              document.getElementById('runmebanner4p').innerHTML= "Generating reaction_hash from reaction";
              var rtypeindx = document.getElementById("reaction_type").selectedIndex
              var mol = "reaction_genhash{"+reaction+"}\n";
              if (rtypeindx>20) {
                 mol = "user_reaction_type{" + document.getElementById("reaction_type").value + "} " + mol
              }

              var textToSaveAsBlob = new Blob([mol], {type:"text/plain"});
              var textToSaveAsURL  = window.URL.createObjectURL(textToSaveAsBlob);

              var ii = Math.floor(Math.random() * 1000) + 1;
              var filenameguess = "nwchem-" + ii +".mol";
              var fileNameToSaveAs =  filenameguess;

              //console.log(fileNameToSaveAs);
              //console.log(mol);

              var formD = new FormData();
              formD.append('file', textToSaveAsBlob,fileNameToSaveAs);
              formD.append('title', fileNameToSaveAs);
              //console.log(formD);

              document.getElementById("reaction_hash").value = "Processing request";
              set_color_reaction([]);
              var xhr = new XMLHttpRequest();
              xhr.open("POST", arrows_post_url0, true);
              xhr.send(formD);
              sleep(2000.0);

              var request = new XMLHttpRequest();
              request.onreadystatechange = function() {
                 if (request.readyState == 4 && request.status == 200) {
                    var textFromUrl = request.responseText;
                    document.getElementById("reaction_hash").value = textFromUrl;
                    document.getElementById('runmebanner4p').innerHTML= "";
                    document.getElementById('apirunning').value = document.getElementById('apirunning').value.replace("+ running gen_rhash2\n","");
                    callback("gen_rhash2");
                  }
              };
              request.open('GET', arrows_get_url+fileNameToSaveAs, true);
              request.send();

           }
        }

        function gen_bondings() {
           console.log("In gen_bondings");
           //var arrows_post_url = "https://arrows.emsl.pnnl.gov/api/upload/";
           //var arrows_get_url  = "https://arrows.emsl.pnnl.gov/api/genhash/";
           //var arrows_post_url = '{{ arrows_api }}upload/';
           //var arrows_get_url  = '{{ arrows_api }}genhash/';
           var calc_url        = document.getElementById("arrows_url").value;
           var arrows_post_url = calc_url + 'upload/';
           var arrows_get_url  = calc_url + 'genhash/';
    

           var mol = exMod().replace('{','').replace('}','');
           var reaction_type    = document.getElementById("reaction_type").value;
           var reaction_indexes = document.getElementById("reaction_indexes").value;
           var mollist = mol.split("\n");
           mollist[2] = "generate_bonding reaction_type{" + reaction_type + "} reaction_indexes{" + reaction_indexes + "}";
           mol =  mollist.join("\n");
           if ((reaction_type!="None") && (reaction_indexes.trim().length>2)) {
              var textToSaveAsBlob = new Blob([mol], {type:"text/plain"});
              var textToSaveAsURL  = window.URL.createObjectURL(textToSaveAsBlob);

              var ii = Math.floor(Math.random() * 1000) + 1;
              var filenameguess = "nwchem-" + ii +".mol";
              var fileNameToSaveAs =  filenameguess;

              var formD = new FormData();
              formD.append('file', textToSaveAsBlob,fileNameToSaveAs);
              formD.append('title', fileNameToSaveAs);

              set_color_reaction([]);
              var xhr = new XMLHttpRequest();
              xhr.open("POST", arrows_post_url, true);
              xhr.send(formD);
              sleep(2000.0);

              document.getElementById("reaction_bondings").value = "Processing request";
              var request = new XMLHttpRequest();
              request.onreadystatechange = function() {
                 if (request.readyState == 4 && request.status == 200) {
                    var textFromUrl = request.responseText;
                    document.getElementById("reaction_bondings").value = "spring " + textFromUrl.split("spring")[1];
                    document.getElementById("reaction_bondings").value += "\n\n";
                    //document.getElementById("reaction_bondings").value += "reaction_type = " + rlist[i][5] + "\n";
                    //document.getElementById("reaction_bondings").value += "reaction_indexes = " + rlist[i][0].join(" ") + "\n";
                  }
              };
              request.open('GET', arrows_get_url+fileNameToSaveAs, true);
              request.send();
           }
        }

        function morph_xyzcells(alpha,xyzcell1,xyzcell2) {
           var nion1 = parseInt(xyzcell1[0].trim().split("\n")[0].trim());
           var nion2 = parseInt(xyzcell2[0].trim().split("\n")[0].trim());
           var xyzcell0 = xyzcell1;
           if (nion1==nion2) {
              var ss1,ss2;
              var a1=xyzcell1[1];
              var a2=xyzcell1[2];
              var a3=xyzcell1[3];
              var xyzlist1 = xyzcell1[0].trim().split("\n");
              var xyzlist2 = xyzcell2[0].trim().split("\n");
              var xyzdat = nion1.toString() + "\n\n";
              for (var i=0; i<nion1; ++i) {
                 ss1 = xyzlist1[i+2].split(/[ ,]+/);
                 ss2 = xyzlist2[i+2].split(/[ ,]+/);
                 vec3 = [(1.0-alpha)*parseFloat(ss1[1]) + alpha*parseFloat(ss2[1]),
                         (1.0-alpha)*parseFloat(ss1[2]) + alpha*parseFloat(ss2[2]),
                         (1.0-alpha)*parseFloat(ss1[3]) + alpha*parseFloat(ss2[3])];
                 xyzdat += ss1[0] + " " + vec3_to_string3(vec3) + "\n";
              }
              xyzcell0 = [xyzdat,a1,a2,a3];
           }
           return(xyzcell0);
        }

        // **********************************
        // *                                *
        // *      xyzcell_Robinson          *
        // *                                *
        // **********************************
        function xyzcell_Robinson(xyzcell) {
           console.log("Inside xyzcell_Robison");
           var i,x,y,z,line,r;

           var xyzlines = xyzcell[0].trim().split("\n");
           var nion     = parseInt(xyzlines[0].trim())
           var a1 = string3_to_vec3(xyzcell[1]);
           var a2 = string3_to_vec3(xyzcell[2]);
           var a3 = string3_to_vec3(xyzcell[3]);

           var symb = [];
           var rion = [];
           for (i=0; i<nion; ++i) {
              line = xyzlines[i+2].trim().split(/[ ,]+/);
              x = parseFloat(line[1]);
              y = parseFloat(line[2]);
              z = parseFloat(line[3]);
              symb.push(line[0]);
              rion.push(x);
              rion.push(y);
              rion.push(z);
           }


           var mindist,delta,coser,siner,cosed,sined,rt;
           var it=0;
           var isbad = true;
           var min_h_h = 0.70;
           var min_x_h = 0.90;
           var min_x_x = 1.18;
           while ((isbad) && (it<10)) {
              isbad = false; it += 1;

              for (i=0; i<(nion-1); ++i) {
                 for (j=i+1; j<nion; ++j) {
                    x = rion[3*i]   - rion[3*j];
                    y = rion[3*i+1] - rion[3*j+1];
                    z = rion[3*i+2] - rion[3*j+2];
                    r = Math.sqrt(x*x + y*y + z*z);
                    if ((symb[i]=="H") && (symb[j]=="H")) {
                      mindist = min_h_h;
                    } else if ((symb[i]=="H") || (symb[j]=="H")) {
                      mindist = min_x_h;
                    } else {
                      mindist = min_x_x;
                    }
                    if (it<=2) {
                       delta = mindist/3.0;
                    } else if (it<=4) {
                       delta = mindist/2.0;
                    } else {
                       delta = mindist/1.5;
                    }


                    if (r < mindist) {
                       if (delta>(mindist-r)) {delta=mindist-r;}
                       console.log("Robinson: it,i,j,mindist,delta,r=",it,i,j,mindist,delta,r);
                       isbad = true;
                       if (r<0.0001) {
                          if (rion[3*i]>rion[3*j])     {rion[3*i]   += 0.001; } else {rion[3*i]   -= 0.001;}
                          if (rion[3*i+1]>rion[3*j+1]) {rion[3*i+1] += 0.001; } else {rion[3*i+1] -= 0.001;}
                          if (rion[3*i+2]>rion[3*j+2]) {rion[3*i+2] += 0.001; } else {rion[3*i+2] -= 0.001;}
                       } else {
                          siner = (rion[3*i+2] - rion[3*j+2])/r;
                          coser = Math.sqrt(1.0-siner*siner);
                          if (coser<1.0e-8) {
                             cosed = 0.0;  
                             sined = 0.0;
                          } else {
                             cosed = (rion[3*i]   - rion[3*j])  /(r*coser);
                             sined = (rion[3*i+1] - rion[3*j+1])/(r*coser);
                          }
                          rion[3*i]   += (delta*coser)*cosed;
                          rion[3*i+1] += (delta*coser)*sined;
                          rion[3*i+2] += delta*siner;
                       }
                    }
                 }
              }

           }

           var xyzdat = nion.toString() + "\n\n";
           for (i=0; i<nion; ++i) {
              xyzdat += symb[i] + " " + rion[3*i].toFixed(6) + " " + rion[3*i+1].toFixed(6) + " " + rion[3*i+2].toFixed(6) + "\n";
           }

           return([xyzdat,xyzcell[1],xyzcell[2],xyzcell[3]]);

        }


        // **********************************
        // *                                *
        // *         gen_morph12            *
        // *                                *
        // **********************************
        function gen_morph12() {
           var m1    = document.getElementById("reaction_model1").value - 1;
           var m2    = document.getElementById("reaction_model2").value - 1;
           var alpha = document.getElementById("reaction_morph12").value;
           var xyzcell1 = window.xyzframes[m1];
           var xyzcell2 = window.xyzframes[m2];

           console.log("xyzcell1=",xyzcell1[0]);
           var nion1 = parseInt(xyzcell1[0].trim().split("\n")[0].trim());
           var nion2 = parseInt(xyzcell2[0].trim().split("\n")[0].trim());
           console.log("nion1=",nion1, " nion2=",nion2);
           
           if (nion1==nion2) {
              var ss1,ss2
              var a1=xyzcell1[1];
              var a2=xyzcell1[2];
              var a3=xyzcell1[3];
              var xyzlist1 = xyzcell1[0].trim().split("\n");
              var xyzlist2 = xyzcell2[0].trim().split("\n");
              var xyzdat = nion1.toString() + "\n\n";
              for (var i=0; i<nion1; ++i) {
                 ss1 = xyzlist1[i+2].split(/[ ,]+/);
                 ss2 = xyzlist2[i+2].split(/[ ,]+/);
                 vec3 = [(1.0-alpha)*parseFloat(ss1[1]) + alpha*parseFloat(ss2[1]),
                         (1.0-alpha)*parseFloat(ss1[2]) + alpha*parseFloat(ss2[2]),
                         (1.0-alpha)*parseFloat(ss1[3]) + alpha*parseFloat(ss2[3])];
                 xyzdat += ss1[0] + " " + vec3_to_string3(vec3) + "\n";
              }
              addxyzcell2frame([xyzdat,a1,a2,a3]);
           }
        }

        // **********************************
        // *                                *
        // *      gen_reaction_path         *
        // *                                *
        // **********************************
        function gen_reaction_path() {
           //var arrows_post_url = 'https://arrows.emsl.pnnl.gov/api/upload/';
           //var arrows_get_url  = 'https://arrows.emsl.pnnl.gov/api/molecular_calculation/';
           //var arrows_post_url = '{{ arrows_api }}upload/';
           //var arrows_get_url  = '{{ arrows_api }}molecular_calculation/';
           var calc_url        = document.getElementById("arrows_url").value;
           var arrows_post_url = calc_url + 'upload/';
           var arrows_get_url  = calc_url + 'molecular_calculation/';

           var bondings = document.getElementById("reaction_bondings").value
           console.log("bondings=",bondings);
           //var xyzdat = jmvar("data({1.1},\"xyz\")");
           var xyzdat = jmvar("data({thisModel},\"xyz\")");
           var nion = xyzdat.trim().split("\n").length;
           xyzdat = nion + "\n\n" + xyzdat;
           var a1 = document.getElementById("lattice_a1").value;
           var a2 = document.getElementById("lattice_a2").value;
           var a3 = document.getElementById("lattice_a3").value;
           var xyzcell = [xyzdat,a1,a2,a3];
           console.log("xyzcell=",xyzcell[0]);
           if (bondings.contains("spring  bondings K gamma")) {
              document.getElementById('apirunning').value += "+ running gen_reaction_path\n";
              document.getElementById('runmebanner4p').innerHTML= "Generating reaction path";
              loadframe2jsmol(false,false,0);
              var jjj = bondings.split("spring  bondings K gamma")[1].split("\n")[0].trim().split(/[ ,]+/);
              var nb = jjj.length/3;
              console.log("jjj=",jjj);

              var bstring = "\"(";
              bstring += "[";
                  for (var b=0; b<nb; ++b) {
                     var s = parseFloat(jjj[3*b]);
                     if (s>0.0) {
                        bstring += "("+jjj[3*b+1] + "," + jjj[3*b+2] + ",1)";
                     } else if (s<0.0) {
                        bstring += "("+jjj[3*b+1] + "," + jjj[3*b+2] + ",0)";
                     }
                     if (b<(nb-1)) { bstring += ",";}
                  }
              bstring += "],";

              bstring += "[";
                  for (var b=0; b<nb; ++b) {
                     bstring += "("+jjj[3*b+1] + "," + jjj[3*b+2] + ",1)";
                     if (b<(nb-1)) { bstring += ",";}
                  }
              bstring += "],";

              bstring += "[";
                  for (var b=0; b<nb; ++b) {
                     var s = parseFloat(jjj[3*b]);
                     if (s>0.0) {
                        bstring += "("+jjj[3*b+1] + "," + jjj[3*b+2] + ",0)";
                     } else if (s<0.0) {
                        bstring += "("+jjj[3*b+1] + "," + jjj[3*b+2] + ",1)";
                     }
                     if (b<(nb-1)) { bstring += ",";}
                  }
              bstring += "])\"";
              surface_atoms = document.getElementById("bulk_atoms").value.trim();

              console.log("bstring =",bstring);
              var textToSave = "input.xyz:\n" + xyzdat + ":input.xyz\n";
              textToSave    += "bstring:" + bstring + ":bstring\n";
              if (surface_atoms.length>0) {
                 textToSave += "calculation: uff-surface :calculation\n";
                 textToSave += "bondings: " + bondings.split("spring  bondings K gamma")[1].split("\n")[0].trim() + ":bondings\n";
                 textToSave += "surface: " + surface_atoms + " :surface\n";
              } else {
                 textToSave    += "calculation: uff-path :calculation\n";
              }
              console.log("chemdb_molcalc input:" + textToSave);

              var ii = Math.floor(Math.random() * 1000) + 1;
              var filenameguess = "nwchem-" + ii +".nw";
              var fileNameToSaveAs =  filenameguess

              var textToSaveAsBlob = new Blob([textToSave], {type:"text/plain"});
              var textToSaveAsURL  = window.URL.createObjectURL(textToSaveAsBlob);

              var formD = new FormData();
              formD.append('file', textToSaveAsBlob,fileNameToSaveAs);
              formD.append('title', fileNameToSaveAs);
              console.log("FORMD=",formD);

              var xhr = new XMLHttpRequest();
              xhr.open("POST", arrows_post_url, true);
              xhr.onload = function (e) {
                 if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                      console.log("  - post response:" +xhr.responseText);
                     }
                  }
              };
              xhr.onerror = function (e) {
                 console.error(xhr.statusText);
              };
              xhr.send(formD);

              var ajax = new XMLHttpRequest();
              ajax.open('GET', arrows_get_url+fileNameToSaveAs, true);
              ajax.onload = function (e) {
                if (ajax.readyState === 4) {
                  if (ajax.status === 200) {
                    var textFromUrl = ajax.responseText;
                    console.log(textFromUrl);
                    document.getElementById('runmebanner4b').innerHTML= "Calculation Finished!";
                    console.log("textFromUrl=",textFromUrl);
                    var path = textFromUrl.split("final_path.xyz:")[1].split(":final_path.xyz")[0].trim();
                    var xyzcell1 = [path.split("\n").slice(0*(nion+2),1*(nion+2)).join("\n"),a1,a2,a3];
                    var xyzcell2 = [path.split("\n").slice(1*(nion+2),2*(nion+2)).join("\n"),a1,a2,a3];
                    var xyzcell3 = [path.split("\n").slice(2*(nion+2),3*(nion+2)).join("\n"),a1,a2,a3];

                    var npath = document.getElementById("reaction_npath").value;
                    if (npath<3) { npath=3; }
                    var nm1 = (npath-3)/2;
                    var nm2 = (npath-3)-nm1;

                    window.xyzframes_ntotal += 1;
                    window.xyzframes.push(xyzcell1);
                    window.xyzframes_cur =  window.xyzframes_ntotal - 1;

                    for (var m=0; m<nm1; ++m) {
                       var alpha = (1.0/(nm1+1.0)) * (m+1);
                       var xyzcell0 = xyzcell_Robinson(morph_xyzcells(alpha,xyzcell1,xyzcell2));
                       window.xyzframes_ntotal += 1;
                       window.xyzframes.push(xyzcell0);
                       window.xyzframes_cur =  window.xyzframes_ntotal - 1;
                    }

                    window.xyzframes_ntotal += 1;
                    window.xyzframes.push(xyzcell2);
                    window.xyzframes_cur =  window.xyzframes_ntotal - 1;

                    for (var m=0; m<nm2; ++m) {
                       var alpha = (1.0/(nm2+1.0)) * (m+1);
                       var xyzcell0 = xyzcell_Robinson(morph_xyzcells(alpha,xyzcell2,xyzcell3));
                       window.xyzframes_ntotal += 1;
                       window.xyzframes.push(xyzcell0);
                       window.xyzframes_cur =  window.xyzframes_ntotal - 1;
                    }

                    addxyzcell2frame(xyzcell3);

                    console.log("nion:", nion);
                    console.log("PATH from Arrows:\n", path);
                    document.getElementById('runmebanner4p').innerHTML= "";
                    check_rgamma();
                    document.getElementById('apirunning').value = document.getElementById('apirunning').value.replace("+ running gen_reaction_path\n","");

                  } else {
                    console.error(ajax.statusText);
                    document.getElementById('runmebanner4b').innerHTML= ajax.statusText;
                  }
                }
              };
              ajax.onerror = function (e) {
                console.error(ajax.statusText);
                document.getElementById('runmebanner4b').innerHTML= ajax.statusText;
              };
              ajax.send();
           } 
        }
      

        function gen_reaction_path2() {
           var m1    = document.getElementById("reaction_model1").value - 1;
           var m2    = document.getElementById("reaction_model2").value - 1;
           var npath = document.getElementById("reaction_npath").value;
           var xyzcell1 = window.xyzframes[m1];
           var xyzcell2 = window.xyzframes[m2];

           console.log("xyzcell1=",xyzcell1[0]);
           var nion1 = parseInt(xyzcell1[0].trim().split("\n")[0].trim());
           var nion2 = parseInt(xyzcell2[0].trim().split("\n")[0].trim());
           console.log("nion1=",nion1, " nion2=",nion2);

           if (nion1==nion2) {
              var ss1,ss2
              var a1=xyzcell1[1];
              var a2=xyzcell1[2];
              var a3=xyzcell1[3];
              var xyzlist1 = xyzcell1[0].trim().split("\n");
              var xyzlist2 = xyzcell2[0].trim().split("\n");
              for (var p=0; p<npath; ++p) {
                 var alpha = p/(npath-1.0);
                 var xyzdat = nion1.toString() + "\n\n";
                 for (var i=0; i<nion1; ++i) {
                    ss1 = xyzlist1[i+2].split(/[ ,]+/);
                    ss2 = xyzlist2[i+2].split(/[ ,]+/);
                    vec3 = [(1.0-alpha)*parseFloat(ss1[1]) + alpha*parseFloat(ss2[1]),
                            (1.0-alpha)*parseFloat(ss1[2]) + alpha*parseFloat(ss2[2]),
                            (1.0-alpha)*parseFloat(ss1[3]) + alpha*parseFloat(ss2[3])];
                    xyzdat += ss1[0] + " " + vec3_to_string3(vec3) + "\n";
                 }
                 addxyzcell2frame([xyzdat,a1,a2,a3]);
              }
           }
        }


        // **********************************
        // *                                *
        // *      gen_wham_model            *
        // *                                *
        // **********************************
        function gen_wham_model(callback) {
           //var arrows_post_url = 'https://arrows.emsl.pnnl.gov/api/upload/';
           //var arrows_get_url  = 'https://arrows.emsl.pnnl.gov/api/molecular_calculation/';
           //var arrows_post_url = '{{ arrows_api }}upload/';
           //var arrows_get_url  = '{{ arrows_api }}molecular_calculation/';
           var calc_url        = document.getElementById("arrows_url").value;
           var arrows_post_url = calc_url + 'upload/';
           var arrows_get_url  = calc_url + 'molecular_calculation/';

           var bondings = document.getElementById("reaction_bondings").value
           console.log("bondings=",bondings);
           //var xyzdat = jmvar("data({1.1},\"xyz\")");
           var xyzdat = jmvar("data({thisModel},\"xyz\")");
           var nion = xyzdat.trim().split("\n").length;
           xyzdat = nion + "\n\n" + xyzdat;
           var a1 = document.getElementById("lattice_a1").value;
           var a2 = document.getElementById("lattice_a2").value;
           var a3 = document.getElementById("lattice_a3").value;
           var xyzcell = [xyzdat,a1,a2,a3];
           console.log("xyzcell=",xyzcell[0]);
           if (bondings.contains("spring  bondings K gamma")) {
              document.getElementById('apirunning').value += "+ running gen_wham_model\n";
              document.getElementById('runmebanner4p').innerHTML= "Generating reaction path";
              //loadframe2jsmol(false,false,0);
              var jjj = bondings.split("spring  bondings K gamma")[1].split("\n")[0].trim().split(/[ ,]+/);
              var nb = jjj.length/3;
              console.log("jjj=",jjj);

              var bstring = "\"(";
              bstring += "[";
                  for (var b=0; b<nb; ++b) {
                     var s = parseFloat(jjj[3*b]);
                     if (s>0.0) {
                        bstring += "("+jjj[3*b+1] + "," + jjj[3*b+2] + ",1)";
                     } else if (s<0.0) {
                        bstring += "("+jjj[3*b+1] + "," + jjj[3*b+2] + ",0)";
                     }
                     if (b<(nb-1)) { bstring += ",";}
                  }
              bstring += "],";

              bstring += "[";
                  for (var b=0; b<nb; ++b) {
                     bstring += "("+jjj[3*b+1] + "," + jjj[3*b+2] + ",1)";
                     if (b<(nb-1)) { bstring += ",";}
                  }
              bstring += "],";

              bstring += "[";
                  for (var b=0; b<nb; ++b) {
                     var s = parseFloat(jjj[3*b]);
                     if (s>0.0) {
                        bstring += "("+jjj[3*b+1] + "," + jjj[3*b+2] + ",0)";
                     } else if (s<0.0) {
                        bstring += "("+jjj[3*b+1] + "," + jjj[3*b+2] + ",1)";
                     }
                     if (b<(nb-1)) { bstring += ",";}
                  }
              bstring += "])\"";
              surface_atoms = document.getElementById("bulk_atoms").value.trim();

              console.log("bstring =",bstring);
              var textToSave = "input.xyz:\n" + xyzdat + ":input.xyz\n";
              textToSave    += "bstring:" + bstring + ":bstring\n";
              if (surface_atoms.length>0) {
                 textToSave += "calculation: uff-surface :calculation\n";
                 textToSave += "bondings: " + bondings.split("spring  bondings K gamma")[1].split("\n")[0].trim() + ":bondings\n";
                 textToSave += "surface: " + surface_atoms + " :surface\n";
              } else {
                 textToSave    += "calculation: uff-path :calculation\n";
              }
              console.log("chemdb_molcalc input:" + textToSave);

              var ii = Math.floor(Math.random() * 1000) + 1;
              var filenameguess = "nwchem-" + ii +".nw";
              var fileNameToSaveAs =  filenameguess

              var textToSaveAsBlob = new Blob([textToSave], {type:"text/plain"});
              var textToSaveAsURL  = window.URL.createObjectURL(textToSaveAsBlob);

              var formD = new FormData();
              formD.append('file', textToSaveAsBlob,fileNameToSaveAs);
              formD.append('title', fileNameToSaveAs);
              console.log("FORMD=",formD);

              var xhr = new XMLHttpRequest();
              xhr.open("POST", arrows_post_url, true);
              xhr.onload = function (e) {
                 if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                      console.log("  - post response:" +xhr.responseText);
                     }
                  }
              };
              xhr.onerror = function (e) {
                 console.error(xhr.statusText);
              };
              xhr.send(formD);

              var ajax = new XMLHttpRequest();
              ajax.open('GET', arrows_get_url+fileNameToSaveAs, true);
              ajax.onload = function (e) {
                if (ajax.readyState === 4) {
                  if (ajax.status === 200) {
                    var textFromUrl = ajax.responseText;
                    console.log(textFromUrl);
                    document.getElementById('runmebanner4b').innerHTML= "Calculation Finished!";
                    console.log("textFromUrl=",textFromUrl);
                    var path = textFromUrl.split("final_path.xyz:")[1].split(":final_path.xyz")[0].trim();
                    var xyzcell1 = [path.split("\n").slice(0*(nion+2),1*(nion+2)).join("\n"),a1,a2,a3];
                    var xyzcell2 = [path.split("\n").slice(1*(nion+2),2*(nion+2)).join("\n"),a1,a2,a3];
                    var xyzcell3 = [path.split("\n").slice(2*(nion+2),3*(nion+2)).join("\n"),a1,a2,a3];
                    var rg1 = calculate_rgamma(xyzcell1)
                    var rg2 = calculate_rgamma(xyzcell2)
                    var rg3 = calculate_rgamma(xyzcell3)
                    console.log("rg1=",rg1);
                    console.log("rg2=",rg2);
                    console.log("rg3=",rg3);
                    wgamma = document.getElementById("umbrella_gamma").value;
                    console.log("wgamma=",wgamma);

                    if (wgamma<=(rg1)) {
                       addxyzcell2frame(xyzcell1);
                    } else if (wgamma>=(rg3)) {
                       addxyzcell2frame(xyzcell3);
                    } else if (wgamma < rg2) {
                       var alpha = (wgamma-rg1)/(rg2-rg1);
                       console.log("A alpha=",alpha);
                       var xyzcell0t;
                       var xyzcell0 = xyzcell_Robinson(morph_xyzcells(alpha,xyzcell1,xyzcell2));
                       var rg0 = calculate_rgamma(xyzcell0);
                       var rg0m = rg0;
                       var dalpha = (rg0-rg1)/(rg2-rg1) - alpha;
                       var it = 0;
                       while ((Math.abs(dalpha)>0.01) && (it<15)) { 
                          it += 1;
                          console.log("optimwgamma it,rg0,rg0m,alpha=",it,rg0,rg0m,alpha-dalpha);
                          xyzcell0t = xyzcell_Robinson(morph_xyzcells(alpha-dalpha,xyzcell1,xyzcell2));
                          rg0 = calculate_rgamma(xyzcell0t);
                          dalpha = (rg0-rg1)/(rg2-rg1) - alpha;
                          if (Math.abs(wgamma-rg0)<Math.abs(wgamma-rg0m)) {
                             rg0m = rg0
                             xyzcell0 = xyzcell0t
                          }
                       }
                       addxyzcell2frame(xyzcell0);
                    } else {
                       var alpha = (wgamma-rg2)/(rg3-rg2);
                       console.log("B alpha=",alpha);
                       var xyzcell0 = xyzcell_Robinson(morph_xyzcells(alpha,xyzcell2,xyzcell3));
                       var rg0 = calculate_rgamma(xyzcell0);
                       var dalpha = (rg0-rg2)/(rg3-rg2) - alpha;
                       var it = 0;
                       while ((Math.abs(dalpha)>0.01) && (it<15)) { 
                          it += 1;
                          console.log("optimwgamma it,rg0,alpha=",it,rg0,alpha-dalpha);
                          xyzcell0 = xyzcell_Robinson(morph_xyzcells(alpha-dalpha,xyzcell2,xyzcell3));
                          rg0 = calculate_rgamma(xyzcell0);
                          dalpha = (rg0-rg2)/(rg3-rg2) - alpha;
                       }
                       addxyzcell2frame(xyzcell0);
                    }

                    console.log("nion:", nion);
                    console.log("PATH from Arrows:\n", path);
                    document.getElementById('runmebanner4p').innerHTML= "";
                    check_rgamma();
                    document.getElementById('apirunning').value = document.getElementById('apirunning').value.replace("+ running gen_wham_model\n","");
                    callback("gen_wham_model");

                  } else {
                    console.error(ajax.statusText);
                    document.getElementById('runmebanner4b').innerHTML= ajax.statusText;
                  }
                }
              };
              ajax.onerror = function (e) {
                console.error(ajax.statusText);
                document.getElementById('runmebanner4b').innerHTML= ajax.statusText;
              };
              ajax.send();
           } 
        }

        // **********************************
        // *                                *
        // *      resolveauxvariables       *
        // *                                *
        // **********************************
        function resolveauxvariables(myid,callback) {
           //var arrows_post_url = 'https://arrows.emsl.pnnl.gov/api/upload/';
           //var arrows_get_url  = 'https://arrows.emsl.pnnl.gov/api/molecular_calculation/';
           //var arrows_post_url = '{{ arrows_api }}upload/';
           //var arrows_get_url  = '{{ arrows_api }}molecular_calculation/';
           var calc_url        = document.getElementById("arrows_url").value;
           var arrows_post_url = calc_url + 'upload/';
           var arrows_get_url  = calc_url + 'molecular_calculation/';

           var auxvar = document.getElementById(myid).value;
           var auxvarlist = auxvar.split("\n");
           var x,y;
           var xblist = [];
           var xxlist = [];
           for (var ln of auxvarlist) {
              if (ln.contains("=") && ln.contains("xb")) {
                 x = ln.split("=")[0].replace("#","").trim()
                 y = ln.split("=")[1].trim()
                 xblist.push([x,y]);
              }
              if (ln.contains("=") && ln.contains("xx")) {
                 x = ln.split("=")[0].replace("#","").trim()
                 y = ln.split("=")[1].trim()
                 xxlist.push([x,y]);
              }
           }
           console.log("xblist=",xblist);
           console.log("xxlist=",xxlist);

           //var xyzdat = jmvar("data({1.1},\"xyz\")");
           var xyzdat = jmvar("data({thisModel},\"xyz\")");
           var nion = xyzdat.trim().split("\n").length;
           xyzdat = nion + "\n\n" + xyzdat;
           var a1 = document.getElementById("lattice_a1").value;
           var a2 = document.getElementById("lattice_a2").value;
           var a3 = document.getElementById("lattice_a3").value;
           var xyzcell = [xyzdat,a1,a2,a3];
           
           if ((xblist.length>0) || (xxlist.length>0)) {
              document.getElementById('apirunning').value += "+ running resolveauxvariables\n";
              document.getElementById('runmebanner4p').innerHTML= "Resolving Variables";

              var textToSave = "input.xyz:\n" + xyzdat + ":input.xyz\n\n";
              textToSave    += "calculation: atomtype_string :calculation\n\n";
              textToSave    += "indexstring: -s ";
              var xcount = 0;
              for (var xy of xblist) {
                 if (xcount>0) { textToSave +=  ","; }
                 xcount     += 1;
                 textToSave += xy[1];
              }
              for (var xy of xxlist) {
                 if (xcount>0) { textToSave +=  ","; }
                 xcount     += 1;
                 textToSave += xy[1];
              }
              textToSave    += " :indexstring\n";
              console.log("textToSave=",textToSave);

              var ii = Math.floor(Math.random() * 1000) + 1;
              var filenameguess = "nwchem-" + ii +".nw";
              var fileNameToSaveAs =  filenameguess

              var textToSaveAsBlob = new Blob([textToSave], {type:"text/plain"});
              var textToSaveAsURL  = window.URL.createObjectURL(textToSaveAsBlob);

              var formD = new FormData();
              formD.append('file', textToSaveAsBlob,fileNameToSaveAs);
              formD.append('title', fileNameToSaveAs);

              var xhr = new XMLHttpRequest();
              xhr.open("POST", arrows_post_url, true);
              xhr.onload = function (e) {
                 if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                      console.log("  - post response:" +xhr.responseText);
                     }
                  }
              };
              xhr.onerror = function (e) {
                 console.error(xhr.statusText);
              };
              xhr.send(formD);
              console.log("start ajax get");

              var ajax = new XMLHttpRequest();
              ajax.open('GET', arrows_get_url+fileNameToSaveAs, true);
              ajax.onload = function (e) {
                if (ajax.readyState === 4) {
                  if (ajax.status === 200) {
                    var textFromUrl = ajax.responseText;
                    var xxdict = {};
                    for (var xx of textFromUrl.split("\n")) {
                       if (xx.contains("result=")) {
                          x = eval(xx.split("result=")[1].trim());
                          xxdict[x[0]] = x[1];
                       }
                    }
                    for (var xy of xblist) {
                       x = xy[0];
                       y = parseInt(xxdict[xy[1]][0]).toString();
                       xxdict[xy[1]].shift();
                       console.log("x,y=",x,y);
                       auxvar = auxvar.split(x).join(y);
                    }
                    for (var xy of xxlist) {
                       x = xy[0];
                       y = parseInt(xxdict[xy[1]][0]).toString();
                       xxdict[xy[1]].shift();
                       console.log("x,y=",x,y);
                       //auxvar = auxvar.replace(x,y);
                       auxvar = auxvar.split(x).join(y);
                    }

                    console.log("xxdict:", xxdict);
                    console.log("textFromUrl:", textFromUrl);
                    document.getElementById(myid).value = auxvar;
                    document.getElementById('runmebanner4p').innerHTML= "";
                    document.getElementById('apirunning').value = document.getElementById('apirunning').value.replace("+ running resolveauxvariables\n","");
                    callback("resolveauxvariables");

                  } else {
                    console.error(ajax.statusText);
                    document.getElementById('runmebanner4b').innerHTML= ajax.statusText;
                  }
                }
              };
              ajax.onerror = function (e) {
                console.error(ajax.statusText);
                document.getElementById('runmebanner4b').innerHTML= ajax.statusText;
              };
              ajax.send();

           }
        }


        function bondings_metadynamics() {
           var bondings = document.getElementById('reaction_bondings').value;
           if (bondings.includes("gamma")) {
              var coefatom = bondings.split("gamma")[1].split("\n")[0].trim();

              document.getElementById("coordinate_type").value = "bondings";
              changecollectivecoords();
              document.getElementById('collective_bondings_coefindexes').value = coefatom; 
              var ggmin =  parseFloat(document.getElementById('min_reaction_gamma').value);
              var ggmax =  parseFloat(document.getElementById('max_reaction_gamma').value);
              var dlta = 2.5;
              ggmin -= dlta;
              ggmax += dlta;
      
              document.getElementById('meta_range').value = ggmin.toFixed(4) + " " + ggmax.toFixed(4);
              document.getElementById('meta_nrange').value = 501;
              document.getElementById("meta_boundary_w").value = 0.1;
              document.getElementById("meta_boundary_sigma").value = 0.1;
           }
        }

      

        function set_color_alist(color,alist) {
           var atomlist1 = expand_atomlist(document.getElementById(alist).value).trim().split(/[ ,]+/);

           for (var i=0; i<atomlist1.length; ++i) {
              jms0("select atomno="+atomlist1[i]+"; color " +color + ";");
           }
        }

        function set_color_bondings(alist) {
           var colors = ['translucent red','translucent green','translucent blue','translucent purple','translucent orange','translucent violet','translucent aqua','translucent yellow'];
           var coefindexes = document.getElementById(alist).value.trim().split(/[ ,]+/);
           var n = parseInt(coefindexes.length/3);
           for (var i=0; i<n; ++i) {
              var color = colors[i%8];
              var ii = parseInt(coefindexes[3*i+1]);
              var jj = parseInt(coefindexes[3*i+2]);
              if (!(isNaN(ii) || isNaN(jj))) {
                 jms0("select atomno="+ii+"; color " +color + ";");
                 jms0("select atomno="+jj+"; color " +color + ";");
              }
           }
        }
        function set_zinitial() {
           if (document.getElementById('collectivef').innerHTML != "") {
              document.getElementById('tamd_zinitial').value = document.getElementById('collectivef').innerHTML + " 0.0";
           } else {
              document.getElementById('tamd_zinitial').value = "0.0 0.0";
           }
        }

        function changencpus() {
           var ncpus = document.getElementById("queue_ncpus").value;
           var data  = editor.getValue(); // or session.getValue
           if (data.includes("#ncpus ")) {
              var data0 = "#ncpus " + data.split("#ncpus ")[1].split("\n")[0];
              data = data.replace(data0,"#ncpus " + ncpus);
              editor.setValue(data,1);
           }
        }

        function changequeue() {
           var qq   = document.getElementById("queue").value.trim();
           var data = editor.getValue(); // or session.getValue
           if (data.includes("#ncpus ")) {
              var data0 = "#queue " + data.split("#queue ")[1].split("\n")[0];
              data = data.replace(data0,"#queue " + qq);
              editor.setValue(data,1);
           }
        }

        function changeqtime() {
           var qt   = document.getElementById("queue_time").value.trim();
           var data = editor.getValue(); // or session.getValue
           if (data.includes("#cputime ")) {
              var data0 = "#cputime " + data.split("#cputime ")[1].split("\n")[0];
              data = data.replace(data0,"#cputime " + qt);
              editor.setValue(data,1);
           }
        }

        function changeaccount() {
           var qa   = document.getElementById("queue_account").value.trim();
           if ( !(qa.includes("Add Account") || qa.includes("None")) ) {
              var data = editor.getValue(); // or session.getValue
              if (data.includes("#account ")) {
                 var data0 = "#account " + data.split("#account ")[1].split("\n")[0];
                 data = data.replace(data0,"#account " + qa);
              } else {
                 data = data.split("#queue ")[0]
                      + "#account " + qa + "\n"
                      + "#queue "
                      + data.split("#queue ")[1]
              }
              editor.setValue(data,1);
           }
        }

    

        function changepermdir() {
           var pd   = document.getElementById("queue_nwchem_permdir").value.trim();
           var data = editor.getValue(); // or session.getValue
           if (data.includes("#permdir ")) {
              var data0 = "#permdir " + data.split("#permdir ")[1].split("\n")[0];
              data = data.replace(data0,"#permdir " + pd);
              editor.setValue(data,1);
           }
        }

        function changecurdir() {
           var pd   = document.getElementById("queue_nwchem_curdir").value.trim();
           var data = editor.getValue(); // or session.getValue
           if (data.includes("#curdir ")) {
              var data0 = "#curdir " + data.split("#curdir ")[1].split("\n")[0];
              data = data.replace(data0,"#curdir " + pd);
              editor.setValue(data,1);
           }
        }

        function definesecret() {
           var sc = document.getElementById("machine").value.trim();
           if ((sc=="etahoma") || (sc=="ccs-knl0") || (sc=="we31869") || (sc=="econstance") || (sc=="theta") || (sc=="erichome") || (sc=="ilton_tahoma")) { 
              document.getElementById("queue_secret_code").value = "xxxxxxxx";
           } else {
              document.getElementById("queue_secret_code").value = "";
           }
           var ncpus=document.getElementById("queue_ncpus").value;
           if (sc.includes("cori"))     { ncpus="48";}
           if (sc.includes("econstance"))     { ncpus="48";}
           if (sc.includes("gulfport")) { ncpus="32";}
           if (sc.includes("aerosol"))  { ncpus="32";}
           if (sc.includes("samsung"))  { ncpus="32";}
           if (sc.includes("etahoma"))  { ncpus="36";}
           if (sc.includes("ilton_tahoma"))  { ncpus="36";}
           if (sc.includes("theta"))    { ncpus="64";}
           if (sc.includes("ccs-knl0")) { ncpus="68";}
           if (sc.includes("we31869")) { ncpus="6";}
           document.getElementById("queue_ncpus").value = ncpus;

           if (sc.includes("econstance")) { 
               document.getElementById("queue_nwchem_curdir0").value =  "we31869.emsl.pnl.gov:/media/seagate2/Projects/Eric/mq_simulations";
           }
           if (sc.includes("ilton_tahoma")) { 
               document.getElementById("queue_nwchem_curdir0").value =  "we31869.emsl.pnl.gov:/home/bylaska/Projects/Eric/BES";
           }
           if (sc.includes("theta")) { 
               document.getElementById("queue_nwchem_curdir0").value =  "we31869.emsl.pnl.gov:/media/seagate2/Projects/Eric/Theta";
           }

           var data  = editor.getValue(); // or session.getValue
           if (!data.includes("#nwchem_input")) { return;}

           if (data.includes("#machine ")) {
              var data0 = "#machine " + data.split("#machine ")[1].split("\n")[0];
              if (sc=="") {
                 data = data.replace(data0+"\n","");
              } else {
                 data = data.replace(data0,"#machine " + sc);
              }
           } else {
              var data0 = data.split("#cputime");
              data = data0[0] + "#machine " + sc + "\n#cputime" + data0[1];
           }
           if (data.includes("#ncpus ")) {
              var data0 = "#ncpus " + data.split("#ncpus ")[1].split("\n")[0];
              //ncpus = data.split("#ncpus ")[1].split("\n")[0];
              data = data.replace(data0,"#ncpus " + ncpus);
           }
           editor.setValue(data,1);
           //document.getElementById("queue_ncpus").value = ncpus;
        }


        function SwapDivsWithClick()
        {
           if( ! arguments.length ) { return; }
           var ishow = parseInt(arguments[0]);
           for(var i=1; i< arguments.length; i++)
           {
               var ta = arguments[i];
               if (i==ishow) {
                  document.getElementById(ta).style.display = "block";
               } else {
                  document.getElementById(ta).style.display = "none";
               }
           }
        }

        function changefreeenergy() {
           var ftype = document.getElementById("free_energy_type").value;
           if (ftype=="Metadynamics") {
              document.getElementById("metainput").style.display = "block";
              document.getElementById("tamdinput").style.display = "none";
              document.getElementById("pmfinput").style.display = "none";
           } else if (ftype=="TAMD") {
              document.getElementById("metainput").style.display = "none";
              document.getElementById("tamdinput").style.display = "block";
              document.getElementById("pmfinput").style.display = "none";
           } else {
              document.getElementById("metainput").style.display = "none";
              document.getElementById("tamdinput").style.display = "none";
              document.getElementById("pmfinput").style.display = "block";
           }
        }

        function changecollectivecoords() {
           var ctype = "collective_" + document.getElementById("coordinate_type").value;
           var alldivs = document.getElementsByClassName("collective_div");
       
           for (var i=0; i<alldivs.length; ++i) {
              if (alldivs[i].id==ctype) {
                 alldivs[i].style.display = "block";
              } else {
                 alldivs[i].style.display = "none";
              }
           }
        }

        function set_Sprik() {
           var checked = document.getElementById("collective_coord_number_sprik").checked;
           if (checked) {
              document.getElementById("Sprik_m").style.display = "none";
           } else {
              document.getElementById("Sprik_m").style.display = "block";
           }
        }

        // **********************************
        // *                                *
        // *      add_select_option         *
        // *                                *
        // **********************************
        function add_select_option(promptstr,defaultpromptstr,selectid) {
           var newrxn  =  prompt(promptstr, defaultpromptstr);
           newrxn = newrxn.trim();
           if (newrxn.includes("-->")) {
              if ((newrxn.split("-->")[0].length > 1) && (newrxn.split("-->"[1]>1))) {
                 var ddl = document.getElementById(selectid);
                 var option = document.createElement("OPTION");
                 option.innerHTML = newrxn;
                 option.value     = newrxn;
                 ddl.options.add(option);
              }
           }
        }


        // **********************************
        // *                                *
        // *      add_select_option2        *
        // *                                *
        // **********************************
        function add_select_option2(promptstr,defaultpromptstr,selectid) {
           var qa  = document.getElementById(selectid).value.trim();
           if (qa.includes(promptstr)) {
              var newrxn  =  prompt(promptstr, defaultpromptstr);
              newrxn = newrxn.trim();
              if (newrxn.includes(":")) {
                 if ((newrxn.split(":")[0].length > 1) && (newrxn.split(":"[1]>1))) {
                    var ddl = document.getElementById(selectid);
                    var option = document.createElement("OPTION");
                    option.innerHTML = newrxn;
                    option.value     = newrxn;
                    ddl.options.add(option);
                 }
              }
           }
        }


        // **********************************
        // *                                *
        // *      add_select_option0        *
        // *                                *
        // **********************************
        function add_select_option0(promptstr,defaultpromptstr,selectid) {
           var qa  = document.getElementById(selectid).value.trim();
           if (qa.includes(promptstr)) {
              var newrxn  =  prompt(promptstr,defaultpromptstr);
              newrxn = newrxn.trim();
              if (newrxn.length>1) {
                 var ddl = document.getElementById(selectid);
                 var option = document.createElement("OPTION");
                 option.innerHTML = newrxn;
                 option.value     = newrxn;
                 ddl.options.add(option);
              }
           }
        }

        // **********************************
        // *                                *
        // *      add_select_option02       *
        // *                                *
        // **********************************
        function add_select_option02(promptstr,defaultpromptstr,selectid,selectid2) {
           var qa  = document.getElementById(selectid).value.trim();
           if (qa.includes(promptstr)) {
              var newrxn  =  prompt(promptstr, defaultpromptstr);
              newrxn = newrxn.trim();
              if (newrxn.length>1) {
                 var ddl = document.getElementById(selectid);
                 var option = document.createElement("OPTION");
                 option.innerHTML = newrxn;
                 option.value     = newrxn;
                 ddl.options.add(option);

                 var ddl2 = document.getElementById(selectid2);
                 var option2 = document.createElement("OPTION");
                 option2.innerHTML = newrxn;
                 option2.value     = newrxn;
                 ddl2.options.add(option2);
              }
           }
        }


        // **********************************
        // *                                *
        // *           set_lock             *
        // *                                *
        // **********************************
        function set_lock() {
           if (document.getElementById("editor_lock").checked) {
              document.getElementsByTagName('body')[0].style.overflow = 'hidden';
           } else {
              document.getElementsByTagName('body')[0].style.overflow = 'visible' // the default for the css property
           }
        }

</script>

</head>


<body onload="jmolOnLoad();cacheLoadAll();changefreeenergy();changecollectivecoords();jmolsetLoadStruct();">

<!--div class="linkbanner">
   <a href="https://arrows.emsl.pnnl.gov/api"><img src="https://dl.dropboxusercontent.com/s/s5fof263qwxzcaq/EMSLArrows2019.png" alt="Copyright Arrows Logo" width="180" height="90" align="middle"></a> 
<a href="https://arrows.emsl.pnnl.gov/api/periodic">Expert Periodic and Molecular Editor</a> &nbsp; 
   <a href="https://arrows.emsl.pnnl.gov/api/3dbuilder">3D Molecular And Reaction Editor</a>  &nbsp; <a href="https://arrows.emsl.pnnl.gov/api/expert">2D and 3D Combo Editor</a> &nbsp;   <a href="https://arrows.emsl.pnnl.gov/api/qsharp_chem">Microsoft Quantum Editor</a> &nbsp;  <a href="https://arrows.emsl.pnnl.gov/api/aerosol">EMSL Aerosol Workshop Editor</a> &nbsp; <a href="http://www.nwchem-sw.org/index.php/EMSL_Arrows#">Manual</a>
</div-->

<div class="linkbanner">
   <a href="{{ arrows_api }}"><img src="{{url_for('static', filename='arrows-static/TinyArrows2019.png')}}" alt="Copyright Arrows Logo" width="180" height="90" align="middle"></a>
<a href="{{ arrows_api }}periodic">Expert Periodic and Molecular Editor</a> &nbsp;
   <a href="{{ arrows_api }}3dbuilder">3D Molecular And Reaction Editor</a>  &nbsp; <a href="{{ arrows_api }}expert">Molecular Combo Editor</a> &nbsp;   <a href="{{ arrows_api }}qsharp_chem">Microsoft Quantum Editor</a> &nbsp;  <a href="{{ arrows_api }}aerosol">EMSL Aerosol Workshop Editor</a> &nbsp; <a href="https://nwchemgit.github.io/EMSL_Arrows.html#">Manual</a>
</div>




	<!-- RECOMMENDED if your web app will not function without JavaScript enabled -->
    <noscript>
	<div style="width: 22em; position: absolute; left: 50%; margin-left: -11em; color: red; background-color: white; border: 1px solid red; padding: 4px; font-family: sans-serif">
   Your web browser must have JavaScript enabled in order for this
    application to display correctly.</div>
    </noscript>


<!-- Tab links -->
<div class="tab" >
  <button class="tablinks" onclick="openCity(event, 'Arrows Periodic 3D Builder')" id="defaultOpen">Arrows Periodic 3D Builder</button>
  <button class="tablinks" onclick="openCity(event, 'NWChem Input Editor')">NWChem Input Editor</button>
  <button class="tablinks" onclick="openCity(event, 'Arrows Entry - 2D Builder')">Arrows Entry - 2D Builder (not periodic)</button>
  <button class="tablinks" onclick="openCity(event, 'Output')">Output</button>
  <button class="tablinks" onclick="openCity(event, 'SpreadSheet')">SpreadSheet</button>
  <button class="tablinks" onclick="openCity(event, 'Reaction Predictor - Beta version')">Reaction Predictor - Beta version</button>
  <button class="tablinks" onclick="openCity(event, 'Queue')">Queue</button>
  <button class="tablinks" onclick="openCity(event, 'Notes')">Notes</button>
  <button class="tablinks" onclick="openCity(event, 'Instructions')">Instructions</button>
</div>






<div id="NWChem Input Editor" class="tabcontent">

    <input type="button" VALUE="JSMol to Editor &#8600;" onClick="jmoltoeditor()" style="background-color:#f8f8ff; color:#0000ff; font-size: 14px; font-weight:bold"/>
    <input type="button" VALUE="&#8598; Editor to JSMol" onClick="jmloadxyz()" style="background-color:#f8f8ff; color:#0000ff; font-size: 14px; font-weight:bold"/>
    <input type="button" VALUE="&#8599; Editor append to JSMol" onClick="jmappendxyz()" style="background-color:#f8f8ff; color:#0000ff; font-size: 14px; font-weight:bold"/>
    <!--input type="button" VALUE="&#8598; Editor to JSMol models" onClick="jmloadxyz()" style="background-color:#f8f8ff; color:#0000ff; font-size: 14px; font-weight:bold"/-->
    &nbsp; &nbsp; 
    <input type="button" VALUE="Previous input" onClick="previnput2editor();" style="background-color:#f8f8ff; color:#FF5733; font-size: 14px; font-weight:bold"/>
    <input type="button" VALUE="Next input" onClick="loadinput2editor(false);" style="background-color:#f8f8ff; color:#FF5733; font-size: 14px; font-weight:bold"/>
    <input type="button" VALUE="New" onClick="loadinput2editor(true);" style="background-color:#f8f8ff; color:#FF5733; font-size: 14px; font-weight:bold"/>
    <input type="button" VALUE="Delete" onClick="deleteinput2editor();" style="background-color:#f8f8ff; color:#FF5733; font-size: 14px; font-weight:bold"/>
    <input type="button" VALUE="Clear" onClick="editor.setValue('');" style="background-color:#f8f8ff; color:#FF5733; font-size: 14px; font-weight:bold"/>
    <b style="color:#FF5733; font-size: 12px;" id="input_label">Input 1 out of 1</b>

    <input type="button" VALUE="CacheGet" onClick="cacheGet();" style="background-color:#f8f8ff; color:#0000ff; font-size: 11px; font-weight:bold"/>
    <input type="button" VALUE="CachePut" onClick="cachePut();" style="background-color:#f8f8ff; color:#0000ff; font-size: 11px; font-weight:bold"/>
    <input type="button" VALUE="Copy to Clipboard" 
     style="background-color:#f8f8ff; color:#0000ff; font-size: 11px; font-weight:bold"
     onClick="navigator.clipboard.writeText(editor.getValue())
         .then(() => { console.log('Text copied to clipboard'); })
         .catch(err => { console.error('Error in copying text: ', err); });"
     />

    <br>
    <!--div id="editor" style="position: relative; top: 85px; z-index: 1000; height: 560px; width: 1000px">some text is here </div-->
    <!--div id="editor" style="height: 560px; width: 1000px">some text is here </div-->
    <div id="editor" style="height: 600px; width: 1200px"></div>

    <script>
       var editor = ace.edit("editor");
       //editor.setTheme("ace/theme/gob");
       //editor.setTheme("ace/theme/monokai");
       //editor.setTheme("ace/theme/merbivore_soft");
       editor.setTheme("ace/theme/terminal");
       //editor.setTheme("ace/theme/vibrant_ink");
       //editor.setTheme("ace/theme/Cobalt");
       //editor.setTheme("ace/theme/dracula");
       //editor.session.setMode("ace/mode/javascript");
       //editor.session.setMode("ace/mode/fortran");
       //editor.session.setMode("ace/mode/css");
       //editor.session.setMode("ace/mode/properties");
       //editor.session.setMode("ace/mode/python");
       editor.session.setMode("ace/mode/perl");
       editor.session.setUseWrapMode(true);
    </script>
    
    <input type="button" VALUE="NWChem Format" onClick="convert2geometry(false)" style="background-color:#f8f8ff; color:#00000f; font-size: 14px; font-weight:bold"/>
    <input type="button" VALUE="XYZ" onClick="convert2XYZ()" style="background-color:#f8f8ff; color:#00000f; font-size: 14px; font-weight:bold"/>
    <input type="button" VALUE="CIF" onClick="convert2geometry(true)" style="background-color:#f8f8ff; color:#00000f; font-size: 14px; font-weight:bold"/>
    <input type="button" VALUE="vim" onClick="editor.setKeyboardHandler('ace/keyboard/vim');" style="background-color:#f8f8ff; color:#00000f; font-size: 14px; font-weight:bold"/>
    <input type="button" VALUE="emacs" onClick="editor.setKeyboardHandler('ace/keyboard/emacs');" style="background-color:#f8f8ff; color:#00000f; font-size: 14px; font-weight:bold"/>
    <input type="button" VALUE="ace" onClick="editor.setKeyboardHandler('');" style="background-color:#f8f8ff; color:#00000f; font-size: 14px; font-weight:bold"/>
    screen lock<input type="radio" id="editor_lock" onClick="ClearRd(this,9); set_lock();" title="editor lock"/>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    <input type="button" class="rbutton4" id="nwchemsplit" value="Split NWChem" onClick="nwinputsplit()" style="background-color:#f8f8ff; color:green;"/>
    <input type="button" class="button4" value="Add ### restart here ###" onClick="editor.session.insert(editor.selection.getCursor(),'\n### restart here ###\n\n')"  style="background-color:#f8f8ff; color:green;"/>
    <input type="button" VALUE="Submit Thomas" onClick="submit_Thomas()" title="Submit NWChem" style="background-color:#f8f8ff; color:#0000ff; font-size: 14px; font-weight:bold"/>
    <input type="button" VALUE="Split Submit NWChem" onClick="submit_splitnwchemjob2(dummy_callback)" title="Submit NWChem" style="background-color:#f8f8ff; color:#0000ff; font-size: 14px; font-weight:bold"/>
    <input type="button" VALUE="Submit NWChem" onClick="submit_nwchemjob2(dummy_callback)" title="Submit NWChem" style="background-color:#f8f8ff; color:#0000ff; font-size: 14px; font-weight:bold"/>
    <br><br>
    Machine:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    <input type="text" oninput="cacheInput(this)" list="machinelist" id="machine" onChange="definesecret()" value="aerosol3"/>
             <datalist id="machinelist">
                <option value="aerosol1">aerosol1</option>
                <option value="aerosol2">aerosol2</option>
                <option value="aerosol3">aerosol3</option>
                <option value="aerosol4">aerosol4</option>
                <option value="aerosol5">aerosol5</option>
                <option value="etahoma">etahoma</option>
                <option value="ilton_tahoma">ilton_tahoma</option>
                <option value="econstance">econstance</option>
                <option value="theta">theta</option>
                <option value="ccs-knl0">ccs-knl0</option>
                <option value="we31869">we31869</option>
                <option value="harsono">harsono</option>
                <option value="erichome">erichome</option>
             </datalist>
    ncpus: <input type="number" name="nLabel" id="queue_ncpus" size="6" min="1" max="1000000" step="1" value="32" onChange="changencpus()" oninput="cacheInput(this)">
    queue: <input type="text" list="queuelist" id="queue" onChange="changequeue()" oninput="cacheInput(this)"/>
             <datalist id="queuelist">
                <option value="regular">regular</option>
                <option value="debug">debug</option>
             </datalist>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    time: <input type="text" name="TLabel" id="queue_time" size="9" onChange="changeqtime()" oninput="cacheInput(this)">
    &nbsp;
    account: <!--input type="text" name="Label" id="queue_account" onChange="changeaccount()" oninput="cacheInput(this)"-->
               <select id="queue_account"
                       name="queue_account"
                       style="font-size:13px;color:#6F4E37"
                       title=": set text queue_account :" 
                       onChange="add_select_option0('Add Account','','queue_account')"
                       oninput="cacheInput(this)">
                       <option>None</option>
                       <option>Add Account</option>
                       <option disabled>──────────</option>
               </select>
    &nbsp;&nbsp;&nbsp;
    Secret Code: <!--input type="text" name="Label" id="queue_secret_code" oninput="cacheInput(this)"-->
               <select id="queue_secret_code"
                       name="queue_secret_code"
                       style="font-size:13px;color:#6F4E37"
                       title=": set text queue_secret_code :" 
                       onChange="add_select_option02('Add Secret Code','','queue_secret_code','queue_secret_code2')"
                       oninput="cacheInput(this)">
                       <option>None</option>
                       <option>Add Secret Code</option>
                       <option disabled>──────────</option>
               </select>
    <br>
    Arrows queue_name: <input type="text" list="queue_name_list" id="queue_name" onChange="changequeue()" oninput="cacheInput(this)"/>
               <datalist id="queue_name_list">
                <option value="nwchem">nwchem</option>
                <option value="geochem">geochem</option>
                <option value="ccs">ccs</option>
                <option value="serdp">serdp</option>
                <option value="samsung">samsung</option>
              </datalist>
    
    <input type="button" VALUE="Arrows Queue Label:" onClick="setQueueLabel()" style="background-color:#f8f8ff; color:#00000f; font-size: 14px; font-weight:bold"/>
    &nbsp;
    <input type="text" name="Label" id="queue_nwchem_label" size=45> 
    QWAIT:: <input type="text" name="Label" id="queue_wait_label">
    &nbsp;&nbsp;&nbsp;&nbsp;
    <a href="{{ arrows_api }}queue_nwchem_check/nwchem">Check submited jobs</a>
    <br>
    <section class="marquee" style="color: red"> <b id="runmebanner3"> </b> </section>
    <section class="marquee" style="color: black"> <b id="runmebanner3b"> </b> </section>
    <br>
    <input type="button" VALUE="Save to file" onClick="editorsave()" style="background-color:#f8f8ff; color:#298DB4; font-size: 14px; font-weight:bold"/>
    <input type="button" VALUE="Load selected file" onClick="loadfiletoeditor()" style="background-color:#f8f8ff; color:#298DB4; font-size: 14px; font-weight:bold"/>
    <input type="file" id="fileToLoad" style="background-color:#f8f8ff; color:#298DB4; font-size: 14px; font-weight:bold"><br>
    <input type="button" VALUE="Save to url" onClick="saveeditortourl()" title="Save data from editor into url" style="background-color:#f8f8ff; color:darkred; font-size: 14px; font-weight:bold"/>
    <input type="url" id="urlToLoad" SIZE=111 style="background-color:#f8f8ff; color:#298DB4; font-size: 14px; font-weight:bold">
    <input type="button" VALUE="Load from url" onClick="loadurltoeditor()" 
           title="Load data from url into editor" style="background-color:#f8f8ff; color:darkgreen; font-size: 14px; font-weight:bold"/><br>
    
    <h4> Simulation directories </h4>
    <table>
       <tr>
         <td>mylabel:</td>
         <!--td> <input type="text" name="Label" id="queue_nwchem_jobname" size=30 value="mylabel" oninput="cacheInput(this)"> </td-->
         <td>  <select id="queue_nwchem_jobname"
                       style="font-size:13px;color:#6F4E37"
                       title=": set text jobname :" 
                       onChange="add_select_option0('Add job label','','queue_nwchem_jobname')"
                       oninput="cacheInput(this)">
                       <option>None</option>
                       <option>Add job label</option>
                       <option disabled>──────────</option>
               </select>
         </td>
         <td>project name:</td>
         <!--td> <input type="text" name="Label" id="queue_nwchem_projectname" size=30 value="PathOpt" oninput="cacheInput(this)"> </td-->
         <td>  <select id="queue_nwchem_projectname"
                       style="font-size:13px;color:#6F4E37"
                       title=": set text projectname :" 
                       onChange="add_select_option0('Add project name','','queue_nwchem_projectname')"
                       oninput="cacheInput(this)">
                       <option>None</option>
                       <option>Add project name</option>
                       <option disabled>──────────</option>
               </select>
         </td>
         <td>model label?<input type="radio" id="queue_nwchem_jobmodel" onClick="ClearRd(this,1)" title="include model number"/></td>
         <td>date label?<input type="radio" id="queue_nwchem_jobdate" onClick="ClearRd(this,1)" title="include date"/></td>
         <td>delete scratch?<input type="radio" id="queue_nwchem_jobdeletescratch" onClick="ClearRd(this,1)" title="deletescratch option"/></td>
       </tr>
    </table>
    <table>
       <tr>
         <td>curdir0:</td>
         <!--td> <input type="text" list="queue_nwchem_curdir0_list" name="Label" id="queue_nwchem_curdir0" size=145 value="mymachine:/Projects/Simulations" oninput="cacheInput(this)"> </td-->
           <td> <select id="queue_nwchem_curdir0"
                    name="queue_nwchem_curdir0"
                    style="font-size:13px;color:#6F4E37" 
                    title=": set text queue_account :" 
                    onChange="add_select_option2('Add curdir0','','queue_nwchem_curdir0')"
                    oninput="cacheInput(this)">
                    <option>None</option>
                    <option>Add curdir0</option> 
                    <option disabled>──────────</option>
                </select> 
           </td>
       </tr>
       <tr>
          <td>permdir: </td> 
          <td> <input type="text" name="Label" id="queue_nwchem_permdir" size=145 value="" onChange="changepermdir()" oninput="cacheInput(this)"> </td>
       </tr>
       <tr>
          <td>curdir: </td>
          <td> <input type="text" name="Label" id="queue_nwchem_curdir" size=145 value="" onChange="changecurdir()" oninput="cacheInput(this)"> </td>
       </tr>
    </table>


    <h4> Simulation generation scripts and input</h4>
    <table>
       <tr>
          <td> <select id="bandpspw" onchange="changebandpspw()" oninput="cacheInput(this)">
                <option value="pspw">PSPW calculation</option>
                <option value="pspw4">PSPW4 calculation</option>
                <option value="dft">DFT calculation</option>
                <option value="hf">HF calculation</option>
                <option value="mp2">MP2 calculation</option>
                <option value="band">BAND calculation</option>
                <option value="pspw-band">PSPW-BAND calculation</option>
              </select>
          </td>
          <td> <select id="basis_type" onChange="changenwchemcutoff()" oninput="cacheInput(this)">
                <option value="default">default</option>
                <option value="def2-svp spherical">def2-svp spherical</option>
                <option value="def2-tzvp spherical">def2-tzvp spherical</option>
                <option value="6-31G* cartesian">6-31G* cartesian</option>
                <option value="6-311++G(2d,2p) cartesian">6-311++G(2d,2p) cartesian</option>
                <option value="30 Ry">30 Ry</option>
                <option value="40 Ry">40 Ry</option>
                <option value="50 Ry">50 Ry</option>
                <option value="60 Ry">60 Ry</option>
                <option value="80 Ry">80 Ry</option>
                <option value="100 Ry">100 Ry</option>
                <option value="120 Ry">120 Ry</option>
              </select>
          </td>
          <td> <select id="xc_type" oninput="cacheInput(this)">
                <option value="default">default</option>
                <option value="lda">lda</option>
                <option value="pbe">pbe</option>
                <option value="pbe0">pbe0</option>
                <option value="single-pbe0">singe-pbe0</option>
                <option value="blyp">blyp</option>
                <option value="b3lyp">b3lyp</option>
                <option value="tpss03">tpss03</option>
                <option value="scan">scan</option>
                <option value="vs98">vs98</option>
                <option value="m06-2x">m06-2x</option>
                <option value="revpbe">revpbe</option>
                <option value="pbesol">pbesol</option>
                <option value="pbe-grimme2">pbe-grimme2</option>
                <option value="pbe-grimme3">pbe-grimme3</option>
                <option value="beef">beef</option>
                <option value="xbeef-cpbe">xbeef-cpbe</option>
                <option value="beef-vdw2">beef-vdw2</option>
              </select>
          </td>
          <td> <select id="latticelocation" oninput="cacheInput(this)">
                <option value="default">default</option>
                <option value="Lattice in geometry block">Lattice in geometry block</option>
                <option value="Lattice in NWPW block">Lattice in NWPW block</option>
                <option value="FCC 38">FCC 38</option>
                <option value="SC 26">SC 26</option>
              </select>
          </td>
          <!--td> <input type="button" class="button4" id="latticelocation" value="Lattice in geometry block" onClick="changelatticelocation()"/>  </td-->
          <td> <input type="button" class="button4" id="springconstraint" value="Add reaction constraint" style="color:green;" onClick="addreactionconstraint(false)"/>  </td>
       </tr>
       <tr>
          <td> <input type="button" class="button4" value="Add Energy task" onClick="addenergy('')"/></td>
          <td> <input type="button" class="button4" value="Add Optimization task" onClick="addoptimization(true)"/></td>
          <td> <input type="button" class="button4" value="Add Frequency task" onClick="addfrequency()"/></td>
          <td> <input type="button" class="button4" value="Add NEB task" style="color:darkmagenta;" onClick="addneb()"/></td>
          <td> <input type="button" class="button4" value="Add String task" style="color:darkmagenta;" onClick="addstring()"/></td>
       </tr>
       <tr>
          <td> <input type="button" class="button4" value="Born Solvation" style="color:green;"  onClick="addborn()"/></td>
          <td> <input type="button" class="button4" value="COSMO Solvation" style="color:green;" onClick="addcosmo()"/></td>
          <td> <input type="button" class="button4" value="COSMO-SMD Solvation" style="color:green;" onClick="addcosmo_smd()"/></td>
          <td> <input type="button" class="button4" id="springconstraintpath" value="Add constraint path" style="color:green;" onClick="addreactionconstraintpath(false)"/>  </td>
          <!--td> <input type="button" class="button4" value="Reaction job" style="color:green;" onClick="generatereactionjob()"/></td-->
       </tr>
    </table>
     
    <select id="SMD_solvent_3" oninput="cacheInput(this)">
        <option value="h2o">water (default)</option>
        <option value="acetacid">acetic acid</option>
        <option value="acetone">acetone</option>
        <option value="acetntrl">acetonitrile</option>
        <option value="acetphen">acetophenone</option>
        <option value="aniline">aniline</option>
        <option value="anisole">anisole</option>
        <option value="benzaldh">benzaldehyde</option>
        <option value="benzene">benzene</option>
        <option value="benzntrl">benzonitrile</option>
        <option value="benzylcl">benzyl chloride</option>
        <option value="brisobut">1-bromo-2-methylpropane</option>
        <option value="brbenzen">bromobenzene</option>
        <option value="brethane">bromoethane</option>
        <option value="bromform">bromoform</option>
        <option value="broctane">1-bromooctane</option>
        <option value="brpentan">1-bromopentane</option>
        <option value="brpropa2">2-bromopropane</option>
        <option value="brpropan">1-bromopropane</option>
        <option value="butanal">butanal</option>
        <option value="butacid">butanoic acid</option>
        <option value="butanol">1-butanol</option>
        <option value="butanol2">2-butanol</option>
        <option value="butanone">butanone</option>
        <option value="butantrl">butanonitrile</option>
        <option value="butile">butyl acetate</option>
        <option value="nba">butylamine</option>
        <option value="nbutbenz">n-butylbenzene</option>
        <option value="sbutbenz">sec-butylbenzene</option>
        <option value="tbutbenz">tert-butylbenzene</option>
        <option value="cs2">carbon disulfide</option>
        <option value="carbntet">carbon tetrachloride</option>
        <option value="clbenzen">chlorobenzene</option>
        <option value="secbutcl">sec-butyl chloride</option>
        <option value="chcl3">chloroform</option>
        <option value="clhexane">1-chlorohexane</option>
        <option value="clpentan">1-chloropentane</option>
        <option value="clpropan">1-chloropropane</option>
        <option value="ocltolue">o-chlorotoluene</option>
        <option value="m-cresol">m-cresol</option>
        <option value="o-cresol">o-cresol</option>
        <option value="cychexan">cyclohexane</option>
        <option value="cychexon">cyclohexanone</option>
        <option value="cycpentn">cyclopentane</option>
        <option value="cycpntol">cyclopentanol</option>
        <option value="cycpnton">cyclopentanone</option>
        <option value="declncis">cis-decalin</option>
        <option value="declntra">trans-decalin</option>
        <option value="declnmix">decalin (cis/trans mixture)</option>
        <option value="decane">n-decane</option>
        <option value="decanol">1-decanol</option>
        <option value="edb12">1,2-dibromoethane</option>
        <option value="dibrmetn">dibromomethane</option>
        <option value="butyleth">dibutyl ether</option>
        <option value="odiclbnz">o-dichlorobenzene</option>
        <option value="edc12">1,2-dichloroethane</option>
        <option value="c12dce">cis-dichloroethylene</option>
        <option value="t12dce">trans-dichloroethylene</option>
        <option value="dcm">dichloromethane</option>
        <option value="ether">diethyl ether</option>
        <option value="et2s">diethyl sulfide</option>
        <option value="dietamin">diethylamine</option>
        <option value="mi">diiodomethane</option>
        <option value="dipe">diisopropyl ether</option>
        <option value="dmds">dimethyl disulfide</option>
        <option value="dmso">dimethyl sulfoxide</option>
        <option value="dma">N,N-dimethylacetamide</option>
        <option value="cisdmchx">cis-1,2-dimethylcyclohexane</option>
        <option value="dmf">N,N-dimethylformamide</option>
        <option value="dmepen24">2,4-dimethylpentane</option>
        <option value="dmepyr24">2,4-dimethylpyridine</option>
        <option value="dmepyr26">2,6-dimethylpyridine</option>
        <option value="dioxane">1,4-dioxane</option>
        <option value="phoph">diphenyl ether</option>
        <option value="dproamin">dipropylamine</option>
        <option value="dodecan">n-dodecane</option>
        <option value="meg">1,2-ethanediol</option>
        <option value="etsh">ethanethiol</option>
        <option value="ethanol">ethanol</option>
        <option value="etoac">ethyl acetate</option>
        <option value="etome">ethyl formate</option>
        <option value="eb">ethylbenzene</option>
        <option value="phenetol">ethyl phenyl ether</option>
        <option value="c6h5f">fluorobenzene</option>
        <option value="foctane">1-fluorooctane</option>
        <option value="formamid">formamide</option>
        <option value="formacid">formic acid</option>
        <option value="heptane">n-heptane</option>
        <option value="heptanol">1-heptanol</option>
        <option value="heptnon2">2-heptanone</option>
        <option value="heptnon4">4-heptanone</option>
        <option value="hexadecn">n-hexadecane</option>
        <option value="hexane">n-hexane</option>
        <option value="hexnacid">hexanoic acid</option>
        <option value="hexanol">1-hexanol</option>
        <option value="hexanon2">2-hexanone</option>
        <option value="hexene">1-hexene</option>
        <option value="hexyne">1-hexyne</option>
        <option value="c6h5i">iodobenzene</option>
        <option value="iobutane">1-iodobutane</option>
        <option value="c2h5i">iodoethane</option>
        <option value="iohexdec">1-iodohexadecane</option>
        <option value="ch3i">iodomethane</option>
        <option value="iopentan">1-iodopentane</option>
        <option value="iopropan">1-iodopropane</option>
        <option value="cumene">isopropylbenzene</option>
        <option value="p-cymene">p-isopropyltoluene</option>
        <option value="mesityln">mesitylene</option>
        <option value="methanol">methanol</option>
        <option value="egme">2-methoxyethanol</option>
        <option value="meacetat">methyl acetate</option>
        <option value="mebnzate">methyl benzoate</option>
        <option value="mebutate">methyl butanoate</option>
        <option value="meformat">methyl formate</option>
        <option value="mibk">4-methyl-2-pentanone</option>
        <option value="mepropyl">methyl propanoate</option>
        <option value="isobutol">2-methyl-1-propanol</option>
        <option value="terbutol">2-methyl-2-propanol</option>
        <option value="nmeaniln">N-methylaniline</option>
        <option value="mecychex">methylcyclohexane</option>
        <option value="nmfmixtr">N-methylformamide (E/Z mixture)</option>
        <option value="isohexan">2-methylpentane</option>
        <option value="mepyrid2">2-methylpyridine</option>
        <option value="mepyrid3">3-methylpyridine</option>
        <option value="mepyrid4">4-methylpyridine</option>
        <option value="c6h5no2">nitrobenzene</option>
        <option value="c2h5no2">nitroethane</option>
        <option value="ch3no2">nitromethane</option>
        <option value="ntrprop1">1-nitropropane</option>
        <option value="ntrprop2">2-nitropropane</option>
        <option value="ontrtolu">o-nitrotoluene</option>
        <option value="nonane">n-nonane</option>
        <option value="nonanol">1-nonanol</option>
        <option value="nonanone">5-nonanone</option>
        <option value="octane">n-octane</option>
        <option value="octanol">1-octanol</option>
        <option value="octanon2">2-octanone</option>
        <option value="pentdecn">n-pentadecane</option>
        <option value="pentanal">pentanal</option>
        <option value="npentane">n-pentane</option>
        <option value="pentacid">pentanoic acid</option>
        <option value="pentanol">1-pentanol</option>
        <option value="pentnon2">2-pentanone</option>
        <option value="pentnon3">3-pentanone</option>
        <option value="pentene">1-pentene</option>
        <option value="e2penten">E-2-pentene</option>
        <option value="pentacet">pentyl acetate</option>
        <option value="pentamin">pentylamine</option>
        <option value="pfb">perfluorobenzene</option>
        <option value="benzalcl">phenylmethanol</option>
        <option value="propanal">propanal</option>
        <option value="propacid">propanoic acid</option>
        <option value="propanol">1-propanol</option>
        <option value="propnol2">2-propanol</option>
        <option value="propntrl">propanonitrile</option>
        <option value="propenol">2-propen-1-ol</option>
        <option value="propacet">propyl acetate</option>
        <option value="propamin">propylamine</option>
        <option value="pyridine">pyridine</option>
        <option value="c2cl4">tetrachloroethene</option>
        <option value="thf">tetrahydrofuran</option>
        <option value="sulfolan">tetrahydrothiophene-S,S-dioxide</option>
        <option value="tetralin">tetralin</option>
        <option value="thiophen">thiophene</option>
        <option value="phsh">thiophenol</option>
        <option value="toluene">toluene</option>
        <option value="tbp">tributyl phosphate</option>
        <option value="tca111">1,1,1-trichloroethane</option>
        <option value="tca112">1,1,2-trichloroethane</option>
        <option value="tce">trichloroethene</option>
        <option value="et3n">triethylamine</option>
        <option value="tfe222">2,2,2-trifluoroethanol</option>
        <option value="tmben124">1,2,4-trimethylbenzene</option>
        <option value="isoctane">2,2,4-trimethylpentane</option>
        <option value="undecane">n-undecane</option>
        <option value="m-xylene">m-xylene</option>
        <option value="o-xylene">o-xylene</option>
        <option value="p-xylene">p-xylene</option>
        <option value="xylenemx">xylene (mixture)</option>
     </select>
     paw atoms: <input type="text" name="pawatoms" id="pawatoms" size=24 value = "" onChange="addpawatoms()" oninput="cacheInput(this)">  
     <select id="pspatomslibrary" onChange="addpawatoms()">
        <option value="development_psps">development_psps psp library</option>
        <option value="HGH_LDA">HGH_LDA psp library</option>
        <option value="TETER">TETER psp library</option>
        <option value="TM">TM psp library</option>
        <option value="pspw_new">pspw_new psp library</option>
        <option value="pspw_old">pspw_old psp library</option>
        <option value="pspw_default">pspw_default psp library</option>
     </select>: <input type="text" name="pspatoms" id="pspatoms" size=24 value = "" onChange="addpawatoms()" oninput="cacheInput(this)">  

    <table>
       <tr>
          <td> charge:       <input type="number" name="nwchemcharge" id="nwchemcharge" size="3" min="-100" max="100" step="1" value="0" 
                                    onChange="changenwchemcharge()" oninput="cacheInput(this)">
               multiplicity: <input type="number" name="nwchemmult" id="nwchemmult" size="3" min="1" max="100" step="1" value="1" 
                                    onChange="changenwchemmult()" oninput="cacheInput(this)"> 
               virtual:      <input type="number" name="nwchemvirt" id="nwchemvirt" size="3" min="0" max="100" step="1" value="0" 
                                    onChange="changenwchemvirt()" oninput="cacheInput(this)"> 
               Ewald rcut:   <input type="number" name="nwchemewald_rcut" id="nwchemewald_rcut" size="3" min="0.00" max="20.0" step="0.5" value="0" 
                                    onChange="changenwchemewald_rcut()" oninput="cacheInput(this)"> 
               Ewald ncut: <input type="number" name="nwchemewald_ncut" id="nwchemewald_ncut" size="3" min="0" max="20" step="1" value="0" onChange="changenwchemewald_ncut()"> 
               <select id="parallelmapping3" onChange="changeparallelmapping3()" oninput="cacheInput(this)">
                  <option value="default">default</option>
                  <option value="1d-slab">1d-slab</option>
                  <option value="2d-hilbert">2d-hilbert</option>
                  <option value="2d-hcurve" selected>2d-hcurve</option>
               </select>
               np_dimensions: <input type="number" name="nwchemnp_dim1" id="nwchemnp_dim1" size="2" min="-1" max="128" step="1" value="-1" onChange="changenwchemnp_dim()" oninput="cacheInput(this)"> 
                              <input type="number" name="nwchemnp_dim2" id="nwchemnp_dim2" size="2" min="-1" max="128" step="1" value="-1" onChange="changenwchemnp_dim()" oninput="cacheInput(this)"> 
               <div id="monkhorst_input_on">
                              <input type="number" name="nwchemnp_dim3" id="nwchemnp_dim3" size="2" min="-1" max="128" step="1" value="-1" onChange="changenwchemnp_dim()" oninput="cacheInput(this)"> 
               Monkhorst-Pack: <input type="number" name="nwchemmp1" id="nwchemmp1" size="2" min="1" max="50" step="1" value="1" onChange="changenwchemmp()" oninput="cacheInput(this)">
                               <input type="number" name="nwchemmp2" id="nwchemmp2" size="2" min="1" max="50" step="1" value="1" onChange="changenwchemmp()" oninput="cacheInput(this)">
                               <input type="number" name="nwchemmp3" id="nwchemmp3" size="2" min="1" max="50" step="1" value="1" onChange="changenwchemmp()" oninput="cacheInput(this)"> 
               dbz(len)_min: <input type="number" name="nwchemmpmin" id="nwchemmpmin" size="2" min="0" max="5" step="0.1" value="0.6" onChange="changenwchemmpmin()" oninput="cacheInput(this)">
               </div>
          </td>
       </tr>
       <tr>
          <td> <select id="nwchemoptimizer" onChange="changenwchemoptimizer()" oninput="cacheInput(this)">
                  <option value="lmbfgs grassman">Grassman lmbfgs</option>
                  <option value="cg grassman">Grassman cg</option>
                  <option value="lmbfgs stiefel">Stiefel lmfgs</option>
                  <option value="cg stiefel">Stiefel cg</option>
                  <option value="scf">scf</option>
               </select>
               loop: <input type="number" name="nwcheminner_loop" id="nwcheminner_loop" size="1" min="1" max="1000" step="1" value="10" onChange="changenwcheminner_loop()" oninput="cacheInput(this)">
                     <input type="number" name="nwchemouter_loop" id="nwchemouter_loop" size="1" min="1" max="1000" step="10" value="100" onChange="changenwchemouter_loop()" oninput="cacheInput(this)">
               <div id="scf_input_on">
               scf options:
               <select id="nwchemscfopt" oninput="cacheInput(this)">
                  <option value="block-cg precondition">preconditioned block-cg</option>
                  <option value="cg precondition">preconditioned cg</option>
                  <option value="rmm-diis precondition">preconditioned rmm-diis</option>
                  <option value="block-cg">block-cg</option>
                  <option value="cg">cg</option>
                  <option value="rmm-diis">rmm-diis</option>
               </select>
               ks_iterations: <input type="number" name="nwcheminner_ksit" id="nwcheminner_ksit" size="1" min="1" max="1000" step="1" value="10" onChange="changenwcheminner_ksit()" oninput="cacheInput(this)">
                              <input type="number" name="nwchemouter_ksit" id="nwchemouter_ksit" size="1" min="1" max="1000" step="1" value="10" onChange="changenwchemouter_ksit()">
               <select id="nwchemscfmixing" oninput="cacheInput(this)">
                  <option value="diis">diis</option>
                  <option value="anderson">anderson</option>
                  <option value="broyden">broyden</option>
                  <option value="simple">simple</option>
               </select>
               <select id="nwchemscfmixingtype">
                  <option value="density">density mixing</option>
                  <option value="potential">potential mixing</option>
               </select>
               ks_alpha: <input type="number" name="nwchemks_alpha" id="nwchemks_alpha" size="2" min="0.00" max="1.0" step="0.01" value="0.05" onChange="changenwchemks_alpha()" oninput="cacheInput(this)"> 
               kerker: <input type="number" name="nwchemkerker" id="nwchemkerker" size="2" min="0.00" max="100.0" step="0.50" value="0.00" onChange="changenwchemkerker()" oninput="cacheInput(this)"> 
               </div>
          </td>
       </tr>
       <tr>
          <td> 
              Born Model <input type="radio" id="nwchem_born" onClick="ClearRd(this,7)" title="include Born solvation"/>
              <select id="nwchemfractional" onChange="changenwchemfractional()">
                  <option value="No fractional">No fractional</option>
                  <option value="Fixed">Fixed fractional</option>
                  <option value="Stepped">Stepped fractional</option>
                  <option value="Fermi">Fermi fractional</option>
                  <option value="Gaussian">Gaussian fractional</option>
                  <option value="Marzari-Vanderbilt">Marzari-Vanderbilt fractional</option>
               </select>
               <div id="fractional_input_on"> temperature(K): <input type="number" name="nwchemkfractional_temperature" id="nwchemfractional_temperature" size="3" min="0.0" max="50000.0" step="10.0" value="300.0" onChange="changenwchemfractional_temperature()" oninput="cacheInput(this)"> 
               alpha: <input type="number" name="nwchemkfractional_alpha" id="nwchemfractional_alpha" size="2" min="0.00" max="1.00" step="0.01" value="0.25" onchange="changenwchemfractional_alpha()" oninput="cacheInput(this)"> 
               extra orbitals: <input type="number" name="nwchemkfractional_orbitals" id="nwchemfractional_orbitals" size="2" min="0" max="50" step="1" value="5" onchange="changenwchemfractional_orbitals()" oninput="cacheInput(this)">  </div>

               <select id="nwchemefieldtype" onchange="changenwchemefieldtype()" oninput="cacheInput(this)">
                  <option value="No efield">No efield</option>
                  <option value="periodic efield">periodic efield</option>
                  <option value="realspace efield">real space efield</option>
                  <option value="APC efield">APC efield</option>
               </select>: 
               <div id="efield_input_on"> 
                  <input type="number" name="nwchemefield1" id="nwchemefield1" size="2" min="0.000" max="5.000" step="0.01" value="0.000" onchange="changenwchemefield()" oninput="cacheInput(this)">
                  <input type="number" name="nwchemefield2" id="nwchemefield2" size="2" min="0.000" max="5.000" step="0.01" value="0.000" onchange="changenwchemefield()" oninput="cacheInput(this)">
                  <input type="number" name="nwchemefield3" id="nwchemefield3" size="2" min="0.000" max="5.000" step="0.01" value="0.000" onchange="changenwchemefield()" oninput="cacheInput(this)"> 
               </div>
          </td>
       </tr>
    </table>
    <br>
    <table>
       <tr>
          <td> <input type="button" class="button4" value="Add Born-Oppenheimer" onClick="addbomd(false,'','')"/></td>
          <td> <input type="button" class="button4" value="Add Car-Parrinello" onClick="addcpmd(false,'','')"/></td>
          <td> <input type="button" class="button4" value="Add Steepest Descent" onClick="addcpsd('')"/></td>
          <td> <input type="button" class="button4" id="metadynamics" value="Add Metadynamics" style="color:darkmagenta;" onClick="addmetadynamics()"/>  </td>
          <td> <input type="button" class="button4" id="TAMD" value="Add TAMD" style="color:darkmagenta;" onClick="addtamd()"/>  </td>
          <td> <input type="button" class="button4" value="EXAFS" style="color:brown;" onClick="addexafs(false)"</td>
          <td> <input type="button" class="button4" value="Add AIMD-EXAFS" style="color:brown;" onClick="addexafs(true)"/></td>
          <td> <input type="button" class="button4" value="Add AIMD-IR" style="color:orangered;" onClick="addaimdir(true)"/></td>
       </tr>
       <tr>
          <td> <input type="button" class="button4" id="springconstraint2" value="Add reaction QMMM" style="color:green;" onClick="addreactionconstraint(true)"/>  </td>
          <td> <input type="button" class="button4" id="shakegconstraint22" value="Add shake constraint" style="color:green;" onClick="addshakeconstraint()"/>  </td>
          <td> <input type="button" class="button4" value="Simulated Annealing" onClick="addannealing()"/></td>
          <td> <input type="button" class="button4" value="Metadynamics Simulation" style="color:darkmagenta;" onClick="jmaddsmiles('Xx',1)"/></td>
          <td> <input type="button" class="button4" value="PMF Simulation" style="color:darkmagenta;" onClick="jmaddsmiles('Xx',1)"/></td>
       </tr>
    </table>
    <table>
       <tr>
          <td>
             translation off <input type="radio" id="nwchem_translation_off" onClick="ClearRd(this,10)" oninput="cacheInput(this)" title="include translation off"/>
             rotation off    <input type="radio" id="nwchem_rotation_off"    onClick="ClearRd(this,11)" oninput="cacheInput(this)" title="include rotation off"/>
          </td>
       </tr>
       <tr>
          <td> temperature(K):<input type="number" name="nwchemmdtemperature" id="nwchemmdtemperature" size="1" min="10.0" max="52190.9" step="10.0" value="300.0" 
                                      oninput="cacheInput(this)">
               fake_mass(au): <input type="number" name="nwchemmdfakemass" id="nwchemmdfakemass" size="1" min="1" max="52190.9" step="1.0" value="750.0" 
                                     oninput="cacheInput(this)">
               time_step(au): <input type="number" name="nwchemmdtimestep" id="nwchemmdtimestep" size="1" min="0.01" max="100.0" step="0.5" value="5.0" 
                                     oninput="cacheInput(this)">
               md_loop:       <input type="number" name="nwchemmdinner_loop" id="nwchemmdinner_loop" size="1" min="0" max="1000" step="5" value="10" 
                                     oninput="cacheInput(this)">
                              <input type="number" name="nwchemmdouter_loop" id="nwchemmdouter_loop" size="1" min="0" max="100000" step="100" value="100" 
                                      oninput="cacheInput(this)">
               total_time(ps):<input type="number" name="nwchemmdtime" id="nwchemmdtime" size="1" min="0.1" max="9000.0" step="0.5" value="10.0" 
                                     oninput="cacheInput(this)">
               motion_label: <input type="text" name="nwchemmdlabel" id="nwchemmdlabel" size="10" value="tequil" 
                                     oninput="cacheInput(this)">
          </td>
       </tr>
    </table>

</div>

<div id="Arrows Periodic 3D Builder" class="tabcontent">

    <!--  end of jsmol table -->
    <table> 
       <!--  start of jsmol block -->
       <tr>
          <td>
             <input type="button" VALUE="&#8599; JSMol to Editor" onClick="jmoltoeditor()" style="background-color:#f8f8ff; color:#0000ff; font-size: 14px; font-weight:bold"/>
             <input type="button" VALUE="Editor to JSMol &#8601;" onClick="jmloadxyz()" style="background-color:#f8f8ff; color:#0000ff; font-size: 14px; font-weight:bold"/>
             <input type="button" VALUE="Editor append to JSMol &#8601;" onClick="jmappendxyz()" style="background-color:#f8f8ff; color:#0000ff; font-size: 14px; font-weight:bold"/>
             <input type="button" VALUE="&#8598; Editor trajectory to JSMol models" onClick="jmloadtraj()" style="background-color:#f8f8ff; color:#0000ff; font-size: 14px; font-weight:bold"/>
             <input type="button" value="Reset pointer"  onClick="jmresetPointer()" style="background-color:#f8f8ff; color:#0000ff; font-size: 14px; font-weight:bold"/>
              <input type="button" class="button" id="showcell1"   value="Unit cell on" onClick="jmshowcell()"/>
          </td>
          <td>
             <!--p style="text-align:left"-->
                 <input type="button" VALUE="Builder" onClick="SwapDivsWithClick(1,'swapper-first','swapper-crystal','swapper-surface','swapper-symmetry','swapper-other','swapper-other2','swapper-other3')" style="background-color:#f8f8ff; color:#102DB0; font-size: 14px; font-weight:bold"/>
                 <input type="button" VALUE="Lattice" onClick="SwapDivsWithClick(2,'swapper-first','swapper-crystal','swapper-surface','swapper-symmetry','swapper-other','swapper-other2','swapper-other3')" style="background-color:#f8f8ff; color:#102DB0; font-size: 14px; font-weight:bold"/>
                 <input type="button" VALUE="Bulk-Surface" onClick="SwapDivsWithClick(3,'swapper-first','swapper-crystal','swapper-surface','swapper-symmetry','swapper-other','swapper-other2','swapper-other3')" style="background-color:#f8f8ff; color:#102DB0; font-size: 14px; font-weight:bold"/>
                 <input type="button" VALUE="Symmetry" onClick="SwapDivsWithClick(4,'swapper-first','swapper-crystal','swapper-surface','swapper-symmetry','swapper-other','swapper-other2','swapper-other3')" style="background-color:#f8f8ff; color:#102DB0; font-size: 14px; font-weight:bold"/>
                 <input type="button" VALUE="Polyhedra" onClick="SwapDivsWithClick(5,'swapper-first','swapper-crystal','swapper-surface','swapper-symmetry','swapper-other','swapper-other2','swapper-other3')" style="background-color:#f8f8ff; color:#102DB0; font-size: 14px; font-weight:bold"/>
                 <input type="button" VALUE="Reaction" onClick="SwapDivsWithClick(6,'swapper-first','swapper-crystal','swapper-surface','swapper-symmetry','swapper-other','swapper-other2','swapper-other3')" style="background-color:#f8f8ff; color:#102DB0; font-size: 14px; font-weight:bold"/>
                 <input type="button" VALUE="Collective" onClick="SwapDivsWithClick(7,'swapper-first','swapper-crystal','swapper-surface','swapper-symmetry','swapper-other','swapper-other2','swapper-other3')" style="background-color:#f8f8ff; color:#102DB0; font-size: 14px; font-weight:bold"/>
             <!--/p -->
          </td>
       </tr> 
       <tr> 
            <td align="left" id="jsmoldiv" class="jmolcontainer" style="height: auto "></td>
            <td>

               <div id="swapper-first" style="display:block; border:2px dashed; border-color: #102DB0; background-color: white;  padding:25px;">
               <table>
                   <tr><td align="center" style="color:#102DB0"> JSMol Builder Options <br><br> </td> </tr>
                   <tr> <td id="jsmolbtns"></td></tr>
                   <tr>
                      <td>
                         <input type="button" value="Center atom"  onClick="jmcenteratom()"/> 
                         <input type="button" value="Center Origin"  onClick="jmcenterorigin()"/> 
                         <input type="button" value="Console" onClick="jms0('console;')"/> 
                         <input type="button" value="Reset pointer"  onClick="jmresetPointer()"/> 
                      </td>
                   </tr>
                   <tr>
                      <td>
                         <table>
                            <tr>
                               <td>
                                  <table align="center">
                                     <tr>
                                        <td> <input type="button" value="H " onClick="jmpickatom('H')" style="background-color:#f8f8ff; color:#606f7d; font-weight:bold"/> </td>
                                        <td> <input type="button" value="B " onClick="jmpickatom('B')" style="background-color:#f8f8ff; color:#ff6699; font-weight:bold"/> </td>
                                        <td> <input type="button" value="C " onClick="jmpickatom('C')" style="background-color:#f8f8ff; color:#000000; font-weight:bold"/> </td>
                                        <td> <input type="button" value="N " onClick="jmpickatom('N')" style="background-color:#f8f8ff; color:#1f2bd5; font-weight:bold"/> </td>
                                     </tr>
                                     <tr>
                                        <td> <input type="button" value="O " onClick="jmpickatom('O')"  style="background-color:#f8f8ff; color:#e6000d; font-weight:bold"/> </td>
                                        <td> <input type="button" value="F " onClick="jmpickatom('F')"  style="background-color:#f8f8ff; color:#7ed83d; font-weight:bold"/> </td>
                                        <td> <input type="button" value="Al" onClick="jmpickatom('Al')" style="background-color:#f8f8ff; color:#a08c8c; font-weight:bold"/> </td>
                                        <td> <input type="button" value="Si" onClick="jmpickatom('Si')" style="background-color:#f8f8ff; color:#dcaf82; font-weight:bold"/> </td>
                                     </tr>
                                     <tr>
                                        <td> <input type="button" value="P " onClick="jmpickatom('P')"  style="background-color:#f8f8ff; color:#e6640a; font-weight:bold"/> </td>
                                        <td> <input type="button" value="S " onClick="jmpickatom('S')"  style="background-color:#f8f8ff; color:#cccc00; font-weight:bold"/> </td>
                                        <td> <input type="button" value="Cl" onClick="jmpickatom('Cl')" style="background-color:#f8f8ff; color:#23c814; font-weight:bold"/> </td>
                                        <td> <input type="button" value="Br" onClick="jmpickatom('Br')" style="background-color:#f8f8ff; color:#8c191e; font-weight:bold"/> </td>
                                     </tr>
                                     <tr>
                                        <td> <input type="button" name="atomX1" id="atomX1" value="??" onClick="jmpickatom('X1')"/> </td>
                                        <td> <input type="button" name="atomX2" id="atomX2" value="??" onClick="jmpickatom('X2')"/> </td>
                                        <td> <input type="button" name="atomX3" id="atomX3" value="??" onClick="jmpickatom('X3')"/> </td>
                                        <td> <input type="button" name="atomX4" id="atomX4" value="??" onClick="jmpickatom('X4')"/> </td>
                                     </tr>
                                     <tr>
                                        <td> <input type="button" name="atomX5" id="atomX5" value="??" onClick="jmpickatom('X5')"/> </td>
                                        <td> <input type="button" name="atomX6" id="atomX6" value="??" onClick="jmpickatom('X6')"/> </td>
                                        <td> <input type="button" name="atomX7" id="atomX7" value="??" onClick="jmpickatom('X7')"/> </td>
                                        <td> <input type="button" value="Xx" onClick="jmpickatom('Xx')"/> </td>
                                     </tr>
                                     <tr>
                                        <td> <input type="button" value="Q+" onClick="jms('set picking assignAtom_pl')"</td>
                                        <td> <input type="button" value="Q-" onClick="jms('set picking assignAtom_mi')"</td>
                                        <td> <input type="button" value="e-" onClick="jmaddsmiles('SHE',1)"</td>
                                        <td> <input type="button" name="insertatom" id="insertatom" value="^^" onClick="jminsertatom(true)"</td>
                                     </tr>
                                  </table>
                               <td/>
                               <td>
                                  <table align="center">
                                     <tr>
                                        <td> <input type="button" class="button" id="showcell0"   value="Unit cell on" onClick="jmshowcell()"/> </td>
                                        <td> <input type="button" class="button" id="centercell0" value="Center" onClick="jmscentercell()"/> </td>
                                     </tr>
                                     <tr>
                                        <td> <input type="button" class="button2" value="Move atom"  onClick="jmmoveatom()"/> </td>
                                        <td> <input type="button" class="button2" value="Move mol."  onClick="jmmovemolecule()"/> </td>
                                     </tr>
                                     <!--tr>
                                        <td> <input type="button" class="button2" value="Drag atom" onClick="jms('set picking dragMinimize')"/> </td>
                                        <td> <input type="button" class="button2" value="Docking" onClick="jms('set picking dragMinimizeMolecule')"/> </td>
                                     </tr-->
                                     <tr>
                                        <td> <input type="button" class="button2" value="Rotate bond"  onClick="jmrotatebond()"/> </td>
                                        <td> <input type="button" class="button2" value="Rotate mol."  onClick="jmrotatemolecule()"/> </td>
                                     </tr>
                                     <tr>
                                        <td> <input type="button" class="button2" value="Corr. H" onClick="jms('delete hydrogen;calculate hydrogens')"/> </td>
                                        <td> <input type="button" class="button2" value="Corr. H mol." onClick="jmhcleanmolecule()"/> </td>
                                     </tr>
                                     <tr>
                                        <td> <input type="button" class="button2" value="Opt. all" onClick="jms('select nonmetal;minimize steps 100; select *; wireframe 0.15; spacefill 23%; boundbox {*}; centerat boundbox; zoom 0; javascript echo(globalVar)')"/> </td>
                                        <td> <input type="button" class="button2" value="Opt. mol." onClick="jmminimizemolecule()"/> </td>
                                     </tr>
                                     <tr>
                                        <td> <input type="button" class="button2" value="Undo" onClick="jm_cmdlist_undo()"/> </td>
                                        <td> <input type="button" class="button2" value="Redo" onClick="jm_cmdlist_redo()"/> </td>
                                     </tr>
                                  </table>
                               </td>
                            <tr/>
                         </table>
                      </td>
                   </tr>
                   <tr>
                      <td>
                         <table>
                            <tr>
                               <td> <input type="button" class="button3" value="Add H2O" onClick="jmaddsmiles('H2O',1)"</td>
                               <td> <input type="button" class="button3" value="Add CH4" onClick="jmaddsmiles('CH4',1)"</td>
                               <td> <input type="button" class="button3" value="Add smiles" onClick="jmaddsmiles('Xx',1)"</td>
                            </tr>
                            <tr>
                               <td> <input type="button" class="button3" name="smilesX1" id="smilesX1" value="smiles?" onClick="jmaddsmiles('X1',1)"</td>
                               <td> <input type="button" class="button3" name="smilesX2" id="smilesX2" value="smiles?" onClick="jmaddsmiles('X2',1)"</td>
                               <td> <input type="button" class="button3" name="smilesX3" id="smilesX3" value="smiles?" onClick="jmaddsmiles('X3',1)"</td>
                            </tr>
                            <tr> <td> </td> </tr>
                            <tr>
                               <td> <input type="button" class="button3" value="Delete atom" 
                                            onClick="jms('set picking off; set picking on; set atomPicking true;set picking DELETEATOM')"/> </td>
                               <td> <input type="button" class="button3" value="Delete bond" onClick="jms('hover on; set picking assignBond_0; hover off')"/> </td>
                               <td> <input type="button" class="button3" value="Delete mol." onClick="jmdeletemolecule()"/> </td>
                            </tr>
                            <tr>
                               <td> <input type="button" class="button3" value="Single" onClick="jms('hover on; set picking assignBond_1; hover off')"/> </td>
                               <td> <input type="button" class="button3" value="Double" onClick="jms('hover on; set picking assignBond_2; hover off')"/> </td>
                               <td> <input type="button" class="button3" value="Triple" onClick="jms('hover on; set picking assignBond_3; hover off')"/> </td>
                            </tr>
                            <tr> <td> </td> </tr>
                            <tr>
                               <td> <input type="button" class="button3" value="Length" 
                                           onClick="jms0('set picking off;set picking on;set pickingstyle MEASURE; set picking MEASURE DISTANCE')"/> </td>
                               <td> <input type="button" class="button3" value="Angle" 
                                           onClick="jms0('set picking off;set picking on;set pickingstyle MEASURE; set picking MEASURE ANGLE')"/> </td>
                               <td> <input type="button" class="button3" value="Torsion" 
                                           onClick="jms0('set picking off;set picking on; set pickingstyle MEASURE; set picking MEASURE TORSION')"/> </td>
                            </tr>
                            <tr>
                               <td> <input type="button" class="button3" name="jmolspin" id="jmolspin" value="Spin on" onClick="jmspin()"/> </td>
                               <td> <input type="button" class="button3" name="jmolaxes" id="jmolaxes" value="Axes on" onClick="jmaxes()"/>  </td>
                               <td> <input type="button" class="button3" name="jmbackcolor" id="jmbackcolor" value="Bckgrnd black" onClick="jmbackground()"/>  </td>
                            </tr>
                            <tr>
                               <td> <input type="button" class="button3" name="jmollabel" id="jmollabel" value="Labels on" onClick="jmlabel()"/>  </td>
                               <td> <input type="button" class="button3" name="jmlblcolor" id="jmlblcolor" value="Label black" onClick="jmlabelcolor()"/>  </td>
                               <td> <input type="button" class="button3" value="Redraw" onClick="jmredrawMolecule()"/>  </td>
                            </tr>
                            <tr>
                               <td> <input type="button" class="button3" name="jmolreactionplane2" id="jmolreactionplane2" value="Reaction on" onClick="jmreactionplane()"/> </td>
                               <td> <input type="button" class="button3" name="jmolmodelkit" id="jmolmodelkit" value="ModelKit off"  onClick="jmmodelkit()"/>  </td>
                               <td> <input type="button" class="button3" value="Clean restart"  onClick="jmreset()"/>  </td>
                            </tr>
                         </table>
                         <input type="button" class="button3" value="trans_selected"  onClick="jmreset()"/> 
                         <input type="3array" id="translate_smiles"  size="21" oninput="cacheInput(this)">
                         <input type="button" VALUE="Solvate" onClick="solvateurltojsmol()" title="Load xyz data from url into jsmol"/>
                         <br>
                         <input type="button" VALUE="Load esmiles" onClick="loadurltojsmol(false)" title="Load xyz data from url into jsmol"/>
                         <input type="button" VALUE="Append" onClick="loadurltojsmol(true)" title="Append xyz data from url into jsmol"/>
                         <input type="url" id="urlToLoad2" SIZE=22 oninput="cacheInput(this)"/>
                         <br>
                         <b style="color: blue; font-size: 14px;" id="runmebanner4b"></b>
                         <br>
                         <b>MD_parameters</b>
                         <input type="button" class="button2" value="Bylaska MD" onClick="myoptimizer()"/>
                         <b id="md_banner" style="color: blue">0 iter.</b>
                         <br>
                         <textarea  name="MD_parameters" id="MD_parameters" rows="4" cols="40" oninput="cacheInput(this)"></textarea>
                         <br>
                         <input type="button" value="Next model" onClick="loadframe2jsmol(false,false,0)" title="Next xyzframe"/>
                         <input type="button" value="Previous model" onClick="prevframe2jsmol(true,false)" title="Previous xyzframe"/>
                         <input type="button" value="New model" onClick="loadframe2jsmol(true,false,0)" title="Add new xyzframe"/>
                         <br>
                         <input type="button" value="Append model" onClick="loadframe2jsmol(false,true,0)" title="Append new xyzframe"/>
                         <input type="button" value="Delete model" onClick="deleteframe2jsmol()" title="Delete current xyz frame"/>
                         <b style="color: blue; font-size: 14px;" id="model_label">Model 1 out of 1</b>
                         <br>
                         <input type="button" value="Delete all models" onClick="deleteframeall()" title="Remove all xyz frames"/>
                      </td>
                   </tr>

               </table>
               </div>

               <div id="swapper-other" style="display:none; border:2px dashed; border-color: #102DB0; background-color: white; padding:10px;">
               <p align="center" style="color:#102DB0"> Polyhedra and Spin Penalty </p>
               <table>
                  <tr> 
                  <input type="button" class="button" id="redrawspin" value="Reset spin color" onClick="jms('select *; color cpk;');"/>  
                  <input type="button" class="button" id="redrawpoly" value="Clear polyhedra" onClick="jms('delete $atomlist*;');"/>  
                  <br> <br>
                  </tr>
                  <tr> 
                     <td> <select id="colortype1" onchange="set_color_penalty('atomlist1','colortype1','penalty1a','penalty1b','penalty1c')" oninput="cacheInput(this)">
                          <option value="translucent green" selected="selected">translucent green</option>
                          <option value="translucent yellow">translucent yellow</option>
                          <option value="translucent red">translucent red</option>
                          <option value="translucent blue">translucent blue</option>
                          <option value="translucent orange">translucent orange</option>
                          <option value="translucent grey">translucent grey</option>
                          </select>
                          <select id="penalty1a" oninput="cacheInput(this)">
                          <option value="up" selected="selected">up</option>
                          <option value="down">down</option>
                          <option value="polyhedra">polyhedra</option>
                          </select>
                          <select id="penalty1b" oninput="cacheInput(this)">
                          <option value="s">s</option>
                          <option value="p">p</option>
                          <option value="d" selected="selected">d</option>
                          <option value="f">f</option>
                          <option value="tetra">tetra</option>
                          <option value="penta">penta</option>
                          <option value="octa">octa</option>
                          <option value="other">other</option>
                          </select>
                          <input type="number" id="penalty1c" size="9" min="-10.000" max="10.000" step="0.01" value="-1.00" oninput="cacheInput(this)"> 
                     </td>
                  </tr> 
                  <tr>
                     <td> atoms: <input type="atomarray" id="atomlist1"  size="70" value="" onchange="set_color_penalty('atomlist1','colortype1','penalty1a','penalty1b','penalty1c')" oninput="cacheInput(this)"> <br><br></td>
                  </tr>
                  <tr> 
                     <td> <select id="colortype2" onchange="set_color_penalty('atomlist2','colortype2','penalty2a','penalty2b','penalty2c')" oninput="cacheInput(this)">
                          <option value="translucent green">translucent green</option>
                          <option value="translucent yellow" selected="selected">translucent yellow</option>
                          <option value="translucent red">translucent red</option>
                          <option value="translucent blue">translucent blue</option>
                          <option value="translucent orange">translucent orange</option>
                          <option value="translucent grey">translucent grey</option>
                          </select>
                          <select id="penalty2a" oninput="cacheInput(this)">
                          <option value="up">up</option>
                          <option value="down" selected="selected">down</option>
                          <option value="polyhedra">polyhedra</option>
                          </select>
                          <select id="penalty2b" oninput="cacheInput(this)">
                          <option value="s">s</option>
                          <option value="p">p</option>
                          <option value="d" selected="selected">d</option>
                          <option value="f">f</option>
                          <option value="tetra">tetra</option>
                          <option value="penta">penta</option>
                          <option value="octa">octa</option>
                          <option value="other">other</option>
                          </select>
                           <input type="number" id="penalty2c" size="9" min="-10.000" max="10.000" step="0.01" value="-1.00" oninput="cacheInput(this)"> 
                     </td>
                  </tr> 
                  <tr> 
                     <td> atoms: <input type="atomarray" id="atomlist2"  size="70" value="" onchange="set_color_penalty('atomlist2','colortype2','penalty2a','penalty2b','penalty2c')" oninput="cacheInput(this)"><br><br> </td>
                  </tr> 
                  <tr> 
                     <td> <select id="colortype3" onchange="set_color_penalty('atomlist3','colortype3','penalty3a','penalty3b','penalty3c')" oninput="cacheInput(this)">
                          <option value="translucent 0.3 green">translucent green</option>
                          <option value="translucent 0.3 yellow">translucent yellow</option>
                          <option value="translucent 0.3 red" selected="selected">translucent red</option>
                          <option value="translucent 0.3 blue">translucent blue</option>
                          <option value="translucent 0.3 orange">translucent orange</option>
                          <option value="translucent 0.3 grey">translucent grey</option>
                          </select>
                          <select id="penalty3a" oninput="cacheInput(this)">
                          <option value="up">up</option>
                          <option value="down">down</option>
                          <option value="polyhedra" selected="selected">polyhedra</option>
                          </select>
                          <select id="penalty3b" oninput="cacheInput(this)">
                          <option value="s">s</option>
                          <option value="p">p</option>
                          <option value="d">d</option>
                          <option value="f">f</option>
                          <option value="tetra">tetra</option>
                          <option value="penta">penta</option>
                          <option value="octa" selected="selected">octa</option>
                          <option value="other">other</option>
                          </select>
                          <input type="number" id="penalty3c" size="9" min="-10.000" max="10.000" step="0.01" value="6" oninput="cacheInput(this)"> 
                     </td>
                  </tr> 
                  <tr> 
                     <td> atoms: <input type="atomarray" id="atomlist3"  size="70" value="" onchange="set_color_penalty('atomlist3','colortype3','penalty3a','penalty3b','penalty3c')" oninput="cacheInput(this)"> <br><br></td>
                  </tr> 
                  <tr> 
                     <td> <select id="colortype4" onchange="set_color_penalty('atomlist4','colortype4','penalty4a','penalty4b','penalty4c')" oninput="cacheInput(this)">
                          <option value="translucent 0.3 green">translucent green</option>
                          <option value="translucent 0.3 yellow">translucent yellow</option>
                          <option value="translucent 0.3 red">translucent red</option>
                          <option value="translucent 0.3 blue" selected="selected">translucent blue</option>
                          <option value="translucent 0.3 orange">translucent orange</option>
                          <option value="translucent 0.3 grey">translucent grey</option>
                          </select>
                          <select id="penalty4a" oninput="cacheInput(this)">
                          <option value="up">up</option>
                          <option value="down">down</option>
                          <option value="polyhedra" selected="selected">polyhedra</option>
                          </select>
                          <select id="penalty4b" oninput="cacheInput(this)">
                          <option value="s">s</option>
                          <option value="p">p</option>
                          <option value="d">d</option>
                          <option value="f">f</option>
                          <option value="tetra">tetra</option>
                          <option value="penta">penta</option>
                          <option value="octa" selected="selected">octa</option>
                          <option value="other">other</option>
                          </select>
                          <input type="number" id="penalty4c" size="9" min="-10.000" max="10.000" step="0.01" value="6" oninput="cacheInput(this)">
                     </td>
                  </tr> 
                  <tr> 
                     <td> atoms: <input type="atomarray" id="atomlist4"  size="70" value="" onchange="set_color_penalty('atomlist4','colortype4','penalty4a','penalty4b','penalty4c')" oninput="cacheInput(this)"> </td>
                  </tr> 
               </table>
               </div>

                <!-- reaction input -->
               <div id="swapper-other2" style="display:none; border:2px dashed;  border-color: #102DB0; background-color: white; padding:10px;">
               <p align="center" style="color:#102DB0"> Reaction Input </p>
                 <section class="marquee" style="color: red"> <b id="runmebanner4"> </b> </section>
                 <form style="font-size:14px; font-weight:bold" autocomplete="on">
                   chemical reaction
                   <br>
                   <input type="text" id="reaction_genhash00" SIZE=83 title="Thomas: set text reaction_genhash00 :" oninput="cacheInput(this)">
                   <input type="button" VALUE="Use JSME reaction" onClick="loadreaction2dWindow('reaction_genhash00')" 
                           style="font-size:13px;background-color:#f8f8ff;color:#6F4E37"
                           title=": reaction_genhash00 : Fetches chemical reaction from JSME editor"/>
                   <br>
                   <input type="button" id="button_buildreactants" VALUE="Build reactants from chemical reaction" 
                          onClick="appendreactants2jsmol(document.getElementById('reaction_genhash00').value,1,
                                                         document.getElementById('check_buildreactants').checked)"
                          title="Loads the reactants into jsmol from the chemical reaction input box"/>
                   <input type="3array" id="translate_reactants"  size="10" oninput="cacheInput(this)">
                   append: <input type="radio" id="check_buildreactants" onClick="ClearRd(this,13)"
                              title="Thomas: set radio check_buildreactants : Append reactants from chemmical reaction"/>
                   <br><br> 
                   reaction_hash 
                      <input type="button" id="button_genrhash" VALUE="Generate reaction hash from chemical reaction" onClick="gen_rhash2(dummy_callback)"
                             title="Generates reaction_hash using chemical reaction input"/>
                      <b style="color: blue; font-size: 14px;" id="runmebanner4p"></b>
                   <br>
                   <textarea name="reaction_hash" id="reaction_hash" rows="5" cols="70" 
                             style="font-size:13px;color:#6F4E37"
                             title="Thomas: set text reaction_hash :" oninput="cacheInput(this)"></textarea>
                   <br><br>
                   reaction constraint choices 
                      <input type="button" id="button_searchrconstraints" VALUE="Generate reaction constaint(s) from reaction hash" 
                             onClick="gen_reactions1(dummy_callback)" title="Searches for possible reaction constraints using the current geometry and reaction_hash"/>
                   <br>
                   <textarea  name="reaction_hash2" id="reaction_hash2" rows="5" cols="70" 
                              style="font-size:13px;color:#6F4E37"
                              title="Thomas: set text reaction_hash2 :" oninput="cacheInput(this)"></textarea>
                   <br>
                   reaction constraint<br>
                   <textarea  name="reaction_bondings" id="reaction_bondings" rows="4" cols="70" 
                              style="font-size:13px;color:#6F4E37"
                              title=": set text reaction_bondings :" oninput="cacheInput(this)"></textarea>
                   <br>
                   <br>

                   reaction_gamma{<input type="number" id="reaction_gamma" value="0.00" step="0.1" min="-100" max="+100" 
                                         style="font-size:13px;color:#6F4E37"
                                         title=": set number reaction_gamma :">}
                      <input type="button" VALUE="Update reaction gamma" onClick="check_rgamma()" 
                             style="font-size:13px;background-color:#f8f8ff;color:#6F4E37"
                             title="Generate the reaction_gamma using current geometry and specified reaction_type and reaction indexes"/>
                   <br>
                   reaction_type{<select id="reaction_type" 
                                         style="font-size:13px;color:#6F4E37"
                                         title=": set text reaction_type :" oninput="cacheInput(this)">
                                   <option>None</option>
                                   <option>A + B --> AB</option>
                                   <option>AB --> A + B</option>
                                   <option>AB + C --> AC + B</option>
                                   <option>AB + CD --> CABD</option>
                                   <option>CABD --> AB + CD</option>
                                   <option>AB + CD --> AD + BC</option>
                                   <option>ABCD --> BCA + D</option>
                                   <option>EA + BCD --> AB + CDE</option>
                                   <option>ABC + DE --> DBE + AC</option>
                                   <option>ABCD + E --> A + BC + DE</option>
                                   <option>A + BCD + E --> ABC + DE</option>
                                   <option>ABCDE --> A + BCD + E</option>
                                   <option>A + B + CD --> AC + BD</option>
                                   <option>AB + C + D --> CABD</option>
                                   <option>AB + C --> ACB</option>
                                   <option>ABCD --> DBCA + DC</option>
                                   <option>DBCA + DC --> ABCD</option>
                                   <option>AB + CD --> ACB + D</option>
                                   <option>AC + BD --> A + B + CD</option>
                                   <option>ACB --> AB + C</option>
                                   <option disabled>──────────</option>
                                 </select>
                      <input type="button" class="button" id="sdd_reacton_type" value="add" 
                             style="font-size:13px;background-color:#f8f8ff;color:#6F4E37"
                             onClick="add_select_option('Add reaction_type: ','','reaction_type');"/> }
                      reaction_indexes{<input type="text" id="reaction_indexes" SIZE=14 
                                              style="font-size:13px;color:#6F4E37"
                                              title=": set text reaction_indexes :">} 
                      <input type="button" class="button" id="reactiontab_to_metadynamics" value="Generate bondings Collective input" 
                             style="font-size:13px;background-color:#f8f8ff;color:#6F4E37"
                             onClick="bondings_metadynamics();evalcollective();"/> 
                      <input type="button" VALUE="reGenerate reaction hash" onClick="gen_rhash1(dummy_callback)" 
                             style="font-size:13px;background-color:#f8f8ff;color:#6F4E37"
                             title="reGenerate reaction_hash using current geometry, reaction_type and reaction_gamma inputs"/>
                   <br>
                   <br>
                   <hr style="border: 1px dashed #102DB0;"/>
                   constraint path input -
                   min_gamma:
                      <input type="number" id="min_reaction_gamma" SIZE=9   min="-1000.0" max="1000.0" step="0.1" value="1000.0" 
                             title=": set number min_reaction_gamma :" oninput="cacheInput(this)"> 
                   max_gamma:
                      <input type="number" id="max_reaction_gamma" SIZE=9   min="-1000.0" max="1000.0" step="0.1" value="-1000.0" 
                             title=": set number max_reaction_gamma :" oninput="cacheInput(this)"> 
                   ngamma:
                      <input type="number" id="reaction_ngamma" SIZE=2  min="2" max="100" step="1" value="10" 
                             title=": set number reaction_ngamma :" oninput="cacheInput(this)"> 
                   <input type="button" value="Generate constraint path input" onClick="jmoltoeditor();convert2geometry(false);addreactionconstraintpath(false);" 
                           title="Load next xyz model into jsmol"/>

                   <hr style="border: 1px dashed #102DB0;"/>
                   WHAM input - 
                   WHAM_spring{<input type="number" id="umbrella_spring" value="0.3000" min="0.0000" max="100.0000" step="0.0010" 
                                      title="Thomas: set number umbrella_spring :" oninput="cacheInput(this)">}
                   WHAM_gamma{<input type="number" id="umbrella_gamma" value="0.00" min="-100" max="+100.00" step="0.10" 
                                     title="Thomas: set number umbrella_gamma :" oninput="cacheInput(this)">}
                   WHAM_nsolvent{<input type="text" id="umbrella_nsolvent" size=3
                                     title="Thomas: set number umbrella_nsolvent :" oninput="cacheInput(this)">}
                   <br>
                   <input type="button" VALUE="Generate WHAM model" onClick="gen_wham_model(dummy_callback)" 
                          title="Generate a new xyz model by morphing 3 point reaction path"/>

                   <input type="button" value="Generate WHAM input" 
                          onClick="if (document.getElementById('check_buildreactants').checked) {
                                      if (confirm('Do you want to append the initial model?')){
                                         loadframe2jsmol(false,true,0);
                                      }
                                   }
                                   jmoltoeditor();convert2geometry(false);addreactionconstraint(true);addcpmd(false,'','');" 
                          title="Load next xyz model into jsmol"/>

                   <input type="button" value="Generate solvated WHAM input" 
                          onClick="if (document.getElementById('check_buildreactants').checked) {
                                      if (confirm('Do you want to append the initial model?')){
                                         loadframe2jsmol(false,true,0);
                                      }
                                   }
                                   solvatewhaminput(-1.0,dummy_callback);" 
                          title="Load next xyz model into jsmol"/>
                   posteriori analysis: 
                      <input type="radio" id="wham_posteriori" onClick="ClearRd(this,6)" 
                              title="Thomas: set radio wham_postiriori : Generate posteriori WHAM DATA block"/>

                   <br>
                   <hr style="border: 1px dashed #102DB0;"/>

                   Auxiliary Penalty Functions 
                      <input type="button" VALUE="Resolve Variables" onClick="resolveauxvariables('auxiliary_functions',dummy_callback)" 
                             style="font-size:13px;background-color:#f8f8ff;color:#6F4E37"
                             title="Fetches chemical reaction from JSME editor"/>
                   <br>
                   <textarea name="auxiliary_functions" id="auxiliary_functions" rows="3" cols="70" 
                             title="Thomas: set text axiliary_functons :" oninput="cacheInput(this)"></textarea>
                   <br> 
                   <hr style="border: 1px dashed #102DB0;"/>
                   <input type="button" VALUE="Generate reaction path" onClick="gen_reaction_path()" 
                          style="font-size:13px;background-color:#f8f8ff;color:#385970"
                          title="Generates reaction path using the current geometry and reaction constraint"/>
                      npath:
                         <input type="number" id="reaction_npath" SIZE=9   min="2" max="1000" step="1" value="1" 
                                title="Thomas: set number reaction_npath :" oninput="cacheInput(this)"> 
                      <input type="button" value="Next model" onClick="loadframe2jsmol(false,false,0);check_rgamma();" 
                             style="font-size:13px;background-color:#f8f8ff;color:#385970"
                             title="Load next xyz model into jsmol"/>
                      <input type="button" value="Previous model" onClick="prevframe2jsmol(true,false);check_rgamma();" 
                             style="font-size:13px;background-color:#f8f8ff;color:#385970"
                             title="Load previous xyz xyz model into jsmol"/>
                      <input type="button" value="New model" onClick="loadframe2jsmol(true,false,0)" title="Add new xyzframe"/>
                      <br>
                      <input type="button" value="Append model" onClick="loadframe2jsmol(false,true,0)" title="Append new xyzframe"/>
                      <input type="button" value="Delete model" onClick="deleteframe2jsmol()" title="Delete current xyz frame"/>
                      <b style="color: blue; font-size: 14px;" id="model_label2">Model 1 out of 1</b> 


                 </form>
               </div>

                <!-- collective input -->
               <div id="swapper-other3" style="display:none; border:2px dashed;  border-color: #102DB0; background-color: white; padding:10px;">
                  <p align="center" style="color:#102DB0"> Collective Variable Input </p>
                  <select id="free_energy_type"  onChange="changefreeenergy()" oninput="cacheInput(this)">
                     <option> Metadynamics </option>
                     <option>TAMD</option>
                     <option>PMF</option>
                  </select>
                   <div id="metainput" class="meta_div" style="display:block; border:1px dotted; border-color: #102DB0;"> 
                      <p align="center"> Metadynamics </p>
                      update: <input type="number" id="meta_update" size="9" min="0" max="1000" step="1" value="10" oninput="cacheInput(this)">
                      print: <input type="number" id="meta_print" size="9" min="0" max="1000" step="1" value="100" oninput="cacheInput(this)">
                      print_shift: <input type="number" id="meta_print_shift" size="9" min="0" max="1000" step="1" value="1" oninput="cacheInput(this)"><br>
                      w: <input type="number" id="meta_w" size="9" min="0.00001" max="1.00000" step="0.00001" value="0.00100" oninput="cacheInput(this)"> 
                      sigma: <input type="number" id="meta_sigma" size="9" min="0.005" max="1.000" step="0.001" value="0.100" oninput="cacheInput(this)"> <br>
                      range: <input type="2array" id="meta_range" size="19"  value="" oninput="cacheInput(this)">
                      nrange: <input type="number" id="meta_nrange" size="9" min="1" max="5000" step="1" value="" oninput="cacheInput(this)" > <br><br>
                      boundary_w: <input type="number" id="meta_boundary_w" size="9" min="0.0001" max="10.0000" step="0.0001" value="0.0000" oninput="cacheInput(this)"> 
                      boundary_sigma: <input type="number" id="meta_boundary_sigma" size="9" min="0.005" max="1.000" step="0.001" value="0.000" oninput="cacheInput(this)">
                      <br>
                      tempered: <input type="number" id="meta_tempered" size="15" min="0.0" max="99000.0" step="1.0" value="" 
                                 onchange="let t = this.value*0.59/298.15;
                                           let f = t.toFixed(2) + ' kcal/mol';
                                           document.getElementById('meta_barrier').innerHTML = f;" 
                                 oninput="cacheInput(this)"/>
                     <b style="color: blue; font-size: 14px;" id="meta_barriertag"> a priori Ebarrier=</b><b style="color: blue; font-size: 14px;" id="meta_barrier"></b>
                    <br><br>
                   </div>
                   <div id="tamdinput" class="meta_div" style="display:none; border:1px dotted; border-color: #102DB0;"> 
                      <p align="center"> TAMD </p>
                      update: <input type="number" id="tamd_update" size="9" min="0" max="1000" step="1" value="10" oninput="cacheInput(this)">
                      print: <input type="number" id="tamd_print" size="9" min="0" max="1000" step="1" value="100" oninput="cacheInput(this)">
                      print_shift: <input type="number" id="tamd_print_shift" size="9" min="0" max="1000" step="1" value="1" oninput="cacheInput(this)"><br>
                      gamma: <input type="number" id="tamd_gamma" size="15" min="0.000" max="10000.0" step="0.001" value="0.001" oninput="cacheInput(this)">
                      k: <input type="number" id="tamd_k" size="15" min="0.000" max="10000.000" step="0.010" value="0.050" oninput="cacheInput(this)">
                      mass: <input type="number" id="tamd_mass" size="15" min="0.0" max="10000.0" step="0.1" value="30.0" oninput="cacheInput(this)"> <br>
                      ztemp: <input type="number" id="tamd_ztemp" size="15" min="0.0" max="99000.0" step="1" value="1000.0" oninput="cacheInput(this)">
                      zinitial: <input type="2array" id="tamd_zinitial" size="19"  value="" oninput="cacheInput(this)"> 
                      <input type="button" class="button" id="setzinitial" value="set zinitial" onClick="set_zinitial();"/>
                      zfixed: <input type="radio" id="tamd_zfixed" onClick="ClearRd(this,0)" title="Load xyz data from url into jsmol"/><br>
                      range: <input type="2array" id="tamd_range" size="19"  value="" oninput="cacheInput(this)">
                      nrange: <input type="number" id="tamd_nrange" size="9" min="1" max="5000" step="1" value="" > 
                   </div>
                   <div id="pmfinput" class="meta_div" style="display:none; border:1px dotted; border-color: #102DB0;"> 
                      <p align="center"> PMF </p>
                   </div>


                   <br><input type="button" class="button" id="redrawcolors" value="Reset atom colors" onClick="jms('select *; color cpk;');"/> <br><br>

                   coordinate_type{<select id="coordinate_type" onChange="changecollectivecoords();evalcollective()" oninput="cacheInput(this)">
                                   <option> None </option>
                                   <option>bond</option>
                                   <option>angle</option>
                                   <option>dihedral</option>
                                   <option>coord_number</option>
                                   <option>group_distance</option>
                                   <option>bond_difference2</option>
                                   <option>bondings</option>
                                   <option>X</option>
                                   <option>Y</option>
                                   <option>Z</option>
                                   <option>n-plane</option>
                                 </select>}
                   <br>
                   <div id="collective_bond" class="collective_div" style="display:none; border-color: #102DB0; background-color: white; padding:10px;"> 
                      atom 1 index (A red): <input type="number" id="collective_bond_a1" size="9" min="1" max="50000" step="1" value=""  onChange="set_color_alist('translucent red','collective_bond_a1');evalcollective()" oninput="cacheInput(this)"> 
                      atom 2 index (B green): <input type="number" id="collective_bond_a2" size="9" min="1" max="50000" step="1" value=""  onChange="set_color_alist('translucent green','collective_bond_a2');evalcollective()" oninput="cacheInput(this)"> <br>
                   Reaction: AB --> A + B <br>
                   </div>
                   <div id="collective_angle" class="collective_div" style="display:none; border-color: #102DB0; background-color: white; padding:10px;"> 
                      atom 1 index (red): <input type="number" id="collective_angle_a1" size="9" min="1" max="50000" step="1" value="" onChange="set_color_alist('translucent red','collective_angle_a1')" oninput="cacheInput(this)"> 
                      atom 2 index (green): <input type="number" id="collective_angle_a2" size="9" min="1" max="50000" step="1" value="" onChange="set_color_alist('translucent green','collective_angle_a2');evalcollective()" oninput="cacheInput(this)"> <br>
                      atom 3 index (blue): <input type="number" id="collective_angle_a3" size="9" min="1" max="50000" step="1" value="" onChange="set_color_alist('translucent blue','collective_angle_a3');evalcollective()" oninput="cacheInput(this)"> <br>
                   </div>
                   <div id="collective_dihedral" class="collective_div" style="display:none; border-color: #102DB0; background-color: white; padding:10px;"> 
                      atom 1 index (red): <input type="number" id="collective_dihedral_a1" size="9" min="1" max="50000" step="1" value="" onChange="set_color_alist('translucent red','collective_dihedral_a1');evalcollective()" oninput="cacheInput(this)"> 
                      atom 2 index (green): <input type="number" id="collective_dihedral_a2" size="9" min="1" max="50000" step="1" value="" onChange="set_color_alist('translucent green','collective_dihedral_a2');evalcollective()" oninput="cacheInput(this)"> <br>
                      atom 3 index (blue): <input type="number" id="collective_dihedral_a3" size="9" min="1" max="50000" step="1" value="" onChange="set_color_alist('translucent blue','collective_dihedral_a3');evalcollective()" oninput="cacheInput(this)"> 
                      atom 4 index (yellow): <input type="number" id="collective_dihedral_a4" size="9" min="1" max="50000" step="1" value="" onChange="set_color_alist('translucent yellow','collective_dihedral_a4');evalcollective()" oninput="cacheInput(this)"> <br>
                   </div>
                   <div id="collective_coord_number" class="collective_div" style="display:none; border-color: #102DB0; background-color: white; padding:10px;"> 
                      atom indexes1: <input type="atomarray" id="collective_coord_number_indexes1"  size="70" value="" onChange="set_color_alist('translucent green','collective_coord_number_indexes1');evalcollective()" oninput="cacheInput(this)"> <br>
                      atom indexes2: <input type="atomarray" id="collective_coord_number_indexes2"  size="70" value="" onChange="set_color_alist('translucent blue','collective_coord_number_indexes2');evalcollective()" oninput="cacheInput(this)"> <br>
                      n12: <input type="number" id="collective_coord_number_n12" size="9" min="0.001" max="50000000.100" step="0.001" value="1.000" onChange="evalcollective()" oninput="cacheInput(this)"> 
                      Sprik: <input type="radio" id="collective_coord_number_sprik" onClick="ClearRd(this,1);evalcollective(); set_Sprik()" title="Sprik"  />
                      n: <input type="number" id="collective_coord_number_n" size="9" min="0.001" max="50.100" step="0.001" value="6.000" onChange="evalcollective()" oninput="cacheInput(this)"> 
                      R0: <input type="number" id="collective_coord_number_r0" size="9" min="0.001" max="50.000" step="0.001" value="1.200" onChange="evalcollective()" oninput="cacheInput(this)"> 
                      <div id="Sprik_m" style="display:block">
                         m: <input type="number" id="collective_coord_number_m" size="9" min="0.001" max="50.100" step="0.001" value="12.000" onChange="evalcollective()" oninput="cacheInput(this)"> 
                      </div>
                     <br>
                   </div>
                   <div id="collective_group_distance" class="collective_div" style="display:none; border-color: #102DB0; background-color: white; padding:10px;"> 
                      atom indexes1: <input type="atomarray" id="collective_group_distance_indexes1"  size="70" value="" onChange="set_color_alist('translucent orange','collective_group_distance_indexes1');evalcollective()" oninput="cacheInput(this)"> 
                      atom indexes2: <input type="atomarray" id="collective_group_distance_indexes2"  size="70" value="" onChange="set_color_alist('translucent aqua','collective_group_distance_indexes2');evalcollective()" oninput="cacheInput(this)"> 
                      n: <input type="number" id="collective_group_distance_n" size="9" min="0.01" max="20.00" step="0.01" value="3.50" onChange="evalcollective()" oninput="cacheInput(this)"> 
                   </div>
                   <div id="collective_bondings" class="collective_div" style="display:none; border-color: #102DB0; background-color: white; padding:10px;"> 
                      coef1 atom1a atom1a coef2 atom2a atom2b ...: <input type="atomarray" id="collective_bondings_coefindexes"  size="70" value="" onChange="set_color_bondings('collective_bondings_coefindexes');evalcollective()" oninput="cacheInput(this)"> 
                   </div>
                   <div id="collective_X" class="collective_div" style="display:none; border-color: #102DB0; background-color: white; padding:10px;"> 
                      atom 1 index (red): <input type="number" id="collective_X_a1" size="9" min="1" max="50000" step="1" value="" onChange="set_color_alist('translucent red','collective_X_a1');evalcollective()" oninput="cacheInput(this)"> 
                   </div>
                   <div id="collective_Y" class="collective_div" style="display:none; border-color: #102DB0; background-color: white; padding:10px;"> 
                      atom 1 index (blue): <input type="number" id="collective_Y_a1" size="9" min="1" max="50000" step="1" value="" onChange="set_color_alist('translucent blue','collective_Y_a1');evalcollective()" oninput="cacheInput(this)"> 
                   </div>
                   <div id="collective_Z" class="collective_div" style="display:none; border-color: #102DB0; background-color: white; padding:10px;"> 
                      atom 1 index (green): <input type="number" id="collective_Z_a1" size="9" min="1" max="50000" step="1" value="" onChange="set_color_alist('translucent green','collective_Z_a1');evalcollective()" oninput="cacheInput(this)"> 
                   </div>
                   <div id="collective_n-plane" class="collective_div" style="display:none; border-color: #102DB0; background-color: white; padding:10px;"> 
                      atom 1 index: <input type="number" id="collective_nplane_a1" size="9" min="1" max="50000" step="1" value="" onChange="set_color_alist('translucent orange','collective_nplane_a1');evalcollective()" oninput="cacheInput(this)"> <br>
                      atom indexes: <input type="atomarray" id="collective_nplane_indexes"  size="70" value="" onChange="set_color_alist('translucent yellow','collective_nplane_indexes');evalcollective()" oninput="cacheInput(this)"><br>
                      normal: <input type="3array" id="collective_nplane_normal"  size="35" value="0.0 0.0 1.0" onChange="evalcollective()" oninput="cacheInput(this)"> 
                   </div>
                   <div id="collective_bond_difference2" class="collective_div" style="display:none; border-color: #102DB0; background-color: white; padding:10px;"> 
                      atom 1 index (A red): <input type="number" id="collective_bond_difference2_a1" size="9" min="1" max="50000" step="1" value="" onChange="set_color_alist('translucent red','collective_bond_difference2_a1')" oninput="cacheInput(this)"> 
                      atom 2 index (B green): <input type="number" id="collective_bond_difference2_a2" size="9" min="1" max="50000" step="1" value="" onChange="set_color_alist('translucent green','collective_bond_difference2_a2');evalcollective()" oninput="cacheInput(this)"> <br>
                      atom 3 index (C blue): <input type="number" id="collective_bond_difference2_a3" size="9" min="1" max="50000" step="1" value="" onChange="set_color_alist('translucent blue','collective_bond_difference2_a3');evalcollective()" oninput="cacheInput(this)"> <br>
                   Reaction: AB + C --> AC + B<br>
                   </div>
   

                   <input type="button" VALUE="evaluate" onClick="evalcollective()" title="Generate reaction_gamma using current geometry"/>
                   <b style="color: blue; font-size: 16px;" id="collectiveftag"> f= </b><b style="color: blue; font-size: 16px;" id="collectivef"></b>

               </div>

                <!-- lattice input -->
               <div id="swapper-crystal" style="display:none; border:2px dashed;  border-color: #102DB0; background-color: white; padding:10px;">
               <p align="center" style="color:#102DB0"> Lattice </p>

               <input type="button" class="button" id="showcell"   value="Unit cell on" onClick="jmshowcell()"/>  
               <input type="button" class="button" id="centercell" value="Center" onClick="jmscentercell()"/>  
               <input type="button" class="button" id="unitscell1" value="Scale lengths by 0.529177" onClick="jmschangecellunits(0.529177)"/>  
               <input type="button" class="button" id="unitscell2" value="Scale lengths by 1.889727" onClick="jmschangecellunits(1.88972687777)"/>  
               <br>
               <input type="button" class="button" id="foldcell"   value="Fold unit cell" onClick="jmsfoldcell()"/>  
               <input type="button" class="button" id="supercell"  value="Supercell" onClick="jmssupercell('')"/>  
               <br>
               <input type="button" class="button" id="promptshiftcell" value="shift cell" onClick="jmsshiftcell(prompt('Shift cell:','0.1 0.1 0.1'))"/> 
               <input type="button" class="button" id="0.5dashiftcell"  value="0.5df"  onClick="jmsshiftcell('0.5 0.5 0.5')"/>  
               <input type="button" class="button" id="-0.5dashiftcell" value="-0.5df" onClick="jmsshiftcell('-0.5 -0.5 -0.5')"/>  
               <input type="button" class="button" id="da1shiftcell"  value="+df1" onClick="jmsshiftcell('0.1 0.0 0.0')"/>  
               <input type="button" class="button" id="da2shiftcell"  value="+df2" onClick="jmsshiftcell('0.0 0.1 0.0')"/>  
               <input type="button" class="button" id="da3shiftcell"  value="+df3" onClick="jmsshiftcell('0.0 0.0 0.1')"/>  
               <input type="button" class="button" id="dam1shiftcell" value="-df1" onClick="jmsshiftcell('-0.1  0.0  0.0')"/>  
               <input type="button" class="button" id="dam2shiftcell" value="-df2" onClick="jmsshiftcell(' 0.0 -0.1  0.0')"/> 
               <input type="button" class="button" id="dam3shiftcell" value="-df3" onClick="jmsshiftcell(' 0.0  0.0 -0.1')"/>  
               <br>
               <table>
                  <tr><td><br></td></tr>
                  <tr>
                     <td> Lattice Vectors </td>
                  </tr>
                  <tr>
                     <!-- crystal input - unit cell -->
                     <td> 
                         <table>
                            <tr> <td> a1: <input type="3array" id="lattice_a1"  size="35" value="10.000  0.000  0.000" onchange="jsmcellchange(0,1)"> </td> </tr>
                            <tr> <td> a2: <input type="3array" id="lattice_a2"  size="35" value=" 0.000 10.000  0.000" onchange="jsmcellchange(0,1)"> </td> </tr>
                            <tr> <td> a3: <input type="3array" id="lattice_a3"  size="35" value=" 0.000  0.000 10.000" onchange="jsmcellchange(0,1)"> </td> </tr>
                            <tr> <td> cell center: <input type="3array" id="lattice_center"  size="35" value=" 0.000 0.000 0.000" onchange="jsmcellchange(0,1)"> </td> </tr>
                         </table>
                     </td> 
                  </tr>
                  <tr><td><br></td></tr>
                  <tr>
                     <td> Lattice Parameters </td>
                  </tr>
                  <tr>
                     <td>
                        <table>
                           <tr>
                              <td> a: <input type="number" id="cell_a" size="9" min="0.500" max="100.000" step="0.01" value="10.000" onchange="jsmcellchange(1,1)"> </td>
                              <td> b: <input type="number" id="cell_b" size="9" min="0.500" max="100.000" step="0.01" value="10.000" onchange="jsmcellchange(1,1)"> </td>
                              <td> c: <input type="number" id="cell_c" size="9" min="0.500" max="100.000" step="0.01" value="10.000" onchange="jsmcellchange(1,1)"> </td>
                           </tr>
                           <tr>
                              <td> alpha: <input type="number" id="cell_alpha" size="9" min="0.000" max="180.000" step="0.01" value="90.000" onchange="jsmcellchange(1,1)"> </td>
                              <td> beta:  <input type="number" id="cell_beta"  size="9" min="0.000" max="180.000" step="0.01" value="90.000" onchange="jsmcellchange(1,1)"> </td>
                              <td> gamma: <input type="number" id="cell_gamma" size="9" min="0.000" max="180.000" step="0.01" value="90.000" onchange="jsmcellchange(1,1)"> </td>
                           </tr>
                        </table>
                     </td>
                  </tr>
               </table>

               <br>    
               <table>
                  <tr>
                     <td> Cartesian Coordinates  </td>
                     <td> Fractional Coordinates - locked: <input type="radio" id="lock_frac" onClick="ClearRd(this,2)" title="Load xyz data from url into jsmol"/> 
                          <input type="button" class="button" id="center_fractional" value="Cntr." 
                           onClick="document.getElementById('fractionalCoords').textContent = centercoords(document.getElementById('fractionalCoords').textContent); jmsupdatefracbox();"/>
                     </td>
                  </tr>
                  <tr>
                     <td> <textarea  id="cartesianCoords" rows="25" cols="35" onChange="jmsupdatecartbox()"></textarea> </td>
                     <td> <textarea  id="fractionalCoords" rows="25" cols="35" onChange="jmsupdatefracbox()"></textarea> </td>
                  </tr>
               </table>

               Bulk Atoms and Frozen Atoms <br> <textarea  name="bulk_atoms" id="bulk_atoms" rows="3" cols="76" oninput="cacheInput(this)"></textarea>
               </div>



                <!-- Bulk-Surface input -->
               <div id="swapper-surface" style="display:none; border:2px dashed;  border-color: #102DB0; background-color: white; padding:10px;">
               <table>
                  <tr><td align="center" style="color:#102DB0"> Bulk-Surface Builders <br><br> </td> </tr>
                  <tr>
                     <td>
                        <input type="button" VALUE="Generate simple bulk crystal" style="font-size:13px;background-color:#f8f8ff;color:#0000ff" onClick="loadbulktojsmol()" title="Generate a bulk crystal and load it into jsmol"/>
                        <input type="button" class="button" id="supercell"  value="Supercell" onClick="jmssupercell('')"/>
                        <input type="button" class="button" id="centercell1" value="Center" onClick="jmscentercell()"/> 
                     </td>
                  </tr>
                  <tr>
                     <td>
                        atoms: <input type="text" id="bulk_name" SIZE=9 value="Pt" oninput="cacheInput(this)"/>
                        <select id="bulk_type" oninput="cacheInput(this)">
                           <option value="sc">Simple Cubic</option>
                           <option value="fcc">Face-Centered Cubic</option>
                           <option value="bcc">Body-Centered Cubic</option>
                           <option value="tetragonal">Tetragonal</option>
                           <option value="bct">Body-Centered Tetragonal</option>
                           <option value="hcp">Hexagonal Closed Packed</option>
                           <option value="rhombohedral">Rhombohedral</option>
                           <option value="orthorhombic">Orthorhombic</option>
                           <option value="mcl">Monoclinic Lattice</option>
                           <option value="diamond">Diamond</option>
                           <option value="zincblende">Zinc Blende</option>
                           <option value="rocksalt">Rock Salt</option>
                           <option value="cesiumchloride">Cesium Choride</option>
                           <option value="fluorite">Fluorite</option>
                           <option value="wurtzite">Wurtzite</option>
                           <option value="graphite">Graphite</option>
                           <option value="graphene">Graphene</option>
                         </select>
                         <br>
                         lat_a: <input type="number" id="bulk_a" size="9" min="0.500" max="30.000" step="0.01" value="4.000" oninput="cacheInput(this)">
                         lat_b: <input type="number" id="bulk_b" size="9" min="0.000" max="30.000" step="0.01" value="0.000" oninput="cacheInput(this)">
                         lat_c: <input type="number" id="bulk_c" size="9" min="0.000" max="30.000" step="0.01" value="0.000" oninput="cacheInput(this)">
                         c/a: <input type="number" id="bulk_covera" size="9" min="0.000" max="30.000" step="0.01" value="0.000" oninput="cacheInput(this)">
                         alpha: <input type="number" id="bulk_alpha" size="9" min="0.000" max="30.000" step="0.01" value="0.000" oninput="cacheInput(this)">
                         lat_u: <input type="number" id="bulk_u" size="9" min="0.000" max="30.000" step="0.01" value="0.000" oninput="cacheInput(this)">
                         primitive: <input type="radio" id="bulk_primitive" onClick="ClearRd(this,0)" title="Load xyz data from url into jsmol"/>
                         cubic: <input type="radio" id="bulk_cubic" onClick="ClearRd(this,1)" title="Load xyz data from url into jsmol"/>
                     </td>
                  </tr>
                  <tr><td><br><br></td></tr>
                  <tr>
                     <td>
                        <input type="button" VALUE="Generate surface" style="font-size:13px;background-color:#f8f8ff;color:#0000ff" onClick="cutslab(1)" title="Load xyz data from url into jsmol"/>
                     </td>
                  </tr>
                  <tr>
                     <td>
                        a(hkl): <input type="text" id="surface_a" SIZE=15 value="1.5 -1.5 0.0" oninput="cacheInput(this)"/>
                        b(hkl): <input type="text" id="surface_b" SIZE=15 value="0.0 1.5 -1.5" oninput="cacheInput(this)"/>
                        c(hkl): <input type="text" id="surface_c" SIZE=15 value="-1.0 -1.0 -1.0" oninput="cacheInput(this)"/>
                        <select id="surface_cut" onChange="defineslab('surface_cut','surface_a','surface_b','surface_c')" oninput="cacheInput(this)">
                           <option value="sc100">SC100</option>
                           <option value="sc001">SC001</option>
                           <option value="sc111">SC111</option>
                           <option value="fcc100">FCC100</option>
                           <option value="fcc110">FCC110</option>
                           <option value="fcc111" selected="selected">FCC111</option>
                           <option value="fcc211">FCC211</option>
                           <option value="bcc100">BCC100</option>
                           <option value="bcc001">BCC001</option>
                           <option value="bcc110">BCC110</option>
                           <option value="bcc111">BCC111</option>
                           <option value="hcp0001">hcp0001</option>
                           <option value="diamond100">diamond100</option>
                           <option value="diamond111">diamond111</option>
                           <option value="graphene001">graphene001</option>
                         </select>
                        <br> vacuum: <input type="number" id="surface_vacuum" size="9" min="0.500" max="30.000" step="0.01" value="10.000" onChange="jsmcellchange(1,1)" oninput="cacheInput(this)">
                        origin: <input type="text" id="surface_origin" SIZE=15 value="0.0 0.0 0.0" oninput="cacheInput(this)"/>
                        scaling: <input type="text" id="surface_scaling" SIZE=15 value="1.0 1.0 1.0" oninput="cacheInput(this)"/>
                        nzplane: <input type="number" id="surface_nzplane" SIZE=5 min="1" max="100" step="1" value="" oninput="cacheInput(this)"/>
                        <br>tolerance: <input type="number" id="surface_tolerance" size="9" min="-3.000" max="3.000" step="0.001" value="0.0010" onChange="jsmcellchange(1,1)" oninput="cacheInput(this)">
                        align c: <input type="radio" id="surface_alignc" onClick="ClearRd(this,1)" title="align c axis" oninput="cacheInput(this)"/>
                     </td>
                  </tr>
               </table>
               <br><br>
               <table>
                  <tr><td align="center" style="color:#102DB0"> Interface Builder <br><br> </td> </tr>
                  <tr>
                     <td>
                        <input type="button" VALUE="Generate interface" style="font-size:13px;background-color:#f8f8ff;color:#0000ff" onClick="geninterface()" title="Load xyz data from url into jsmol"/>
                     </td>
                  </tr>
                  <tr>
                     <td>
                        Base atoms: <input type="text" id="bulk1_name" SIZE=9 value="Pt" oninput="cacheInput(this)"/>
                        <select id="bulk1_type" oninput="cacheInput(this)">
                           <option value="sc">Simple Cubic</option>
                           <option value="fcc">Face-Centered Cubic</option>
                           <option value="bcc">Body-Centered Cubic</option>
                           <option value="tetragonal">Tetragonal</option>
                           <option value="bct">Body-Centered Tetragonal</option>
                           <option value="hcp">Hexagonal Closed Packed</option>
                           <option value="rhombohedral">Rhombohedral</option>
                           <option value="orthorhombic">Orthorhombic</option>
                           <option value="mcl">Monoclinic Lattice</option>
                           <option value="diamond">Diamond</option>
                           <option value="zincblende">Zinc Blende</option>
                           <option value="rocksalt">Rock Salt</option>
                           <option value="cesiumchloride">Cesium Choride</option>
                           <option value="fluorite">Fluorite</option>
                           <option value="wurtzite">Wurtzite</option>
                           <option value="graphite">Graphite</option>
                           <option value="graphene">Graphene</option>
                         </select>
                         <br>
                         lat_a: <input type="number" id="bulk1_a" size="9" min="0.500" max="30.000" step="0.01" value="4.000" oninput="cacheInput(this)">
                         lat_b: <input type="number" id="bulk1_b" size="9" min="0.500" max="30.000" step="0.01" value="4.000" oninput="cacheInput(this)">
                         lat_c: <input type="number" id="bulk1_c" size="9" min="0.000" max="30.000" step="0.01" value="0.000" oninput="cacheInput(this)">
                         c/a:   <input type="number" id="bulk1_covera" size="9" min="0.000" max="30.000" step="0.01" value="0.000" oninput="cacheInput(this)">
                         alpha: <input type="number" id="bulk1_alpha" size="9" min="0.000" max="30.000" step="0.01" value="0.000" oninput="cacheInput(this)">
                         lat_u: <input type="number" id="bulk1_u" size="9" min="0.000" max="30.000" step="0.01" value="0.000" oninput="cacheInput(this)">
                         primitive: <input type="radio" id="bulk1_primitive" onClick="ClearRd(this,0)" title="Load xyz data from url into jsmol"/>
                         cubic: <input type="radio" id="bulk1_cubic" onClick="ClearRd(this,1)" title="Load xyz data from url into jsmol"/><br>
                         a(hkl): <input type="text" id="surface1_a" SIZE=15 value="1.5 -1.5 0.0" oninput="cacheInput(this)"/>
                         b(hkl): <input type="text" id="surface1_b" SIZE=15 value="0.0 1.5 -1.5" oninput="cacheInput(this)"/>
                         c(hkl): <input type="text" id="surface1_c" SIZE=15 value="-1.0 -1.0 -1.0" oninput="cacheInput(this)"/>
                         <select id="surface1_cut" onChange="defineslab('surface1_cut','surface1_a','surface1_b','surface1_c')" oninput="cacheInput(this)">
                           <option value="sc100">SC100</option>
                           <option value="sc001">SC001</option>
                           <option value="sc111">SC111</option>
                           <option value="fcc100">FCC100</option>
                           <option value="fcc110">FCC110</option>
                           <option value="fcc111" selected="selected">FCC111</option>
                           <option value="fcc211">FCC211</option>
                           <option value="bcc100">BCC100</option>
                           <option value="bcc001">BCC001</option>
                           <option value="bcc110">BCC110</option>
                           <option value="bcc111">BCC111</option>
                           <option value="hcp0001">hcp0001</option>
                           <option value="diamond100">diamond100</option>
                           <option value="diamond111">diamond111</option>
                           <option value="graphene001">graphene001</option>
                         </select>
                         <br> 
                         origin: <input type="text" id="surface1_origin" SIZE=15 value="0.0 0.0 0.0" oninput="cacheInput(this)"/>
                         scaling: <input type="text" id="surface1_scaling" SIZE=15 value="1.0 1.0 1.0" oninput="cacheInput(this)"/>
                     </td>
                  </tr>
                  <tr>
                     <td>
                        <br> Adjunct atoms: <input type="text" id="bulk2_name" SIZE=9 value="Pt" oninput="cacheInput(this)"/>
                        <select id="bulk2_type" oninput="cacheInput(this)">
                           <option value="sc">Simple Cubic</option>
                           <option value="fcc">Face-Centered Cubic</option>
                           <option value="bcc">Body-Centered Cubic</option>
                           <option value="tetragonal">Tetragonal</option>
                           <option value="bct">Body-Centered Tetragonal</option>
                           <option value="hcp">Hexagonal Closed Packed</option>
                           <option value="rhombohedral">Rhombohedral</option>
                           <option value="orthorhombic">Orthorhombic</option>
                           <option value="mcl">Monoclinic Lattice</option>
                           <option value="diamond">Diamond</option>
                           <option value="zincblende">Zinc Blende</option>
                           <option value="rocksalt">Rock Salt</option>
                           <option value="cesiumchloride">Cesium Choride</option>
                           <option value="fluorite">Fluorite</option>
                           <option value="wurtzite">Wurtzite</option>
                           <option value="graphite">Graphite</option>
                           <option value="graphene">traphene</option>
                         </select>
                         <br>
                         lat_a: <input type="number" id="bulk2_a" size="9" min="0.500" max="30.000" step="0.01" value="4.000" oninput="cacheInput(this)">
                         lat_b: <input type="number" id="bulk2_b" size="9" min="0.500" max="30.000" step="0.01" value="4.000" oninput="cacheInput(this)">
                         lat_c: <input type="number" id="bulk2_c" size="9" min="0.000" max="30.000" step="0.01" value="0.000" oninput="cacheInput(this)">
                         c/a:   <input type="number" id="bulk2_covera" size="9" min="0.000" max="30.000" step="0.01" value="0.000" oninput="cacheInput(this)">
                         alpha: <input type="number" id="bulk2_alpha" size="9" min="0.000" max="30.000" step="0.01" value="0.000" oninput="cacheInput(this)">
                         lat_u: <input type="number" id="bulk2_u" size="9" min="0.000" max="30.000" step="0.01" value="0.000" oninput="cacheInput(this)">
                         primitive: <input type="radio" id="bulk2_primitive" onClick="ClearRd(this,0)" title="Load xyz data from url into jsmol"/>
                         cubic: <input type="radio" id="bulk2_cubic" onClick="ClearRd(this,1)" title="Load xyz data from url into jsmol"/><br>
                         a(hkl): <input type="text" id="surface2_a" SIZE=15 value="1.5 -1.5 0.0" oninput="cacheInput(this)"/>
                         b(hkl): <input type="text" id="surface2_b" SIZE=15 value="0.0 1.5 -1.5" oninput="cacheInput(this)"/>
                         c(hkl): <input type="text" id="surface2_c" SIZE=15 value="-1.0 -1.0 -1.0" oninput="cacheInput(this)"/>
                         <select id="surface2_cut" onChange="defineslab('surface2_cut','surface2_a','surface2_b','surface2_c')" oninput="cacheInput(this)">
                           <option value="sc100">SC100</option>
                           <option value="sc001">SC001</option>
                           <option value="sc111">SC111</option>
                           <option value="fcc100">FCC100</option>
                           <option value="fcc110">FCC110</option>
                           <option value="fcc111" selected="selected">FCC111</option>
                           <option value="fcc211">FCC211</option>
                           <option value="bcc100">BCC100</option>
                           <option value="bcc001">BCC001</option>
                           <option value="bcc110">BCC110</option>
                           <option value="bcc111">BCC111</option>
                           <option value="hcp0001">hcp0001</option>
                           <option value="diamond100">diamond100</option>
                           <option value="diamond111">diamond111</option>
                           <option value="graphene001">graphene001</option>
                         </select>
                         <br>
                         origin: <input type="text" id="surface2_origin" SIZE=15 value="0.0 0.0 0.0" oninput="cacheInput(this)"/>
                         scaling: <input type="text" id="surface2_scaling" SIZE=15 value="1.0 1.0 1.0" oninput="cacheInput(this)"/>
                     </td>
                  </tr>
                  <tr>
                     <td>
                         <br> interface distance delta: <input type="number" id="interface_delta" size="9" min="-10.00" max="10.00" step="0.01" value="0.00" oninput="cacheInput(this)">
                     
                     </td>
                  </tr>

               </table>
               </div>


                <!-- symmetry input -->
               <div id="swapper-symmetry" style="display:none; border:2px dashed; border-color: #102DB0; background-color: white; padding:5px;">
               <p align="center" style="color:#102DB0"> Symmetry <br> </p>
               <table>
                  <tr>
                     <td> Lattice Symmetry </td>
                  </tr>
                  <tr>
                     <td>
                        <table>
                        <tr>
                            <td> symmetry: <input type="spacegroup" id="lattice_group"  size="15" value="P1" onChange="jsmcellchange(0,1)" oninput="cacheInput(this)"> </td>
                            <td> setting: <input type="spacegroup" id="lattice_group_setting"  size="5" value="1" onChange="jsmcellchange(0,1)" oninput="cacheInput(this)"> </td>
                        </tr>
                        <tr>
                           <td> crystal system:
                             <select id="crystal_system" oninput="cacheInput(this)">
                                <option value="Triclinic">Triclinic</option>
                                <option value="Monoclinic">Monoclinic</option>
                                <option value="Orthorhombic">Orthorhombic</option>
                                <option value="Tetragonal">Tetragonal</option>
                                <option value="Trigonal">Trigonal</option>
                                <option value="Hexagonal">Hexagonal</option>
                                <option value="Cubic">Cubic</option>
                              </select>
                           </td>
                            <td> group number: <input type="spacegroup" id="lattice_group_number"  size="5" value="1" onChange="jsmcellchange(0,1)" oninput="cacheInput(this)"> </td>
                        </tr>
                        </table>
                     </td>
                  </tr>
                  <tr>
                     <td> Symmetry Ops </td>
                  </tr>
                  <tr>
                     <td> <textarea  id="symmetryops" rows="25" cols="40" onChange="jmsupdatesymmetry()" oninput="cacheInput(this)">+x,+y,+z</textarea></td>
                  </tr>
               </table>
               </div>

            </td>
       </tr> 
       <!--  end of jsmol block -->
    </table>
    <!--  end of jsmol table -->



    <!-- Arrows Entry "{{ arrows_api }}" -->
    <button class="collapsible">Arrows Entry</button>
    <div class="content">
    <h2>Enter an <a href="https://nwchemgit.github.io/EMSL_Arrows#introduction-to-esmiles-how-to-change-calculation-theories">esmiles</a>, <a href="https://nwchemgit.github.io/EMSL_Arrows#esmiles-reactions-how-to-calculate-reaction-energies"> esmiles reaction</a>, or other Arrows input, then push the "Run Arrows" button.</h2>


    <form action="{{ arrows_api }}" id="JSMol-arrows-form" name="form" target="iframe_output" method="POST">
       <table>
          <tr>
             <!--td> <input type="text" name="smi" SIZE=120> </td-->
             <td> <textarea  name="smi" rows="10" cols="80" style="font-family: sans-serif; font-size: 20px;" oninput="cacheInput(this)"></textarea></td>
             <!--td> <input type="submit" name="JSMol-arrows" value="Run Arrows" style="font-family: sans-serif; font-size: 20px;"></td-->
             <td> <input type="button" name="JSMol-arrows-button" value="Run Arrows" style="font-family: sans-serif; font-size: 20px;" onClick="Confirm(this.form,1)"></td>
          </tr>
          <tr>
             <td>
                  <INPUT TYPE="button" VALUE="Append xyzdata{} from JSMol Editor" onClick="appendXYZ2()"> &nbsp;
                  <INPUT TYPE="button" VALUE="Append SMILES from JSMol Editor" onClick="appendSmiles2()"> &nbsp;
                  <input type="button" class="button" name="jmolreactionplane3" id="jmolreactionplane3" 
                          value="Reaction on" onClick="jmreactionplane()"/>
                  <INPUT TYPE="button" VALUE="no html5" 
                          onClick="document.form.smi.value+=' nohtml5'" >
                  <INPUT TYPE="button" VALUE="Clear" onClick="clearSmiles()"> </td>
             <td> <INPUT TYPE="button" VALUE="Email Submit" onClick="emailSmiles()"> </td>
          </tr>
       </table>
    </form>
    <br>
    <section class="blink" style="color: red"> <b id="runmebanner"> </b> </section>
    <br>
    <FORM METHOD="POST" ONSUBMIT="return false;">
       <INPUT TYPE="button" VALUE="theory{band}" id="band"
              onClick="txspressed('band',1)"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="theory{pspw}" id="pspw"
              onClick="txspressed('pspw',1)"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="theory{pspw4}" id="pspw4"
              onClick="txspressed('pspw4',1)"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="theory{dft}" id="dft"
              onClick="txspressed('dft',1)"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="theory{mp2}" id="mp2"
              onClick="txspressed('mp2',1)"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="theory{ccsd(t)}" id="ccsd(t)"
              onClick="txspressed('ccsd(t)',1)"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="theory{pm3}" id="pm3"
              onClick="txspressed('pm3',1)"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="basis{6-31G*}" id="6-31G*"
              onClick="txspressed('6-31G*',1)"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="basis{6-311++G(2d,2p)}" id="6-311++G(2d,2p)"
              onClick="txspressed('6-311++G(2d,2p)',1)"
              style="background-color:#f8f8ff; color:#298DB4;">
       <br>
       <INPUT TYPE="button" VALUE="xc{lda}" id="lda"
              onClick="txspressed('lda',1)"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="xc{pbe}" id="pbe"
              onClick="txspressed('pbe',1)"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="xc{pbe0}" id="pbe0"
              onClick="txspressed('pbe0',1)"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="xc{blyp}" id="blyp"
              onClick="txspressed('blyp',1)"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="xc{b3lyp}" id="b3lyp"
              onClick="txspressed('b3lyp',1)"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="xc{m06-2x}" id="m06-2x"
              onClick="txspressed('m06-2x',1)"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="xc{scan}" id="scan"
              onClick="txspressed('scan',1)"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="xc{tpss03}" id="tpss03"
              onClick="txspressed('tpss03',1)"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="xc{vs98}" id="vs98"
              onClick="txspressed('vs98',1)"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="xc{revpbe}" id="revpbe"
              onClick="txspressed('revpbe',1)"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="xc{pbesol}" id="pbesol"
              onClick="txspressed('pbesol',1)"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="xc{pbe-grimme2}" id="pbe-grimme2"
              onClick="txspressed('pbe-grimme2',1)"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="xc{pbe-grimme3}" id="pbe-grimme3"
              onClick="txspressed('pbe-grimme3',1)"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="xc{beef}" id="beef"
              onClick="txspressed('beef',1)"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="xc{xbeef-cpbe}" id="xbeef-cpbe"
              onClick="txspressed('xbeef-cpbe',1)"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="xc{beef-vdw2}" id="beef-vdw2"
              onClick="txspressed('beef-vdw2',1)"
              style="background-color:#f8f8ff; color:#298DB4;">

       <INPUT TYPE="button" VALUE="solvation_type{None}" id="None"
              onClick="txspressed('None',1)"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="solvation_type{COSMO}"  id="COSMO"
              onClick="txspressed('COSMO',1)"
              onClick="document.form.smi.value+=' solvation_type{COSMO}'" 
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="solvation_type{COSMO-SMD}"  id="COSMO-SMD"
              onClick="txspressed('COSMO-SMD',1)"
              style="background-color:#f8f8ff; color:#298DB4;">
       <select id="SMD_solvent" onChange="document.getElementById('COSMO-SMD').value = document.getElementById('SMD_solvent').value;" oninput="cacheInput(this)">
                 <option value="solvation_type{COSMO-SMD}">water (default)</option>
                 <option value="solvation_type{COSMO-SMD:acetacid}">acetic acid</option>
                 <option value="solvation_type{COSMO-SMD:acetone}">acetone</option>
                 <option value="solvation_type{COSMO-SMD:acetntrl}">acetonitrile</option>
                 <option value="solvation_type{COSMO-SMD:acetphen}">acetophenone</option>
                 <option value="solvation_type{COSMO-SMD:aniline}">aniline</option>
                 <option value="solvation_type{COSMO-SMD:anisole}">anisole</option>
                 <option value="solvation_type{COSMO-SMD:benzaldh}">benzaldehyde</option>
                 <option value="solvation_type{COSMO-SMD:benzene}">benzene</option>
                 <option value="solvation_type{COSMO-SMD:benzntrl}">benzonitrile</option>
                 <option value="solvation_type{COSMO-SMD:benzylcl}">benzyl chloride</option>
                 <option value="solvation_type{COSMO-SMD:brisobut}">1-bromo-2-methylpropane</option>
                 <option value="solvation_type{COSMO-SMD:brbenzen}">bromobenzene</option>
                 <option value="solvation_type{COSMO-SMD:brethane}">bromoethane</option>
                 <option value="solvation_type{COSMO-SMD:bromform}">bromoform</option>
                 <option value="solvation_type{COSMO-SMD:broctane}">1-bromooctane</option>
                 <option value="solvation_type{COSMO-SMD:brpentan}">1-bromopentane</option>
                 <option value="solvation_type{COSMO-SMD:brpropa2}">2-bromopropane</option>
                 <option value="solvation_type{COSMO-SMD:brpropan}">1-bromopropane</option>
                 <option value="solvation_type{COSMO-SMD:butanal}">butanal</option>
                 <option value="solvation_type{COSMO-SMD:butacid}">butanoic acid</option>
                 <option value="solvation_type{COSMO-SMD:butanol}">1-butanol</option>
                 <option value="solvation_type{COSMO-SMD:butanol2}">2-butanol</option>
                 <option value="solvation_type{COSMO-SMD:butanone}">butanone</option>
                 <option value="solvation_type{COSMO-SMD:butantrl}">butanonitrile</option>
                 <option value="solvation_type{COSMO-SMD:butile}">butyl acetate</option>
                 <option value="solvation_type{COSMO-SMD:nba}">butylamine</option>
                 <option value="solvation_type{COSMO-SMD:nbutbenz}">n-butylbenzene</option>
                 <option value="solvation_type{COSMO-SMD:sbutbenz}">sec-butylbenzene</option>
                 <option value="solvation_type{COSMO-SMD:tbutbenz}">tert-butylbenzene</option>
                 <option value="solvation_type{COSMO-SMD:cs2}">carbon disulfide</option>
                 <option value="solvation_type{COSMO-SMD:carbntet}">carbon tetrachloride</option>
                 <option value="solvation_type{COSMO-SMD:clbenzen}">chlorobenzene</option>
                 <option value="solvation_type{COSMO-SMD:secbutcl}">sec-butyl chloride</option>
                 <option value="solvation_type{COSMO-SMD:chcl3}">chloroform</option>
                 <option value="solvation_type{COSMO-SMD:clhexane}">1-chlorohexane</option>
                 <option value="solvation_type{COSMO-SMD:clpentan}">1-chloropentane</option>
                 <option value="solvation_type{COSMO-SMD:clpropan}">1-chloropropane</option>
                 <option value="solvation_type{COSMO-SMD:ocltolue}">o-chlorotoluene</option>
                 <option value="solvation_type{COSMO-SMD:m-cresol}">m-cresol</option>
                 <option value="solvation_type{COSMO-SMD:o-cresol}">o-cresol</option>
                 <option value="solvation_type{COSMO-SMD:cychexan}">cyclohexane</option>
                 <option value="solvation_type{COSMO-SMD:cychexon}">cyclohexanone</option>
                 <option value="solvation_type{COSMO-SMD:cycpentn}">cyclopentane</option>
                 <option value="solvation_type{COSMO-SMD:cycpntol}">cyclopentanol</option>
                 <option value="solvation_type{COSMO-SMD:cycpnton}">cyclopentanone</option>
                 <option value="solvation_type{COSMO-SMD:declncis}">cis-decalin</option>
                 <option value="solvation_type{COSMO-SMD:declntra}">trans-decalin</option>
                 <option value="solvation_type{COSMO-SMD:declnmix}">decalin (cis/trans mixture)</option>
                 <option value="solvation_type{COSMO-SMD:decane}">n-decane</option>
                 <option value="solvation_type{COSMO-SMD:decanol}">1-decanol</option>
                 <option value="solvation_type{COSMO-SMD:edb12}">1,2-dibromoethane</option>
                 <option value="solvation_type{COSMO-SMD:dibrmetn}">dibromomethane</option>
                 <option value="solvation_type{COSMO-SMD:butyleth}">dibutyl ether</option>
                 <option value="solvation_type{COSMO-SMD:odiclbnz}">o-dichlorobenzene</option>
                 <option value="solvation_type{COSMO-SMD:edc12}">1,2-dichloroethane</option>
                 <option value="solvation_type{COSMO-SMD:c12dce}">cis-dichloroethylene</option>
                 <option value="solvation_type{COSMO-SMD:t12dce}">trans-dichloroethylene</option>
                 <option value="solvation_type{COSMO-SMD:dcm}">dichloromethane</option>
                 <option value="solvation_type{COSMO-SMD:ether}">diethyl ether</option>
                 <option value="solvation_type{COSMO-SMD:et2s}">diethyl sulfide</option>
                 <option value="solvation_type{COSMO-SMD:dietamin}">diethylamine</option>
                 <option value="solvation_type{COSMO-SMD:mi}">diiodomethane</option>
                 <option value="solvation_type{COSMO-SMD:dipe}">diisopropyl ether</option>
                 <option value="solvation_type{COSMO-SMD:dmds}">dimethyl disulfide</option>
                 <option value="solvation_type{COSMO-SMD:dmso}">dimethyl sulfoxide</option>
                 <option value="solvation_type{COSMO-SMD:dma}">N,N-dimethylacetamide</option>
                 <option value="solvation_type{COSMO-SMD:cisdmchx}">cis-1,2-dimethylcyclohexane</option>
                 <option value="solvation_type{COSMO-SMD:dmf}">N,N-dimethylformamide</option>
                 <option value="solvation_type{COSMO-SMD:dmepen24}">2,4-dimethylpentane</option>
                 <option value="solvation_type{COSMO-SMD:dmepyr24}">2,4-dimethylpyridine</option>
                 <option value="solvation_type{COSMO-SMD:dmepyr26}">2,6-dimethylpyridine</option>
                 <option value="solvation_type{COSMO-SMD:dioxane}">1,4-dioxane</option>
                 <option value="solvation_type{COSMO-SMD:phoph}">diphenyl ether</option>
                 <option value="solvation_type{COSMO-SMD:dproamin}">dipropylamine</option>
                 <option value="solvation_type{COSMO-SMD:dodecan}">n-dodecane</option>
                 <option value="solvation_type{COSMO-SMD:meg}">1,2-ethanediol</option>
                 <option value="solvation_type{COSMO-SMD:etsh}">ethanethiol</option>
                 <option value="solvation_type{COSMO-SMD:ethanol}">ethanol</option>
                 <option value="solvation_type{COSMO-SMD:etoac}">ethyl acetate</option>
                 <option value="solvation_type{COSMO-SMD:etome}">ethyl formate</option>
                 <option value="solvation_type{COSMO-SMD:eb}">ethylbenzene</option>
                 <option value="solvation_type{COSMO-SMD:phenetol}">ethyl phenyl ether</option>
                 <option value="solvation_type{COSMO-SMD:c6h5f}">fluorobenzene</option>
                 <option value="solvation_type{COSMO-SMD:foctane}">1-fluorooctane</option>
                 <option value="solvation_type{COSMO-SMD:formamid}">formamide</option>
                 <option value="solvation_type{COSMO-SMD:formacid}">formic acid</option>
                 <option value="solvation_type{COSMO-SMD:heptane}">n-heptane</option>
                 <option value="solvation_type{COSMO-SMD:heptanol}">1-heptanol</option>
                 <option value="solvation_type{COSMO-SMD:heptnon2}">2-heptanone</option>
                 <option value="solvation_type{COSMO-SMD:heptnon4}">4-heptanone</option>
                 <option value="solvation_type{COSMO-SMD:hexadecn}">n-hexadecane</option>
                 <option value="solvation_type{COSMO-SMD:hexane}">n-hexane</option>
                 <option value="solvation_type{COSMO-SMD:hexnacid}">hexanoic acid</option>
                 <option value="solvation_type{COSMO-SMD:hexanol}">1-hexanol</option>
                 <option value="solvation_type{COSMO-SMD:hexanon2}">2-hexanone</option>
                 <option value="solvation_type{COSMO-SMD:hexene}">1-hexene</option>
                 <option value="solvation_type{COSMO-SMD:hexyne}">1-hexyne</option>
                 <option value="solvation_type{COSMO-SMD:c6h5i}">iodobenzene</option>
                 <option value="solvation_type{COSMO-SMD:iobutane}">1-iodobutane</option>
                 <option value="solvation_type{COSMO-SMD:c2h5i}">iodoethane</option>
                 <option value="solvation_type{COSMO-SMD:iohexdec}">1-iodohexadecane</option>
                 <option value="solvation_type{COSMO-SMD:ch3i}">iodomethane</option>
                 <option value="solvation_type{COSMO-SMD:iopentan}">1-iodopentane</option>
                 <option value="solvation_type{COSMO-SMD:iopropan}">1-iodopropane</option>
                 <option value="solvation_type{COSMO-SMD:cumene}">isopropylbenzene</option>
                 <option value="solvation_type{COSMO-SMD:p-cymene}">p-isopropyltoluene</option>
                 <option value="solvation_type{COSMO-SMD:mesityln}">mesitylene</option>
                 <option value="solvation_type{COSMO-SMD:methanol}">methanol</option>
                 <option value="solvation_type{COSMO-SMD:egme}">2-methoxyethanol</option>
                 <option value="solvation_type{COSMO-SMD:meacetat}">methyl acetate</option>
                 <option value="solvation_type{COSMO-SMD:mebnzate}">methyl benzoate</option>
                 <option value="solvation_type{COSMO-SMD:mebutate}">methyl butanoate</option>
                 <option value="solvation_type{COSMO-SMD:meformat}">methyl formate</option>
                 <option value="solvation_type{COSMO-SMD:mibk}">4-methyl-2-pentanone</option>
                 <option value="solvation_type{COSMO-SMD:mepropyl}">methyl propanoate</option>
                 <option value="solvation_type{COSMO-SMD:isobutol}">2-methyl-1-propanol</option>
                 <option value="solvation_type{COSMO-SMD:terbutol}">2-methyl-2-propanol</option>
                 <option value="solvation_type{COSMO-SMD:nmeaniln}">N-methylaniline</option>
                 <option value="solvation_type{COSMO-SMD:mecychex}">methylcyclohexane</option>
                 <option value="solvation_type{COSMO-SMD:nmfmixtr}">N-methylformamide (E/Z mixture)</option>
                 <option value="solvation_type{COSMO-SMD:isohexan}">2-methylpentane</option>
                 <option value="solvation_type{COSMO-SMD:mepyrid2}">2-methylpyridine</option>
                 <option value="solvation_type{COSMO-SMD:mepyrid3}">3-methylpyridine</option>
                 <option value="solvation_type{COSMO-SMD:mepyrid4}">4-methylpyridine</option>
                 <option value="solvation_type{COSMO-SMD:c6h5no2}">nitrobenzene</option>
                 <option value="solvation_type{COSMO-SMD:c2h5no2}">nitroethane</option>
                 <option value="solvation_type{COSMO-SMD:ch3no2}">nitromethane</option>
                 <option value="solvation_type{COSMO-SMD:ntrprop1}">1-nitropropane</option>
                 <option value="solvation_type{COSMO-SMD:ntrprop2}">2-nitropropane</option>
                 <option value="solvation_type{COSMO-SMD:ontrtolu}">o-nitrotoluene</option>
                 <option value="solvation_type{COSMO-SMD:nonane}">n-nonane</option>
                 <option value="solvation_type{COSMO-SMD:nonanol}">1-nonanol</option>
                 <option value="solvation_type{COSMO-SMD:nonanone}">5-nonanone</option>
                 <option value="solvation_type{COSMO-SMD:octane}">n-octane</option>
                 <option value="solvation_type{COSMO-SMD:octanol}">1-octanol</option>
                 <option value="solvation_type{COSMO-SMD:octanon2}">2-octanone</option>
                 <option value="solvation_type{COSMO-SMD:pentdecn}">n-pentadecane</option>
                 <option value="solvation_type{COSMO-SMD:pentanal}">pentanal</option>
                 <option value="solvation_type{COSMO-SMD:npentane}">n-pentane</option>
                 <option value="solvation_type{COSMO-SMD:pentacid}">pentanoic acid</option>
                 <option value="solvation_type{COSMO-SMD:pentanol}">1-pentanol</option>
                 <option value="solvation_type{COSMO-SMD:pentnon2}">2-pentanone</option>
                 <option value="solvation_type{COSMO-SMD:pentnon3}">3-pentanone</option>
                 <option value="solvation_type{COSMO-SMD:pentene}">1-pentene</option>
                 <option value="solvation_type{COSMO-SMD:e2penten}">E-2-pentene</option>
                 <option value="solvation_type{COSMO-SMD:pentacet}">pentyl acetate</option>
                 <option value="solvation_type{COSMO-SMD:pentamin}">pentylamine</option>
                 <option value="solvation_type{COSMO-SMD:pfb}">perfluorobenzene</option>
                 <option value="solvation_type{COSMO-SMD:benzalcl}">phenylmethanol</option>
                 <option value="solvation_type{COSMO-SMD:propanal}">propanal</option>
                 <option value="solvation_type{COSMO-SMD:propacid}">propanoic acid</option>
                 <option value="solvation_type{COSMO-SMD:propanol}">1-propanol</option>
                 <option value="solvation_type{COSMO-SMD:propnol2}">2-propanol</option>
                 <option value="solvation_type{COSMO-SMD:propntrl}">propanonitrile</option>
                 <option value="solvation_type{COSMO-SMD:propenol}">2-propen-1-ol</option>
                 <option value="solvation_type{COSMO-SMD:propacet}">propyl acetate</option>
                 <option value="solvation_type{COSMO-SMD:propamin}">propylamine</option>
                 <option value="solvation_type{COSMO-SMD:pyridine}">pyridine</option>
                 <option value="solvation_type{COSMO-SMD:c2cl4}">tetrachloroethene</option>
                 <option value="solvation_type{COSMO-SMD:thf}">tetrahydrofuran</option>
                 <option value="solvation_type{COSMO-SMD:sulfolan}">tetrahydrothiophene-S,S-dioxide</option>
                 <option value="solvation_type{COSMO-SMD:tetralin}">tetralin</option>
                 <option value="solvation_type{COSMO-SMD:thiophen}">thiophene</option>
                 <option value="solvation_type{COSMO-SMD:phsh}">thiophenol</option>
                 <option value="solvation_type{COSMO-SMD:toluene}">toluene</option>
                 <option value="solvation_type{COSMO-SMD:tbp}">tributyl phosphate</option>
                 <option value="solvation_type{COSMO-SMD:tca111}">1,1,1-trichloroethane</option>
                 <option value="solvation_type{COSMO-SMD:tca112}">1,1,2-trichloroethane</option>
                 <option value="solvation_type{COSMO-SMD:tce}">trichloroethene</option>
                 <option value="solvation_type{COSMO-SMD:et3n}">triethylamine</option>
                 <option value="solvation_type{COSMO-SMD:tfe222}">2,2,2-trifluoroethanol</option>
                 <option value="solvation_type{COSMO-SMD:tmben124}">1,2,4-trimethylbenzene</option>
                 <option value="solvation_type{COSMO-SMD:isoctane}">2,2,4-trimethylpentane</option>
                 <option value="solvation_type{COSMO-SMD:undecane}">n-undecane</option>
                 <option value="solvation_type{COSMO-SMD:m-xylene}">m-xylene</option>
                 <option value="solvation_type{COSMO-SMD:o-xylene}">o-xylene</option>
                 <option value="solvation_type{COSMO-SMD:p-xylene}">p-xylene</option>
                 <option value="solvation_type{COSMO-SMD:xylenemx}">xylene (mixture)</option>
       </select> <br>

       <INPUT TYPE="button" VALUE="solvation_type{None}" id="None"
              onClick="txspressed('None',1)"
              style="background-color:#f8f8ff; color:#298DB4;"> <br>


       <INPUT TYPE="button" VALUE="calculation_type{a}" id="neb"
              onClick="document.form.smi.value+=' calculation_type{a}'" 
              style="background-color:#f8f8ff; color:#298DB4;"> <br>

       <INPUT TYPE="button" VALUE="-->" 
              onClick="document.form.smi.value+=' --> '" 
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="+" 
              onClick="document.form.smi.value+=' + '" 
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="~" 
              onClick="document.form.smi.value+=' ~ '" 
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="1" 
              onClick="document.form.smi.value+='1'" 
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="2" 
              onClick="document.form.smi.value+='2'" 
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="3" 
              onClick="document.form.smi.value+='3'" 
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="4" 
              onClick="document.form.smi.value+='4'" 
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="5" 
              onClick="document.form.smi.value+='5'" 
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="6" 
              onClick="document.form.smi.value+='6'" 
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="7" 
              onClick="document.form.smi.value+='7'" 
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="8" 
              onClick="document.form.smi.value+='8'" 
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="9" 
              onClick="document.form.smi.value+='9'" 
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="0" 
              onClick="document.form.smi.value+='0'" 
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE=" " 
              onClick="document.form.smi.value+=' '" 
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="charge" 
              onClick="entercharge(document.form.smi)" 
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="mult" 
              onClick="entermult(document.form.smi)" 
              style="background-color:#f8f8ff; color:#298DB4;">
    </FORM>
    <br>

    </div>

    <br>

</div>

<div id="Arrows Entry - 2D Builder" class="tabcontent">


<!-- Arrows Entry "{{ arrows_api }}" -->

   <h2>Enter an <a href="https://nwchemgit.github.io/EMSL_Arrows#introduction-to-esmiles-how-to-change-calculation-theories">esmiles</a>, <a href="https://nwchemgit.github.io/EMSL_Arrows#esmiles-reactions-how-to-calculate-reaction-energies"> esmiles reaction</a>, or other Arrows input, then push the "Run Arrows" button.</h2>
    <form action="{{ arrows_api }}" id="JSME-arrows-form" name="form2" target="iframe_output"  method="POST">
       <table>
          <tr>
             <td> <input type="text" name="smi" SIZE=100 
                   style="font-family: sans-serif; font-size: 20px;" 
                   onkeydown="if (event.keyCode == 13) Confirm(this.form,2)" oninput="cacheInput(this)"> 
             </td>
             <!--td> <input type="submit" name="JSME-arrows" value="Run Arrows" style="font-family: sans-serif; font-size: 20px;"></td-->
             <td> <input type="button" name="JSME-arrows" value="Run Arrows" style="font-family: sans-serif; font-size: 20px;" onClick="Confirm(this.form,2)"></td>
          </tr>
          <tr>
             <td> <INPUT TYPE="button" VALUE="Append SMILES from JSME Molecular Editor" onClick="appendSmiles()"> &nbsp;
                  <input type="button" class="button3" name="jmolreactionplane" id="jmolreactionplane" value="Reaction on" onClick="jmreactionplane()"/>
                  <INPUT TYPE="button" VALUE="no html5"
                          onClick="document.form2.smi.value+=' nohtml5'" >
                  <INPUT TYPE="button" VALUE="Clear" onClick="clearSmiles2()">
            </td>
             <td> <INPUT TYPE="button" VALUE="Email Submit" onClick="emailSmiles()"> </td>
          </tr>
       </table>
    </form>
    <section class="blink" style="color: red"> <b id="runmebanner2"> </b> </section>
    <br>

    Calculation Options: <br>
    <FORM METHOD="POST" ONSUBMIT="return false;">
       <select id="theory_2" onChange="txspressed(document.getElementById('theory_2').value,2)">
            <option value="" selected> theory/method </option>
            <option value="dft"     id="dft_2">     dft     </option>
            <option value="pspw"    id="pspw_2">    pspw    </option>
            <option value="pspw4"   id="pspw4_2">   pspw4    </option>
            <option value="mp2"     id="mp2_2">     mp2    </option>
            <option value="ccsd(t)" id="ccsd(t)_2"> ccsd(t)    </option>
            <option value="pm3"     id="pm3_2">     pm3    </option>
            <option value="band"    id="band_2">    band    </option>
          </select>
       <select id="xc_2" onChange="txspressed(document.getElementById('xc_2').value,2)">
            <option value="" selected> exchange correlation </option>
            <option value="lda"    id="lda_2">    lda     </option>
            <option value="pbe"    id="pbe_2">    pbe     </option>
            <option value="pbe0"   id="pbe0_2">   pbe0   </option>
            <option value="blyp"   id="blyp_2">   blyp   </option>
            <option value="b3lyp"  id="b3lyp_2">  b3lyp  </option>
            <option value="m06-2x" id="m06-2x_2"> m06-2x </option>
            <option value="scan"   id="scan_2">   scan   </option>
            <option value="tpss03" id="tpss03_2"> tpss03 </option>
            <option value="vs98"   id="vs98_2">   vs98   </option>
            <option value="revpbe" id="revpbe_2"> revpbe </option>
            <option value="pbesol" id="pbesol_2"> pbesol </option>
            <option value="pbe-grimme2" id="pbe-grimme2_2"> pbe-grimme2 </option>
            <option value="pbe-grimme3" id="pbe-grimme3_2"> pbe-grimme3 </option>
            <option value="beef"        id="beef_2">               beef </option>
            <option value="xbeef-cpbe"  id="xbeef-cpbe_2">   xbeef-cpbe </option>
            <option value="beef-vdw2"   id="beef-vdw2_2">     beef-vdw2 </option>
            <option value="beef-grimme2" id="beef-grimme2_2"> beef-grimme2 </option>
          </select>
       <select id="basis_2" onChange="txspressed(document.getElementById('basis_2').value,2)">
            <option value="" selected> basis sets </option>
            <option value="6-31G*" id="6-31G*_2">                   6-31G*           </option>
            <option value="6-311++G(2d,2p)" id="6-311++G(2d,2p)_2"> 6-3111++G(2d,2p) </option>
          </select>
       <select id="SMD_solvent_2" onChange="txspressed('COSMO-SMD',2);">
            <option value=""> solvation theories      </option>
            <option value=" solvation_type{None}">gas phase </option>
            <option value=" solvation_type{COSMO}">water (COSMO)</option>
            <option value=" solvation_type{COSMO-SMD}">water (COSMO-SMD)</option>
            <option value=" solvation_type{COSMO-SMD:acetacid}">acetic acid</option>
            <option value=" solvation_type{COSMO-SMD:acetone}">acetone</option>
            <option value=" solvation_type{COSMO-SMD:acetntrl}">acetonitrile</option>
            <option value=" solvation_type{COSMO-SMD:acetphen}">acetophenone</option>
            <option value=" solvation_type{COSMO-SMD:aniline}">aniline</option>
            <option value=" solvation_type{COSMO-SMD:anisole}">anisole</option>
            <option value=" solvation_type{COSMO-SMD:benzaldh}">benzaldehyde</option>
            <option value=" solvation_type{COSMO-SMD:benzene}">benzene</option>
            <option value=" solvation_type{COSMO-SMD:benzntrl}">benzonitrile</option>
            <option value=" solvation_type{COSMO-SMD:benzylcl}">benzyl chloride</option>
            <option value=" solvation_type{COSMO-SMD:brisobut}">1-bromo-2-methylpropane</option>
            <option value=" solvation_type{COSMO-SMD:brbenzen}">bromobenzene</option>
            <option value=" solvation_type{COSMO-SMD:brethane}">bromoethane</option>
            <option value=" solvation_type{COSMO-SMD:bromform}">bromoform</option>
            <option value=" solvation_type{COSMO-SMD:broctane}">1-bromooctane</option>
            <option value=" solvation_type{COSMO-SMD:brpentan}">1-bromopentane</option>
            <option value=" solvation_type{COSMO-SMD:brpropa2}">2-bromopropane</option>
            <option value=" solvation_type{COSMO-SMD:brpropan}">1-bromopropane</option>
            <option value=" solvation_type{COSMO-SMD:butanal}">butanal</option>
            <option value=" solvation_type{COSMO-SMD:butacid}">butanoic acid</option>
            <option value=" solvation_type{COSMO-SMD:butanol}">1-butanol</option>
            <option value=" solvation_type{COSMO-SMD:butanol2}">2-butanol</option>
            <option value=" solvation_type{COSMO-SMD:butanone}">butanone</option>
            <option value=" solvation_type{COSMO-SMD:butantrl}">butanonitrile</option>
            <option value=" solvation_type{COSMO-SMD:butile}">butyl acetate</option>
            <option value=" solvation_type{COSMO-SMD:nba}">butylamine</option>
            <option value=" solvation_type{COSMO-SMD:nbutbenz}">n-butylbenzene</option>
            <option value=" solvation_type{COSMO-SMD:sbutbenz}">sec-butylbenzene</option>
            <option value=" solvation_type{COSMO-SMD:tbutbenz}">tert-butylbenzene</option>
            <option value=" solvation_type{COSMO-SMD:cs2}">carbon disulfide</option>
            <option value=" solvation_type{COSMO-SMD:carbntet}">carbon tetrachloride</option>
            <option value=" solvation_type{COSMO-SMD:clbenzen}">chlorobenzene</option>
            <option value=" solvation_type{COSMO-SMD:secbutcl}">sec-butyl chloride</option>
            <option value=" solvation_type{COSMO-SMD:chcl3}">chloroform</option>
            <option value=" solvation_type{COSMO-SMD:clhexane}">1-chlorohexane</option>
            <option value=" solvation_type{COSMO-SMD:clpentan}">1-chloropentane</option>
            <option value=" solvation_type{COSMO-SMD:clpropan}">1-chloropropane</option>
            <option value=" solvation_type{COSMO-SMD:ocltolue}">o-chlorotoluene</option>
            <option value=" solvation_type{COSMO-SMD:m-cresol}">m-cresol</option>
            <option value=" solvation_type{COSMO-SMD:o-cresol}">o-cresol</option>
            <option value=" solvation_type{COSMO-SMD:cychexan}">cyclohexane</option>
            <option value=" solvation_type{COSMO-SMD:cychexon}">cyclohexanone</option>
            <option value=" solvation_type{COSMO-SMD:cycpentn}">cyclopentane</option>
            <option value=" solvation_type{COSMO-SMD:cycpntol}">cyclopentanol</option>
            <option value=" solvation_type{COSMO-SMD:cycpnton}">cyclopentanone</option>
            <option value=" solvation_type{COSMO-SMD:declncis}">cis-decalin</option>
            <option value=" solvation_type{COSMO-SMD:declntra}">trans-decalin</option>
            <option value=" solvation_type{COSMO-SMD:declnmix}">decalin (cis/trans mixture)</option>
            <option value=" solvation_type{COSMO-SMD:decane}">n-decane</option>
            <option value=" solvation_type{COSMO-SMD:decanol}">1-decanol</option>
            <option value=" solvation_type{COSMO-SMD:edb12}">1,2-dibromoethane</option>
            <option value=" solvation_type{COSMO-SMD:dibrmetn}">dibromomethane</option>
            <option value=" solvation_type{COSMO-SMD:butyleth}">dibutyl ether</option>
            <option value=" solvation_type{COSMO-SMD:odiclbnz}">o-dichlorobenzene</option>
            <option value=" solvation_type{COSMO-SMD:edc12}">1,2-dichloroethane</option>
            <option value=" solvation_type{COSMO-SMD:c12dce}">cis-dichloroethylene</option>
            <option value=" solvation_type{COSMO-SMD:t12dce}">trans-dichloroethylene</option>
            <option value=" solvation_type{COSMO-SMD:dcm}">dichloromethane</option>
            <option value=" solvation_type{COSMO-SMD:ether}">diethyl ether</option>
            <option value=" solvation_type{COSMO-SMD:et2s}">diethyl sulfide</option>
            <option value=" solvation_type{COSMO-SMD:dietamin}">diethylamine</option>
            <option value=" solvation_type{COSMO-SMD:mi}">diiodomethane</option>
            <option value=" solvation_type{COSMO-SMD:dipe}">diisopropyl ether</option>
            <option value=" solvation_type{COSMO-SMD:dmds}">dimethyl disulfide</option>
            <option value=" solvation_type{COSMO-SMD:dmso}">dimethyl sulfoxide</option>
            <option value=" solvation_type{COSMO-SMD:dma}">N,N-dimethylacetamide</option>
            <option value=" solvation_type{COSMO-SMD:cisdmchx}">cis-1,2-dimethylcyclohexane</option>
            <option value=" solvation_type{COSMO-SMD:dmf}">N,N-dimethylformamide</option>
            <option value=" solvation_type{COSMO-SMD:dmepen24}">2,4-dimethylpentane</option>
            <option value=" solvation_type{COSMO-SMD:dmepyr24}">2,4-dimethylpyridine</option>
            <option value=" solvation_type{COSMO-SMD:dmepyr26}">2,6-dimethylpyridine</option>
            <option value=" solvation_type{COSMO-SMD:dioxane}">1,4-dioxane</option>
            <option value=" solvation_type{COSMO-SMD:phoph}">diphenyl ether</option>
            <option value=" solvation_type{COSMO-SMD:dproamin}">dipropylamine</option>
            <option value=" solvation_type{COSMO-SMD:dodecan}">n-dodecane</option>
            <option value=" solvation_type{COSMO-SMD:meg}">1,2-ethanediol</option>
            <option value=" solvation_type{COSMO-SMD:etsh}">ethanethiol</option>
            <option value=" solvation_type{COSMO-SMD:ethanol}">ethanol</option>
            <option value=" solvation_type{COSMO-SMD:etoac}">ethyl acetate</option>
            <option value=" solvation_type{COSMO-SMD:etome}">ethyl formate</option>
            <option value=" solvation_type{COSMO-SMD:eb}">ethylbenzene</option>
            <option value=" solvation_type{COSMO-SMD:phenetol}">ethyl phenyl ether</option>
            <option value=" solvation_type{COSMO-SMD:c6h5f}">fluorobenzene</option>
            <option value=" solvation_type{COSMO-SMD:foctane}">1-fluorooctane</option>
            <option value=" solvation_type{COSMO-SMD:formamid}">formamide</option>
            <option value=" solvation_type{COSMO-SMD:formacid}">formic acid</option>
            <option value=" solvation_type{COSMO-SMD:heptane}">n-heptane</option>
            <option value=" solvation_type{COSMO-SMD:heptanol}">1-heptanol</option>
            <option value=" solvation_type{COSMO-SMD:heptnon2}">2-heptanone</option>
            <option value=" solvation_type{COSMO-SMD:heptnon4}">4-heptanone</option>
            <option value=" solvation_type{COSMO-SMD:hexadecn}">n-hexadecane</option>
            <option value=" solvation_type{COSMO-SMD:hexane}">n-hexane</option>
            <option value=" solvation_type{COSMO-SMD:hexnacid}">hexanoic acid</option>
            <option value=" solvation_type{COSMO-SMD:hexanol}">1-hexanol</option>
            <option value=" solvation_type{COSMO-SMD:hexanon2}">2-hexanone</option>
            <option value=" solvation_type{COSMO-SMD:hexene}">1-hexene</option>
            <option value=" solvation_type{COSMO-SMD:hexyne}">1-hexyne</option>
            <option value=" solvation_type{COSMO-SMD:c6h5i}">iodobenzene</option>
            <option value=" solvation_type{COSMO-SMD:iobutane}">1-iodobutane</option>
            <option value=" solvation_type{COSMO-SMD:c2h5i}">iodoethane</option>
            <option value=" solvation_type{COSMO-SMD:iohexdec}">1-iodohexadecane</option>
            <option value=" solvation_type{COSMO-SMD:ch3i}">iodomethane</option>
            <option value=" solvation_type{COSMO-SMD:iopentan}">1-iodopentane</option>
            <option value=" solvation_type{COSMO-SMD:iopropan}">1-iodopropane</option>
            <option value=" solvation_type{COSMO-SMD:cumene}">isopropylbenzene</option>
            <option value=" solvation_type{COSMO-SMD:p-cymene}">p-isopropyltoluene</option>
            <option value=" solvation_type{COSMO-SMD:mesityln}">mesitylene</option>
            <option value=" solvation_type{COSMO-SMD:methanol}">methanol</option>
            <option value=" solvation_type{COSMO-SMD:egme}">2-methoxyethanol</option>
            <option value=" solvation_type{COSMO-SMD:meacetat}">methyl acetate</option>
            <option value=" solvation_type{COSMO-SMD:mebnzate}">methyl benzoate</option>
            <option value=" solvation_type{COSMO-SMD:mebutate}">methyl butanoate</option>
            <option value=" solvation_type{COSMO-SMD:meformat}">methyl formate</option>
            <option value=" solvation_type{COSMO-SMD:mibk}">4-methyl-2-pentanone</option>
            <option value=" solvation_type{COSMO-SMD:mepropyl}">methyl propanoate</option>
            <option value=" solvation_type{COSMO-SMD:isobutol}">2-methyl-1-propanol</option>
            <option value=" solvation_type{COSMO-SMD:terbutol}">2-methyl-2-propanol</option>
            <option value=" solvation_type{COSMO-SMD:nmeaniln}">N-methylaniline</option>
            <option value=" solvation_type{COSMO-SMD:mecychex}">methylcyclohexane</option>
            <option value=" solvation_type{COSMO-SMD:nmfmixtr}">N-methylformamide (E/Z mixture)</option>
            <option value=" solvation_type{COSMO-SMD:isohexan}">2-methylpentane</option>
            <option value=" solvation_type{COSMO-SMD:mepyrid2}">2-methylpyridine</option>
            <option value=" solvation_type{COSMO-SMD:mepyrid3}">3-methylpyridine</option>
            <option value=" solvation_type{COSMO-SMD:mepyrid4}">4-methylpyridine</option>
            <option value=" solvation_type{COSMO-SMD:c6h5no2}">nitrobenzene</option>
            <option value=" solvation_type{COSMO-SMD:c2h5no2}">nitroethane</option>
            <option value=" solvation_type{COSMO-SMD:ch3no2}">nitromethane</option>
            <option value=" solvation_type{COSMO-SMD:ntrprop1}">1-nitropropane</option>
            <option value=" solvation_type{COSMO-SMD:ntrprop2}">2-nitropropane</option>
            <option value=" solvation_type{COSMO-SMD:ontrtolu}">o-nitrotoluene</option>
            <option value=" solvation_type{COSMO-SMD:nonane}">n-nonane</option>
            <option value=" solvation_type{COSMO-SMD:nonanol}">1-nonanol</option>
            <option value=" solvation_type{COSMO-SMD:nonanone}">5-nonanone</option>
            <option value=" solvation_type{COSMO-SMD:octane}">n-octane</option>
            <option value=" solvation_type{COSMO-SMD:octanol}">1-octanol</option>
            <option value=" solvation_type{COSMO-SMD:octanon2}">2-octanone</option>
            <option value=" solvation_type{COSMO-SMD:pentdecn}">n-pentadecane</option>
            <option value=" solvation_type{COSMO-SMD:pentanal}">pentanal</option>
            <option value=" solvation_type{COSMO-SMD:npentane}">n-pentane</option>
            <option value=" solvation_type{COSMO-SMD:pentacid}">pentanoic acid</option>
            <option value=" solvation_type{COSMO-SMD:pentanol}">1-pentanol</option>
            <option value=" solvation_type{COSMO-SMD:pentnon2}">2-pentanone</option>
            <option value=" solvation_type{COSMO-SMD:pentnon3}">3-pentanone</option>
            <option value=" solvation_type{COSMO-SMD:pentene}">1-pentene</option>
            <option value=" solvation_type{COSMO-SMD:e2penten}">E-2-pentene</option>
            <option value=" solvation_type{COSMO-SMD:pentacet}">pentyl acetate</option>
            <option value=" solvation_type{COSMO-SMD:pentamin}">pentylamine</option>
            <option value=" solvation_type{COSMO-SMD:pfb}">perfluorobenzene</option>
            <option value=" solvation_type{COSMO-SMD:benzalcl}">phenylmethanol</option>
            <option value=" solvation_type{COSMO-SMD:propanal}">propanal</option>
            <option value=" solvation_type{COSMO-SMD:propacid}">propanoic acid</option>
            <option value=" solvation_type{COSMO-SMD:propanol}">1-propanol</option>
            <option value=" solvation_type{COSMO-SMD:propnol2}">2-propanol</option>
            <option value=" solvation_type{COSMO-SMD:propntrl}">propanonitrile</option>
            <option value=" solvation_type{COSMO-SMD:propenol}">2-propen-1-ol</option>
            <option value=" solvation_type{COSMO-SMD:propacet}">propyl acetate</option>
            <option value=" solvation_type{COSMO-SMD:propamin}">propylamine</option>
            <option value=" solvation_type{COSMO-SMD:pyridine}">pyridine</option>
            <option value=" solvation_type{COSMO-SMD:c2cl4}">tetrachloroethene</option>
            <option value=" solvation_type{COSMO-SMD:thf}">tetrahydrofuran</option>
            <option value=" solvation_type{COSMO-SMD:sulfolan}">tetrahydrothiophene-S,S-dioxide</option>
            <option value=" solvation_type{COSMO-SMD:tetralin}">tetralin</option>
            <option value=" solvation_type{COSMO-SMD:thiophen}">thiophene</option>
            <option value=" solvation_type{COSMO-SMD:phsh}">thiophenol</option>
            <option value=" solvation_type{COSMO-SMD:toluene}">toluene</option>
            <option value=" solvation_type{COSMO-SMD:tbp}">tributyl phosphate</option>
            <option value=" solvation_type{COSMO-SMD:tca111}">1,1,1-trichloroethane</option>
            <option value=" solvation_type{COSMO-SMD:tca112}">1,1,2-trichloroethane</option>
            <option value=" solvation_type{COSMO-SMD:tce}">trichloroethene</option>
            <option value=" solvation_type{COSMO-SMD:et3n}">triethylamine</option>
            <option value=" solvation_type{COSMO-SMD:tfe222}">2,2,2-trifluoroethanol</option>
            <option value=" solvation_type{COSMO-SMD:tmben124}">1,2,4-trimethylbenzene</option>
            <option value=" solvation_type{COSMO-SMD:isoctane}">2,2,4-trimethylpentane</option>
            <option value=" solvation_type{COSMO-SMD:undecane}">n-undecane</option>
            <option value=" solvation_type{COSMO-SMD:m-xylene}">m-xylene</option>
            <option value=" solvation_type{COSMO-SMD:o-xylene}">o-xylene</option>
            <option value=" solvation_type{COSMO-SMD:p-xylene}">p-xylene</option>
            <option value=" solvation_type{COSMO-SMD:xylenemx}">xylene (mixture)</option>
          </select>
       
       <INPUT TYPE="button" VALUE="-->"
              onClick="document.form2.smi.value+=' --> '"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="+"
              onClick="document.form2.smi.value+=' + '"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="~"
              onClick="document.form2.smi.value+=' ~ '"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="1"
              onClick="document.form2.smi.value+='1'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="2"
              onClick="document.form2.smi.value+='2'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="3"
              onClick="document.form2.smi.value+='3'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="4"
              onClick="document.form2.smi.value+='4'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="5"
              onClick="document.form2.smi.value+='5'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="6"
              onClick="document.form2.smi.value+='6'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="7"
              onClick="document.form2.smi.value+='7'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="8"
              onClick="document.form2.smi.value+='8'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="9"
              onClick="document.form2.smi.value+='9'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="0"
              onClick="document.form2.smi.value+='0'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE=" "
              onClick="document.form2.smi.value+=' '"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="charge"
              onClick="entercharge(document.form2.smi)"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="mult"
              onClick="entermult(document.form2.smi)"
              style="background-color:#f8f8ff; color:#298DB4;">
    </FORM>
    <br>

    <!--  start of ace-jsme table -->
    <br>
    <table>
         <tr>
            <td>
               <input type="button" VALUE="Arrows input to JSME &#8600;" onClick="esmiles2dWindow()" style="background-color:#f8f8ff; color:#de3e59; font-size: 14px; font-weight:bold"/>
               <input type="button" VALUE="JSMol to JSME &#8600;" onClick="readMolecule()" style="background-color:#f8f8ff; color:#0000ff; font-size: 14px; font-weight:bold"/>
               <input type="button" VALUE="JSMol append to JSME &#8600;" onClick="appendMolecule()" style="background-color:#f8f8ff; color:#0000ff; font-size: 14px; font-weight:bold"/>
               <input type="button" VALUE="&#8598; JSME to JSMol" onClick="jmsmiles()" style="background-color:#f8f8ff; color:#0000ff; font-size: 14px; font-weight:bold"/>
               <input type="button" VALUE="&#8598; JSME append to JSMol" onClick="jmasmiles()" style="background-color:#f8f8ff; color:#0000ff; font-size: 14px; font-weight:bold"/>
            </td>
         </tr>
         <tr>
             <!--td id="editor" style="height: 500px; width: 750px">some text is here </td-->
             <td id="appletContainer"></td>
        </tr>
        <tr> 
           <td>
           <input type="button" class="button3" name="jmolreactionplane4" id="jmolreactionplane4" value="Reaction on" onClick="jmreactionplane()"/>
           <input type="button" class="button3" value="Redraw JSME" onClick="redraw2dWindow()"/>
           <input type="button" class="button3" value="Arrows to JSME" onClick="arrows2dWindow()"/>
           </td>
        </tr>
    </table>
    <!--  end of ace-jsme table -->



    <font color="00008B">
    <h3>  The following are examples of input that can be used with Tiny Arrows. Clicking on a button places the command into the above entry box. </h3>
    <form method="POST" ONSUBMIT="return false;">
       <p><b> <font size="+1.5">Molecular calculations: </font> </b> &nbsp;
       <INPUT TYPE="button" VALUE="CN1C=NC2=C1C(=O)N(C(=O)N2C)C" onClick="document.form2.smi.value='CN1C=NC2=C1C(=O)N(C(=O)N2C)C'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="Pubchem=2519" onClick="document.form2.smi.value='Pubchem=2519'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="ChemSpider=2424" onClick="document.form2.smi.value='ChemSpider=2424'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="cas=58-08-2" onClick="document.form2.smi.value='cas=58-08-2'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="kegg=D00528" onClick="document.form2.smi.value='kegg=D00528'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="InChI=1S/C8H10N4O2/c1-10-4-9-6-5(10)7(13)12(3)8(14)11(6)2/h4H,1-3H3"
              onClick="document.form2.smi.value='InChI=1S/C8H10N4O2/c1-10-4-9-6-5(10)7(13)12(3)8(14)11(6)2/h4H,1-3H3'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="Caffeine" onClick="document.form2.smi.value='Caffeine'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="CHEMBL113" onClick="document.form2.smi.value='CHEMBL113'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="CN1C=NC2=C1C(=O)N(C(=O)N2C)C theory{pspw}" onClick="document.form2.smi.value='CN1C=NC2=C1C(=O)N(C(=O)N2C)C theory{pspw}'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="CN1C=NC2=C1C(=O)N(C(=O)N2C)C xc{pbe}" onClick="document.form2.smi.value='CN1C=NC2=C1C(=O)N(C(=O)N2C)C xc{pbe}'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="CN1C=NC2=C1C(=O)N(C(=O)N2C)C xc{m06-2x}" onClick="document.form2.smi.value='CN1C=NC2=C1C(=O)N(C(=O)N2C)C xc{m06-2x}'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="CN1C=NC2=C1C(=O)N(C(=O)N2C)C theory{mp2}" onClick="document.form2.smi.value='CN1C=NC2=C1C(=O)N(C(=O)N2C)C theory{mp2}'"
              style="background-color:#f8f8ff; color:#298DB4;">
       </p>
       <p><b><font size="+1.5">  Reaction calculations: </font> </b> &nbsp;
       <INPUT TYPE="button" VALUE="CC + hydrogen gas --> 2 methane" onClick="document.form2.smi.value='CC + hydrogen gas --> 2 methane'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="C=C + ClCl --> ClCCCl" onClick="document.form2.smi.value='C=C + ClCl --> ClCCCl'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="TNT + hydroxide --> TNT-2-OH + nitrite" onClick="document.form2.smi.value='TNT + hydroxide --> TNT-2-OH + nitrite'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="TNT + hydroxide --> TNT-2-OH + nitrite ~ xc{m06-2x}"
              onClick="document.form2.smi.value='TNT + hydroxide --> TNT-2-OH + nitrite ~ xc{m06-2x}'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="TNT + hydroxide --> TNT-2-OH + nitrite ~ theory{pspw4}"
              onClick="document.form2.smi.value='TNT + hydroxide --> TNT-2-OH + nitrite ~ theory{pspw4}'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="TNT + water --> TNT-2-OH + nitrous acid ~ theory{pspw}"
              onClick="document.form2.smi.value='TNT + water --> TNT-2-OH + nitrous acid ~ theory{pspw}'"
              style="background-color:#f8f8ff; color:#298DB4;">

       </p>
       <p><b> <font size="+1.5"> NMR calculations: </font> </b> &nbsp;
       <INPUT TYPE="button" VALUE="nmr for O=N(=O)c1cc(N(=O)=O)c(c(c1)N(=O)=O)C basis{6-31G*}"
              onClick="document.form2.smi.value='nmr for O=N(=O)c1cc(N(=O)=O)c(c(c1)N(=O)=O)C basis{6-31G*}'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="nmr for O=N(=O)c1cc(N(=O)=O)c(c(c1)N(=O)=O)C basis{6-31G*} solvation_type{None}"
              onClick="document.form2.smi.value='nmr for O=N(=O)c1cc(N(=O)=O)c(c(c1)N(=O)=O)C basis{6-31G*} solvation_type{None}'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="nmr for aspirin"
              onClick="document.form2.smi.value='nmr for aspirin'"
              style="background-color:#f8f8ff; color:#298DB4;">
       </p>
       <p><b><font size="+1.5">  Predict reactions: </font></b> &nbsp;
       <INPUT TYPE="button" VALUE="TNT + hydroxide -->"
              onClick="document.form2.smi.value='TNT + hydroxide -->'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="C=C + ClCl -->"
              onClick="document.form2.smi.value='C=C + ClCl -->'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="TNT + hydroxide --> ~ theory{pspw4}"
              onClick="document.form2.smi.value='TNT + hydroxide --> ~ theory{pspw4}'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="predict for TNT + hydroxide"
              onClick="document.form2.smi.value='predict for TNT + hydroxide'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="predict for tetryl + hydroxide"
              onClick="document.form2.smi.value='predict for tetryl + hydroxide'"
              style="background-color:#f8f8ff; color:#298DB4;">
       </p>
       <p><b><font size="+1.5"> SMARTS searching: </font></b> &nbsp;
       <INPUT TYPE="button" VALUE="smarts cN(=O)=O  xc{m06-2x}"
              onClick="document.form2.smi.value='smarts cN(=O)=O  xc{m06-2x}'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="smarts c1ccccc1 theory{pspw4}"
              onClick="document.form2.smi.value='smarts c1ccccc1 theory{pspw4}'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="smarts [CX3H1](=O)[#6]"
              onClick="document.form2.smi.value='smarts [CX3H1](=O)[#6]'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="smarts [CX3](=[OX1])C theory{mp2}"
              onClick="document.form2.smi.value='smarts [CX3](=[OX1])C theory{mp2}'"
              style="background-color:#f8f8ff; color:#298DB4;">
       </p>
       <p><b><font size="+1.5"> Generate NWChem input, Fetch NWChem output, Fetch XYZ and Fetch JSON: </font></b> &nbsp;
       <INPUT TYPE="button" VALUE="input deck for aspirin"
              onClick="document.form2.smi.value='input deck for aspirin'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="input deck for aspirin theory{pspw}"
              onClick="document.form2.smi.value='input deck for aspirin theory{pspw}'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="input deck for aspirin theory{mp2}"
              onClick="document.form2.smi.value='input deck for aspirin theory{mp2}'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="input deck for PubChem=2519 xc{pbe}"
              onClick="document.form2.smi.value='input deck for PubChem=2519 xc{pbe}'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="output deck for aspirin"
              onClick="document.form2.smi.value='output deck for aspirin'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="nwoutput for aspirin theory{pspw}"
              onClick="document.form2.smi.value='nwoutput for aspirin theory{pspw}'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="xyz for aspirin theory{pspw}"
              onClick="document.form2.smi.value='xyz for aspirin theory{pspw}'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="json for aspirin theory{pspw}"
              onClick="document.form2.smi.value='json for aspirin theory{pspw}'"
              style="background-color:#f8f8ff; color:#298DB4;">
       </p>
        <p>
       <p><b><font size="+1.5"> Other Arrows commands: </font></b> &nbsp;
       <INPUT TYPE="button" VALUE="list all reactions"
              onClick="document.form2.smi.value='list all reactions'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="list all esmiles 100"
              onClick="document.form2.smi.value='list all esmiles 100'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="queue"
              onClick="document.form2.smi.value='queue'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="download fetch_nwchem_input"
              onClick="document.form2.smi.value='download fetch_nwchem_input'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="download upload_nwchem_outfiles"
              onClick="document.form2.smi.value='download upload_nwchem_outfiles'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="download arrows_esmiles2xyz"
              onClick="document.form2.smi.value='download arrows_esmiles2xyz'"
              style="background-color:#f8f8ff; color:#298DB4;">
       <INPUT TYPE="button" VALUE="submitesmiles for ethene theory{pspw}"
              onClick="document.form2.smi.value='submitesmiles for ethene theory{pspw}'"
              style="background-color:#f8f8ff; color:#298DB4;">
        </p>
    </form>
    </font>

</div>

<div id="Notes" class="tabcontent">

cached notes db (IndexedDB) name:
   <input type="text" list="notesnamelist" id="notedbname"  value="note1" oninput="cacheInput(this)"/>
      <datalist id="notesnamelist">
         <option value="note1">note1</option>
         <option value="note2">note2</option>
         <option value="note3">note3</option>
         <option value="note4">note4</option>
         <option value="note5">note5</option>
         <option value="note6">note6</option>
         <option value="note7">note7</option>
         <option value="note8">note8</option>
         <option value="note9">note9</option>
         <option value="note10">note10</option>
         <option value="note11">note11</option>
         <option value="note12">note12</option>
      </datalist>
   <input type="button" VALUE="read"  onClick="loadnotetodbname();" style="background-color:#f8f8ff; color:#298DB4; font-size: 14px; font-weight:bold"/>
   <input type="button" VALUE="write" onClick="savenotetodbname();" style="background-color:#f8f8ff; color:#298DB4; font-size: 14px; font-weight:bold"/>
   <b style="color: blue; font-size: 14px;" class="blink9" id="notedbnamebanner"></b> 

<br> <br>
<textarea id="joditeditor" name="joditeditor"></textarea>
<br>
<a href=" https://base64.guru/converter/encode/image">image to base64</a>
<br>
Encode image to base64:
<input id="inputFileToLoad" type="file" onChange="encodeImageFileAsURL();" />
<div id="imgTest"></div>


<br>
<input type="button" VALUE="Save to file" onClick="savenotefile(document.getElementById('notedbname').value)" style="background-color:#f8f8ff; color:#298DB4; font-size: 14px; font-weight:bold"/>
<input type="button" VALUE="Load selected file" onClick="loadnotefile()" style="background-color:#f8f8ff; color:#298DB4; font-size: 14px; font-weight:bold"/>
<input type="file" id="noteToLoad" style="background-color:#f8f8ff; color:#298DB4; font-size: 14px; font-weight:bold">
<br>
<input type="button" VALUE="Save to url" onClick="savenotetourl()" title="Save note to url" style="background-color:#f8f8ff; color:darkred; font-size: 14px; font-weight:bold"/>
<input type="url" id="urlToLoadnote" SIZE=117  style="background-color:#f8f8ff; color:#298DB4; font-size: 14px; font-weight:bold">
<input type="button" VALUE="Load from url" onClick="loadurltonote()" title="Load note from url into editor" style="background-color:#f8f8ff; color:darkgreen; font-size: 14px; font-weight:bold"/>
<br>
<input type="button" value="NWChem Bugs" onClick="document.getElementById('urlToLoadnote').value='https://arrows.emsl.pnnl.gov/api/eric_view/raw=we31869:/media/seagate2/Projects/Eric/nwchem-bugs.note'" style="background-color:#f8f8ff; color:#298DB4;">
<input type="button" value="NWChemEx Status" onClick="document.getElementById('urlToLoadnote').value='https://arrows.emsl.pnnl.gov/api/eric_view/raw=we31869:/media/seagate2/Projects/Eric/nwchemex-status.note'" style="background-color:#f8f8ff; color:#298DB4;">
<input type="button" value="CCS Status" onClick="document.getElementById('urlToLoadnote').value='https://arrows.emsl.pnnl.gov/api/eric_view/raw=we31869:/media/seagate2/Projects/Eric/ccs-status.note'" style="background-color:#f8f8ff; color:#298DB4;">
<input type="button" value="Samsung Status" onClick="document.getElementById('urlToLoadnote').value='https://arrows.emsl.pnnl.gov/api/eric_view/raw=we31869:/media/seagate2/Projects/Eric/samsung-status.note'" style="background-color:#f8f8ff; color:#298DB4;">
<input type="button" value="SERDP Status" onClick="document.getElementById('urlToLoadnote').value='https://arrows.emsl.pnnl.gov/api/eric_view/raw=we31869:/media/seagate2/Projects/Eric/serdp-status.note'" style="background-color:#f8f8ff; color:#298DB4;">
<input type="button" value="QUASAR Status" onClick="document.getElementById('urlToLoadnote').value='https://arrows.emsl.pnnl.gov/api/eric_view/raw=we31869:/media/seagate2/Projects/Eric/quasar-status.note'" style="background-color:#f8f8ff; color:#298DB4;">
<input type="button" value="Ilton Status" onClick="document.getElementById('urlToLoadnote').value='https://arrows.emsl.pnnl.gov/api/eric_view/raw=we31869:/media/seagate2/Projects/Eric/ilton-status.note'" style="background-color:#f8f8ff; color:#298DB4;">

<script type='text/javascript'>

  function encodeImageFileAsURL() {

    var filesSelected = document.getElementById("inputFileToLoad").files;
    if (filesSelected.length > 0) {
      var fileToLoad = filesSelected[0];

      var fileReader = new FileReader();

      fileReader.onload = function(fileLoadedEvent) {
        var srcData = fileLoadedEvent.target.result; // <--- data: base64

        var newImage = document.createElement('img');
        newImage.src = srcData;

        document.getElementById("imgTest").innerHTML = newImage.outerHTML;
        alert("Converted Base64 version is " + document.getElementById("imgTest").innerHTML);
        console.log("Converted Base64 version is " + document.getElementById("imgTest").innerHTML);
      }
      fileReader.readAsDataURL(fileToLoad);
    }
  }


var joditeditor = new Jodit('#joditeditor', {
    //defaultMode: Jodit.MODE_SPLIT,
    toolbarButtonSize: "large",
    spellcheck: true,
    i18n: 'en',
    minHeight: 500,
    height: 500,
    extraButtons: [
        {
            name: 'insertDate',
            iconURL: "{{ url_for('static', filename='arrows-static/icons8-timestamp-67.png')}}",
            //iconURL: "{{ url_for('static', filename='arrows-static/date-time.png')}}",
            //iconURL: "{{ url_for('static', filename='arrows-static/iconfinder_History_132755.png')}}",
            //iconURL: '/arrows-static/iconfinder_History_132755.png',
            exec: function (editor) {
                editor.selection.insertHTML((new Date).toUTCString());
            }
        }
    ]
});
//joditeditor.setEditorValue('The World is flat <p>start</p>');


function savenotefile(filename) {
   var textToSave = joditeditor.getEditorValue();
   var fileNameToSaveAs;
   if (filename.length>0) {
      fileNameToSaveAs = prompt("Please enter filename:", filename);
   } else {
      var filenameguess = "arrows.note";
      fileNameToSaveAs = prompt("Please enter filename:", filenameguess);
   }

   var textToSaveAsBlob = new Blob([textToSave], {type:"text/plain"});
   var textToSaveAsURL  = window.URL.createObjectURL(textToSaveAsBlob);

   var downloadLink = document.createElement("a");
   downloadLink.download = fileNameToSaveAs;
   downloadLink.innerHTML = "Download File";
   downloadLink.href = textToSaveAsURL;
   downloadLink.onclick = destroyClickedElement;
   downloadLink.style.display = "none";
   document.body.appendChild(downloadLink);
   downloadLink.click();
} 

function loadnotefile() {
   var data = "no data";
   var fileToLoad = document.getElementById("noteToLoad").files[0];

   var fileReader = new FileReader();
   fileReader.onload = function(fileLoadedEvent) {
      var textFromFileLoaded = fileLoadedEvent.target.result;
      joditeditor.setEditorValue(textFromFileLoaded);
   };
   fileReader.readAsText(fileToLoad, "UTF-8");
}

function savenotetourl() {
   //var arrows_post_url = 'https://arrows.emsl.pnnl.gov/api/upload/';
   var arrows_post_url = '{{ arrows_api }}upload/';
   var url = document.getElementById("urlToLoadnote").value;
   var saveurl = url.replace("raw=","raw_deposit=");

   var textToSave = joditeditor.getEditorValue();
   var fileNameToSaveAs =  url.split("/").pop();

   if (confirm("Do you want to save " + fileNameToSaveAs + " ?")) {
      var textToSaveAsBlob = new Blob([textToSave], {type:"text/plain"});
      var textToSaveAsURL  = window.URL.createObjectURL(textToSaveAsBlob);

      var formD = new FormData();
      formD.append('file', textToSaveAsBlob,fileNameToSaveAs);
      formD.append('title', fileNameToSaveAs);

      var xhr = new XMLHttpRequest();
      xhr.open("POST", arrows_post_url, true);
      xhr.onload = function (e) {
         if (xhr.readyState === 4) {
            if (xhr.status === 200) {
               console.log("  - post response:" +xhr.responseText);
            }
         }
      };
      xhr.onerror = function (e) {
         console.error(xhr.statusText);
      };
      xhr.send(formD);
      
      var request = new XMLHttpRequest();
      request.open('GET', saveurl, true);
      request.onload = function (e) {
         if (request.readyState === 4) {
            if (request.status === 200) {
               var textFromUrl = request.responseText;
               console.log(textFromUrl);
               alert(textFromUrl);
            } else {
               console.error(request.statusText);
            }
         }
      };
      request.onerror = function (e) {
         console.error(request.statusText);
      };
      request.send();
   }
}

function loadurltonote() {
   //var corh = "https://cors-anywhere.herokuapp.com/"
   var corh = "";
   var url = corh + document.getElementById("urlToLoadnote").value;

   if (url.trim().length>9) {
      var ajax = new XMLHttpRequest();
      ajax.open("GET", url, false); // third parameter is async flag
      ajax.send();
      var textFromUrl = ajax.responseText;
      joditeditor.setEditorValue(textFromUrl);
   }
}



/********************************************
 *                                          *
 *            savenotetodbname              *
 *                                          *
 ********************************************/
function savenotetodbname() {
   document.getElementById('notedbnamebanner').style.display = "none";

   var notetitle  = document.getElementById("notedbname").value;
   var textToSave = joditeditor.getEditorValue();

   const dbname    = "arrows_notes";
   const dbversion = 1;

   if (confirm("Do you want to save " + notetitle + " ?")) {

   const request = indexedDB.open(dbname,dbversion);

      // on upgrade needed
      request.onupgradeneeded = e => {
         const db = e.target.result;
         const pNotes = db.createObjectStore("personal_notes",{keyPath: "title"});

         console.log(`savenote upgrade called, name: ${db.name}  version: ${db.version}`);
      }

      // on success
      request.onsuccess = e => {
         const db = e.target.result;
         console.log(`savenote on success called, name: ${db.name}  version: ${db.version}`);
         const tx = db.transaction("personal_notes","readwrite");
         tx.onerror = etx => alert(`savenote: tx on error called, ${etx.target.error}`);

         const pNotes = tx.objectStore("personal_notes");
         const putrequest = pNotes.put({title: notetitle, notetext: textToSave});
         //putrequest.onsuccess = eee => console.log(`Note ${notetitle} was saved into ${dbname}`);
         putrequest.onsuccess = eee => {document.getElementById('notedbnamebanner').style.display = "inline";
                                        document.getElementById('notedbnamebanner').innerHTML= `Note ${notetitle} was saved into ${dbname} (IndexedDB) db`;
                                        console.log(`Note ${notetitle} was saved into ${dbname}`);}
         putrequest.onerror   = eee => alert(`pNotes.put into ${notetitle} failed!`);

      };

      // on error
      request.onerror = e => {
         alert(`savenote error: ${e.target.error} was found`);
      }
   }
}


/********************************************
 *                                          *
 *            loadnotetodbname              *
 *                                          *
 ********************************************/
function loadnotetodbname() {
   document.getElementById('notedbnamebanner').style.display = "none";

   var notetitle = document.getElementById("notedbname").value;

   const dbname    = "arrows_notes";
   const dbversion = 1;
   if (confirm("Do you want to load " + notetitle + " ?")) {

      const request = indexedDB.open(dbname,dbversion);

      // on upgrade needed
      request.onupgradeneeded = e => {
         const db = e.target.result;
         const pTables = db.createObjectStore("personal_notes",{keyPath: "title"});

         console.log(`loadnote upgrade called, name: ${db.name}  version: ${db.version}`);
      }

      // on success
      request.onsuccess = e => {
         const db = e.target.result;
         console.log(`loadnote on success called, name: ${db.name}  version: ${db.version}`);
         const tx = db.transaction("personal_notes","readonly");
         tx.onerror = etx => alert(`loadnote: tx on error called, ${etx.target.error}`);

         const pNotes = tx.objectStore("personal_notes");
         const getrequest = pNotes.get(notetitle);
            getrequest.onsuccess = eee => {
               var textFromdb = eee.target.result;
               console.log("loadnote textFromdb=",textFromdb);
               joditeditor.setEditorValue(textFromdb.notetext);
               document.getElementById('notedbnamebanner').style.display = "inline";
               document.getElementById('notedbnamebanner').innerHTML= `Note ${notetitle} was loaded from ${dbname} (IndexedDB) db`;
            }

            getrequest.onerror   = eee => alert(`The note name ${notetitle} was not found in the ${dbname} indexedDB database`);
      };

      // on error
      request.onerror = e => {
         alert(`loadnote error: ${e.target.error} was found`);
      }
   }
}
</script>
</div>





<div id="SpreadSheet" class="tabcontent">

cached table db (IndexedDB) name: 
   <input type="text" list="tablenamelist" id="spreadsheetdbname"  value="table1" oninput="cacheInput(this)"/>
      <datalist id="tablenamelist">
         <option value="table1">table1</option>
         <option value="table2">table2</option>
         <option value="table3">table3</option>
         <option value="table4">table4</option>
         <option value="table5">table5</option>
         <option value="table6">table6</option>
         <option value="table7">table7</option>
         <option value="table8">table8</option>
         <option value="table9">table9</option>
         <option value="table10">table10</option>
         <option value="table11">table11</option>
         <option value="table12">table12</option>
      </datalist>
     <input type="button" VALUE="read"  onClick="loadspreadtodbname();" style="background-color:#f8f8ff; color:#298DB4; font-size: 14px; font-weight:bold"/>
     <input type="button" VALUE="write" onClick="savespreadtodbname();" style="background-color:#f8f8ff; color:#298DB4; font-size: 14px; font-weight:bold"/>
     <b style="color: blue; font-size: 14px;" class="blink9"  id="spreadsheetdbnamebanner"></b>
   <br> <br>
   <input type="button" VALUE="Submit Arrows" onClick="submit_spreadSheet()" title="Submit Arrows" style="background-color:#f8f8ff; color:#0000ff; font-size: 14px; font-weight:bold"/>
   <input type="button" VALUE="Clear run" onClick="document.getElementById('runmebanner4d').innerHTML= ''" title="Clear run"/>
   <b style="color: blue; font-size: 14px;" id="runmebanner4c"></b> -- <b style="color: red; font-size: 14px;" id="runmebanner4d"></b>
   <br>

<div id="jspreadsheet"></div>


<script>

myspreadsheet = jexcel(document.getElementById('jspreadsheet'), {
    //data:data,
    search:true,
    rowResize:true,
    tableOverflow:true,
    tableHeight:'600px',
    //loadingSpin:true,
    //pagination:25,
    minDimensions: [10, 50],
    toolbar:[
        { type:'i', content:'undo', onclick:function() { myspreadsheet.undo(); } },
        { type:'i', content:'redo', onclick:function() { myspreadsheet.redo(); } },
        { type:'i', content:'upload', onclick:function () { loadspreadtodbname(); } },
        { type:'i', content:'save', onclick:function () { savespreadtodbname(); } },
        { type:'i', content:'sentiment_satisfied_alt', onclick:function () { addjsmesmiles(); } },
        { type:'i', content:'3d_rotation', onclick:function () {pushesmilesjsmol();}},
        { type:'i', content:'table_chart', onclick:function () {addtable_spreadsheet();}},
        { type:'i', content:'filter_2', onclick:function () { setprecision(); } },
        { type:'select', k:'font-family', v:['Arial','Verdana'] },
        { type:'select', k:'font-size', v:['9px','10px','11px','12px','13px','14px','15px','16px','17px','18px','19px','20px'] },
        { type:'i', content:'format_align_left', k:'text-align', v:'left' },
        { type:'i', content:'format_align_center', k:'text-align', v:'center' },
        { type:'i', content:'format_align_right', k:'text-align', v:'right' },
        { type:'i', content:'format_bold', k:'font-weight', v:'bold' },
        { type:'color', content:'format_color_text', k:'color' },
        { type:'color', content:'format_color_fill', k:'background-color' },
    ], 
    columnSorting:false,
    columns: [
              {width:150},
              {width:150},
              {width:150},
              {width:150},
              {width:150},
              {width:150},
             ] ,
     updateTable:function(instance, cell, col, row, val, label, cellName) {
        // Number formating
        var v = parseFloat(label);
        var pp = hasprecision(row,col);
        if ((!isNaN(v)) && (pp>=0)) {
           cell.innerHTML = v.toFixed(pp);
        }
     }

});

function addjsmesmiles() {
   var smiles = document.JME.smiles();
   var re = /\./g;
   smiles = smiles.replace(re, " + ");
   smiles = smiles.replace(">>"," --> ");
  
   var xx = myspreadsheet.getSelectedRows(true);
   var yy = myspreadsheet.getSelectedColumns();
   var ff = myspreadsheet.getStyle();
   var data = myspreadsheet.getData();
   for (i=0; i<xx.length; ++i) {
      ii = xx[i];
      for (j=0; j<yy.length; ++j) {
         jj = yy[j];
         data[ii][jj] = smiles;
      }
   }
   myspreadsheet.setData(data);
   myspreadsheet.setStyle(ff);
}
function pushesmilesjsmol() {
   var rr,pp;
   var xx = myspreadsheet.getSelectedRows(true);
   var yy = myspreadsheet.getSelectedColumns();
   if ((xx.length>0) && (yy.length>0)) {
      var ii = xx[0];
      var jj = yy[0];
      var data = myspreadsheet.getData();
      var esmiles = data[ii][jj];
      if (esmiles.includes("-->")) {
         rr = esmiles.split("-->")[0].trim();
         pp = esmiles.split("-->")[1].trim();
         esmiles = rr + "\>\>" + pp;
         document.getElementById("jmolreactionplane").value = "Reaction on";
      } else {
         document.getElementById("jmolreactionplane").value = "Reaction off";
      }
      jmreactionplane()
      //esmiles = esmiles.split(" + ").join(".");
      var ss = esmiles.split(" + ");
      esmiles = "";
      for (var i=0; i<ss.length; ++i) {
         var tt = ss[i].trim().split(/[ ,]+/);
         if (!isNaN(parseFloat(tt[0]))) {
            for (var j=0; j<(parseInt(tt[0])); ++j) {
               esmiles += tt[1] + ".";
            }
         } else {
            esmiles += ss[i].trim() + ".";
         }
      }
      esmiles = esmiles.slice(0,esmiles.length-1);
      console.log("ESMILES=",esmiles);
      jmsmiles0(esmiles);
      alert("Uploaded " + data[ii][jj] + " to 3D Builder");
      
   }
}

function addtable_spreadsheet() {
   var xx = myspreadsheet.getSelectedRows(true);
   var yy = myspreadsheet.getSelectedColumns();
   if ((xx.length>0) && (yy.length>0)) {
      var ii = xx[0];
      var jj = yy[0];
      var tableType = document.getElementById("tableType").value.split("|")[0];
      var method    = document.getElementById("tableType").value.split("|")[1];
      var theories  = document.getElementById("columnTheories").value.split("|");
      var nrows     = document.getElementById("nrowsTable").value.split("|");
      var ff = myspreadsheet.getStyle();
      var data = myspreadsheet.getData();
      data[ii][jj] = tableType;
      for (var ix=0; ix<nrows; ++ix) {
        data[ii+ix+1][jj] = "esmiles or esmiles reaction";
      }
      for (var j=0; j<theories.length; ++j) {
         data[ii][jj+j+1] = theories[j].trim();
         for (var i=0; i<nrows; ++i) {
            data[ii+i+1][jj+j+1] = method;
         }
      }
      myspreadsheet.setData(data);
      myspreadsheet.setStyle(ff);
   }
}




var spreadformats = [];
var ni_spreadformats = 0;
var nj_spreadformats = 0;
function hasprecision(i,j) {
   var pp = -1;
   if ((i<window.ni_spreadformats) && (j<window.nj_spreadformats)) {
      pp = window.spreadformats[i][j];
   }
   return pp;
}

function setprecision() {
   var i,j,ii,jj,ff;
   var pp = parseInt(prompt("set precision=",2));
   var data = myspreadsheet.getData();
   var ni = data.length;
   var nj = data[0].length;
   var newdata = [];
   if ((ni!=window.ni_spreadformats) || (nj!=window.nj_spreadformats)) {
      for (i=0; i<ni; ++i) {
         var rr = [];
         for (j=0; j<nj; ++j) {
            if ((i<window.nj_spreadformats) && (j<window.nj_spreadformats)) {
               ff = window.spreadformats[i][j];
            } else {
               ff = -1;
            }
            rr.push(ff);
         }
         newdata.push(rr);
      }
      window.spreadformats = newdata;
      window.ni_spreadformats = ni;
      window.nj_spreadformats = nj;
   }

   var xx = myspreadsheet.getSelectedRows(true);
   var yy = myspreadsheet.getSelectedColumns();
   for (i=0; i<xx.length; ++i) {
      ii = xx[i];
      for (j=0; j<yy.length; ++j) {
         jj = yy[j];
         window.spreadformats[ii][jj] = pp;
      }
   }
   myspreadsheet.updateTable();
}





function loadcsvfile() {
   var data = [["Year","Performing artist(s)","Work"],
               [2006,"U2","How to Dismantle an Atomic Bomb"]];
   var fileToLoad = document.getElementById("csvToLoad").files[0];
   var fileReader = new FileReader();
   fileReader.onload = function(fileLoadedEvent) {
      var textFromFileLoaded = fileLoadedEvent.target.result;
      var ldata = textFromFileLoaded.split("\n");
      data = [];
      for (var i=0; i<ldata.length; ++i) {
         data.push(ldata[i].split(","));
      }
      myspreadsheet.setData(data);
   };
   fileReader.readAsText(fileToLoad, "UTF-8");
}

function savecsvfile() {
    myspreadsheet.download();
}

var computeCells        = [];
var computeCells_length = 0;
var computeCells_cur    = 0;
function run_next_cell() {
   if (window.computeCells_cur < window.computeCells_length) {
      submit_cell(window.computeCells[window.computeCells_cur]);
      window.computeCells_cur += 1;
   }
}

function finish_spreadsheet(cellstr,energy) {
   if (!isNaN(parseFloat(energy))) {
      //myspreadsheet.setValue('A1', energy);
      myspreadsheet.setValue(cellstr, energy);
      Text2Speech0("Value added to cell " + cellstr);
   }
   run_next_cell();
   if (window.computeCells_cur >= window.computeCells_length) {
      document.getElementById('runmebanner4d').innerHTML= "";
   }
}

function submit_cell(cell) {
   var reaction_str = cell[1];
   //var arrows_get_url  = "https://arrows.emsl.pnnl.gov/api/reaction/'OC(O)C(O)OC(O)C(O)O --> OC1OC(O)C(O)OC1O + O ~ theory{pspw4} parse_output{hrxn(gas)}'";
   var table_calc_url = document.getElementById("arrows_calculation_url").value;

   // parsing standard hrxn etc.
   var arrows_get_url;
   if (reaction_str.includes("-->")) {
      reaction_str = reaction_str.replace(/#/gi,"!");
      //arrows_get_url  = "https://arrows.emsl.pnnl.gov/api/reaction/'" + reaction_str + "'";
      //arrows_get_url  = "{{ arrows_api }}reaction/'" + reaction_str + "'";
      arrows_get_url  = table_calc_url + "reaction/'" + reaction_str + "'";
   } else if (reaction_str.includes("submitesmiles")) {
      var tt = "parse_output{" + reaction_str.split("parse_output{")[1].split("}")[0] + "}";
      reaction_str = reaction_str.replace(tt,"");
      reaction_str = reaction_str.replace("submitesmiles","");
      reaction_str = reaction_str.replace("~","");
      reaction_str = reaction_str.replace(/#/gi,"!");
      //arrows_get_url  = "https://arrows.emsl.pnnl.gov/api/submitesmiles/'" + reaction_str + "'";
      //arrows_get_url  = "{{ arrows_api }}submitesmiles/'" + reaction_str + "'";
      arrows_get_url  = table_calc_url + "submitesmiles/'" + reaction_str + "'";
   } else {
      reaction_str = reaction_str.replace("~","");
      reaction_str = reaction_str.replace(/#/gi,"!");
      //arrows_get_url  = "https://arrows.emsl.pnnl.gov/api/molecule/'" + reaction_str + "'";
      //arrows_get_url  = "{{ arrows_api }}molecule/'" + reaction_str + "'";
      arrows_get_url  = table_calc_url + "molecule/'" + reaction_str + "'";
   }
   document.getElementById('runmebanner4c').innerHTML= "Arrows calculation started for " + reaction_str + " at " + cell[0];
   Text2Speech0("Arrows calculation started for cell " + cell[0]);
   console.log("Running Web API ", arrows_get_url);

   var ajax = new XMLHttpRequest();
   ajax.open('GET', arrows_get_url, true);
   ajax.onload = function (e) {
     if (ajax.readyState === 4) {
       if (ajax.status === 200) {
         var textFromUrl = ajax.responseText;
         document.getElementById('runmebanner4c').innerHTML= "Arrows Finished!";
         finish_spreadsheet(cell[0],textFromUrl);
       } else {
         console.error(ajax.statusText);
         document.getElementById('runmebanner4c').innerHTML= ajax.statusText;
       }
     }
   };
   ajax.onerror = function (e) {
      console.error(ajax.statusText);
      document.getElementById('runmebanner4c').innerHTML= ajax.statusText;
   };
   ajax.send();
}

function check_cell_for_hashString(cell) {
   var reaction_str = cell[1];
   if (reaction_str.includes("hstart:") && reaction_str.includes(":hmid:") && reaction_str.includes(":hend")) {
      Text2Speech0("Parsing hashstring for cell " + cell[0]);
      var parstring0 =  reaction_str.split("hstart:")[1].split(":hmid:")[0];
      var urlstring0 =  reaction_str.split(":hmid:")[1].split(":hend")[0];
      finish_spreadsheet(cell[0], splitparsingdata(parstring0, loadurldata(urlstring0)));
   }
}


function check_command(str) {
   var ok = false;
   if (typeof str === 'string' || str instanceof String) {
      var xstr = str.trim();
      if ( (xstr.contains("erxn(gas)")) ||
           (xstr.contains("e(gas)")) ||
           (xstr.contains("hrxn(gas)")) ||
           (xstr.contains("h(gas)")) ||
           (xstr.contains("grxn(gas)")) ||
           (xstr.contains("g(gas)")) ||
           (xstr.contains("grxn(aq)")) ||
           (xstr.contains("g(aq)")) ||
           (xstr.contains("g(solvation)")) ||
           (xstr.contains("g(delta_solvation)")) ||
           (xstr.contains("submitesmiles")) ||
           (xstr.contains("homo")) ||
           (xstr.contains("alpha_homo")) ||
           (xstr.contains("beta_homo")) ||
           (xstr.contains("lumo")) ||
           (xstr.contains("alpha_lumo")) ||
           (xstr.contains("beta_lumo"))) {
         ok = true;
      }
   }
   return ok; }

//
// convert_command: replaces g(solvation) and g(delta_solvation) 
//
function convert_command(str) {
   if (typeof str === 'string' || str instanceof String) {
      var xstr = str.trim();
      if (xstr.contains("g(solvation)"))       xstr = "solvation";
      if (xstr.contains("g(delta_solvation)")) xstr = "delta_solvation";
      return xstr;
   } else {
      return str;
   }
}


function check_float(str) {
   return (!isNaN(parseFloat(str))); // true
}

function check_not_commandOrFloat(str) {
   var ok = false;
   if (isNaN(parseFloat(str))) {
      var xstr = str.trim();
      if  ((!check_command(xstr)) && (!check_float(xstr)) && (xstr.length>0)) {
         ok = true;
      }
   }
   return ok;
}

function gencellstr(i,j) {
   return String.fromCharCode(65+j) + i.toString();
}

function submit_spreadSheet() {
   var test = document.getElementById('runmebanner4d').innerHTML;
   if (!test.includes("Running Arrows")) {
      document.getElementById('runmebanner4d').innerHTML= "Running Arrows. Please be patient.";
      window.computeCells = [];
      window.computeCells_length = 0;
      window.computeCells_cur    = 0;
      var xx = myspreadsheet.getData(false);
      for (var i=0; i<xx.length; ++i) {
         var yy = xx[i];
         for (var j=0; j<yy.length; ++j) {
            check_cell_for_hashString([gencellstr(i+1,j),xx[i][j].trim()]);
            if (check_command(yy[j])) {
               var ii = i-1;
               var jj = j-1;
               var colfound = false;
               var rowfound = false;
               while ((jj>=0) && (!colfound)) {
                  if (check_not_commandOrFloat(xx[i][jj])) {
                     colfound = true;
                  } else {
                     --jj;
                  }
               }
               while ((ii>=0) && (!rowfound)) {
                  if (check_not_commandOrFloat(xx[ii][j])) {
                     rowfound = true;
                  } else {
                     --ii;
                  }
               }

               if (colfound && rowfound) {
                  window.computeCells.push([gencellstr(i+1,j),xx[i][jj]+" ~ "+xx[ii][j]+" parse_output{"+convert_command(xx[i][j].trim())+"}"]);
                  window.computeCells_length += 1;
               }
            }
         }
      }
      run_next_cell();
   }
}

function savejsonfile() {
   var xx = [myspreadsheet.getData(),myspreadsheet.getStyle(),myspreadsheet.getWidth(),window.spreadformats];
   var textToSave = JSON.stringify(xx);
   var filenameguess = "arrows.json";
   var textToSaveAsBlob = new Blob([textToSave], {type:"text/plain"});
   var textToSaveAsURL  = window.URL.createObjectURL(textToSaveAsBlob);
   var fileNameToSaveAs =  prompt("Please enter filename:", filenameguess);
   var downloadLink = document.createElement("a");
   downloadLink.download = fileNameToSaveAs;
   downloadLink.innerHTML = "Download File";
   downloadLink.href = textToSaveAsURL;
   downloadLink.onclick = destroyClickedElement;
   downloadLink.style.display = "none";
   document.body.appendChild(downloadLink);
   downloadLink.click();
}

function loadjsonfile() {
   var fileToLoad = document.getElementById("csvToLoad").files[0];

   var fileReader = new FileReader();
   fileReader.onload = function(fileLoadedEvent) {
      var textFromFileLoaded = fileLoadedEvent.target.result;
      var xx = JSON.parse(textFromFileLoaded);
      window.spreadformats = xx[3];
      window.ni_spreadformats = xx[3].length;
      if (window.ni_spreadformats > 0) {
         window.nj_spreadformats = xx[3][0].length;
      } else {
         window.nj_spreadformats = 0;
      }
      myspreadsheet.setData(xx[0]);
      myspreadsheet.setStyle(xx[1]);
      for (var i=0; i<xx[2].length; ++i) {
         myspreadsheet.setWidth(i, parseInt(xx[2][i]));
      }
   };
   fileReader.readAsText(fileToLoad, "UTF-8");
}


function loadurltospread() {
   //var corh = "https://cors-anywhere.herokuapp.com/";
   var corh = "";
   var url = corh + document.getElementById("urlToLoadspread").value;

   if (url.trim().length>9) {
      var ajax = new XMLHttpRequest();
      ajax.open("GET", url, false); // third parameter is async flag
      ajax.send();
      var textFromUrl = ajax.responseText;
      if (url.includes("json")) {
         var xx = JSON.parse(textFromUrl);
         window.spreadformats = xx[3];
         window.ni_spreadformats = xx[3].length;
         if (window.ni_spreadformats > 0) {
            window.nj_spreadformats = xx[3][0].length;
         } else {
            window.nj_spreadformats = 0;
         }
         myspreadsheet.setData(xx[0]);
         myspreadsheet.setStyle(xx[1]);
         for (var i=0; i<xx[2].length; ++i) {
            myspreadsheet.setWidth(i, parseInt(xx[2][i]));
         }
      } else {
         var ldata = textFromUrl.split("\n");
         var data = [];
         for (var i=0; i<ldata.length; ++i) {
            data.push(ldata[i].split(","));
         }
         myspreadsheet.setData(data);
      }
   }
}


function savespreadtourl() {
   //var arrows_post_url = 'https://arrows.emsl.pnnl.gov/api/upload/';
   var arrows_post_url = '{{ arrows_api }}upload/';

   var url = document.getElementById("urlToLoadspread").value;
   var saveurl = url.replace("raw=","raw_deposit=");

   var textToSave;
   if (url.includes(".json")) {
      var xx = [myspreadsheet.getData(),myspreadsheet.getStyle(),myspreadsheet.getWidth(),window.spreadformats];
      textToSave = JSON.stringify(xx);
   } else {
      var xx = myspreadsheet.getData();
      textToSave = "";
      for (var i=0; i<xx.length; ++i) {
         var ln = xx[i];
         for (var j=0; j<ln.length; ++j) {
            textToSave += ln[j];
            if (j<(ln.length-1)) {textToSave += ",";}
         }
         textToSave += "\n";
      }
   }

   var fileNameToSaveAs =  url.split("/").pop();

   if (confirm("Do you want to save " + fileNameToSaveAs + " ?")) {
      var textToSaveAsBlob = new Blob([textToSave], {type:"text/plain"});
      var textToSaveAsURL  = window.URL.createObjectURL(textToSaveAsBlob);

      var formD = new FormData();
      formD.append('file', textToSaveAsBlob,fileNameToSaveAs);
      formD.append('title', fileNameToSaveAs);

      var xhr = new XMLHttpRequest();
      xhr.open("POST", arrows_post_url, true);
      xhr.send(formD);

      var request = new XMLHttpRequest();
      request.open('GET', saveurl, true);
      request.send();
   }
}




/********************************************
 *                                          *
 *            savespreadtodbname            *
 *                                          *
 ********************************************/
function savespreadtodbname() {
   document.getElementById('spreadsheetdbnamebanner').style.display = "none";

   var tabtitle = document.getElementById("spreadsheetdbname").value;
   var xx         = [myspreadsheet.getData(),myspreadsheet.getStyle(),myspreadsheet.getWidth(),window.spreadformats];
   var textToSave = JSON.stringify(xx);

   const dbname    = "arrows_spreadsheet";
   const dbversion = 1;

  if (confirm("Do you want to save " + tabtitle + " ?")) {

   const request = indexedDB.open(dbname,dbversion);

      // on upgrade needed
      request.onupgradeneeded = e => {
         const db = e.target.result;
         const pTables = db.createObjectStore("personal_tables",{keyPath: "title"});

         console.log(`savespreadsheet upgrade called, name: ${db.name}  version: ${db.version}`);
      }

      // on success
      request.onsuccess = e => {
         const db = e.target.result;
         console.log(`savespreadsheet on success called, name: ${db.name}  version: ${db.version}`);
         const tx = db.transaction("personal_tables","readwrite");
         tx.onerror = etx => alert(`savespreadsheet: tx on error called, ${etx.target.error}`);

         const pTables = tx.objectStore("personal_tables");
         const putrequest = pTables.put({title: tabtitle, tabletext: textToSave});
         //putrequest.onsuccess = eee => console.log(`Table ${tabtitle} was saved into ${dbname}`);
         putrequest.onsuccess = eee => {document.getElementById('spreadsheetdbnamebanner').style.display = "inline";
                                        document.getElementById('spreadsheetdbnamebanner').innerHTML = `Table ${tabtitle} was saved into ${dbname} (IndexedDB) db`;
                                        console.log(`Table ${tabtitle} was saved into ${dbname}`);}
         putrequest.onerror   = eee => alert(`pTables.put into ${tabtitle} failed!`);

      };

      // on error
      request.onerror = e => {
         alert(`savespreadsheet error: ${e.target.error} was found`);
      }
   }
}



/********************************************
 *                                          *
 *            loadspreadtodbname            *
 *                                          *
 ********************************************/
function loadspreadtodbname() {
   document.getElementById('spreadsheetdbnamebanner').style.display = "none";
   var tabtitle = document.getElementById("spreadsheetdbname").value;

   const dbname    = "arrows_spreadsheet";
   const dbversion = 1;

   if (confirm("Do you want to load " + tabtitle + " ?")) {

   const request = indexedDB.open(dbname,dbversion);

      // on upgrade needed
      request.onupgradeneeded = e => {
         const db = e.target.result;
         const pTables = db.createObjectStore("personal_tables",{keyPath: "title"});

         console.log(`loadspreadsheet upgrade called, name: ${db.name}  version: ${db.version}`);
      }

      // on success
      request.onsuccess = e => {
         const db = e.target.result;
         console.log(`loadspreadsheet on success called, name: ${db.name}  version: ${db.version}`);
         const tx = db.transaction("personal_tables","readonly");
         tx.onerror = etx => alert(`loadspreadsheet: tx on error called, ${etx.target.error}`);

         const pTables = tx.objectStore("personal_tables");
         const getrequest = pTables.get(tabtitle);
            getrequest.onsuccess = eee => {
               var textFromdb = eee.target.result;
               console.log("loadspreadsheet textFromdb=",textFromdb);
               if (textFromdb) {
                  var xx         = JSON.parse(textFromdb.tabletext);
                  console.log("loadspreadsheet xx=",xx);
                  document.getElementById('spreadsheetdbnamebanner').style.display = "inline";
                  document.getElementById('spreadsheetdbnamebanner').innerHTML= `Table ${tabtitle} was loaded from ${dbname} (IndexedDB) db`;

                  window.spreadformats = xx[3];
                  window.ni_spreadformats = xx[3].length;
                  if (window.ni_spreadformats > 0) {
                     window.nj_spreadformats = xx[3][0].length;
                  } else {
                     window.nj_spreadformats = 0;
                  }
                  myspreadsheet.setData(xx[0]);
                  myspreadsheet.setStyle(xx[1]);
                  for (var i=0; i<xx[2].length; ++i) {
                     myspreadsheet.setWidth(i, parseInt(xx[2][i]));
                  }
               } else { alert(`The table db ${tabtitle} was not found in the ${dbname} indexedDB database`); }
            }

            getrequest.onerror   = eee => alert(`The table name ${tabtitle} was not found in the ${dbname} indexedDB database`);

      };

      // on error
      request.onerror = e => {
         alert(`loadspreadsheet error: ${e.target.error} was found`);
      }

   }
}


// **********************************
// *                                *
// *      add_column_theory         *
// *                                *
// **********************************
function add_column_theory(promptstr,defaultpromptstr,selectid) {
   var oldlist = document.getElementById(selectid).value.trim();
   if (oldlist.length>1) { oldlist += " | ";}
   oldlist += prompt(promptstr, defaultpromptstr).trim();
   document.getElementById(selectid).value = oldlist;
}
function add_string_id(selectid,newstr) { document.getElementById(selectid).value += " " + newstr;}



</script>

<br>
table type: <select id="tableType" oninput="cacheInput(this)">
    <option value="Gas-Phase Energy (Hartrees)|e(gas)">Gas-Phase Energy (Hartrees)</option>
    <option value="Gas-Phase Enthalpy (Hartrees)|h(gas)">Gas-Phase Enthalpy (Hartrees)</option>
    <option value="Gas-Phase Free Energy (Hartrees)|g(gas)">Gas-Phase Free Energy (Hartrees)</option>
    <option value="Solvation Free Energy (Hartrees)|g(solvation)">Solvation Free Energy (Hartrees)</option>
    <option value="Aqueous Free Energy (Hartrees)|g(aq)">Aqueous Free Energy (Hartrees)</option>
    <option value="Gas-Phase Reaction Energy (Hartrees)|erxn(gas)">Gas-Phase Reaction Energy (Hartrees)</option>
    <option value="Gas-Phase Reaction Enthalpy (Hartrees)|hrxn(gas)" selected="selected">Gas-Phase Reaction Enthalpy (Hartrees)</option>
    <option value="Gas-Phase Reaction Free Energy (Hartrees)|grxn(gas)">Gas-Phase Reaction Free Energy (Hartrees)</option>
    <option value="Solvation Reaction Free Energy (Hartrees)|g(delta_solvation)">Solvation Reaction Free Energy (Hartrees)</option>
    <option value="Aqueous Reaction Free Energy (Hartrees)|grxn(aq)">Aqueous Reaction Free Energy (Hartrees)</option>
    <option value="Highest Occp. MO (eV)|homo">HOMO Energy (eV)</option>
    <option value="Lowest Occp. MO (eV)|lumo">LUMO Energy (eV)</option>
    <option value="Highest Occp. alpha MO (eV)|alpha_homo">Alpha HOMO Energy (eV)</option>
    <option value="Lowest Occp. alpha MO (eV)|alpha_lumo">Alpha LUMO Energy (eV)</option>
    <option value="Highest Occp. beta MO (eV)|beta_homo">Beta HOMO Energy (eV)</option>
    <option value="Lowest Occp. beta MO (eV)|beta_lumo">Beta LUMO Energy (eV)</option>
    <option value="SubmitEsmiles|submitesmiles">SubmitEsmiles</option>
</select>
column theories: <input type="theoryarray" id="columnTheories"  size="92" value="xc{pbe} | xc{b3lyp} | xc{m06-2x} | xc{pbe0}" oninput="cacheInput(this)">
<input type="button" class="button" id="add_column_theory" value="add"
                             style="font-size:13px;background-color:#f8f8ff;color:#6F4E37"
                             onClick="add_column_theory('Add theory or enter none for spacer: ','','columnTheories');"/> }
<br>
number table rows: <input type="number" id="nrowsTable" size="9" min="1" max="1000" step="1" value="5" oninput="cacheInput(this)">
<br>
<select id="theory_s2" onChange="add_string_id('columnTheories',document.getElementById('theory_s2').value)">
     <option value=""> theory/methods         </option>
     <option value="theory{dft}">     dft     </option>
     <option value="theory{pspw}">    pspw    </option>
     <option value="theory{pspw4}">   pspw4   </option>
     <option value="theory{mp2}">     mp2     </option>
     <option value="theory{ccsd(t)}"> ccsd(t) </option>
     <option value="theory{pm3}">     pm3     </option>
     <option value="theory{band}">    band    </option>
   </select>
<select id="xc_s2" onChange="add_string_id('columnTheories',document.getElementById('xc_s2').value)">
     <option value=""> exchange correlation </option>
     <option value="xc{lda}">    lda        </option>
     <option value="xc{pbe}">    pbe        </option>
     <option value="xc{pbe0}">   pbe0       </option>
     <option value="xc{blyp}">   blyp       </option>
     <option value="xc{b3lyp}">  b3lyp      </option>
     <option value="xc{m06-2x}"> m06-2x     </option>
     <option value="xc{scan}">   scan       </option>
     <option value="xc{tpss03}"> tpss03      </option>
   </select>
<select id="basis_s2" onChange="add_string_id('columnTheories',document.getElementById('basis_s2').value)">
     <option value=""> basis sets                          </option>
     <option value="basis{6-31G*}"> 6-31G*                 </option>
     <option value="basis{6-311++G(2d,2p}"> 6-311++G(2d,2p)</option>
   </select>
<select id="SMD_solvent_s2" onChange="add_string_id('columnTheories',document.getElementById('SMD_solvent_s2').value)">
     <option value=""> solvation theories      </option>
     <option value="solvation_type{COSMO}">water (COSMO)</option>
     <option value="solvation_type{COSMO-SMD}">water (COSMO-SMD)</option>
     <option value="solvation_type{COSMO-SMD:acetacid}">acetic acid</option>
     <option value="solvation_type{COSMO-SMD:acetone}">acetone</option>
     <option value="solvation_type{COSMO-SMD:acetntrl}">acetonitrile</option>
     <option value="solvation_type{COSMO-SMD:acetphen}">acetophenone</option>
     <option value="solvation_type{COSMO-SMD:aniline}">aniline</option>
     <option value="solvation_type{COSMO-SMD:anisole}">anisole</option>
     <option value="solvation_type{COSMO-SMD:benzaldh}">benzaldehyde</option>
     <option value="solvation_type{COSMO-SMD:benzene}">benzene</option>
     <option value="solvation_type{COSMO-SMD:benzntrl}">benzonitrile</option>
     <option value="solvation_type{COSMO-SMD:benzylcl}">benzyl chloride</option>
     <option value="solvation_type{COSMO-SMD:brisobut}">1-bromo-2-methylpropane</option>
     <option value="solvation_type{COSMO-SMD:brbenzen}">bromobenzene</option>
     <option value="solvation_type{COSMO-SMD:brethane}">bromoethane</option>
     <option value="solvation_type{COSMO-SMD:bromform}">bromoform</option>
     <option value="solvation_type{COSMO-SMD:broctane}">1-bromooctane</option>
     <option value="solvation_type{COSMO-SMD:brpentan}">1-bromopentane</option>
     <option value="solvation_type{COSMO-SMD:brpropa2}">2-bromopropane</option>
     <option value="solvation_type{COSMO-SMD:brpropan}">1-bromopropane</option>
     <option value="solvation_type{COSMO-SMD:butanal}">butanal</option>
     <option value="solvation_type{COSMO-SMD:butacid}">butanoic acid</option>
     <option value="solvation_type{COSMO-SMD:butanol}">1-butanol</option>
     <option value="solvation_type{COSMO-SMD:butanol2}">2-butanol</option>
     <option value="solvation_type{COSMO-SMD:butanone}">butanone</option>
     <option value="solvation_type{COSMO-SMD:butantrl}">butanonitrile</option>
     <option value="solvation_type{COSMO-SMD:butile}">butyl acetate</option>
     <option value="solvation_type{COSMO-SMD:nba}">butylamine</option>
     <option value="solvation_type{COSMO-SMD:nbutbenz}">n-butylbenzene</option>
     <option value="solvation_type{COSMO-SMD:sbutbenz}">sec-butylbenzene</option>
     <option value="solvation_type{COSMO-SMD:tbutbenz}">tert-butylbenzene</option>
     <option value="solvation_type{COSMO-SMD:cs2}">carbon disulfide</option>
     <option value="solvation_type{COSMO-SMD:carbntet}">carbon tetrachloride</option>
     <option value="solvation_type{COSMO-SMD:clbenzen}">chlorobenzene</option>
     <option value="solvation_type{COSMO-SMD:secbutcl}">sec-butyl chloride</option>
     <option value="solvation_type{COSMO-SMD:chcl3}">chloroform</option>
     <option value="solvation_type{COSMO-SMD:clhexane}">1-chlorohexane</option>
     <option value="solvation_type{COSMO-SMD:clpentan}">1-chloropentane</option>
     <option value="solvation_type{COSMO-SMD:clpropan}">1-chloropropane</option>
     <option value="solvation_type{COSMO-SMD:ocltolue}">o-chlorotoluene</option>
     <option value="solvation_type{COSMO-SMD:m-cresol}">m-cresol</option>
     <option value="solvation_type{COSMO-SMD:o-cresol}">o-cresol</option>
     <option value="solvation_type{COSMO-SMD:cychexan}">cyclohexane</option>
     <option value="solvation_type{COSMO-SMD:cychexon}">cyclohexanone</option>
     <option value="solvation_type{COSMO-SMD:cycpentn}">cyclopentane</option>
     <option value="solvation_type{COSMO-SMD:cycpntol}">cyclopentanol</option>
     <option value="solvation_type{COSMO-SMD:cycpnton}">cyclopentanone</option>
     <option value="solvation_type{COSMO-SMD:declncis}">cis-decalin</option>
     <option value="solvation_type{COSMO-SMD:declntra}">trans-decalin</option>
     <option value="solvation_type{COSMO-SMD:declnmix}">decalin (cis/trans mixture)</option>
     <option value="solvation_type{COSMO-SMD:decane}">n-decane</option>
     <option value="solvation_type{COSMO-SMD:decanol}">1-decanol</option>
     <option value="solvation_type{COSMO-SMD:edb12}">1,2-dibromoethane</option>
     <option value="solvation_type{COSMO-SMD:dibrmetn}">dibromomethane</option>
     <option value="solvation_type{COSMO-SMD:butyleth}">dibutyl ether</option>
     <option value="solvation_type{COSMO-SMD:odiclbnz}">o-dichlorobenzene</option>
     <option value="solvation_type{COSMO-SMD:edc12}">1,2-dichloroethane</option>
     <option value="solvation_type{COSMO-SMD:c12dce}">cis-dichloroethylene</option>
     <option value="solvation_type{COSMO-SMD:t12dce}">trans-dichloroethylene</option>
     <option value="solvation_type{COSMO-SMD:dcm}">dichloromethane</option>
     <option value="solvation_type{COSMO-SMD:ether}">diethyl ether</option>
     <option value="solvation_type{COSMO-SMD:et2s}">diethyl sulfide</option>
     <option value="solvation_type{COSMO-SMD:dietamin}">diethylamine</option>
     <option value="solvation_type{COSMO-SMD:mi}">diiodomethane</option>
     <option value="solvation_type{COSMO-SMD:dipe}">diisopropyl ether</option>
     <option value="solvation_type{COSMO-SMD:dmds}">dimethyl disulfide</option>
     <option value="solvation_type{COSMO-SMD:dmso}">dimethyl sulfoxide</option>
     <option value="solvation_type{COSMO-SMD:dma}">N,N-dimethylacetamide</option>
     <option value="solvation_type{COSMO-SMD:cisdmchx}">cis-1,2-dimethylcyclohexane</option>
     <option value="solvation_type{COSMO-SMD:dmf}">N,N-dimethylformamide</option>
     <option value="solvation_type{COSMO-SMD:dmepen24}">2,4-dimethylpentane</option>
     <option value="solvation_type{COSMO-SMD:dmepyr24}">2,4-dimethylpyridine</option>
     <option value="solvation_type{COSMO-SMD:dmepyr26}">2,6-dimethylpyridine</option>
     <option value="solvation_type{COSMO-SMD:dioxane}">1,4-dioxane</option>
     <option value="solvation_type{COSMO-SMD:phoph}">diphenyl ether</option>
     <option value="solvation_type{COSMO-SMD:dproamin}">dipropylamine</option>
     <option value="solvation_type{COSMO-SMD:dodecan}">n-dodecane</option>
     <option value="solvation_type{COSMO-SMD:meg}">1,2-ethanediol</option>
     <option value="solvation_type{COSMO-SMD:etsh}">ethanethiol</option>
     <option value="solvation_type{COSMO-SMD:ethanol}">ethanol</option>
     <option value="solvation_type{COSMO-SMD:etoac}">ethyl acetate</option>
     <option value="solvation_type{COSMO-SMD:etome}">ethyl formate</option>
     <option value="solvation_type{COSMO-SMD:eb}">ethylbenzene</option>
     <option value="solvation_type{COSMO-SMD:phenetol}">ethyl phenyl ether</option>
     <option value="solvation_type{COSMO-SMD:c6h5f}">fluorobenzene</option>
     <option value="solvation_type{COSMO-SMD:foctane}">1-fluorooctane</option>
     <option value="solvation_type{COSMO-SMD:formamid}">formamide</option>
     <option value="solvation_type{COSMO-SMD:formacid}">formic acid</option>
     <option value="solvation_type{COSMO-SMD:heptane}">n-heptane</option>
     <option value="solvation_type{COSMO-SMD:heptanol}">1-heptanol</option>
     <option value="solvation_type{COSMO-SMD:heptnon2}">2-heptanone</option>
     <option value="solvation_type{COSMO-SMD:heptnon4}">4-heptanone</option>
     <option value="solvation_type{COSMO-SMD:hexadecn}">n-hexadecane</option>
     <option value="solvation_type{COSMO-SMD:hexane}">n-hexane</option>
     <option value="solvation_type{COSMO-SMD:hexnacid}">hexanoic acid</option>
     <option value="solvation_type{COSMO-SMD:hexanol}">1-hexanol</option>
     <option value="solvation_type{COSMO-SMD:hexanon2}">2-hexanone</option>
     <option value="solvation_type{COSMO-SMD:hexene}">1-hexene</option>
     <option value="solvation_type{COSMO-SMD:hexyne}">1-hexyne</option>
     <option value="solvation_type{COSMO-SMD:c6h5i}">iodobenzene</option>
     <option value="solvation_type{COSMO-SMD:iobutane}">1-iodobutane</option>
     <option value="solvation_type{COSMO-SMD:c2h5i}">iodoethane</option>
     <option value="solvation_type{COSMO-SMD:iohexdec}">1-iodohexadecane</option>
     <option value="solvation_type{COSMO-SMD:ch3i}">iodomethane</option>
     <option value="solvation_type{COSMO-SMD:iopentan}">1-iodopentane</option>
     <option value="solvation_type{COSMO-SMD:iopropan}">1-iodopropane</option>
     <option value="solvation_type{COSMO-SMD:cumene}">isopropylbenzene</option>
     <option value="solvation_type{COSMO-SMD:p-cymene}">p-isopropyltoluene</option>
     <option value="solvation_type{COSMO-SMD:mesityln}">mesitylene</option>
     <option value="solvation_type{COSMO-SMD:methanol}">methanol</option>
     <option value="solvation_type{COSMO-SMD:egme}">2-methoxyethanol</option>
     <option value="solvation_type{COSMO-SMD:meacetat}">methyl acetate</option>
     <option value="solvation_type{COSMO-SMD:mebnzate}">methyl benzoate</option>
     <option value="solvation_type{COSMO-SMD:mebutate}">methyl butanoate</option>
     <option value="solvation_type{COSMO-SMD:meformat}">methyl formate</option>
     <option value="solvation_type{COSMO-SMD:mibk}">4-methyl-2-pentanone</option>
     <option value="solvation_type{COSMO-SMD:mepropyl}">methyl propanoate</option>
     <option value="solvation_type{COSMO-SMD:isobutol}">2-methyl-1-propanol</option>
     <option value="solvation_type{COSMO-SMD:terbutol}">2-methyl-2-propanol</option>
     <option value="solvation_type{COSMO-SMD:nmeaniln}">N-methylaniline</option>
     <option value="solvation_type{COSMO-SMD:mecychex}">methylcyclohexane</option>
     <option value="solvation_type{COSMO-SMD:nmfmixtr}">N-methylformamide (E/Z mixture)</option>
     <option value="solvation_type{COSMO-SMD:isohexan}">2-methylpentane</option>
     <option value="solvation_type{COSMO-SMD:mepyrid2}">2-methylpyridine</option>
     <option value="solvation_type{COSMO-SMD:mepyrid3}">3-methylpyridine</option>
     <option value="solvation_type{COSMO-SMD:mepyrid4}">4-methylpyridine</option>
     <option value="solvation_type{COSMO-SMD:c6h5no2}">nitrobenzene</option>
     <option value="solvation_type{COSMO-SMD:c2h5no2}">nitroethane</option>
     <option value="solvation_type{COSMO-SMD:ch3no2}">nitromethane</option>
     <option value="solvation_type{COSMO-SMD:ntrprop1}">1-nitropropane</option>
     <option value="solvation_type{COSMO-SMD:ntrprop2}">2-nitropropane</option>
     <option value="solvation_type{COSMO-SMD:ontrtolu}">o-nitrotoluene</option>
     <option value="solvation_type{COSMO-SMD:nonane}">n-nonane</option>
     <option value="solvation_type{COSMO-SMD:nonanol}">1-nonanol</option>
     <option value="solvation_type{COSMO-SMD:nonanone}">5-nonanone</option>
     <option value="solvation_type{COSMO-SMD:octane}">n-octane</option>
     <option value="solvation_type{COSMO-SMD:octanol}">1-octanol</option>
     <option value="solvation_type{COSMO-SMD:octanon2}">2-octanone</option>
     <option value="solvation_type{COSMO-SMD:pentdecn}">n-pentadecane</option>
     <option value="solvation_type{COSMO-SMD:pentanal}">pentanal</option>
     <option value="solvation_type{COSMO-SMD:npentane}">n-pentane</option>
     <option value="solvation_type{COSMO-SMD:pentacid}">pentanoic acid</option>
     <option value="solvation_type{COSMO-SMD:pentanol}">1-pentanol</option>
     <option value="solvation_type{COSMO-SMD:pentnon2}">2-pentanone</option>
     <option value="solvation_type{COSMO-SMD:pentnon3}">3-pentanone</option>
     <option value="solvation_type{COSMO-SMD:pentene}">1-pentene</option>
     <option value="solvation_type{COSMO-SMD:e2penten}">E-2-pentene</option>
     <option value="solvation_type{COSMO-SMD:pentacet}">pentyl acetate</option>
     <option value="solvation_type{COSMO-SMD:pentamin}">pentylamine</option>
     <option value="solvation_type{COSMO-SMD:pfb}">perfluorobenzene</option>
     <option value="solvation_type{COSMO-SMD:benzalcl}">phenylmethanol</option>
     <option value="solvation_type{COSMO-SMD:propanal}">propanal</option>
     <option value="solvation_type{COSMO-SMD:propacid}">propanoic acid</option>
     <option value="solvation_type{COSMO-SMD:propanol}">1-propanol</option>
     <option value="solvation_type{COSMO-SMD:propnol2}">2-propanol</option>
     <option value="solvation_type{COSMO-SMD:propntrl}">propanonitrile</option>
     <option value="solvation_type{COSMO-SMD:propenol}">2-propen-1-ol</option>
     <option value="solvation_type{COSMO-SMD:propacet}">propyl acetate</option>
     <option value="solvation_type{COSMO-SMD:propamin}">propylamine</option>
     <option value="solvation_type{COSMO-SMD:pyridine}">pyridine</option>
     <option value="solvation_type{COSMO-SMD:c2cl4}">tetrachloroethene</option>
     <option value="solvation_type{COSMO-SMD:thf}">tetrahydrofuran</option>
     <option value="solvation_type{COSMO-SMD:sulfolan}">tetrahydrothiophene-S,S-dioxide</option>
     <option value="solvation_type{COSMO-SMD:tetralin}">tetralin</option>
     <option value="solvation_type{COSMO-SMD:thiophen}">thiophene</option>
     <option value="solvation_type{COSMO-SMD:phsh}">thiophenol</option>
     <option value="solvation_type{COSMO-SMD:toluene}">toluene</option>
     <option value="solvation_type{COSMO-SMD:tbp}">tributyl phosphate</option>
     <option value="solvation_type{COSMO-SMD:tca111}">1,1,1-trichloroethane</option>
     <option value="solvation_type{COSMO-SMD:tca112}">1,1,2-trichloroethane</option>
     <option value="solvation_type{COSMO-SMD:tce}">trichloroethene</option>
     <option value="solvation_type{COSMO-SMD:et3n}">triethylamine</option>
     <option value="solvation_type{COSMO-SMD:tfe222}">2,2,2-trifluoroethanol</option>
     <option value="solvation_type{COSMO-SMD:tmben124}">1,2,4-trimethylbenzene</option>
     <option value="solvation_type{COSMO-SMD:isoctane}">2,2,4-trimethylpentane</option>
     <option value="solvation_type{COSMO-SMD:undecane}">n-undecane</option>
     <option value="solvation_type{COSMO-SMD:m-xylene}">m-xylene</option>
     <option value="solvation_type{COSMO-SMD:o-xylene}">o-xylene</option>
     <option value="solvation_type{COSMO-SMD:p-xylene}">p-xylene</option>
     <option value="solvation_type{COSMO-SMD:xylenemx}">xylene (mixture)</option>
   </select>
<select id="run_options_s2" onChange="add_string_id('columnTheories',document.getElementById('run_options_s2').value)">
     <option value=""> run options                      </option>
     <option value="optimizer{cgmin}"> optimizer{cgmin} </option>
     <option value="smear{0.01}">      smear{0.01}      </option>
     <option value="smear{0.05}">      smear{0.05}      </option>
     <option value="smear{0.1}">        smear{0.1}      </option>
   </select>

<br><br><br>
<input type="button" VALUE="Save json file" onClick="savejsonfile()" style="background-color:#f8f8ff; color:#298DB4; font-size: 14px; font-weight:bold"/>
<input type="button" VALUE="Save to csv file" onClick="savecsvfile()" style="background-color:#f8f8ff; color:#298DB4; font-size: 14px; font-weight:bold"/>
<input type="button" VALUE="Load selected json file" onClick="loadjsonfile()" style="background-color:#f8f8ff; color:#298DB4; font-size: 14px; font-weight:bold"/>
<input type="button" VALUE="Load selected csv file" onClick="loadcsvfile()" style="background-color:#f8f8ff; color:#298DB4; font-size: 14px; font-weight:bold"/>
<input type="file" id="csvToLoad" style="background-color:#f8f8ff; color:#298DB4; font-size: 14px; font-weight:bold">
<br>
<input type="button" VALUE="Save to url" onClick="savespreadtourl()" title="Save spreadsheet to url" style="background-color:#f8f8ff; color:darkred; font-size: 14px; font-weight:bold"/>
<input type="url" id="urlToLoadspread" SIZE=120 style="background-color:#f8f8ff; color:#298DB4; font-size: 14px; font-weight:bold" oninput="cacheInput(this)">
<input type="button" VALUE="Load from url" onClick="loadurltospread()" title="Load csv or json data from url into spreadsheet" style="background-color:#f8f8ff; color:darkgreen; font-size: 14px; font-weight:bold"/><br>

<br>
<input type="button" value="NWChem Bugs" onClick="document.getElementById('urlToLoadspread').value='https://arrows.emsl.pnnl.gov/api/eric_view/raw=we31869:/media/seagate2/Projects/Eric/nwchem-bugs.json'" style="background-color:#f8f8ff; color:#298DB4;">
<input type="button" value="NWChemEx Status" onClick="document.getElementById('urlToLoadspread').value='https://arrows.emsl.pnnl.gov/api/eric_view/raw=we31869:/media/seagate2/Projects/Eric/nwchemex-status.json'" style="background-color:#f8f8ff; color:#298DB4;">
<input type="button" value="CCS Status" onClick="document.getElementById('urlToLoadspread').value='https://arrows.emsl.pnnl.gov/api/eric_view/raw=we31869:/media/seagate2/Projects/Eric/ccs-status.json'" style="background-color:#f8f8ff; color:#298DB4;">
<input type="button" value="Samsung Status" onClick="document.getElementById('urlToLoadspread').value='https://arrows.emsl.pnnl.gov/api/eric_view/raw=we31869:/media/seagate2/Projects/Eric/samsung-status.json'" style="background-color:#f8f8ff; color:#298DB4;">
<input type="button" value="MQ Status" onClick="document.getElementById('urlToLoadspread').value='https://arrows.emsl.pnnl.gov/api/eric_view/raw=we31869:/media/seagate2/Projects/Eric/mq-status.json'" style="background-color:#f8f8ff; color:#298DB4;">
<input type="button" value="MQ NO Status" onClick="document.getElementById('urlToLoadspread').value='https://arrows.emsl.pnnl.gov/api/eric_view/raw=we31869:/media/seagate2/Projects/Eric/mq-NO-status.json'" style="background-color:#f8f8ff; color:#298DB4;">
<input type="button" value="MQ NN Status" onClick="document.getElementById('urlToLoadspread').value='https://arrows.emsl.pnnl.gov/api/eric_view/raw=we31869:/media/seagate2/Projects/Eric/mq-NN-status.json'" style="background-color:#f8f8ff; color:#298DB4;">
<input type="button" value="MQ O Status" onClick="document.getElementById('urlToLoadspread').value='https://arrows.emsl.pnnl.gov/api/eric_view/raw=we31869:/media/seagate2/Projects/Eric/mq-O-status.json'" style="background-color:#f8f8ff; color:#298DB4;">
<br>
<font color="443322" size="2"><p><a href="https://docs.google.com/spreadsheets/d/1FP1ahyibrMfthXuLE0exYGwHkCn1hs0pg7TrsLWet2Y/edit?usp=sharing">Kinetics example with Google Sheets</a></p></font>

<h4> Encode parsing url </h4>
url string    :<input type="parsingstring" id="splitparsingurl" size="164" value=""> 
<br><br>
parsing string:<input type="parsingstring" id="splitparsing"  list="parsinglist" size="160" value="" oninput="cacheInput(this)"> <br>
     <datalist id="parsinglist" oninput="cacheInput(this)">
                <option value="split:@|-1:split split:eoln|0:split split::split split:spaces|1:split">optimized</option>
                <option value="split:spring parameters (K0,gamma0):|-1:split split:eoln|0:split split::split split:spaces|1:split">gamma0</option>
                <option value="split:gamma                        :|-1:split split:eoln|0:split split::split split:spaces|0:split">gamma</option>
                <option value="split:Total energy with constraints        :|-1:split split:eoln|0:split split::split split:spaces|0:split">
                        Total energy with constraints</option>
                <option value="split:Energy contribution from constraints :|-1:split split:eoln|0:split split::split split:spaces|0:split">
                        Energy contribution from constraints</option>
                <option value="split:Total energy without constraints     :|-1:split split:eoln|0:split split::split split:spaces|0:split">
                        Total energy without constraints</option>
                <option value="aerosol4">aerosol4</option>
                <option value="erichome">erichome</option>
             </datalist>
<input type="button" VALUE="Hash" 
       onClick="document.getElementById('splitparsingresult').value =
                    'hstart:' 
                  + document.getElementById('splitparsing').value
                  + ':hmid:'
                  + document.getElementById('splitparsingurl').value 
                  + ':hend';"
      style="background-color:#f8f8ff; color:#298DB4; font-size: 14px; font-weight:bold"/> 
<input type="button" VALUE="Result string" 
       onClick="document.getElementById('splitparsingresult').value =
                  splitparsingdata(document.getElementById('splitparsing').value,
                                   loadurldata(document.getElementById('splitparsingurl').value));" 
      style="background-color:#f8f8ff; color:#298DB4; font-size: 14px; font-weight:bold"/> 
<!--input type="parsingstring" id="splitparsingresult"  size="80" value=""-->
<br>
<textarea name="splitparsingresult" id="splitparsingresult" rows="3" cols="172" style="color: blue; font-size: 12px;" oninput="cacheInput(this)"></textarea><br>
<input type="button" VALUE="copy to clipboard" 
       onClick="var textBox=document.getElementById('splitparsingresult');
                textBox.select(); 
                document.execCommand('copy');"
      style="background-color:#f8f8ff; color:#298DB4; font-size:12px;"/> 

</div>
<br>




<div id="Output" class="tabcontent">

<script>
function iframe_output_changed() {
   var idoc = document.getElementsByName('iframe_output')[0].contentWindow.document;
   var xy = idoc.body.innerHTML;
   var hasjob = xy.includes("Your Arrows job");
   console.log("hasjob=",hasjob);
   if (!hasjob) {
      document.getElementById('runmebanner').innerHTML='';
      document.getElementById('runmebanner2').innerHTML='';
   }
}
</script>

<iframe name="iframe_output" width="1000" height="600" onLoad="iframe_output_changed()"></iframe>

<script>
var xdoc = document.getElementsByName("iframe_output")[0].contentWindow.document;
xdoc.open();
xdoc.write("<html><body>Your Arrows job output goes here!</body></html>");
xdoc.close();
</script>


</div>



<div id="Queue" class="tabcontent">
   <br>
   <div style="padding: 5px 5px 5px 5px; background-color:whitesmoke; color: #0900C4; font: Helvetica 12pt;border: 1px solid black;">
   <h2>Fetch Input Decks from Arrows </h2>
    machine_type: <input type="text" list="machinelist" id="queue_machine_type" onChange="definesecret()" value="" oninput="cacheInput(this)"/>
    queue_name: <input type="text" id="queue_nwchem_name" value="nwchem" oninput="cacheInput(this)"/>
    <input type="button" VALUE="queue_nwchem" onClick="queue_nwchem_fetch()" title="queue_nwchem" style="background-color:#f8f8ff; color:#0000ff; font-size: 14px; font-weight:bold"/>
    <input type="radio" id="show_window" onClick="ClearRd(this,12)" oninput="cacheInput(this)" title="show window"/>
   <br>
   <br>
   <section  class="listWrapper" style="color: black" id="queue_nwchem_area"> 
      <br>
      Enter a machine_type and press queue_nwchem button to fetch queue entries.
      <br>
      <br>
   </section>
   <br>
   
   <input type="button" VALUE="Download queue_entry" onClick="queue_entry_download(document.getElementById('queue_entry').value, document.getElementById('queue_entry_secret').value)" title="qnwchem_dload" style="background-color:#f8f8ff; color:#0000ff; font-size: 14px; font-weight:bold"/>
   <input type="text" id="queue_entry" oninput="cacheInput(this)"/> 
   Secret Code: <!--input type="text" name="queue_secret_code" id="queue_secret_code" oninput="cacheInput(this)"-->
               <select id="queue_secret_code2"
                       name="queue_secret_code2"
                       style="font-size:13px;color:#6F4E37"
                       title=": set text queue_secret_code2 :" oninput="cacheInput(this)">
                       <option>None</option>
                       <option disabled>──────────</option>
               </select>
   <br>
   <br>
   </div>
   <br>
   <hr>
   <br>
   <div id="drop_zone" ondrop="dropHandler(event);" ondragover="dragOverHandler(event);" style="padding: 5px 5px 5px 5px; background-color:whitesmoke; color: #0900C4; font: Helvetica 12pt;border: 1px solid black;">
   <h2>Upload Results to Arrows - Drag & Drop Files or choose files below </h2>
   <section  class="listWrapper" style="color:#91003e;" id="queue_upload_area"> 
      Files to Upload:
   </section>
   <br>
   <!--input type="file" id="queue_entry_upload_tag" multiple onChange="queue_entry_upload()" style="background-color:#f8f8ff; color:#0000ff; font-size: 14px; font-weight:bold"-->
   <input type="file" id="queue_entry_upload_tag" multiple>

    <input type="button" VALUE="Clear files" onClick="queue_entry_clear();" title="qnwchem_upload_clear" style="background-color:#f8f8ff; color:#0000ff; font-size: 14px; font-weight:bold"/>
    <input type="button" VALUE="Upload files" onClick="queue_upload_files();" title="qnwchem_upload_files" style="background-color:#f8f8ff; color:#0000ff; font-size: 14px; font-weight:bold"/>
   <br>
   <br>
   </div>
   <br>
   <br>



<script>

var uploadFileList = [];

  var fileSelector = document.getElementById('queue_entry_upload_tag');
  fileSelector.addEventListener('change', (event) => {
        var fileList = event.target.files;
        for (var i=0; i<fileList.length; ++i) {
           window.uploadFileList.push(fileList[i]);
        }
        document.getElementById('queue_upload_area').innerHTML = "Files to Upload: <br>\n";
        for (var i=0; i<window.uploadFileList.length; ++i) {
           document.getElementById('queue_upload_area').innerHTML += window.uploadFileList[i].name + "<br>\n";
        }
        console.log("uploadFileList=",window.uploadFileList);
  });

function dropHandler(ev) {
  console.log('File(s) dropped');

  // Prevent default behavior (Prevent file from being opened)
  ev.preventDefault();

  if (ev.dataTransfer.items) {
    // Use DataTransferItemList interface to access the file(s)
    for (var i = 0; i < ev.dataTransfer.items.length; i++) {
      // If dropped items aren't files, reject them
      if (ev.dataTransfer.items[i].kind === 'file') {
        var file = ev.dataTransfer.items[i].getAsFile();
        console.log('... file[' + i + '].name = ' + file.name);
        window.uploadFileList.push(file);
      }
    }
  } else {
    // Use DataTransfer interface to access the file(s)
    for (var i = 0; i < ev.dataTransfer.files.length; i++) {
      console.log('... file[' + i + '].name = ' + ev.dataTransfer.files[i].name);
      window.uploadFileList.push(ev.dataTransfer.files[i]);
    }
  }
  document.getElementById('queue_upload_area').innerHTML = "Files to Upload: <br>\n";
  for (var i=0; i<window.uploadFileList.length; ++i) {
     document.getElementById('queue_upload_area').innerHTML += window.uploadFileList[i].name + "<br>\n";
  }
  console.log("uploadFileList=",window.uploadFileList);
}

function dragOverHandler(ev) {
  console.log('File(s) in drop zone'); 

  // Prevent default behavior (Prevent file from being opened)
  ev.preventDefault();
}




function queue_entry_upload() {
   var fileInput = document.getElementById('queue_entry_upload_tag');
   var file = fileInput.files[0];
   window.uploadFileList.push(file);

//   if (file.name.includes(".out")) {
//      var data = "";
//      var fileReader = new FileReader();
//      fileReader.onload = function(fileLoadedEvent) {
//          data = fileLoadedEvent.target.result;
//      };
//      fileReader.readAsText(file, "UTF-8");
//   }

   document.getElementById('queue_upload_area').innerHTML = "Files to Upload: <br>\n";
   for (var i=0; i<window.uploadFileList.length; ++i) {
      document.getElementById('queue_upload_area').innerHTML += window.uploadFileList[i].name + "<br>\n";
   }

   console.log("uploadFileList=",window.uploadFileList);
}

function queue_entry_clear() {
   window.uploadFileList = [];
   document.getElementById('queue_upload_area').innerHTML = "Files to upload: <br>\n";
}

function queue_upload_files0(cur,filelist) {
   //var arrows_post_url  = "https://arrows.emsl.pnnl.gov/api/upload/";
   //var arrows_get_url   = "https://arrows.emsl.pnnl.gov/api/submit_output_nwchem/"
   var arrows_post_url = '{{ arrows_api }}upload/';
   var arrows_get_url  = '{{ arrows_api }}submit_output_nwchem/';

   var nlist = filelist.length;
   if (cur<nlist) {
      filelist[cur].type = "text/plain";
      console.log("uploading = " + filelist[cur].name);
      console.log("type      = " + filelist[cur].type);

      var formData = new FormData();
      formData.append('file', filelist[cur]);
      var xhr = new XMLHttpRequest();
      xhr.open('POST', arrows_post_url, true);
      xhr.onload = function (e) {
         if (xhr.readyState === 4) {
            if (xhr.status === 200) {
              console.log("Posted:"+filelist[cur].name);
              console.log("  - post response:" +xhr.responseText);
              queue_upload_files0(cur+1,filelist);
            }
         }
      };
      xhr.onerror = function (e) {
         console.error(xhr.statusText);
      };
      xhr.send(formData);


   } else {
      datafiles_names = "";
      for (var i=0; i<nlist; ++i) {
         datafiles_names += filelist[i].name  + " ";
      }
      datafiles_names = datafiles_names.trim();

      var request = new XMLHttpRequest();
      request.open('GET', arrows_get_url + "\"" + datafiles_names + "\"", true);
      request.onload = function (e) {
         if (request.readyState === 4) {
            if (request.status === 200) {
              console.log(request.responseText);
              var txt = request.responseText;
              alert("Files have been parsed: "+ txt);
              queue_entry_clear();
            }
         }
      };
      request.onerror = function (e) {
         console.error(request.statusText);
      };
      request.send();
   }
}

function queue_upload_files() { queue_upload_files0(0,window.uploadFileList); }

function queue_entry_download(qentry,qsecret) {
   //var arrows_queue_fetch_url  = 'https://arrows.emsl.pnnl.gov/api/queue_nwchem_fetch/'
   //var arrows_queue_fetch_url  = '{{ arrows_api }}queue_nwchem_fetch/';
   var calc_url        = document.getElementById("arrows_calculation_url").value;
   var arrows_queue_fetch_url  = calc_url + 'queue_nwchem_fetch/';

   var qq = qentry;
   if (qsecret.trim().length > 0) {
     qq += "_" + qsecret.trim();
   }
   alert("Download qentry = " + qq);
   var arrows_get_url = arrows_queue_fetch_url + qq;
   var filename = "nwchemarrows-" + qentry + ".nw";

   var request = new XMLHttpRequest();
   request.open('GET', arrows_get_url, true);
   request.onload = function (e) {
      if (request.readyState === 4) {
         if (request.status === 200) {
           console.log("QUEUE_ENTRY_DOWNLOAD=",request.responseText);
           var txt = request.responseText;
           if (txt.includes("# CHEMDB ENTRY NOT AVAILABLE!")) {
              alert("# CHEMDB ENTRY NOT AVAILABLE! queue_entry="+qq);
           } else if (txt.includes("# CHEMDB OUTPUT AVAILABLE!")) {
              alert("# CHEMDB OUTPUT AVAILABLE! Try downloading zip file");
          } else if ((txt.includes("#chemdb_queue_nwchem - version 1.0")) && (txt.includes("</pre> </html>"))) {
              txt = "#chemdb_queue_nwchem - version 1.0" + txt.split("#chemdb_queue_nwchem - version 1.0")[1].split("</pre> </html>")[0].trim();
              if (txt.includes("#nwchem_input")) {
                 filename = txt.split("#nwchem_input")[1].split("\n")[0].trim();
              }
              savefile(txt,filename);
           } else if ((txt.includes("#chemdb_queue_nwchem - version 2.0")) && (txt.includes("</pre> </html>"))) {
              txt = "#chemdb_queue_nwchem - version 2.0" + txt.split("#chemdb_queue_nwchem - version 2.0")[1].split("</pre> </html>")[0].trim();
              if (txt.includes("#nwchem_input")) {
                 filename = txt.split("#nwchem_input")[1].split("\n")[0].trim();
              }
              savefile(txt,filename);
           }

         } else {
           console.error(request.statusText);
         }
      }
   };
   request.onerror = function (e) {
      console.error(request.statusText);
   };
   request.send();
}


function queue_entry_set(qentry) {
  document.getElementById('queue_entry').value = qentry;
}

function queue_nwchem_filter(text) {
   var text2 = text;
   var calc_url        = document.getElementById("arrows_calculation_url").value;
   var arrows_get_url  = calc_url + 'queue_nwchem_view/';

   if (text2.includes("#chemdb_queue_nwchem - version 1.0")) {
      text2 = text2.split("#chemdb_queue_nwchem - version 1.0")[1].split("</pre> </html>")[0].trim();
      var mt = document.getElementById('queue_machine_type').value;
      var lines = text2.split("\n");
      text2 = lines[0] + "\n";
      for (var i=1; i<lines.length; ++i) {
         if (lines[i].includes(mt)) {
            var ll = lines[i].trim();
            var qentry   = ll.split("</a>")[0].split(">")[1];
            var hreplace = arrows_get_url + qentry;
            ll = ll.replace(hreplace,"javascript:queue_entry_set("+qentry+");");
            text2 += ll + "\n";
         }
      }
   }

   if (text2.includes("#chemdb_queue_nwchem - version 2.0")) {
      text2 = text2.split("#chemdb_queue_nwchem - version 2.0")[1].split("</pre> </html>")[0].trim();
      var mt = document.getElementById('queue_machine_type').value;
      var lines = text2.split("\n");
      text2 = lines[0] + "\n";
      for (var i=1; i<lines.length; ++i) {
         if (lines[i].includes(mt)) {
            var ll = lines[i].trim();
            var qentry   = ll.split("</a>")[0].split(">")[1];
            var hreplace = arrows_get_url + qentry;
            ll = ll.replace(hreplace,"javascript:queue_entry_set("+qentry+");");
            text2 += ll + "\n";
         }
      }
   }

   return text2;
}

function queue_nwchem_fetch() {
   //var arrows_get_url  = 'https://arrows.emsl.pnnl.gov/api/queue_nwchem_check/nwchem';
   //var arrows_get_url  = '{{ arrows_api }}queue_nwchem_check/';
   var calc_url        = document.getElementById("arrows_calculation_url").value;
   var arrows_get_url  = calc_url + 'queue_nwchem_check/';

   var qname = 'nwchem';
   if (document.getElementById('queue_nwchem_name').value.trim().length>0) {
      qname = document.getElementById('queue_nwchem_name').value.trim();
   }
   arrows_get_url  += qname;

   var request = new XMLHttpRequest();
   request.open('GET', arrows_get_url, true);
   request.onload = function (e) {
      if (request.readyState === 4) {
         if (request.status === 200) {
           console.log(request.responseText);
           document.getElementById('queue_nwchem_area').innerHTML= "<pre> " + queue_nwchem_filter(request.responseText) + "</pre>";
         } else {
           console.error(request.statusText);
           document.getElementById('queue_nwchem_area').value= request.statusText;
         }
      }
   };
   request.onerror = function (e) {
      console.error(request.statusText);
      document.getElementById('queue_nwchem_area').value= request.statusText;
   };
   request.send();

   queue_openwindow(arrows_get_url,"temp");
}

function queue_openwindow(url,name) {
   if (document.getElementById("show_window").checked) {
      window.open(url,name,"menubar=1,resizable=1,width=350,height=250");
   }
}





</script>

</div>

<div id="Reaction Predictor - Beta version" class="tabcontent">


<script>

dummy_dict = {};
reactants_dict = {};

async function geturlresult(nr,prespace,reactants_str,reactant,it,max_energy,current_level,show_bad_reactions,element,url) {
   //fetch(url, {mode: 'cors'})
   //  .then(function(response) {
   //    return response.text();
   //  })
   //  .then(function(text) {
   //    console.log('Request successful', text);
   //  })
   //  .catch(function(error) {
   //    log('Request failed', error)
   //  });
   var energytitles = "Erxn(gas)       Hrxn(gas)       Grxn(gas) Delta_Solvation        Grxn(aq)".split(/[ ,]+/);
   var level = (prespace.length)/4;
   var level = current_level;

   console.log("start geturlresult");
   
   const request = async() => {
      const response = await fetch(url, {mode: 'cors'});
      const data = await response.text();
      console.log("geturlresult data=",data);
      return data;
   }

   var rr = await request();
   console.log("end  geturlresult, rr=",rr);


   if (rr.includes("Predicted Reactions")) {
      window.reactants_dict[reactants_str] = rr;
   } else {
      window.dummy_dict[reactants_str] = rr;
   }
   if (rr.includes("check back in ~10 minutes")) {
      var hhh = "+--------------------------------------------------+\n";
      var ggg = "|               Reaction Prediction                |";
      element.value += hhh+ggg+"\n";
      element.value += rr.split(ggg)[1].trim().split("check back in ~10 minutes")[0].trim() + "\n";
      element.value += "check back in ~10 minutes\n";
   }
   var newreactions0 =  makereaction_dictionary(rr);
   console.log("newreactions0=",newreactions0);
   //document.getElementById("predictor_reactions").innerHTML = "";
   //document.getElementById("predictor_metabolites").innerHTML = "";
   for (var i=0; i<newreactions0.length; ++i) {
      rxn = newreactions0[i];
      console.log("i=",i," rxn=",rxn);

      if ((parseFloat(rxn['energies'][it]) < max_energy) || show_bad_reactions) {
        var str   =  rxn['reaction'];
        var rlink = document.getElementById("arrows_calculation_url").value + "reaction/" + "\"" + str + "\"";
        var treaction = str.link(rlink).split('<a').join('<a target="_blank"');
        var tenergy = rxn['energies'][it].trim();
        var estring = energytitles[it]+ " = " + tenergy + "  ";
        if (!document.getElementById("predictor_reactions").innerHTML.includes(treaction)) {
           document.getElementById("predictor_reactions").innerHTML += estring + treaction + "<br>";

           for (var j=0; j<rxn['metabolites'].length; ++j) {
              var mm = rxn['metabolites'][j].trim();

              var label = "";
              //for (var k=1; k<reactants_str.split("+").length; ++k) {
              //   var rr = reactants_str.split("+")[k].trim();
              //   label += "+" + rr + ",";
              //}
              for (var k=0; k<rxn['reactants'].length; ++k) {
                 var rr = rxn['reactants'][k];
                 label += "+" + rr + ",";
              }
              for (var k=0; k<rxn['new_reactants'].length; ++k) {
                 var pp = rxn['new_reactants'][k];
                 label += "-" + pp + ",";
              }
              for (var k=0; k<rxn['metabolites'].length; ++k) {
                 console.log("j,k=",j,k);
                 if (k!=j) {
                    var pp = rxn['metabolites'][k];
                    label += "-" + pp + ",";
                 }
              }
              label += rxn['energies'][it];
              var acolor;
              if (parseFloat(rxn['energies'][it])<0.0) {
                 acolor = " style=\"stroke: red;\" arrowheadStyle=\"fill: red\"";
              } else {
                 acolor = " style=\"stroke: blue;\" arrowheadStyle=\"fill: blue\"";
              }

              // drawing graph
              //var addedge0 = "\"" + reactants_str.split("+")[0].trim() + "\" -> \"" + mm + "\"";
              //var addedge = addedge0 + "[label=\""+label+"\" labelStyle=\"fill: green;\"" + acolor + "]; \n /*end*/}\n";
              //var e0found = document.getElementById("inputGraph").innerHTML.includes(addedge0) ||
              //              document.getElementById("inputGraph").innerHTML.includes(addedge0.replace("->","-&gt;"));

              //if (!e0found) {
              //   console.log("inputgraph=",document.getElementById("inputGraph").innerHTML);
              //   document.getElementById("inputGraph").innerHTML = document.getElementById("inputGraph").innerHTML.split("/*end*/}")[0].trim() + "\n" + addedge;
              //   console.log("addedge0=",addedge0);
              //   console.log("addedge=",addedge);
              //}
           }
        }

         console.log("i=",i," in parsFloat",parseFloat(rxn['energies'][it]));
         element.value += "\n";
         element.value += prespace + "+ Reaction Level =" + level.toString() + "\n";
         element.value += prespace + "  - " + rxn['reaction'] + "\n";
         element.value += prespace + "    " + energytitles[it] + " = " + rxn['energies'][it] + "\n";
         element.value += prespace + "    metabolites = " + rxn['metabolites'] + "\n";
         element.value += prespace + "    nreactants  = " + rxn['new_reactants'] + "\n";
         if (parseFloat(rxn['energies'][it]) < max_energy) {
            nr.push(rxn);
            element.value += prespace + "    Reaction included!" + "\n";
            for (var j=0; j<rxn['metabolites'].length; ++j) {
               var mm = rxn['metabolites'][j];
               var rlink2 = document.getElementById("arrows_calculation_url").value + "molecule/" + "\"" + mm + "\"";
               var tmetabolite = mm.link(rlink2).split('<a').join('<a target="_blank"');
               if (!document.getElementById("predictor_metabolites").innerHTML.includes(tmetabolite)) {
                  document.getElementById("predictor_metabolites").innerHTML += tmetabolite + " " + "<br>";
               }
               if (!document.getElementById('predictor_esmiles').value.includes(mm)) {
                  document.getElementById('predictor_esmiles').value += mm + "\n";
               }
            //   Analyze_reactants(nr,prespace,mm,reactant,max_energy,max_level,show_bad_reactions,element)
            }
            for (var j=0; j<rxn['new_reactants'].length; ++j) {
               var mm = rxn['new_reactants'][j];
               var rlink2 = document.getElementById("arrows_calculation_url").value + "molecule/" + "\"" + mm + "\"";
               var tnreactant = mm.link(rlink2).split('<a').join('<a target="_blank"');
               if (!document.getElementById("predictor_genreactants").innerHTML.includes(tnreactant)) {
                  document.getElementById("predictor_genreactants").innerHTML += tnreactant + " " + "<br>";
               }
            }
         } else {
            element.value += prespace + "    Reaction ignored because energy greater than " + max_energy.toFixed(2) + "\n";
         }
      } 
      //tryDraw();
   }
}

//##### fetch_reactants #######
function fetch_reactants(nr,prespace,reactants_str,reactant,it,max_energy,current_level,show_bad_reactions,element) {
   console.log("start fetch_reactants, reactants_str=" + reactants_str);
   var reaction_url = document.getElementById("arrows_calculation_url").value + "reaction/";
   //if (reactants_str in window.dummy_dict) {
   //   nr.push(window.dummy_dict[reactants_str]);
   //   nr.push(rr);
   //} else if (reactants_str in window.reactants_dict)  {
   //   nr.push(window.reactants_dict[reactants_str]);
   //   window.dummy_dict[reactants_str] = window.reactants_dict[reactants_str];
   //} else {
      element.value += "\n";
      element.value += prespace + "+ Asking Arrows for reactions that contain reactants = " + reactants_str + "\n";
      var reactants =  reactants_str.replace(" ","%20")
      var reaction = reaction_url + "'" + reactants + "%20-->'";
      element.value += prespace + "+ Calling the arrows api wtih " + reaction + "\n";
      
      geturlresult(nr,prespace,reactants_str,reactant,it,max_energy,current_level,show_bad_reactions,element,reaction);
      console.log("finished geturlresult");
   //}
}


function parse_metabolites(rxn_str) {
   var metabolites = [];
   if (rxn_str.includes("-->")) {
      var products = rxn_str.split("-->")[1].trim();
      var products_split = products.split(" + ");
      //for m in products.split(" + ") {
      for (var i=0; i<products_split.length; ++i) {
         var m = products_split[i];
         var mm = m.split("Cl").join("");
         //### make metabolite contains a carbon ### if ("C" in m) or ("c" in m) {
         if (mm.includes("C")  ||  mm.includes("c")) {
            metabolites.push(m.trim());
         }
      }
   }

   return metabolites;
}

function parse_newreactants(rxn_str) {
   var nreactants = [];
   if (rxn_str.includes("-->")) {
      var products = rxn_str.split("-->")[1].trim();
      var products_split = products.split(" + ");
     
      for (var i=0; i<products_split.length; ++i) {
         var m = products_split[i];
         var mm = m.split("Cl").join("");
         //### make metabolite not contain a carbon ### if ("C" not in m) and ("c" not in m) {
         if ((!mm.includes("C")) && (!mm.includes("c"))) {
            nreactants.push(m.trim());
         }
      }
   }

   return nreactants;
}

function parse_reactants(rxn_str) {
   var reactants = [];
   if (rxn_str.includes("-->")) {
      var rrpp = rxn_str.split("-->")[0].trim();
      var reactants_split = rrpp.split(" + ");
    
      for (var i=1; i<reactants_split.length; ++i) {
         var m = reactants_split[i];
         reactants.push(m.trim());
      }
   }
   return reactants;
}

function makereaction_dictionary(rr) {
   console.log("makereaction_dictionary",rr.includes("Predicted_Reaction:"));
   var myreactions = [];
   if (rr.includes("Predicted_Reaction:")) {
      var newreactions = rr.split("Predicted_Reaction:");
      console.log("newreactions=",newreactions);
      for (var i=1; i<newreactions.length; ++i) {
         var nr = newreactions[i];
         var rdict = {};
         var rxn_str            = nr.split(":Reaction_Predicted")[0].split('style="font-size:1.0em">')[1].split("</a>")[0].trim();
         rdict['reaction']      = rxn_str;
         rdict['energies']      = nr.split("energy_estimates:")[1].split(":energy_estimates")[0].trim().split(/[ ,]+/);
         rdict['deviations']    = nr.split("deviations:")[1].split(":deviations")[0].trim().split(/[ ,]+/);
         rdict['metabolites']   = parse_metabolites(rxn_str);
         rdict['new_reactants'] = parse_newreactants(rxn_str);
         rdict['reactants']     = parse_reactants(rxn_str);
         myreactions.push(rdict);
      }
   }

   return myreactions;
}


function Analyze_reactants(nr,prespace,esmiles,reactant,it,max_energy,current_level,show_bad_reactions,element) {
   console.log("start Analyze_reactants, esmiles=" + esmiles);
   prespace += "    ";

   var reactants_str = esmiles.trim();
   if (reactant.trim().length>0) {
      reactants_str += " + " + reactant;
   }

   fetch_reactants(nr,prespace,reactants_str,reactant,it,max_energy,current_level,show_bad_reactions,element);
   console.log("finished fetch_reactants");
}

function run_reactions(nr,esmiles,reactants,it,max_energy,current_level,show_bad_reactions,element) {
   for (var i=0; i<reactants.length; ++i) {
      var r = reactants[i];
      console.log("i=",i," reactant=",r);
      Analyze_reactants(nr,"",esmiles,r,it,max_energy,current_level,show_bad_reactions,element);
   }
}

function runpredictor(esmiles,reactants,max_energy,max_level,energy_type,element) {
   
   var current_level = 1;
   if (esmiles.includes("Reaction Level =")) {
      var ss = esmiles.split("Reaction Level =");
      var ns = ss.length;
      var current_level = parseInt(ss[ns-1].split("------")[0].trim()) + 1;
      var esmiles = ss[ns-1].split("------")[1];
   }

   if (current_level<=max_level)  {

      console.log("esmiles=",esmiles);
      console.log("reactants=",reactants);
      document.getElementById('predictor_esmiles').value   = document.getElementById('predictor_esmiles').value.trim()   + "\n" + "------ Reaction Level = " + current_level.toString() + " ------\n";
      document.getElementById('predictor_reactants').value = document.getElementById('predictor_reactants').value.trim() + "\n";

      document.getElementById('predictor_reactions').innerHTML    += "------ Reaction Level = " + current_level.toString() + " ------<br>";
      document.getElementById('predictor_metabolites').innerHTML  += "------ Reaction Level = " + current_level.toString() + " ------<br>";
      document.getElementById('predictor_genreactants').innerHTML += "------ Reaction Level = " + current_level.toString() + " ------<br>";

      //var compounds = esmiles.trim().split("\n");
      //var reactant_list = reactants.trim().split("\n");
      var compounds = esmiles.trim().split(/[,\n]+/);
      for (var i=0; i<compounds.length; ++i) { compounds[i] = compounds[i].trim(); }

      var reactant_list = reactants.trim().split(/[,\n]+/);
      for (var i=0; i<reactant_list.length; ++i) { reactant_list[i] = reactant_list[i].trim(); }

      var show_bad_reactions = false;

      if (isNaN(max_energy)) { max_energy = 9.9e99;} 
      if (isNaN(max_level)) { max_level = 3;} 
      if (isNaN(energy_type)) { energy_type = 0;}

      var output = "\n";
      output += "++=====================================++\n";
      output += "|| Running Reaction Prediction Program ||\n";
      output += "++=====================================++\n\n";
      output += "compound list=" + compounds + "\n";
      output += "reactant list=" + reactant_list + "\n";
      output += "max_energy   =" + max_energy + "\n";
      output += "max_level    =" + max_level + "\n";
      output += "energy_type  =" + energy_type + "\n";
      output += "current_level=" + current_level + "\n";
      element.value += output;

      var nr = [];
      for (var i=0; i<compounds.length; ++i) {
         run_reactions(nr,compounds[i],reactant_list,energy_type,max_energy,current_level,show_bad_reactions,element);
      }
   } else {
      element.value += "The current_level=" + (current_level-1).toString() + " is >= max_level=" + max_level.toString() + "\n";

   }

}

function resetpredictor() {
   document.getElementById('predictor_esmiles').value   = '';
   document.getElementById('predictor_reactants').value = '';
   document.getElementById('predictor_output').value = '';

   document.getElementById('predictor_reactions').innerHTML    = '';
   document.getElementById('predictor_metabolites').innerHTML  = '';
   document.getElementById('predictor_genreactants').innerHTML = '';

   document.getElementById("inputGraph").innerHTML = 'digraph {\n'
      + '   node [rx=5 ry=5 labelStyle="font: 300 14px \'Helvetica Neue\', Helvetica"]\n'
      + '   edge [labelStyle="font: 300 14px \'Helvetica Neue\', Helvetica"]\n'
      + '\n/*start graph*/\n'
      + '\n/*end*/}\n';

   tryDraw();
}

</script>

<h2> Reaction Prediction </h2>

<table>
   <tr>
      <td> esmiles compounds:   </td>
      <td><textarea  name="predictor_esmiles" id="predictor_esmiles" rows="8" cols="100"></textarea></td>
   </tr>
   <tr>
      <td> reactants: </td>
      <td><textarea  name="predictor_reactants" id="predictor_reactants" rows="3" cols="100"></textarea></td>
   </tr>
</table>
<table>
   <tr>
      <td> max_energy: </td>
      <td> <input type="number" name="Label" id="predictor_max_energy" size="20" value="30"> </td>
      <td> max_level: </td>
      <td> <input type="number" name="Label" id="predictor_max_level" size="2" value="3"> </td>
      <td> energy_type: </td>
      <td> <select id="predictor_energy_type">
              <option value=0>Erxn(g)</option>
              <option value=1>Hrxn(g)</option>
              <option value=2>Grxn(g)</option>
              <option value=3>Delta_Solvation</option>
              <option value=4>Grxn(aq)</option>
           </select>
      </td>
   </tr>
</table>
<br>

<input type="button" VALUE="Run Reaction Prediction" 
   onClick="runpredictor(document.getElementById('predictor_esmiles').value,
                         document.getElementById('predictor_reactants').value,
                         parseFloat(document.getElementById('predictor_max_energy').value),
                         parseInt(document.getElementById('predictor_max_level').value),
                         parseInt(document.getElementById('predictor_energy_type').value),
                         document.getElementById('predictor_output') )"
   title="Run reaction prediction"/>
<input type="button" VALUE="Reset" onClick="resetpredictor();" title="Reset predictor"/>

<br>
<br>
<textarea  name="predictor_output" id="predictor_output" rows="33" cols="100"></textarea>
<br>
<br>
<p id="predictor_reactions">  <b>Reactions   </b> <br></p>
<br>
<p id="predictor_metabolites"><b>Metabolites</b> <br></p>
<br>
<p id="predictor_genreactants"><b>Generated Reactants</b> <br></p>


</div>




<div id="Instructions" class="tabcontent">

<p> This webpage is not finished.</p>

<h4> Miscellaneous Commands </h4>
<ul>
   <li> To reset an image use: https://arrows.emsl.pnnl.gov/api/image_reset/11836 </li>
   <li> To run multiple reaction cycles use the ncycles tag in predict reaction, e.g.  TNT + 2 hydroxide --> ~ ncycles{2} </li>
   <li> To change the accuracy of reaction prediction use the maxlevel tag, e.g.  TNT + hydroxide --> ~ maxlevel{2} </li>
</ul>

<h4> Thomas Commands </h4>
<ul>
   <li> Thomas excecute LSD </li>
   <li> Thomas load tylenol </li>
   <li> Thomas run molecule </li>
   <li> Thomas run 2d molecule </li>
   <li> Thomas add water </li>
   <li> Thomas optimize </li>
   <li> Thomas turn on unit cell </li>
   <li> Thomas turn off unit cell </li>
   <li> Thomas center unit cell </li>
   <li> Thomas origin unit cell </li>
   <li> Thomas stick </li>
   <li> Thomas space fill </li>
   <li> Thomas ball and stick </li>
   <li> Thomas 2d </li>
   <li> Thomas 3d </li>
   <li> Thomas switch to 3d builder </li>
   <li> Thomas switch to 2d builder </li>
   <li> Thomas switch to input editor </li>
   <li> Thomas switch to notes </li>
   <li> Thomas switch to spreadsheet </li>
   <li> Thomas switch to output </li>
   <li> Thomas switch to queue </li>
   <li> Thomas switch to instructions </li>
   <li> Thomas toggle builder </li>
   <li> Thomas toggle lattice </li>
   <li> Thomas toggle bulk surface </li>
   <li> Thomas toggle symmetry </li>
   <li> Thomas toggle polyhedra </li>
   <li> Thomas toggle reaction </li>
   <li> Thomas toggle collective </li>
   
</ul>

<p> Tiny Arrows is a revolutionary approach to materials and chemical simulations that uses NWChem and chemical computational databases to make materials and chemical modeling accessible via a broad spectrum of digital communications.  With this webpage, a molecule can be entered into Tiny Arrows using either an <a href="https://nwchemgit.github.io/EMSL_Arrows#introduction-to-esmiles-how-to-change-calculation-theories">esmiles</a> string, a 2D molecular builder, a 3D molecular builder, or as a NWChem input deck.</p>

   <font color="443322" size="2"><p><a href="https://ace.c9.io">ACE: High Performance Code Editor for the Web</a></p></font>
    <font color="443322" size="2"><p><a href="http://wiki.jmol.org/index.php/JSmol">JSmol: an open-source HTML5 viewer for chemical structures in 3D</a></p></font>
    <font color="443322" size="2"><p> JSME Editor Citation: <a href="http://jcheminf.springeropen.com/articles/10.1186/1758-2946-5-24"> B. Bienfait and P. Ertl, JSME: a free molecule editor in JavaScript, J. Cheminformatics 5:24 (2013)</a> </p></font>
    <font color="443322" size="2"><p><a href="https://bossanova.uk/jspreadsheet/v4/">Jspreadsheet v4: The javascript spreadsheet</a></p></font>

    <table> <tr>
    <td> <font color="443322" size="2"> <p align="justify"> This software service and its documentation were developed at the Environmental Molecular Sciences Laboratory (EMSL) at Pacific Northwest National Laboratory, a multiprogram national laboratory, operated for the U.S. Department of Energy by Battelle under Contract Number DE-AC05-76RL01830. Support for this work was provided by the Department of Energy Office of Biological and Environmental Research, and Department of Defense environmental science and technology program (SERDP). THE SOFTWARE SERVICE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE SERVICE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE SERVICE. </p></font> </td>
    <td> <a href="https://dl.dropboxusercontent.com/s/chxhlvamd8ro356/ArrowsBeaker2.gif"><img src="https://dl.dropboxusercontent.com/s/chxhlvamd8ro356/ArrowsBeaker2.gif" alt="Arrows Movie"> </a> </td>
    </tr></table>
     Keywords: quantum chemistry calculations - quantum chemistry computations - quantum chemistry - molecular modeling calculations - molecular modeling computations - molecular modeling - chemical modeling - chemical reactions calculations - chemical reactions computations - chemical reactions - NWChem calculations - computational chemistry - NWChem

<br><br>
<div align="right"><font color="298DB4"> Tiny Arrows API visited {{ visits }} times </font></div>

</div>





<script type="text/javascript">
function openCity(evt, cityName) {
    // Declare all variables
    var i, tabcontent, tablinks;

    // Get all elements with class="tabcontent" and hide them
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }

    // Get all elements with class="tablinks" and remove the class "active"
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }

    // Show the current tab, and add an "active" class to the button that opened the tab
    document.getElementById(cityName).style.display = "block";
    evt.currentTarget.className += " active";
}
document.getElementById("defaultOpen").click();
</script>

<script>
var coll = document.getElementsByClassName("collapsible");
var i;

for (i = 0; i < coll.length; i++) {
  coll[i].addEventListener("click", function() {
    this.classList.toggle("active");
    var content = this.nextElementSibling;
    if (content.style.display === "block") {
      content.style.display = "none";
    } else {
      content.style.display = "block";
    }
  });
}

</script>

<script>
setTimeout(function(){
 //your code here
 jmshowcell();
 jms("set StructureModifiedCallback \"jmsetcoordboxes\";");
}, 3000);
changenwchemoptimizer();
changenwchemfractional();
//changebandpspw();
changenwchemefieldtype();
</script>


<hr>
<div align="left"> 
<table>
   <tr> 
      <td>
         <input type="radio" id="text2speech_on" onClick="ClearRd(this,3)" title="Turn on/off Text 2 Speech"/>
         <b style="color: green; font-size: 14px;">Arrows: </b> 
         <font color="298DB4" style="color: green; font-size: 14px;" id="text2speechbanner">Hello</font> 
         <br>
         <input type="radio" id="speech2text_on" onClick="ClearRd(this,4);Speech2Text();" title="Turn on/off Speech 2 Text"/>
         <b style="color: blue; font-size: 14px;">You: </b> 
      </td>
   </tr>
</table>
<br>
<table>
   <tr>
      <td>
         <input type="button" VALUE="Return" onClick="returnfinalTranscript()" title="Return"
          style="background-color:#f8f8ff; color:#0000ff; font-size: 14px; font-weight:bold"/>
         <input type="button" VALUE="Clear" onClick="clearfinalTranscript()" title=Clear"
          style="background-color:#f8f8ff; color:#0000ff; font-size: 14px; font-weight:bold"/> 
      </td>
   </tr>
   <tr>
      <td>
         <textarea onChange="resetfinalTranscript();" name="speech2textbanner" id="speech2textbanner" rows="5" cols="70" 
          style="color: blue; font-size: 14px;"></textarea>
      </td>
      <td>
         <textarea name="apirunning0" id="apirunning" rows="5" cols="30" style="color: blue; font-size: 14px;"></textarea>
      </td>
   </tr>
</table>
arrows url: <input type="url" id="arrows_url" SIZE=30 value="{{ arrows_api }}" oninput="cacheInput(this)"/> 
arrows program directory: <input type="url" id="arrowsprogramurl" SIZE=30 value="{{url_for('static',filename='arrows-scripts')}}" oninput="cacheInput(this)"/> 
<br>
arrows calculation queue url: <input type="url" id="arrows_calculation_url" SIZE=30 value="{{ arrows_api }}" oninput="cacheInput(this)"/> 
</div>
<br><br><br>
<hr>
               

</body>
</html>
