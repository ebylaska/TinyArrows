var JSON;if(!JSON){JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());"use strict";(function($jsRoot){function emptyFunction(){}function __$A__(iterable){if(!iterable){return[]}if(iterable.toArray){return iterable.toArray()}var length=iterable.length||0,results=new Array(length);while(length--){results[length]=iterable[length]}return results}var Class={createCore:function(){var parent=null,properties=__$A__(arguments);if(Object.isFunction(properties[0])){parent=properties.shift()}function klass(){this.initialize.apply(this,arguments)}Object.extend(klass,Class.Methods);klass.superclass=parent;klass.subclasses=[];if(parent){var subclass=function(){};subclass.prototype=parent.prototype;klass.prototype=new subclass;parent.subclasses.push(klass)}for(var i=0;i<properties.length;i++){klass.addMethods(properties[i])}if(!klass.prototype.initialize){klass.prototype.initialize=emptyFunction}klass.prototype.constructor=klass;return klass},create:function(){var result=Class.createCore.apply(this,arguments);return result},free:function(obj){if(obj.finalize){obj.finalize()}obj=null}};Class.Methods={addMethods:function(source){if(!source){return this}var ancestor=this.superclass&&this.superclass.prototype;var properties=Object.keys(source);if(!Object.keys({toString:true}).length){properties.push("toString","valueOf")}var doNothing=function(){};for(var i=0,length=properties.length;i<length;i++){var property=properties[i];var value=source[property];var isFunction=Object.isFunction(value);if(ancestor&&isFunction&&FunctionUtils.argumentNames(value).first()=="$super"){var method=value;value=(function(m){return function(){return(ancestor[m]||doNothing).apply(this,arguments)}})(property).wrap(method);value.valueOf=method.valueOf.bind(method);value.toString=method.toString.bind(method)}this.prototype[property]=value}return this}};Object.extend=function(destination,source,ignoreUnsetValue,ignoreEmptyString){for(var property in source){var value=source[property];if(ignoreUnsetValue&&((value===undefined)||(value===null))){continue}if(ignoreEmptyString&&(value==="")){continue}destination[property]=value}return destination};Object.extendEx=function(destination,source,options){var ops=options||{};for(var property in source){var value=source[property];if(ops.ignoreUnsetValue&&((value===undefined)||(value===null))){continue}if(ops.ignoreEmptyString&&(value==="")){continue}var oldValue=destination[property];if(options.preserveExisted&&oldValue){continue}var oldProto=oldValue&&oldValue.constructor&&oldValue.constructor.prototype;var newProto=value&&value.constructor&&value.constructor.prototype;if(oldValue&&typeof(oldValue)==="object"&&oldProto===newProto){Object.extend(oldValue,value)}else{destination[property]=value}}return destination};Object._extendSupportMethods=function(destination,methods){return Object.extendEx(destination,methods,{ignoreUnsetValue:true,preserveExisted:true})};Object.getCascadeFieldValue=function(fieldName,root){var result;var cascadeNames;if(fieldName.length&&fieldName.splice){cascadeNames=fieldName}else{cascadeNames=fieldName.split(".")}if(!root){var root=this}for(var i=0,l=cascadeNames.length;i<l;++i){result=root[cascadeNames[i]];if(!result){break}else{root=result}}return result};Object.setCascadeFieldValue=function(fieldName,value,root,forceCreateEssentialObjs){var cascadeNames;if(fieldName.length&&fieldName.splice){cascadeNames=fieldName}else{cascadeNames=fieldName.split(".")}var parent=root;for(var i=0,l=cascadeNames.length;i<l;++i){var name=cascadeNames[i];if(i===l-1){parent[name]=value;return value}else{var obj=parent[name];if(!obj&&forceCreateEssentialObjs){obj={};parent[name]=obj}if(!obj){return false}else{parent=obj}}}};Object._inherit=function(proto){if(proto===null){proto={}}var t=typeof(proto);if(!(DataType.isFunctionType(t)||DataType.isObjectType(t))){throw TypeError()}function f(){}f.prototype=proto;return new f()};if(!Object.create){Object.create=Object._inherit}Object.copyValues=function(dest,src,propNames){if(!propNames){return Object.extend(dest,source)}else{for(var i=0,l=propNames.length;i<l;++i){var prop=propNames[i];var value=src[prop];if(value!==undefined){dest[prop]=value}}return dest}};Object._extendSupportMethods(Object,{keys:function(object){var keys=[];for(var property in object){keys.push(property)}return keys},isFunction:function(object){return typeof object=="function"},isUndefined:function(object){return typeof object=="undefined"}});var FunctionUtils={argumentNames:function(f){var names=((f.toString().match(/^[\s\(]*function[^(]*\(([^\)]*)\)/)||[])[1]||"").replace(/\s+/g,"").split(",");return names.length==1&&!names[0]?[]:names},};Object._extendSupportMethods(Function.prototype,{argumentNames:function(){var names=this.toString().match(/^[\s\(]*function[^(]*\(([^\)]*)\)/)[1].replace(/\s+/g,"").split(",");return names.length==1&&!names[0]?[]:names},wrap:function(wrapper){var __method=this;return function(){return wrapper.apply(this,[__method.bind(this)].concat(__$A__(arguments)))}},methodize:function(){if(this._methodized){return this._methodized}var __method=this;return this._methodized=function(){var a=Array.prototype.slice.call(arguments);a.unshift(this);return __method.apply(null,a)}},bind:function(){if(arguments.length<2&&Object.isUndefined(arguments[0])){return this}var __method=this,args=__$A__(arguments),object=args.shift();return function(){return __method.apply(object,args.concat(__$A__(arguments)))}},delay:function(){var __method=this,args=__$A__(arguments),timeout=args.shift();return window.setTimeout(function(){return __method.apply(__method,args)},timeout)},defer:function(){var __method=this,args=__$A__(arguments),timeout=args.shift();return window.setTimeout(function(){return __method.apply(__method,args)},10)}});Object._extendSupportMethods(Array.prototype,{first:function(){return this[0]},last:function(){return this[this.length-1]},clear:function(){this.length=0;return this},without:function(){var values=__$A__(arguments);return this.select(function(value){return !values.include(value)})},removeAt:function(index){this.splice(index,1)},remove:function(item){var index=this.indexOf(item);if(index>=0){return this.removeAt(index)}},forEach:function(func,scope){var i,len;for(i=0,len=this.length;i<len;++i){if(i in this){func.call(scope,this[i],i,this)}}}});if(!Array.prototype.indexOf){Array.prototype.indexOf=function(item,i){i||(i=0);var length=this.length;if(i<0){i=length+i}for(;i<length;i++){if(this[i]===item){return i}}return -1}}if(!Array.prototype.lastIndexOf){Array.prototype.lastIndexOf=function(item,i){i=isNaN(i)?this.length:(i<0?this.length+i:i)+1;var n=this.slice(0,i).reverse().indexOf(item);return(n<0)?n:i-n-1}}Object._extendSupportMethods(String.prototype,{gsub:function gsub(pattern,replacement){var result="",source=this,match;while(source.length>0){if(match=source.match(pattern)){result+=source.slice(0,match.index);result+=replacement;source=source.slice(match.index+match[0].length)}else{result+=source,source=""}}return result},sub:function(pattern,replacement,count){count=Object.isUndefined(count)?1:count;return this.gsub(pattern,function(match){if(--count<0){return match[0]}return replacement(match)})},scan:function(pattern,iterator){this.gsub(pattern,iterator);return String(this)},truncate:function(length,truncation){length=length||30;truncation=Object.isUndefined(truncation)?"...":truncation;return this.length>length?this.slice(0,length-truncation.length)+truncation:String(this)},strip:function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")},stripTags:function(){return this.replace(/<\/?[^>]+>/gi,"")},stripScripts:function(){return this.replace(new RegExp(Prototype.ScriptFragment,"img"),"")},extractScripts:function(){var matchAll=new RegExp(Prototype.ScriptFragment,"img");var matchOne=new RegExp(Prototype.ScriptFragment,"im");return(this.match(matchAll)||[]).map(function(scriptTag){return(scriptTag.match(matchOne)||["",""])[1]})},evalScripts:function(){return this.extractScripts().map(function(script){return eval(script)})},escapeHTML:function escapeHTML(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br />")},unescapeHTML:function(){return this.replace(/\<br \/\>/g,"\n").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">")},toQueryParams:function(separator){var match=this.strip().match(/([^?#]*)(#.*)?$/);if(!match){return{}}return match[1].split(separator||"&").inject({},function(hash,pair){if((pair=pair.split("="))[0]){var key=decodeURIComponent(pair.shift());var value=pair.length>1?pair.join("="):pair[0];if(value!=undefined){value=decodeURIComponent(value)}if(key in hash){if(!Object.isArray(hash[key])){hash[key]=[hash[key]]}hash[key].push(value)}else{hash[key]=value}}return hash})},toArray:function(){return this.split("")},succ:function(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)},times:function(count){return count<1?"":new Array(count+1).join(this)},camelize:function(){var parts=this.split("-"),len=parts.length;if(len==1){return parts[0]}var camelized=this.charAt(0)=="-"?parts[0].charAt(0).toUpperCase()+parts[0].substring(1):parts[0];for(var i=1;i<len;i++){camelized+=parts[i].charAt(0).toUpperCase()+parts[i].substring(1)}return camelized},capitalize:function(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()},capitalizeFirst:function(){return this.charAt(0).toUpperCase()+this.substring(1)},underscore:function(){return this.gsub(/::/,"/").gsub(/([A-Z]+)([A-Z][a-z])/,"#{1}_#{2}").gsub(/([a-z\d])([A-Z])/,"#{1}_#{2}").gsub(/-/,"_").toLowerCase()},dasherize:function(){return this.gsub(/_/,"-")},inspect:function(useDoubleQuotes){var escapedString=this.gsub(/[\x00-\x1f\\]/,function(match){var character=String.specialChar[match[0]];return character?character:"\\u00"+match[0].charCodeAt().toPaddedString(2,16)});if(useDoubleQuotes){return'"'+escapedString.replace(/"/g,'\\"')+'"'}return"'"+escapedString.replace(/'/g,"\\'")+"'"},toJSON:function(){return this.inspect(true)},unfilterJSON:function(filter){return this.sub(filter||Prototype.JSONFilter,"#{1}")},isJSON:function(){var str=this;if(str.blank()){return false}str=this.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"/g,"");return(/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/).test(str)},evalJSON:function(sanitize){var json=this.unfilterJSON();try{if(!sanitize||json.isJSON()){return eval("("+json+")")}}catch(e){}throw new SyntaxError("Badly formed JSON string: "+this.inspect())},include:function(pattern){return this.indexOf(pattern)>-1},startsWith:function(pattern){return this.indexOf(pattern)===0},endsWith:function(pattern){var d=this.length-pattern.length;return d>=0&&this.lastIndexOf(pattern)===d},empty:function(){return this==""},blank:function(){return/^\s*$/.test(this)},interpolate:function(object,pattern){return new Template(this,pattern).evaluate(object)}});Object._extendSupportMethods(String.prototype,{upperFirst:function(){return this.charAt(0).toUpperCase()+this.substring(1)},format:function(){var formatted=this;for(var i=0;i<arguments.length;i++){var regexp=new RegExp("\\{"+i+"\\}","gi");formatted=formatted.replace(regexp,arguments[i])}return formatted},trim:function(){return this.replace(/^\s*|\s*$/g,"")},ltrim:function(){return this.replace(/^\s+/,"")},rtrim:function(){return this.replace(/\s+$/,"")},trimLeft:function(){return this.ltrim()},trimRight:function(){return this.rtrim()},pad:function(length,padString,rightPad){var p=padString||" ";var a=[];for(var i=0,l=length-this.length;i<l;++i){a.push(p)}var str=this;if(rightPad){return str+a.join("")}else{return a.join("")+str}},lpad:function(length,padString){return this.pad(length,padString,false)},rpad:function(length,padString){return this.pad(length,padString,true)},reverse:function(){var length=this.length;var a=[];for(var i=length-1;i>=0;--i){a.push(this.charAt(i))}return a.join("")},toCharArray:function(){var a=[];for(var i=0,l=this.length;i<l;++i){a.push(this.charAt(i))}return a},hyphenize:function(hyphen){if(!hyphen){hyphen="-"}var len=this.length;var a=[];for(var i=0;i<len;++i){var c=this.charAt(i);if((i!==0)&&(c>="A")&&(c<="Z")){a.push(hyphen+c.toLowerCase())}else{a.push(c)}}return a.join("")}});var StringUtils={STRUE:"$TRUE",SFALSE:"$FALSE",SUNDEFINED:"$UNDEFINED",SNULL:"$NULL",SNAN:"$NAN",SPOSITIVE:"+",SNEGATIVE:"-",SDATEPREFIX:"@",isAllDigitalChar:function(str){for(var i=0,l=str.length;i<l;++i){var c=str.charAt(i);var isDigital=(c>="0")&&(c<="9");if((!isDigital)&&(c!=".")){return false}}return true},isNumbericStr:function(str){var a=Number(str);return !isNaN(a)},serializeValue:function(value,unchangeTypes){var utypes=unchangeTypes||[];var vtype=DataType.getType(value);if(utypes.indexOf(vtype)>=0){return value.toString()}if(value===null){return StringUtils.SNULL}else{if(typeof(value)=="undefined"){return StringUtils.SUNDEFINED}else{if(value!=value){return StringUtils.SNAN}else{switch(vtype){case"boolean":return value?StringUtils.STRUE:StringUtils.SFALSE;break;case"number":case DataType.INT:case DataType.FLOAT:var sign=(value>=0)?StringUtils.SPOSITIVE:"";return sign+value;break;case DataType.DATE:return StringUtils.SDATEPREFIX+value.toString();default:return value.toString()}}}}},deserializeValue:function(str,preferedType){if(typeof(str)!=="string"){return str}switch(str){case StringUtils.STRUE:return true;break;case StringUtils.SFALSE:return false;break;case StringUtils.SNULL:return null;break;case StringUtils.SUNDEFINED:return undefined;break;case StringUtils.SNAN:return NaN;break;default:if(preferedType){switch(preferedType){case DataType.FLOAT:return parseFloat(str);break;case DataType.INT:return parseInt(str);break;case"number":return parseFloat(str);break;case"boolean":return !!str;break;default:return str}}else{var firstChar=str.charAt(0);switch(firstChar){case StringUtils.SPOSITIVE:case StringUtils.SNEGATIVE:var s=str.substring(1);if(StringUtils.isNumbericStr(s)){return parseFloat(str)}else{return str}break;case StringUtils.SDATEPREFIX:var s=str.substr(1);return new Date(s);default:return str}}}}};Object.extend(Date.prototype,{copyFrom:function(src){this.setFullYear(src.getFullYear(),src.getMonth(),src.getDate());this.setTime(src.getTime())}});if(!Math.sqr){Math.sqr=function(x){return x*x}}if(!Math.sign){Math.sign=function(x){return(x>0)?1:(x<0)?-1:0}}if(!$jsRoot.Node){$jsRoot.Node={}}if(!$jsRoot.Node.ELEMENT_NODE){Object.extend($jsRoot.Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12})}Class.PropertyScope={DEFAULT:3,PUBLISHED:3,PUBLIC:2,PRIVATE:1};Class.PropList=function(){this.props=[]};Class.PropList.prototype={addProperty:function(propName,options){if(!options){options={}}var propInfo;propInfo=this.getPropInfo(propName);if(!propInfo){propInfo={};this.props.push(propInfo)}propInfo=Object.extend(propInfo,options);if(propInfo.serializable===undefined){propInfo.serializable=true}propInfo.name=propName;return propInfo},removeProperty:function(propName){var index=this.indexOf(propName);if(index>=0){this.props.splice(index,1)}},removePropAt:function(index){if(index>=0){var prop=this.props[index];if(prop){this.props.splice(index,1)}}},getLength:function(){return this.props.length},indexOf:function(propName){for(var i=0,l=this.props.length;i<l;++i){if(this.props[i].name===propName){return i}}return -1},getPropInfoAt:function(index){if(index>=0){return this.props[index]}else{return null}},getPropInfo:function(propName){var result;var index=this.indexOf(propName);var result=this.getPropInfoAt(index);return result},hasProperty:function(propName){return(this.indexOf(propName)>=0)},clear:function(){this.props.clear()},clone:function(){var result=new Class.PropList();result.props=this.props.slice();return result},appendList:function(propList){for(var i=0,l=propList.props.length;i<l;++i){this.props.push(propList.props[i])}}};Class.PropList.prototype.constructor=Class.PropList;Class.EventHandlerList=function(){this.handlers=[];this._$flag_="KekuleEventList"};Class.EventHandlerList.prototype={add:function(handler,thisArg){if(!thisArg){thisArg=null}this.handlers.push({thisArg:thisArg,handler:handler})},remove:function(handler,thisArg){var indexes=this.indexesOf(handler,thisArg);if(indexes.length>0){for(var i=indexes.length-1;i>=0;--i){this.removeAt(indexes[i])}}},removeAt:function(index){for(var i=index,l=this.handlers.length;i<l;++i){this.handlers[i]=this.handlers[i+1]}this.handlers.length=this.handlers.length-1},clear:function(){this.handlers=[]},getHandlerInfo:function(index){return this.handlers[index]},indexOf:function(handler,thisArg){for(var i=0,l=this.handlers.length;i<l;++i){if(this.handlers[i].handler==handler){if((thisArg!==undefined)&&(this.handlers[i].thisArg===thisArg)){return i}else{if(thisArg===undefined){return i}}}}return -1},indexesOf:function(handler,thisArg){var result=[];for(var i=0,l=this.handlers.length;i<l;++i){if(this.handlers[i].handler==handler){if((thisArg!==undefined)&&(this.handlers[i].thisArg===thisArg)){result.push(i)}else{if(thisArg===undefined){result.push(i)}}}}return result},getLength:function(){return this.handlers.length}};Class.EventHandlerList.constructor=Class.EventHandlerList;var DataType={UNKNOWN:null,VARIANT:null,PRIMARY:"primary",UNDEFINED:"undefined",BOOL:"boolean",BOOLEAN:"boolean",NUMBER:"number",INT:"int",INTEGER:"int",FLOAT:"float",STRING:"string",ARRAY:"array",FUNCTION:"function",DATE:"date",HASH:"object",OBJECT:"object",OBJECTEX:"objectex",CLASS:"class",isSimpleType:function(typeName){return(typeName==DataType.STRING)||(typeName==DataType.NUMBER)||(typeName==DataType.INT)||(typeName==DataType.FLOAT)||(typeName==DataType.BOOL)||(typeName==DataType.UNDEFINED)||(typeName==DataType.PRIMARY)},isComplexType:function(typeName){return !(DataType.isSimpleType(typeName)||DataType.isFunctionType(typeName))},isFunctionType:function(typeName){return typeName==DataType.FUNCTION},isObjectType:function(typeName){return typeName==DataType.OBJECT},isDateType:function(typeName){return typeName==DataType.DATE},isObjectExType:function(typeName){var result=DataType.isComplexType(typeName)&&(!DataType.isObjectType(typeName))&&(!DataType.isDateType(typeName));if(result){var classObj=ClassEx.findClass(typeName);result=classObj&&ClassEx.isOrIsDescendantOf(classObj,ObjectEx)}return result},getType:function(value){var stype=typeof(value);switch(stype){case"undefined":return DataType.UNDEFINED;case"function":return DataType.FUNCTION;case"boolean":return DataType.BOOL;case"string":return DataType.STRING;case"number":if(Math.floor(value)==value){return DataType.INT}else{return DataType.FLOAT}case"object":if(this.isDateValue(value)){return DataType.DATE}else{if(DataType.isArrayValue(value)){return DataType.ARRAY}else{if(ClassEx.isClass(value)){return DataType.CLASS}else{if(DataType.isObjectExValue(value)&&value.getClassName){return value.getClassName()}else{return DataType.OBJECT}}}}default:return stype}},isSimpleValue:function(value){return DataType.isSimpleType(typeof(value))},isUndefinedValue:function(value){return typeof(value)=="undefined"},isNullValue:function(value){return(value===null)},isFunctionValue:function(value){return typeof(value)=="function"},isObjectValue:function(value){if(value){return(typeof(value)=="object")&&(!DataType.isArrayValue(value))&&(!DataType.isDateValue(value))}else{return false}},isDateValue:function(value){if(value){return((typeof(value)=="object")&&(value.getFullYear!==undefined))}return false},isArrayValue:function(value){if(value){return((typeof(value)=="object")&&(value.length!==undefined))}else{return false}},isObjectExValue:function(value){return(value instanceof ObjectEx)},createInstance:function(typeName){switch(typeName){case DataType.UNDEFINED:return undefined;case DataType.DATE:return new Date();case DataType.ARRAY:return new Array();case DataType.OBJECT:return new Object();case DataType.FUNCTION:return new Function();default:var classInstance=ClassEx.findClass(typeName.capitalizeFirst());return new classInstance()}}};var ClassEx={isClass:function(classObj){if(!classObj){return false}return !!(classObj.superclass||classObj.subclasses)},findClass:function(className,root){return Object.getCascadeFieldValue(className,root||$jsRoot)},getClassName:function(aClass){return aClass.prototype.CLASS_NAME},getClassLocalName:function(aClass){var className=ClassEx.getClassName(aClass);var pos=className.lastIndexOf(".");return(pos>=0)?className.substring(pos+1):className},getPrototype:function(aClass){return aClass.prototype},getSuperClass:function(aClass){return aClass.superclass||aClass.constructor.superclass},getSuperClassPrototype:function(aClass){if(aClass.superclass){return aClass.superclass.prototype}else{return null}},_getCommonSuperClass2:function(class1,class2){var result=class1;while(result&&(!ClassEx.isOrIsDescendantOf(class2,result))){result=ClassEx.getSuperClass(result)}return result},getCommonSuperClass:function(objects){if(!objects||!objects.length){return null}var result=objects[0].getClass?objects[0].getClass():null;if(!result){return null}for(var i=1,l=objects.length;i<l;++i){var classObj=objects[i].getClass?objects[i].getClass():null;if(!classObj){return null}result=ClassEx._getCommonSuperClass2(result,classObj)}return result},isDescendantOf:function(aClass,superClass){var ancestor=ClassEx.getSuperClass(aClass);while(ancestor&&(ancestor!==superClass)){ancestor=ClassEx.getSuperClass(ancestor)}return !!ancestor},isOrIsDescendantOf:function(aClass,superClass){return(aClass===superClass)||ClassEx.isDescendantOf(aClass,superClass)},isOrIsDescendantOfClasses:function(aClass,superClasses){for(var i=0,l=superClasses.length;i<l;++i){if(ClassEx.isOrIsDescendantOf(aClass,superClasses[i])){return true}}return false},_ensurePropertySystem:function(aClass){var proto=ClassEx.getPrototype(aClass);if(!proto){return}if(!proto.hasOwnProperty("properties")){var parent=ClassEx.getSuperClass(aClass);if(parent){ClassEx._ensurePropertySystem(parent)}ClassEx._createPropertyList(aClass);if(proto.hasOwnProperty("initProperties")){proto.initProperties.apply(proto)}}},_createPropertyList:function(aClass){if(!ClassEx.getPrototype(aClass).hasOwnProperty("properties")){ClassEx.getPrototype(aClass).properties=new Class.PropList()}},getOwnPropList:function(aClass){var proto=ClassEx.getPrototype(aClass);if(proto){proto._initPropertySystem();return proto.properties}else{return null}},getAllPropList:function(aClass){var result;var s=ClassEx.getSuperClassPrototype(aClass);if(s){result=s.getAllPropList().clone();result.appendList(ClassEx.getOwnPropList(aClass))}else{result=ClassEx.getOwnPropList(aClass)}return result},getPropListOfScopes:function(aClass,scopes){var findOwnList=function(aClass,scopes){var list=ClassEx.getOwnPropList(aClass).clone();if(list){for(var i=list.getLength()-1;i>=0;--i){var propInfo=list.getPropInfoAt(i);var propScope=propInfo.scope||Class.PropertyScope.DEFAULT;if(scopes.indexOf(propScope)<0){list.removePropAt(i)}}}return list};var result;var s=ClassEx.getSuperClass(aClass);if(s){result=ClassEx.getPropListOfScopes(s,scopes).clone();result.appendList(findOwnList(aClass,scopes))}else{result=findOwnList(aClass,scopes)}return result},defineProp:function(aClass,propName,options){ClassEx._ensurePropertySystem(aClass);return ClassEx.getPrototype(aClass).defineProp(propName,options)},defineProps:function(aClass,propDefItems){ClassEx._ensurePropertySystem(aClass);var proto=ClassEx.getPrototype(aClass);for(var i=0,l=propDefItems.length;i<l;++i){var item=propDefItems[i];var propName=item.name;var options=item;proto.defineProp(propName,options)}},getPropInfo:function(aClass,propName){return ClassEx.getPrototype(aClass).getPropInfo(propName)},defineEvent:function(aClass,eventName){return ClassEx.getPrototype(aClass).defineEvent(eventName)},getUnusedMethodName:function(aClass,baseName,fromIndex){var start=fromIndex||0;var i=start;var p=ClassEx.getPrototype(aClass);var name=baseName+Number(i).toString();while(p[name]){++i;name=baseName+Number(i).toString()}return name},extendMethod:function(aClass,methodName,method){var proto=ClassEx.getPrototype(aClass);var originMethod=proto[methodName];var newName=ClassEx.getUnusedMethodName(aClass,"__$changed$_"+methodName+"__");proto[newName]=originMethod;var value=(function(m){return function(){return proto[m].apply(this,arguments)}})(newName).wrap(method);proto[methodName]=value;value.valueOf=method.valueOf.bind(method);value.toString=method.toString.bind(method)},extend:function(aClass,extension){var proto=ClassEx.getPrototype(aClass);var ancestor=ClassEx.getSuperClassPrototype(aClass);var properties=Object.keys(extension);if(!Object.keys({toString:true}).length){properties.push("toString","valueOf")}for(var i=0,length=properties.length;i<length;i++){var property=properties[i],value=extension[property];if(typeof(value)=="function"){var args=FunctionUtils.argumentNames(value);var first=args.first();if(first=="$origin"){var method=value;var originMethod=proto[property];var newName=ClassEx.getUnusedMethodName(aClass,"__$changed$_"+property+"__");proto[newName]=originMethod;value=(function(m){return function(){return proto[m].apply(this,arguments)}})(newName).wrap(method);value.valueOf=method.valueOf.bind(method);value.toString=method.toString.bind(method);args.shift();first=args.first()}if(first=="$super"){var method=value;value=(function(m){return function(){return ancestor[m].apply(this,arguments)}})(property).wrap(method);value.valueOf=method.valueOf.bind(method);value.toString=method.toString.bind(method)}}proto[property]=value}return aClass}};var ObjectEx=Class.create({CLASS_NAME:"ObjectEx",initialize:function(){this._initPropertySystem();this.initPropValues();this._updateStatus=0;this._childChangeEventSuppressed=false;this._modifiedProps=[];this._finalized=false;this.afterInitialization()},afterInitialization:function(){},finalize:function(){if(!this._finalized){this.doFinalize();this.invokeEvent("finalize",{obj:this});this.setPropStoreFieldValue("eventHandlers",null);this._finalized=true}},doFinalize:function(){},initProperties:function(){this.defineProp("enablePropValueGetEvent",{dataType:DataType.BOOL,serializable:false,scope:Class.PropertyScope.PUBLIC});this.defineProp("enablePropValueSetEvent",{dataType:DataType.BOOL,serializable:false,scope:Class.PropertyScope.PUBLIC});this.defineProp("bubbleEvent",{dataType:DataType.BOOL,serializable:false,scope:Class.PropertyScope.PUBLIC});this.defineProp("suppressChildChangeEventInUpdating",{dataType:DataType.BOOL,serializable:false,scope:Class.PropertyScope.PUBLIC});this.defineProp("eventHandlers",{dataType:DataType.HASH,serializable:false,scope:Class.PropertyScope.PRIVATE,getter:function(){var r=this.getPropStoreFieldValue("eventHandlers");if(!r){r={};this.setPropStoreFieldValue("eventHandlers",r)}return r}})},initPropValues:function(){},getHigherLevelObj:function(){return null},saved:function(){},loaded:function(){},_initPropertySystem:function(){if(!this.getPrototype().hasOwnProperty("properties")){var parent=this.getSuperClassPrototype();if(parent){parent._initPropertySystem.apply(parent)}this._createPropertyList();if(this.getPrototype().hasOwnProperty("initProperties")){this.getPrototype().initProperties.apply(this.getPrototype())}}},_createPropertyList:function(){if(!this.getPrototype().hasOwnProperty("properties")){this.getPrototype().properties=new Class.PropList()}},getClass:function(){return this.constructor},getSuperClass:function(){return this.getClass().superclass},getClassName:function(){return this.getPrototype().CLASS_NAME},getClassLocalName:function(){return ClassEx.getClassLocalName(this.getClass())},getSerializationName:function(){return this.getClassName()},getPrototype:function(){if(this.prototype){return this.prototype}else{return this.constructor.prototype}},getSuperClassPrototype:function(){if(this.constructor&&this.constructor.superclass){return this.constructor.superclass.prototype}else{return null}},getOwnPropList:function(){this._initPropertySystem();return this.getPrototype().properties},getAllPropList:function(){var result;var s=this.getSuperClassPrototype();if(s){result=s.getAllPropList().clone();result.appendList(this.getOwnPropList())}else{result=this.getOwnPropList().clone()}return result},getPropListOfScopes:function(scopes){return ClassEx.getPropListOfScopes(this.getClass(),scopes)},getPropInfoHashKey:function(propName){return ObjectEx._PROPINFO_HASHKEY_PREFIX+propName},getDefPropStoreFieldName:function(propName){return ObjectEx._PROP_STOREFIELD_PREFIX+propName},defineProp:function(propName,options){if(!options){options={}}if(options.serializable===undefined){options.serializable=true}if(!options.storeField){options.storeField=this.getDefPropStoreFieldName(propName)}var list=this.getOwnPropList();var prop=list.addProperty(propName,options);if(options.getter!==null){prop.getter=this.createPropGetter(prop,options.getter)}if(options.setter!==null){prop.setter=this.createPropSetter(prop,options.setter)}this[this.getPropInfoHashKey(propName)]=prop;return prop},createPropGetter:function(prop,getter){var propNameBase=prop.name.toString().upperFirst();var getterName="get"+propNameBase;var doGetterName="doGet"+propNameBase;var actualGetter=this[doGetterName];if(!actualGetter){actualGetter=getter||new Function('return this["'+prop.storeField+'"];');this.getPrototype()[doGetterName]=actualGetter}this.getPrototype()[getterName]=function(){var args=arguments;return this[doGetterName].apply(this,args)};return doGetterName},createPropSetter:function(prop,setter){var propName=prop.name.toString();var propNameBase=propName.upperFirst();var setterName="set"+propNameBase;var doSetterName="doSet"+propNameBase;var actualSetter=this[doSetterName];if(!this[doSetterName]){actualSetter=setter||new Function("value",'this["'+prop.storeField+'"] = value;');this.getPrototype()[doSetterName]=actualSetter}this.getPrototype()[setterName]=function(){var args=Array.prototype.slice.call(arguments);var value=args[0];this[doSetterName].apply(this,args);this.notifyPropSet(propName,value);return this};return doSetterName},hasProperty:function(propName){return(this.getPropInfo(propName)!=null)},getPropInfo:function(propName){var pname=propName||"";var hashKey=this.getPropInfoHashKey(pname)||"";var result=this[hashKey];if(!result){result=this.getOwnPropList().getPropInfo(pname);if(!result){var parent=this.getSuperClassPrototype();if(parent&&parent.getPropInfo){result=parent.getPropInfo(pname)}else{result=null}}}return result},getPropertyDataType:function(propName){var info=this.getPropInfo(propName);return info?info.dataType:null},isPropertySerializable:function(propName){var info=this.getPropInfo(propName);var s=info&&info.serializable;return(s===undefined)||(!!s)},getPropStoreFieldValue:function(propName){var info=this.getPropInfo(propName);if(info.storeField){return this[info.storeField]}else{return undefined}},getPropValue:function(propName){var result;var info=this.getPropInfo(propName);if(info){if(info.getter){var args=Array.prototype.slice.call(arguments);args.shift();result=this[info.getter].apply(this,args)}else{result=this[info.storeField]}return result}else{return null}},getPropValues:function(propNames){var result={};var names;if(DataType.isArrayValue(propNames)){for(var i=0,l=propNames.length;i<l;++i){var pname=propNames[i];result[pname]=this.getPropValue(pname)}}else{if(DataType.isObjectValue(propNames)){for(var pname in propNames){if(propNames.hasOwnProperty(pname)&&typeof(obj[pname])!=="function"){result[pname]=this.getPropValue(pname)}}}}return result},setPropStoreFieldValue:function(propName,value){var pname;var info=this.getPropInfo(propName);if(info.storeField){this[info.storeField]=value}},setPropValue:function(propName,value,ignoreReadOnly){var info=this.getPropInfo(propName);if(info){if(info.setter){this[info.setter].apply(this,[value])}else{if(ignoreReadOnly){this[info.storeField]=value}}this.notifyPropSet(propName,value)}return this},setPropValueX:function(){var args=Array.prototype.slice.call(arguments);var propName=args.shift();var info=this.getPropInfo(propName);if(info){if(info.setter){this[info.setter].apply(this,args)}this.notifyPropSet(propName,this.getPropValue(propName))}return this},setPropValues:function(hash,ignoreReadOnly){for(var propName in hash){if(hash.hasOwnProperty(propName)){if(this.hasProperty(propName)){var propValue=hash[propName];this.setPropValue(propName,propValue,ignoreReadOnly)}}}return this},_isPropGetOrSetEvent:function(propName){return(propName=="propValueGet")||(propName=="propValueSet")},notifyPropSet:function(propName,newValue,doNotEvokeObjChange){if(this.isUpdating()){if(this._modifiedProps.indexOf(propName)<0){this._modifiedProps.push(propName)}return}if(this._isPropGetOrSetEvent(propName)||this.isEventPropName(propName)){return}this.doPropChanged(propName,newValue);if(this.getPropStoreFieldValue("enablePropValueSetEvent")){this.invokeEvent("propValueSet",{propName:propName,propValue:newValue})}if(!doNotEvokeObjChange){this.objectChange([propName])}},objectChange:function(modifiedPropNames){this.doObjectChange(modifiedPropNames);this.invokeEvent("change",{changedPropNames:modifiedPropNames})},doObjectChange:function(modifiedPropNames){},doPropChanged:function(propName,newValue){},defineEvent:function(eventName){return;var propName=this.eventNameToPropName(eventName);var result=this.defineProp(propName,{serializable:false,setter:null});return result},eventNameToPropName:function(eventName){return"__event_"+eventName},isEventPropName:function(propName){return((typeof(propName)=="string")&&(propName.indexOf("__event_")>=0))},isEventHandlerList:function(value){return(value&&(typeof(value)=="object")&&(value instanceof Class.EventHandlerList))},getEventHandlerList:function(eventName){var hs=this.getEventHandlers();var result=hs[eventName];if(!result){result=new Class.EventHandlerList();hs[eventName]=result}return result},addEventListener:function(eventName,listener,thisArg){var handlerList=this.getEventHandlerList(eventName);if(this.isEventHandlerList(handlerList)){return handlerList.add(listener,thisArg)}else{return null}},addOnceEventListener:function(eventName,listener,thisArg){var self=this;var wrapper=function(event){self.removeEventListener(eventName,wrapper,thisArg);listener(event)};return this.addEventListener(eventName,wrapper,thisArg)},removeEventListener:function(eventName,listener,thisArg){var handlerList=this.getEventHandlerList(eventName);if(this.isEventHandlerList(handlerList)){return handlerList.remove(listener,thisArg)}},on:function(eventName,listener,thisArg){return this.addEventListener(eventName,listener,thisArg)},once:function(eventName,listener,thisArg){return this.addOnceEventListener(eventName,listener,thisArg)},off:function(eventName,listener,thisArg){return this.removeEventListener(eventName,listener,thisArg)},invokeEvent:function(eventName,event){if(!event){event={}}event.name=eventName;event.target=this;event.stopPropagation=function(){event.cancelBubble=true};this.dispatchEvent(eventName,event)},relayEvent:function(eventName,event){event.currentTarget=this;if(eventName==="change"&&this.getSuppressChildChangeEventInUpdating()&&this.isUpdating()){this._childChangeEventSuppressed=true}else{this.dispatchEvent(eventName,event)}},dispatchEvent:function(eventName,event){var handlerList=this.getEventHandlerList(eventName);if(this.isEventHandlerList(handlerList)){for(var i=0,l=handlerList.getLength();i<l;++i){var handlerInfo=handlerList.getHandlerInfo(i);if(handlerInfo.handler){handlerInfo.handler.apply(handlerInfo.thisArg,[event])}}}else{}var higherObj=this.getHigherLevelObj();if(!event.cancelBubble&&this.getBubbleEvent()&&higherObj){if(higherObj.relayEvent){higherObj.relayEvent(eventName,event)}}},stopEventPropagation:function(event){event.cancelBubble=true},overwriteMethod:function(methodName,newMethod){var self=this;var oldMethod=this[methodName];this[methodName]=function _delegator_(){var args=Array.prototype.slice.call(arguments);args.unshift(oldMethod.bind(self));return newMethod.apply(self,args)};return this},assign:function(srcObj){return srcObj.assignTo(this)},assignTo:function(targetObj){var jsonObj={};this.saveObj(jsonObj,"json");targetObj.loadObj(jsonObj,"json")},clone:function(){var classObj=this.getClass();var result=new classObj();this.assignTo(result);return result},beginUpdate:function(){++this._updateStatus},endUpdate:function(){--this._updateStatus;this.checkUpdateStatus();if(!this.isUpdating()){var modifiedProps=this._modifiedProps||[];this._modifiedProps=[];if(this._childChangeEventSuppressed){modifiedProps.push("[children]")}this.doEndUpdate(modifiedProps);this._childChangeEventSuppressed=false}},doEndUpdate:function(modifiedPropNames){if(modifiedPropNames.length){if(this.getPropStoreFieldValue("enablePropValueSetEvent")){for(var i=0,l=modifiedPropNames.length;i<l;++i){var propName=modifiedPropNames[i];var propValue=this.getPropValue(propName);this.notifyPropSet(propName,propValue,true)}}this.objectChange(modifiedPropNames)}},isUpdating:function(){return this._updateStatus>0},isPropUpdated:function(propName){return(this._modifiedProps.indexOf(propName)>=0)},checkUpdateStatus:function(){if(this._updateStatus<=0){this._updateStatus=0}},copyPropsTo:function(dest){var props=this.getAllPropList();for(var i=0,l=props.getLength();i<l;++i){var propName=props.getPropInfoAt(i).name;if(dest.hasProperty(propName)){var propValue=this.getPropValue(propName);dest.setPropValue(propName,propValue,true)}}}});ObjectEx._PROPINFO_HASHKEY_PREFIX="__$propInfo__";ObjectEx._PROP_STOREFIELD_PREFIX="__$";$jsRoot.Class=Class;$jsRoot.ClassEx=ClassEx;$jsRoot.ObjectEx=ObjectEx;$jsRoot.DataType=DataType;DataType.StringUtils=StringUtils})(this);var JsonUtility={DEF_LOAD_TIMEOUT:20000,FILE_EXT_JSON:".json",FILE_EXT_JSON_JS_WRAPPER:".jsonjs",DEF_SERIALIZE_TO_JSCODE_VARNAME:"__jsonvar__",parse:function(a){return JSON.parse(a)},parseFromJsWrappedCode:function(code,jsVarName){if(!jsVarName){jsVarName=JsonUtility.DEF_SERIALIZE_TO_JSCODE_VARNAME}eval(code);return JsonUtility.parse(eval(jsVarName))},load:function(b,d,a){var c=WebShow.URL.getFileExt(b);if(c.toLowerCase()==JsonUtility.FILE_EXT_JSON_JS_WRAPPER){return JsonUtility.loadJsWrapper(b,d,a)}else{return JsonUtility.loadJson(b,d,a)}},loadJsWrapper:function(url,callback,options){var loptions=options||{};var wrapperVarName=loptions.wrapperVarName||JsonUtility.DEF_SERIALIZE_TO_JSCODE_VARNAME;if(!loptions.timeout){loptions.timeout=JsonUtility.DEF_LOAD_TIMEOUT}var runCallBack=function(jsonObj,isSuccess){if(callback){callback(jsonObj,isSuccess)}};var wrapperCallback=function(src,isSuccess){var jsonObj=null;if(isSuccess){var wrapperVar=eval(wrapperVarName);if(wrapperVar){if(typeof(wrapperVar)=="string"){jsonObj=JsonUtility.parse(wrapperVar)}else{jsonObj=wrapperVar}}runCallBack(jsonObj,true)}else{runCallBack(null,false)}};WebShow.ScriptLoader.load(url,wrapperCallback,loptions)},loadJson:function(c,e,b){loptions=b||{};if(!loptions.timeout){loptions.timeout=JsonUtility.DEF_LOAD_TIMEOUT}loptions.resultType=WebShow.FileLoader.ResultType.TEXT;loptions.extractBody=false;var d=function(h,f,g){if(f){var i=JsonUtility.parse(h);e(i,true)}else{e(null,false)}};var a=new WebShow.XHRLoader();a.load(c,d,loptions)},serializeToStr:function(b,a){if(a&&a.prettyPrint){return JSON.stringify(b,null,a.indentSpaces||2)}else{return JSON.stringify(b)}},serializeToJsCode:function(d,b,e){if(!e){e="'"}if(!b){b=JsonUtility.DEF_SERIALIZE_TO_JSCODE_VARNAME}var a=JsonUtility.serializeToStr(d);var c=new RegExp(e,"g");a=a.replace(c,"\\"+e);return"var "+b+" = "+e+a+e}};var XmlUtility={DEF_INCLUDE_TAG_NAME:"include",DEF_INCLUDE_SRC_ATTRIB:"src",DEF_LOAD_TIMEOUT:20000,DEF_BYPASS_ROOT_ELEM:true,DEF_SERIALIZE_TO_JSCODE_VARNAME:"__xmlStr__",FILE_EXT_XML:".xml",FILE_EXT_XML_JS_WRAPPER:".xmljs",newDocument:function(b,a){if(!b){b=""}if(!a){a=""}if(document.implementation&&document.implementation.createDocument){var f=document.implementation.createDocument(a,b,null);return f}else{var f=new ActiveXObject("MSXML2.DOMDocument");if(b){var d="";var c=b;var e=b.indexOf(":");if(e!=-1){d=b.substring(0,e);c=b.substring(e+1)}var g="<"+(d?(d+":"):"")+c+(a?((d?" xmlns:":" xmlns")+d+'="'+a+'"'):"")+"/>";f.loadXML(g)}return f}},parse:function(d){if(typeof DOMParser!="undefined"){return(new DOMParser()).parseFromString(d,"application/xml")}else{if(typeof ActiveXObject!="undefined"){var c=XmlUtility.newDocument();c.loadXML(d);return c}else{var a="data:text/xml;charset=utf-8,"+encodeURIComponent(d);var b=new XMLHttpRequest();b.open("GET",a,false);b.send(null);return b.responseXML}}},load:function(b,d,a){var c=WebShow.URL.getFileExt(b);if(c.toLowerCase()==XmlUtility.FILE_EXT_XML_JS_WRAPPER){return XmlUtility.loadHelper.loadJsWrapper(b,d,a)}if(!a){a={disableInclude:false}}if(!a.disableInclude){return XmlUtility.loadHelper.loadAndHandleIncludeElement(b,d,a)}else{return XmlUtility.loadHelper.loadSimple(b,d,a.timeout)}},loadHelper:{loadSimple:function(a,h,f){var b=(h!=null);if((f===null)||(f===undefined)){f=XmlUtility.DEF_LOAD_TIMEOUT}if(!(document.implementation&&document.implementation.createDocument)){return XmlUtility.loadHelper.loadSimpleViaDoc(a,h)}else{var d=new XMLHttpRequest();var i=null;if(f){i=setTimeout(function(){j(null,false)},f)}var j=function(k,e){if(i){clearTimeout(i)}if(h){h(k,e)}};if(b){d.onreadystatechange=function(){if(d.readyState==4){var e=d.responseXML;if(e&&e.documentElement){j(e,true)}else{j(null,false)}}}}try{d.open("get",a,b);d.send(null)}catch(c){WebShow.reportError(c);j(null,false)}var g=d.responseXML;if(g&&g.documentElement){return g}else{return null}}},loadSimpleViaDoc:function(c,e){var b="dummy_dummy_dummy_dummy";var d=(e!=null);var a=XmlUtility.newDocument(b);a.async=d;if(d){a.onreadystatechange=function(){if(a.readyState==4){if((!a.documentElement)||(a.documentElement.tag==b)){e(a,false)}else{e(a,true)}}}}a.load(c);return a},loadAndHandleIncludeElement:function(c,f,b){var e;if(b){e=b.timeout}else{e=null}var d=(f==null);if(d){var a=XmlUtility.loadHelper.loadSimple(c,null,e);if(a&&a.documentElement){XmlUtility.loadHelper.handleIncludedXmlInElement(a.documentElement,null,b);return a}else{return null}}else{return XmlUtility.loadHelper.loadSimple(c,function(h,g){if(!g){f(h,false)}else{XmlUtility.loadHelper.handleIncludedXmlInElement(h.documentElement,function(i){f(h,true)},b)}},e)}},loadJsWrapper:function(url,callback,options){options=options||{};var wrapperVarName=options.wrapperVarName||XmlUtility.DEF_SERIALIZE_TO_JSCODE_VARNAME;var loadTimeout=options.timeout;if((loadTimeout===null)||(loadTimeout===undefined)){loadTimeout=XmlUtility.DEF_LOAD_TIMEOUT}var runCallBack=function(xmldoc,isSuccess){if(callback){callback(xmldoc,isSuccess)}};var wrapperCallback=function(src,isSuccess){if(isSuccess){var xmlContent=eval(wrapperVarName);var doc=XmlUtility.parse(xmlContent);runCallBack(doc,true)}else{runCallBack(null,false)}};options.timeout=loadTimeout;WebShow.ScriptLoader.load(url,wrapperCallback,options)},getIncludeElements:function(b,c){var a=[];if(!c){c=XmlUtility.DEF_INCLUDE_TAG_NAME}return b.getElementsByTagName(c)},handleIncludedXmlInElement:function(b,n,p){if(!p){p={}}var j=p.includeTagName||XmlUtility.DEF_INCLUDE_TAG_NAME;var o=p.srcAttribName||XmlUtility.DEF_INCLUDE_SRC_ATTRIB;var a=(p.bypassRootElem!=null)?p.bypassRootElem:XmlUtility.DEF_BYPASS_ROOT_ELEM;var k=(n==null);var m=XmlUtility.getXmlDocUrl(b.ownerDocument);var h=XmlUtility.loadHelper.getIncludeElements(b,j);if(!o){var d=null}var e=null;var l=0;var c=h.length;if(c<=0){if(n){n(0)}return null}var f;for(var g=h.length-1;g>=0;--g){e=h[g];d=e.getAttribute(o);if(d){d=WebShow.URL.mergePath(d,m);if(k){f=XmlUtility.loadHelper.loadSimple(d);if(f){XmlUtility.loadHelper.insertIncludedSection(f,e,a)}}else{XmlUtility.loadHelper.loadSimple(d,(function(r,q,i){if(i&&q){f=q;XmlUtility.loadHelper.insertIncludedSection(f,r,a)}l++;if(l==c){n(l)}}).bind(this,e))}}}return b},insertIncludedSection:function(j,h,a){var c=[];if(a){var d=j.documentElement.firstChild;while(d){if(d.nodeType==Node.ELEMENT_NODE){c.push(d)}d=d.nextSibling}}else{c.push(j.documentElement)}var f;var b=h.ownerDocument;var e=b.documentElement;for(var k=0,g=c.length;k<g;++k){var f=c[k];if(b.importNode){f=b.importNode(f,true)}h.parentNode.insertBefore(f,h)}h.parentNode.removeChild(h);return b}},serializeNode:function(b,a){if(a&&a.prettyPrint){return XmlUtility.serializeNodePretty(b)}if(typeof XMLSerializer!="undefined"){return(new XMLSerializer()).serializeToString(b)}else{if(b.xml){return b.xml}else{throw"XML.serialize is not supported or can't serialize "+b}}},serializeNodePretty:function(a){try{return XML((new XMLSerializer()).serializeToString(a)).toXMLString()}catch(b){return XmlUtility.serializeNode(a)}},serializeNodeToJsCode:function(d,a,c){if(!c){c="'"}if(!a){a=XmlUtility.DEF_SERIALIZE_TO_JSCODE_VARNAME}var e=XmlUtility.serializeNode(d);var b=new RegExp(c,"g");e=e.replace(b,"\\"+c);return"var "+a+" = "+c+e+c+";"},parseFromJsWrappedCode:function(code,jsVarName){eval(code);var xmlText=eval(jsVarName);return XmlUtility.parse(xmlText)},getXmlDocUrl:function(a){return a.url||a.documentURI||a.URL||a.location}};var ObjSerializer=Class.create({CLASS_NAME:"ObjSerializer",serializeValue:function(a){return a},deserializeValue:function(b,a){return b},propNameToStorageName:function(a){return a},storageNameToPropName:function(a){return a},getObjCustomSaveMethod:function(a){return(a.doSaveObj)},getObjCustomLoadMethod:function(a){return(a.doLoadObj)},getObjCustomPropSaveMethod:function(a){return(a.doSaveProp)},getObjCustomPropLoadMethod:function(a){return(a.doLoadProp)},isUndefined:function(a){return DataType.isUndefinedValue(a)},isNull:function(a){return(a===null)},isNaN:function(a){return a!=a},isFunction:function(a){return DataType.isFunctionValue(a)},isArray:function(a){return DataType.isArrayValue(a)},isDate:function(a){return DataType.isDateValue(a)},isObject:function(a){return DataType.isObjectValue(a)},isObjectEx:function(a){return DataType.isObjectExValue(a)},isSimpleType:function(b){var a=typeof(b);return(a=="string")||(a=="number")||(a=="boolean")||(a=="undefined")||(this.isNull(b))},isComplexType:function(a){return(!this.isSimpleType(a))},createChildStorageNode:function(c,b,a){},appendArrayItemStorageNode:function(b,c,a){},getNameForArrayItemStorageNode:function(a){var b=this.getDefaultArrayItemStorageName();return b},getChildStorageNode:function(a,b){},getAllArrayItemStorageNodes:function(a){},getAllStoredStorageNames:function(a){},setStorageNodeExplicitType:function(a,b){},getStorageNodeExplicitType:function(a){},getStorageNodeName:function(a){},isComplexStorageNode:function(a){},isComplexArrayItemStorageNode:function(a){},isSimpleStorageNode:function(a){},getValueExplicitType:function(a){if(a instanceof ObjectEx){return a.getClassName()}else{if(this.isObject(a)){return DataType.OBJECT}else{if(this.isArray(a)){return DataType.ARRAY}else{if(this.isDate(a)){return DataType.DATE}else{return(typeof a)}}}}},getDefaultArrayItemStorageName:function(){return"item"},getDefaultDateStorageName:function(){return"date"},save:function save(d,c,b){if(typeof(d)=="object"){var e=this.getObjCustomSaveMethod(d);if(e){return e(d,c,this)}}var a=this.doSave(d,c,b||{});if(a&&this.isFunction(d.saved)){d.saved()}return a},doSave:function(c,b,a){if(typeof(c)=="object"){if(c instanceof ObjectEx){this.doSaveObjectEx(c,b,a)}else{if(this.isArray(c)){this.doSaveArray(c,b)}else{if(this.isDate(c)){this.doSaveDate(c,b)}else{this.doSaveSimpleObject(c,b)}}}}this.setStorageNodeExplicitType(b,this.getValueExplicitType(c));return c},doSaveSimpleObject:function(d,b){for(var e in d){if(!d.hasOwnProperty(e)){continue}var a=d[e];var c;if(this.isComplexType(a)){c=this.getValueExplicitType(a)}this.doSaveFieldValue(d,e,a,b,c)}},doSaveArray:function(b,e){for(var c=0,a=b.length;c<a;++c){var d=b[c];var g=this.getNameForArrayItemStorageNode(d);if(this.isComplexType(d)){var f=this.appendArrayItemStorageNode(e,this.propNameToStorageName(g),this.isArray(d));this.setStorageNodeExplicitType(f,this.getValueExplicitType(d));this.save(d,f)}else{this.doAppendArrayItemSimpleValue(this.serializeValue(d),typeof(d),e)}}},doSaveDate:function(c,b){var a=c.toUTCString();this.doSaveSimpleValue(c,this.propNameToStorageName(this.getDefaultDateStorageName()),this.serializeValue(a),DataType.DATE,b)},doSaveObjectEx:function(f,b,m){var j=f.getAllPropList();var h=m.propFilter;for(var g=0,c=j.getLength();g<c;++g){var a=j.getPropInfoAt(g);var d=h?h(a,f):true;if(!d){continue}var e=this.getObjCustomPropSaveMethod(f);var k=false;if(e){k=e(f,a,b,this)}if(!!k){continue}if(a.serializable){this.doSaveObjectExProp(f,a,b,m)}}},doSaveObjectExProp:function(e,h,c,a){var b=h.name;var g=h.dataType;var f=e.getPropValue(b);if(a.saveDefaultValues||(f!==h.defaultValue)){var d;if(f instanceof ObjectEx){if(f.getClassName()!=g){d=f.getClassName()}}else{if(this.isComplexType(f)){d=this.getValueExplicitType(f);if(d==g){d=undefined}}}this.doSaveFieldValue(e,b,f,c,d)}},doSaveFieldValue:function(d,e,b,a,c){if(typeof(b)!="function"){if(this.isComplexType(b)){subNode=this.createChildStorageNode(a,this.propNameToStorageName(e),this.isArray(b));if(c){this.setStorageNodeExplicitType(subNode,c)}this.save(b,subNode)}else{this.doSaveSimpleValue(d,this.propNameToStorageName(e),this.serializeValue(b),this.getValueExplicitType(b),a)}}},doSaveSimpleValue:function(d,a,c,e,b){},doAppendArrayItemSimpleValue:function(b,c,a){},load:function(c,b){if(!c){var e=this.getStorageNodeExplicitType(b);if(e){c=DataType.createInstance(e)}else{if(this.doLoadUntypedNode){return this.doLoadUntypedNode(b)}else{return null}}}if(typeof(c)==="object"){var d=this.getObjCustomLoadMethod(c);if(d){return d(c,b,this)}}var a=this.doLoad(c,b);if(a&&this.isFunction(c.loaded)){c.loaded()}return a},doLoad:function(c,a){var b=this.getStorageNodeExplicitType(a);if(typeof(c)=="object"){if(c instanceof ObjectEx){c=this.doLoadObjectEx(c,a)}else{if(this.isArray(c)){c=this.doLoadArray(c,a)}else{if(this.isDate(c)){c=this.doLoadDate(c,a)}else{c=this.doLoadSimpleObject(c,a)}}}}return c},doLoadArray:function(j,a){var g=this.getAllArrayItemStorageNodes(a);for(var f=0,c=g.length;f<c;++f){var b=g[f];if(this.isComplexArrayItemStorageNode(b)){var e;var d=this.getStorageNodeExplicitType(b)||this.getStorageNodeName(b);if(d){e=DataType.createInstance(d);this.load(e,b)}else{e={};this.load(e,b)}j.push(e)}else{var h=this.deserializeValue(this.doGetArrayItemSimpleStorageValue(b));j.push(h)}}return j},doLoadDate:function(e,d){var a=this.propNameToStorageName(this.getDefaultDateStorageName());var b=this.doLoadSimpleValue(e,a,DataType.DATE,d);if(b){var c=new Date(b);e.copyFrom(c);return e}else{return undefined}},doLoadSimpleObject:function(d,a){var b=this.getAllStoredStorageNames(a);for(var e=0,c=b.length;e<c;++e){var k=b[e];var j=this.storageNameToPropName(k);var f=this.getChildStorageNode(a,k);if(f){var m;var h=this.getStorageNodeExplicitType(f);if(h){m=DataType.createInstance(h)}else{m={}}this.load(m,f);d[j]=m}else{var g=this.doLoadSimpleValue(d,k,null,a);d[j]=g}}return d},doLoadObjectEx:function(f,e){var d=f.getAllPropList();for(var c=0,a=d.getLength();c<a;++c){var h=d.getPropInfoAt(c);if(!h.serializable){continue}var g=this.getObjCustomPropLoadMethod(f);var b=false;if(g){b=g(f,h,e,this)}if(!!b){continue}this.doLoadObjectExProp(f,h,e)}return f},doLoadObjectExProp:function(c,f,b){var a=f.name;var e=f.dataType;var d=this.doLoadFieldValue(c,a,b,e);if((d!==null)&&(d!==undefined)){c.setPropValue(a,d,true)}},doLoadFieldValue:function(f,h,c,b){var a;var e=false;if(DataType.isComplexType(b)){var g=this.getChildStorageNode(c,this.propNameToStorageName(h));if(g){var d=this.getStorageNodeExplicitType(g);if(d&&(d!=b)){a=DataType.createInstance(d)}else{a=DataType.createInstance(b)}this.load(a,g);e=true}}if(DataType.isSimpleType(b)||(!e)){a=this.doLoadSimpleValue(f,this.propNameToStorageName(h),b,c)}return a},doLoadSimpleValue:function(d,a,e,c){var b=this.doLoadSimpleStorageValue(a,c);return this.deserializeValue(b,e)},doLoadSimpleStorageValue:function(a,b){},doGetArrayItemSimpleStorageValue:function(a){}});var JsonObjSerializer=Class.create(ObjSerializer,{CLASS_NAME:"JsonObjSerializer",TYPE_TAG_NAME:"__type__",createChildStorageNode:function(d,c,b){var a=b?[]:{};d[c]=a;return a},appendArrayItemStorageNode:function(c,d,b){var a=b?[]:{};c.push(a);return a},getChildStorageNode:function(b,c){var a=b[c];if(this.isSimpleType(a)){a=null}return a},getAllArrayItemStorageNodes:function(b){var a=Array.prototype.slice.call(b);return a},getAllStoredStorageNames:function(c){var a=[];for(var b in c){if(c.hasOwnProperty(b)){if(b!=this.TYPE_TAG_NAME){a.push(b)}}}return a},isComplexStorageNode:function(a){return this.isComplexType(a)},isComplexArrayItemStorageNode:function(a){return this.isComplexStorageNode(a)},isSimpleStorageNode:function(a){return this.isSimpleType(a)},setStorageNodeExplicitType:function(a,b){if(!this.isArray(a)){a[this.TYPE_TAG_NAME]=b}},getStorageNodeExplicitType:function(b){var a=b[this.TYPE_TAG_NAME]||null;if((!a)&&this.isArray(b)){return DataType.ARRAY}else{return a}},doSaveSimpleValue:function(d,a,c,e,b){b[a]=c},doAppendArrayItemSimpleValue:function(b,c,a){return a.push(b)},doLoadSimpleStorageValue:function(a,b){return b[a]},doLoadUntypedNode:function(a){return a},doGetArrayItemSimpleStorageValue:function(a){return a}});var XmlObjSerializer=Class.create(ObjSerializer,{CLASS_NAME:"XmlObjSerializer",TYPE_TAG_NAME:"dataType",getLocalName:function(a){return a.localName||a.baseName||a.nodeName},getElemTextValue:function(d){var a="";for(var c=0,b=d.childNodes.length;c<b;++c){if(d.childNodes[c].nodeType==Node.TEXT_NODE){a+=d.childNodes[c].nodeValue}}return a},serializeValue:function(a){return DataType.StringUtils.serializeValue(a)},deserializeValue:function(b,a){return DataType.StringUtils.deserializeValue(b,a)},createChildStorageNode:function(d,c,b){var a=d.ownerDocument.createElement(c);d.appendChild(a);return a},appendArrayItemStorageNode:function(b,c,a){return this.createChildStorageNode(b,c,a)},getAllArrayItemStorageNodes:function(b){var a=[];for(var d=0,c=b.childNodes.length;d<c;++d){var e=b.childNodes[d];if(e.nodeType==Node.ELEMENT_NODE){a.push(e)}}return a},getAllStoredStorageNames:function(f){var a=[];for(var c=0,b=f.childNodes.length;c<b;++c){var d=f.childNodes[c];if(d.nodeType==Node.ELEMENT_NODE){if(this.getLocalName(d)!=this.TYPE_TAG_NAME){a.push(this.getLocalName(d))}}}for(var c=0,b=f.attributes.length;c<b;++c){var e=f.attributes[c];if(this.getLocalName(e)!=this.TYPE_TAG_NAME){a.push(this.getLocalName(e))}}return a},getChildStorageNode:function(b,f){var a=null;for(var d=0,c=b.childNodes.length;d<c;++d){var e=b.childNodes[d];if(e.nodeType==Node.ELEMENT_NODE){if(this.getLocalName(e)==f){a=e}}}return a},isComplexStorageNode:function(a){return a.nodeType==Node.ELEMENT_NODE},isComplexArrayItemStorageNode:function(a){return this.isComplexStorageNode(a)&&(a.attributes.length)&&(!this.getElemTextValue(a).trim())},isSimpleStorageNode:function(a){return a.nodeType==Node.ATTRIBUTE_NODE},setStorageNodeExplicitType:function(a,b){a.setAttribute(this.TYPE_TAG_NAME,b)},getStorageNodeExplicitType:function(a){return a.getAttribute(this.TYPE_TAG_NAME)||null},getStorageNodeName:function(b){var a=b.tagName;if(a==this.getDefaultArrayItemStorageName()){return null}else{return a}},doSaveSimpleObject:function($super,b,a){$super(b,a)},doSaveArray:function($super,a,b){$super(a,b)},doSaveSimpleValue:function(d,a,c,e,b){b.setAttribute(a,c)},doAppendArrayItemSimpleValue:function(c,e,a){var b=this.appendArrayItemStorageNode(a,this.propNameToStorageName(this.getDefaultArrayItemStorageName()),false);var d=b.ownerDocument.createTextNode(c);b.appendChild(d)},doLoadSimpleStorageValue:function(a,b){return b.getAttribute(a)},doGetArrayItemSimpleStorageValue:function(a){return this.getElemTextValue(a)}});var ObjSerializerFactory={_serializerClasses:{},_defaultName:null,registerSerializer:function(a,c,b){var d=(typeof(c)=="string")?ClassEx.findClass(c):c;ObjSerializerFactory._serializerClasses[a]=d;if(b){ObjSerializerFactory._defaultName=a}},getSerializer:function(a){var b=a||ObjSerializerFactory._defaultName;if(b){var c=ObjSerializerFactory._serializerClasses[b];return c?new c():null}else{return null}}};(function(){ObjSerializerFactory.registerSerializer("json",JsonObjSerializer,true);ObjSerializerFactory.registerSerializer("xml",XmlObjSerializer)})();ClassEx.extend(ObjectEx,{saveObj:function(c,a,b){if(!a){serializer=ObjSerializerFactory.getSerializer()}else{if(typeof(a)=="string"){serializer=ObjSerializerFactory.getSerializer(a)}else{serializer=a}}return serializer.save(this,c,b)},loadObj:function(b,a){if(!a){serializer=ObjSerializerFactory.getSerializer()}else{if(typeof(a)=="string"){serializer=ObjSerializerFactory.getSerializer(a)}else{serializer=a}}return serializer.load(this,b)}});Object.extend(ClassEx,{saveObj:function(c,d,a,b){if(!a){serializer=ObjSerializerFactory.getSerializer()}else{if(typeof(a)=="string"){serializer=ObjSerializerFactory.getSerializer(a)}else{serializer=a}}return serializer.save(c,d,b)},loadObj:function(c,b,a){if(!a){serializer=ObjSerializerFactory.getSerializer()}else{if(typeof(a)=="string"){serializer=ObjSerializerFactory.getSerializer(a)}else{serializer=a}}return serializer.load(c,b)}});Object.extend(DataType,{valueToJson:function(c,b){if(DataType.isSimpleValue(c)){return JSON.stringify(c)}else{var a=DataType.isArrayValue(c)?[]:{};ClassEx.saveObj(c,a,"json",b);return JSON.stringify(a)}},jsonToValue:function(a){var b=JSON.parse(a);if(!b||DataType.isSimpleValue(b)){return b}else{return ClassEx.loadObj(null,b,"json")}}});var Kekule={LIBNAME:"Kekule.js",LIBNAME_CORE:"Kekule",VERSION:"0.7.5.170624",LOADED:false,_afterLoadProcedures:[],PROP_AUTO_TITLE:true};Kekule._loaded=function(){Kekule.LOADED=true;var b=Kekule._afterLoadProcedures;while(b.length){var a=b.shift();if(a){a()}}};Kekule._isLoaded=function(){return Kekule.LOADED};Kekule._registerAfterLoadProc=function(a){if(a){Kekule._afterLoadProcedures.push(a)}};Kekule.$jsRoot=this;Kekule.$document=this.document||null;Kekule.scriptSrcInfo=Kekule.$jsRoot["__$kekule_load_info__"];if(Kekule.scriptSrcInfo&&Kekule.scriptSrcInfo.language){Kekule.language=Kekule.scriptSrcInfo.language}if(!Kekule.scriptSrcInfo&&Kekule.$jsRoot.document){Kekule.scriptSrcInfo=(function(){var g=/^(.*\/?)kekule\..*\.js(\?.*)?$/;var f=document.getElementsByTagName("script");var h;for(var d=f.length-1;d>=0;--d){var e=f[d];if(e.src){var b=e.src.match(g);if(b){var c=b[2];if(c){c=c.substr(1)}var a={src:e.src,path:b[1],paramStr:c,useMinFile:true};return a}}}return null})()}Kekule.getScriptPath=function(){return Kekule.scriptSrcInfo.path};if(Kekule.$jsRoot&&Kekule.$jsRoot.addEventListener&&Kekule.$jsRoot.postMessage){Kekule.$jsRoot.addEventListener("message",function(a){if(a.data==="kekule-sys-info-query"){Kekule.$jsRoot.postMessage({msg:"kekule-sys-info-result",libName:Kekule.LIBNAME,version:Kekule.VERSION},"*")}},false)};