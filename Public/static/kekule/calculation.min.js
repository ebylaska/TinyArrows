(function(){Kekule.Calculator={};Kekule.Calculator.getWorkerBasePath=function(){var c=Kekule.scriptSrcInfo.useMinFile;var b=c?"workers/":"calculation/workers/";b=Kekule.scriptSrcInfo.path+b;return b};Kekule.Calculator.Base=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Calculator.Base",initProperties:function(){this.defineProp("async",{dataType:DataType.BOOL});this.defineProp("worker",{dataType:DataType.OBJECT,setter:null})},initPropValues:function($super){$super();this.setAsync(true);this.reactWorkerMessageBind=this.reactWorkerMessage.bind(this);this.reactWorkerErrorBind=this.reactWorkerError.bind(this)},getWorkerBasePath:function(){return Kekule.Calculator.getWorkerBasePath()},execute:function(i,c){var d=this;this._doneCallback=i;this._errCallback=c;if(this.getAsync()&&this.isWorkerSupported()&&this.createWorker()){var b=this.getWorker();this.workerStartCalc(b)}else{var g,f;try{f=this.executeSync(i)}catch(h){g=h}if(g){Kekule.error(g);this.error(g)}else{if(f){if(g){this.error(g)}else{this.done()}}}}},executeSync:function(b){},error:function(b){Kekule.error(b);if(this._errCallback){this._errCallback(b)}},done:function(){if(this._doneCallback){this._doneCallback.apply(this,arguments)}this.workerJobDone()},halt:function(){var b=this.getWorker();if(b){b.terminate();this.error(Kekule.$L("ErrorMsg.CALC_TERMINATED_BY_USER"))}},isWorkerSupported:function(){return Kekule.BrowserFeature.workers},createWorker:function(){if(this.isWorkerSupported()){var c=this.getWorkerScriptFile();if(c){var b=new Worker(c);b.addEventListener("message",this.reactWorkerMessageBind);b.addEventListener("error",this.reactWorkerErrorBind);this.setPropStoreFieldValue("worker",b);return b}}},getWorkerScriptFile:function(){return null},importWorkerScriptFile:function(b){this.postWorkerMessage({type:"importScript",url:b})},postWorkerMessage:function(c){var b=this.getWorker();if(b){b.postMessage(c)}},reactWorkerMessage:function(b){return this.doReactWorkerMessage(b.data,b)},doReactWorkerMessage:function(b,c){},reactWorkerError:function(b){Kekule.error(b.message);this.error(b.message)},workerStartCalc:function(b){},workerJobDone:function(){var b=this.getWorker();if(b){b.terminate();this.setPropStoreFieldValue("worker",null)}}});Kekule.Calculator.AbstractStructure3DGenerator=Class.create(Kekule.Calculator.Base,{CLASS_NAME:"Kekule.Calculator.AbstractStructure3DGenerator",initProperties:function(){this.defineProp("sourceMol",{dataType:"Kekule.StructureFragment",serializable:false});this.defineProp("generatedMol",{dataType:"Kekule.StructureFragment",serializable:false});this.defineProp("options",{dataType:DataType.HASH,getter:function(){var b=this.getPropStoreFieldValue("options");if(!b){b={};this.setPropStoreFieldValue("options",b)}return b}})}});Kekule.Calculator.ServiceManager={_services:{},_getServiceClasses:function(c,d){var b=a._services[c];if(!b&&d){b=[];a._services[c]=b}return b},register:function(d,e){var c=a._getServiceClasses(d,true);var b=c.indexOf(e);if(b>=0){c.splice(b,1)}c.push(e)},unregister:function(d,e){var c=a._getServiceClasses(d,true);var b=c.indexOf(e);if(b>=0){c.splice(b,1)}},getServiceClass:function(d){var b=null;var c=a._getServiceClasses(d);if(c&&c.length){b=c[c.length-1]}return b}};var a=Kekule.Calculator.ServiceManager;Kekule.Calculator.Services={GEN3D:"3D structure generator"};Kekule.Calculator.generate3D=function(l,n,m,i){var h=Kekule.Calculator.Services.GEN3D;var k=a.getServiceClass(h);if(k){var b=new k();try{var d=function(){if(m){m(b.getGeneratedMol())}};var j=function(c){if(i){i(c)}};try{b.setSourceMol(l);b.setOptions(n);b.execute(d,j)}catch(g){j(g)}}finally{return b}}else{var f=Kekule.$L("ErrorMsg.CALC_SERVICE_UNAVAILABLE").format(h);if(m){m(f)}return null}}})();