Kekule.Operation=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Operation",initialize:function($super){$super()},initProperties:function(){},isReversible:function(){return true},execute:function(){var a=this.doExecute();return a},doExecute:function(){},reverse:function(){if(!this.isReversible()){Kekule.raise(Kekule.$L("ErrorMsg.COMMAND_NOT_REVERSIBLE"))}var a=this.doReverse();return a},doReverse:function(){}});Kekule.Operation.State={UNEXECUTED:0,EXECUTED:1};Kekule.MacroOperation=Class.create(Kekule.Operation,{CLASS_NAME:"Kekule.MacroOperation",initialize:function($super,a){$super();this.setChildren(a||[])},initProperties:function(){this.defineProp("children",{dataType:DataType.ARRAY})},isReversible:function(){var c=this.getChildren();for(var b=0,a=c.length;b<a;++b){if(!c[b].isReversible()){return false}}return true},doExecute:function(){var c=this.getChildren();for(var b=0,a=c.length;b<a;++b){c[b].execute()}},doReverse:function(){var b=this.getChildren();for(var a=b.length-1;a>=0;--a){b[a].reverse()}},add:function(a){return this.getChildren().push(a)},remove:function(c){var b=this.getChildren();var a=b.indexOf(c);if(a>=0){return b.splice(a,1)}else{return null}},getChildAt:function(a){return this.getChildren()[a]},getChildCount:function(){return this.getChildren().length}});Kekule.OperationHistory=Class.create(ObjectEx,{CLASS_NAME:"Kekule.OperationHistory",initialize:function($super,a){$super();this.setCapacity(a||null)},initProperties:function(){this.defineProp("capacity",{dataType:DataType.INT});this.defineProp("operations",{dataType:DataType.ARRAY,getter:function(){var a=this.getPropStoreFieldValue("operations");if(!a){a=[];this.setPropStoreFieldValue("operations",a)}return a}});this.defineProp("currIndex",{dataType:DataType.INT,serializable:false});this.defineEvent("push");this.defineEvent("pop");this.defineEvent("undo");this.defineEvent("redo")},checkCapacity:function(){var d=this.getCapacity();if((!d)||(d<=0)){return}var b=this.getPropStoreFieldValue("operations");while(b&&(b.length>d)){b.shift();if(this.getCurrIndex()>0){this.setCurrIndex(this.getCurrIndex()-1)}}},getOperationCount:function(){return this.getOperations().length},getOperationAt:function(a){return this.getOperations()[a]},getCurrOperation:function(){var a=this.getCurrIndex();if(a>=0){return this.getOperations()[a]}else{return null}},clear:function(){this.setOperations([]);this.setCurrIndex(-1);this.invokeEvent("clear",{currOperIndex:this.getCurrIndex()});this.invokeEvent("operChange")},push:function(c){var b=this.getOperations();var d=this.getCurrIndex();if(d<b.length){b.splice(d+1,b.length-d-1)}b.push(c);this.setCurrIndex(b.length-1);this.checkCapacity();this.invokeEvent("push",{operation:c,currOperIndex:this.getCurrIndex()});this.invokeEvent("operChange")},pop:function(){var a;var b=this.getCurrIndex();if(this.canPop()){a=this.getOperations()[b];this.setCurrIndex(--b);this.invokeEvent("pop",{operation:a,currOperIndex:this.getCurrIndex()});this.invokeEvent("operChange")}else{a=null}return a},canPop:function(){var a=this.getCurrIndex();return((a>=0)&&(!!this.getOperations().length))},unpop:function(){var b;var d=this.getCurrIndex();var c=this.getOperations();if(this.canUnpop()){this.setCurrIndex(++d);b=this.getOperations()[d]}else{b=null}return b},canUnpop:function(){var a=this.getCurrIndex();return(a<this.getOperations().length-1)},undo:function(){var a=this.pop();if(a&&a.isReversible()){a.reverse()}this.invokeEvent("undo",{operation:a,currOperIndex:this.getCurrIndex()});this.invokeEvent("operChange");return a},undoAll:function(){while(this.canUndo){this.undo()}},canUndo:function(){return this.canPop()},redo:function(){var a=this.unpop();if(a){a.execute()}this.invokeEvent("redo",{operation:a,currOperIndex:this.getCurrIndex()});this.invokeEvent("operChange");return a},canRedo:function(){return this.canUnpop()}});(function(){Kekule.Action=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Action",HTML_CLASSNAME:null,initialize:function($super){$super();this.setPropStoreFieldValue("linkedWidgets",[]);this.setPropStoreFieldValue("enabled",true);this.setPropStoreFieldValue("visible",true);this.setPropStoreFieldValue("displayed",true);this.setPropStoreFieldValue("htmlClassName",this.getInitialHtmlClassName());this.setBubbleEvent(true);this.reactWidgetExecuteBind=this.reactWidgetExecute.bind(this)},finalize:function($super){var b=this.getOwner();if(b&&b.actionRemoved){b.actionRemoved(this)}this.unlinkAllWidgets();this.setPropStoreFieldValue("linkedWidgets",[]);$super()},initProperties:function(){this.defineProp("enabled",{dataType:DataType.BOOL,setter:function(b){if(b!==this.getEnabled()){this.setPropStoreFieldValue("enabled",b);this.updateAllWidgetsProp("enabled",b)}}});this.defineProp("visible",{dataType:DataType.BOOL,setter:function(b){if(b!==this.getVisible()){this.setPropStoreFieldValue("visible",b);this.updateAllWidgetsProp("visible",b)}}});this.defineProp("displayed",{dataType:DataType.BOOL,setter:function(b){if(b!==this.getDisplayed()){this.setPropStoreFieldValue("displayed",b);this.updateAllWidgetsProp("displayed",b)}}});this.defineProp("checked",{dataType:DataType.BOOL,setter:function(b){if(b!==this.getChecked()){this.setPropStoreFieldValue("checked",b);this.updateAllWidgetsProp("checked",b);this.checkedChanged()}}});this.defineProp("checkGroup",{dataType:DataType.STRING});this.defineProp("hint",{dataType:DataType.STRING,setter:function(b){if(b&&(b!==this.getHint())){this.setPropStoreFieldValue("hint",b);this.updateAllWidgetsProp("hint",b)}}});this.defineProp("text",{dataType:DataType.STRING,setter:function(b){if(b&&(b!==this.getText())){this.setPropStoreFieldValue("text",b);this.updateAllWidgetsProp("text",b)}}});this.defineProp("htmlClassName",{dataType:DataType.STRING,setter:function(c){var b=this.getHtmlClassName();this.setPropStoreFieldValue("htmlClassName",c);this.updateAllWidgetClassName(c,b)}});this.defineProp("owner",{dataType:DataType.OBJECT,serializable:false,setter:null});this.defineProp("linkedWidgets",{dataType:DataType.ARRAY,serializable:false,setter:null});this.defineProp("invoker",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:null})},getHigherLevelObj:function(){return this.getOwner()},invokeEvent:function($super,b,c){if(!c){c={}}if(!c.invoker){c.invoker=this.getInvoker()}$super(b,c)},getInitialHtmlClassName:function(){return this.HTML_CLASSNAME||null},getActionList:function(){var b=this.getOwner();return(b instanceof Kekule.ActionList)?b:null},checkedChanged:function(){var b=this.getActionList();if(b){b.actionCheckedChanged(this)}},linkWidget:function(c){var b=this.getLinkedWidgets();if(b.indexOf(c)<0){var e=this.getText();if(e){this.updateWidgetProp(c,"text",e)}var d=this.getHint();if(d){this.updateWidgetProp(c,"hint",d)}this.updateWidgetProp(c,"enabled",this.getEnabled());this.updateWidgetProp(c,"displayed",this.getDisplayed());this.updateWidgetProp(c,"visible",this.getVisible());this.updateWidgetProp(c,"checked",this.getChecked());this.updateWidgetClassName(c,this.getHtmlClassName(),null);c.addEventListener("execute",this.reactWidgetExecuteBind);b.push(c);return this}},unlinkWidget:function(d){var c=this.getLinkedWidgets();var b=c.indexOf(d);if(b>=0){this.updateWidgetClassName(d,null,this.getHtmlClassName());d.removeEventListener("execute",this.reactWidgetExecuteBind);c.splice(b,1)}},unlinkAllWidgets:function(){var c=this.getLinkedWidgets();for(var b=c.length-1;b>=0;--b){this.unlinkWidget(c[b])}},reactWidgetExecute:function(b){return this.execute(b.target,b.htmlEvent)},execute:function(d,b){var c=this.getChecked();if(!this.getCheckGroup()||!c){this.doExecute(d,b);if(this.getCheckGroup()){this.setChecked(true)}}this.setPropStoreFieldValue("invoker",d);this.invokeEvent("execute",{htmlEvent:b});return this},doExecute:function(c,b){},update:function(){this.doUpdate();return this},doUpdate:function(){},updateAllWidgetsProp:function(f,g){var e=this.getLinkedWidgets();for(var d=0,c=e.length;d<c;++d){var b=e[d];this.updateWidgetProp(b,f,g)}},updateWidgetProp:function(c,b,d){if(c.hasProperty(b)){c.setPropValue(b,d)}},updateWidgetClassName:function(c,d,b){if(b){c.removeClassName(b,true)}if(d){c.addClassName(d,true)}},updateAllWidgetClassName:function(g,b){var f=this.getLinkedWidgets();for(var e=0,d=f.length;e<d;++e){var c=f[e];this.updateWidgetClassName(c,g,b)}}});Kekule.ActionList=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ActionList",initialize:function($super){$super();this.setPropStoreFieldValue("actions",[]);this.setPropStoreFieldValue("ownActions",true);this.setPropStoreFieldValue("autoUpdate",true);this.reactActionExecutedBind=this.reactActionExecuted.bind(this);this.addEventListener("execute",this.reactActionExecutedBind)},finalize:function($super){this.removeEventListener("execute",this.reactActionExecutedBind);this.clear();this.setPropStoreFieldValue("actions",null);$super()},initProperties:function(){this.defineProp("actions",{dataType:DataType.ARRAY,serializable:false,setter:null});this.defineProp("ownActions",{dataType:DataType.BOOL});this.defineProp("autoUpdate",{dataType:DataType.BOOL,setter:function(b){this.setPropStoreFieldValue("autoUpdate",b);if(b){this.updateAll()}}})},hasActionChecked:function(b){return !!this.getCheckedAction(b)},getCheckedAction:function(e){var f=this.getActions();for(var d=0,c=f.length;d<c;++d){var b=f[d];if((b.getCheckGroup()===e)&&(b.getChecked())){return b}}return null},actionAdded:function(c){if(this.getOwnActions()){var b=c.getOwner();if(b&&b.actionRemoved){b.actionRemoved(c)}c.setPropStoreFieldValue("owner",this)}Kekule.ArrayUtils.pushUnique(this.getActions(),c);c.update()},actionRemoved:function(b){Kekule.ArrayUtils.remove(this.getActions(),b);b.setPropStoreFieldValue("owner",null)},actionCheckedChanged:function(e){if(e&&e.getChecked()){var f=e.getCheckGroup();if(f){var g=this.getActions();for(var d=0,c=g.length;d<c;++d){var b=g[d];if((b!==e)&&(b.getCheckGroup()===f)&&(b.getChecked())){b.setChecked(false)}}}}},reactActionExecuted:function(b){if(b.target instanceof Kekule.Action){this.invokeEvent("execute",{action:b.target});if(this.getAutoUpdate()){this.updateAll()}}},getActionCount:function(){return this.getActions().length},getActionLength:function(){return this.getActions().length},getActionAt:function(b){return this.getActions()[b]},indexOfAction:function(b){return this.getActions().indexOf(b)},hasAction:function(b){return this.indexOfAction(b)>=0},add:function(b){this.actionAdded(b);return this},remove:function(b){this.actionRemoved(b);if(this.getOwnActions()){b.finalize()}return this},removeAt:function(b){var d=this.getActions();var c=d[b];if(c){Kekule.ArrayUtils.removeAt(d,b);this.actionRemoved(c)}return this},clear:function(){var c=this.getActions();for(var b=c.length-1;b>=0;--b){this.actionRemoved(c[b])}this.setPropStoreFieldValue("actions",[]);return this},updateAll:function(){var d=this.getActions();for(var c=0,b=d.length;c<b;++c){d[c].update()}return this}});Kekule.ActionFileOpen=Class.create(Kekule.Action,{CLASS_NAME:"Kekule.ChemWidget.ActionFileOpen",initialize:function($super){$super()},initProperties:function(){this.defineProp("filters",{dataType:DataType.ARRAY})},doUpdate:function($super){$super();this.setEnabled(this.getEnabled()&&Kekule.NativeServices.showFilePickerDialog)},doExecute:function(f){var d=f.getElement();var e=d.ownerDocument;var c=this;var b=this.getInvoker();this.openFilePicker(e,function(g,i,h){if(g){c.fileOpened(h,b)}})},openFilePicker:function(b,c){return Kekule.NativeServices.showFilePickerDialog(b,c,{mode:"open",filters:this.getFilters()})},fileOpened:function(c,b){this.doFileOpened(c,b);this.invokeEvent("open",{files:c,file:c[0]})},doFileOpened:function(c,b){}});Kekule.ActionLoadFileData=Class.create(Kekule.Action,{CLASS_NAME:"Kekule.ChemWidget.ActionLoadFileData",initialize:function($super){$super()},initProperties:function(){this.defineProp("filters",{dataType:DataType.ARRAY})},doUpdate:function($super){$super();this.setEnabled(this.getEnabled()&&Kekule.NativeServices.canLoadFileData())},doExecute:function(f){var d=f.getElement();var e=d.ownerDocument;var c=this;var b=this.getInvoker();this.loadFileData(e,function(g,h,i){c.dataLoaded(h,i,!!g,b)})},loadFileData:function(b,c){return Kekule.NativeServices.loadFileData(b,c,{filters:this.getFilters()})},reactFileLoad:function(b,c,d){this.dataLoaded(c,d,!!b)},dataLoaded:function(d,e,c,b){this.doDataLoaded(d,e,c,b);this.invokeEvent("load",{fileName:e,data:d,success:c})},doDataLoaded:function(d,e,c,b){}});Kekule.ActionFileSave=Class.create(Kekule.Action,{CLASS_NAME:"Kekule.ChemWidget.ActionFileSave",initialize:function($super,b,c){$super();if(b){this.setData(b)}if(c){this.setFileName(c)}},initProperties:function(){this.defineProp("data",{dataType:DataType.STRING,serializable:false});this.defineProp("fileName",{dataType:DataType.STRING,serializable:false});this.defineProp("filters",{dataType:DataType.ARRAY})},doUpdate:function($super){$super();this.setEnabled(this.getEnabled()&&Kekule.NativeServices.canSaveFileData())},doExecute:function(d){var c;if(!d){c=document}else{var b=d.getElement();c=b.ownerDocument}Kekule.NativeServices.saveFileData(c,this.getData(),null,{initialFileName:this.getFileName(),filters:this.getFilters()})}});Kekule.ActionManager={_namedActionMap:null,_getNamedActionMap:function(c){var b=a._namedActionMap;if(!b&&c){b=new Kekule.MapEx();a._namedActionMap=b}return b},getRegisteredActionsOfClass:function(d,e){var c=a._getNamedActionMap(e);if(c){var b=c.get(d);if(!b&&e){b={};c.set(d,b)}return b}else{return null}},registerNamedActionClass:function(b,d,c){var e=a.getRegisteredActionsOfClass(c,true);e[b]=d},unregisterNamedActionClass:function(b,c){var d=a.getRegisteredActionsOfClass(c,false);if(d&&d[b]){delete d[b]}},getActionClassOfName:function(d,c,f){var h=ClassEx.isClass(c)?c:(c.getClass&&c.getClass());if(!h){return null}var g=a.getRegisteredActionsOfClass(h,false);var b=g&&g[d];if(!b&&f){var e=ClassEx.getSuperClass(h);b=e?a.getActionClassOfName(d,e,f):null}return b}};var a=Kekule.ActionManager})();(function(){Kekule.DataBingItem=Class.create(ObjectEx,{CLASS_NAME:"Kekule.DataBingItem",initialize:function($super,c,a,d,b){$super();this.setSource(c);this.setSourceName(a);this.setTarget(d);this.setTargetName(b)},initProperties:function(){this.defineProp("source",{dataType:DataType.OBJECTEX,serializable:false});this.defineProp("sourceName",{dataType:DataType.STRING,serializable:false});this.defineProp("target",{dataType:DataType.OBJECTEX,serializable:false});this.defineProp("targetName",{dataType:DataType.STRING,serializable:false})},updateData:function(a){var f=this.getSource();var e=this.getTarget();var c=this.getSourceName();var b=this.getTargetName();if(f&&e&&c&&b){if(a){var d=e.getDataByBindingName(b);f.setDataByBindingName(c,d)}else{var d=f.getDataByBindingName(sourceName);e.setDataByBindingName(b,d)}}}});ClassEx.extend(ObjectEx,{getDataByBindingName:function(a){if(this.hasProperty(a)){return this.getPropValue(a)}else{if(DataType.isFunctionValue(this[a])){return this[a]()}}},setDataByBindingName:function(c,d){var b=d;var a=this.getPropInfo(c);if(a){var e=a.dataType;var f=DataType.getType(d);if((e!==f)&&(f===DataType.STRING)){b=DataType.StringUtils.deserializeValue(d)}}this.setPropValue(c,b);return this},createDataBinding:function(d,c,b){var a=new Kekule.DataBingItem(d,c,this,b);this.getDataBindings(true).push(a);return a},removeDataBinding:function(a){Kekule.ArrayUtils.remove(this.getDataBindings(),a)},updateBindingData:function(c){var b=this.getDataBindings();if(b&&b.length){for(var d=0,a=b.length;d<a;++d){b[d].updateData(c)}}}});ClassEx.defineProp(ObjectEx,"dataBindings",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PRIVATE,getter:function(b){var a=this.getPropStoreFieldValue("dataBindings");if(!a&&b){a=[];this.setPropStoreFieldValue("dataBindings",a)}return a}})})();(function(){var a=Kekule.ArrayUtils;var e=Kekule.HtmlElementUtils;Kekule.Widget={DEF_EVENT_HANDLER_PREFIX:"react_",DEF_TOUCH_GESTURE_HANDLER_PREFIX:"react_touch_",getEventHandleFuncName:function(f){return Kekule.Widget.DEF_EVENT_HANDLER_PREFIX+f},getTouchGestureHandleFuncName:function(f){return Kekule.Widget.DEF_EVENT_HANDLER_PREFIX+f}};Kekule.Widget.HtmlClassNames={BASE:"K-Widget",DYN_CREATED:"K-Dynamic-Created",NORMAL_BACKGROUND:"K-Normal-Background",NONSELECTABLE:"K-NonSelectable",SELECTABLE:"K-Selectable",STATE_NORMAL:"K-State-Normal",STATE_DISABLED:"K-State-Disabled",STATE_HOVER:"K-State-Hover",STATE_ACTIVE:"K-State-Active",STATE_FOCUSED:"K-State-Focused",STATE_SELECTED:"K-State-Selected",STATE_CHECKED:"K-State-Checked",SHOW_POPUP:"K-Show-Popup",SHOW_DIALOG:"K-Show-Dialog",SHOW_ACTIVE_MODAL:"K-Show-ActiveModal",PART_CONTENT:"K-Content",PART_TEXT_CONTENT:"K-Text-Content",PART_ASSOC_TEXT_CONTENT:"K-Assoc-Text-Content",PART_IMG_CONTENT:"K-Img-Content",PART_GLYPH_CONTENT:"K-Glyph-Content",PART_PRI_GLYPH_CONTENT:"K-Pri-Glyph-Content",PART_ASSOC_GLYPH_CONTENT:"K-Assoc-Glyph-Content",PART_DECORATION_CONTENT:"K-Decoration-Content",PART_ERROR_REPORT:"K-Error-Report",FIRST_CHILD:"K-First-Child",LAST_CHILD:"K-Last-Child",TEXT_NO_WRAP:"K-No-Wrap",LAYOUT_H:"K-Layout-H",LAYOUT_V:"K-Layout-V",CORNER_ALL:"K-Corner-All",CORNER_LEFT:"K-Corner-Left",CORNER_RIGHT:"K-Corner-Right",CORNER_TOP:"K-Corner-Top",CORNER_BOTTOM:"K-Corner-Bottom",CORNER_TL:"K-Corner-TL",CORNER_TR:"K-Corner-TR",CORNER_BL:"K-Corner-BL",CORNER_BR:"K-Corner-BR",CORNER_LEADING:"K-Corner-Leading",CORNER_TAILING:"K-Corner-Tailing",FULLFILL:"K-Fulfill",NOWRAP:"K-No-Wrap",HIDE_TEXT:"K-Text-Hide",HIDE_GLYPH:"K-Glyph-Hide",SHOW_TEXT:"K-Text-Show",SHOW_GLYPH:"K-Glyph-Show",MODAL_BACKGROUND:"K-Modal-Background"};var c=Kekule.Widget.HtmlClassNames;Kekule.Widget.Layout={HORIZONTAL:1,VERTICAL:2};Kekule.Widget.Position={AUTO:0,TOP:1,LEFT:2,BOTTOM:4,RIGHT:8,TOP_LEFT:3,TOP_RIGHT:9,BOTTOM_LEFT:6,BOTTOM_RIGHT:12};Kekule.Widget.Direction={AUTO:0,LTR:1,TTB:2,RTL:4,BTT:8,isInHorizontal:function(g){var f=Kekule.Widget.Direction;return !!((g&f.LTR)||(g&f.RTL))},isInVertical:function(g){var f=Kekule.Widget.Direction;return !!((g&f.TTB)||(g&f.BTT))}};Kekule.Widget.State={NORMAL:0,FOCUSED:1,HOVER:2,ACTIVE:3,DISABLED:-1};var b=Kekule.Widget.State;Kekule.Widget.ShowHideType={DROPDOWN:1,POPUP:2,DIALOG:3,DEFAULT:0};Kekule.Widget.UiEvents=["click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup","mousewheel","keydown","keyup","keypress","touchstart","touchend","touchcancel","touchleave","touchmove"];Kekule.Widget.UiLocalEvents=["blur","focus","mouseenter","mouseleave"];Kekule.Widget.TouchGestures=["hold","tap","doubletap","swipe","swipeup","swipedown","swipeleft","swiperight","transform","transformstart","transformend","rotate","pinch","pinchin","pinchout","touch","release"];var d="__$kekule_widget__";Kekule.Widget.BaseWidget=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.BaseWidget",BINDABLE_TAG_NAMES:null,DEF_PERIODICAL_EXEC_DELAY:500,DEF_PERIODICAL_EXEC_INTERVAL:100,STYLE_RES_FIELD:"__$style_resources__",initialize:function($super,f,g){this._stateClassName=null;this._isDismissed=false;this._pendingHtmlClassNames="";this._reactElemAttribMutationBind=this._reactElemAttribMutation.bind(this);this.setPropStoreFieldValue("inheritEnabled",true);this.setPropStoreFieldValue("inheritStatic",true);this.setPropStoreFieldValue("selfEnabled",true);this.setPropStoreFieldValue("selfStatic",false);this.setPropStoreFieldValue("periodicalExecDelay",this.DEF_PERIODICAL_EXEC_DELAY);this.setPropStoreFieldValue("periodicalExecInterval",this.DEF_PERIODICAL_EXEC_INTERVAL);$super();this.setPropStoreFieldValue("isDumb",!!g);if(!g){this.reactUiEventBind=this.reactUiEvent.bind(this)}if(f){if(f instanceof Kekule.Widget.BaseWidget){this.setDocument(f.getDocument());this.createElement();this.setParent(f)}else{if(f.documentElement){this.setDocument(f);this.createElement()}else{this.setDocument(f.ownerDocument);this.setElement(f)}}}this._stateClassName=null;this._layoutClassName=null;if(!this.getLayout()){this.setLayout(Kekule.Widget.Layout.HORIZONTAL)}this.setDraggable(false);this._periodicalExecBind=this._periodicalExec.bind(this);this.setBubbleEvent(true);this.setInheritBubbleUiEvents(true);this.stateChanged();if(Kekule.Widget.globalManager){Kekule.Widget.globalManager.notifyWidgetCreated(this)}},initProperties:function(){this.defineProp("isDumb",{dataType:DataType.BOOL,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:function(g){if(this.getIsDumb()!=g){this.setPropStoreFieldValue("isDumb",g);var f=this.getElement();if(f){if(g){this.uninstallUiEventHandlers(f)}else{this.installUiEventHandlers(f)}}}}});this.defineProp("bubbleUiEvents",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC});this.defineProp("inheritBubbleUiEvents",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC});this.defineProp("parent",{dataType:"Kekule.Widget.BaseWidget",serializable:false,scope:Class.PropertyScope.PUBLISHED,setter:function(g){var f=this.getParent();if(f){f._removeChild(this)}if(g){g._addChild(this)}this.setPropStoreFieldValue("parent",g)}});this.defineProp("childWidgets",{dataType:DataType.ARRAY,serializable:false,setter:null,scope:Class.PropertyScope.PUBLIC,getter:function(){var f=this.getPropStoreFieldValue("childWidgets");if(!f){f=[];this.setPropStoreFieldValue("childWidgets",f)}return f}});this.defineProp("document",{dataType:DataType.OBJECT,serializable:false,scope:Class.PropertyScope.PUBLIC});this.defineProp("element",{dataType:DataType.OBJECT,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:function(g){var f=this.getElement();if(g!==f){this.setPropStoreFieldValue("element",g);this.elementChanged(g,f)}}});this.defineProp("observeElementAttribChanges",{dataType:DataType.BOOL,setter:function(f){if(!!f!==!!this.getObserveElementAttribChanges()){this.setPropStoreFieldValue("observeElementAttribChanges",f);this.observeElementAttribChangesChanged(!!f)}}});this.defineElemAttribMappingProp("id","id");this.defineElemAttribMappingProp("draggable","draggable");this.defineElemStyleMappingProp("width","width");this.defineElemStyleMappingProp("height","height");this.defineProp("offsetParent",{dataType:DataType.OBJECT,serializable:false,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getElement().offsetParent},setter:null});this.defineProp("offsetLeft",{dataType:DataType.INT,serializable:false,getter:function(){return this.getElement().offsetLeft},setter:null});this.defineProp("offsetTop",{dataType:DataType.INT,serializable:false,getter:function(){return this.getElement().offsetTop},setter:null});this.defineProp("offsetWidth",{dataType:DataType.INT,serializable:false,getter:function(){return this.getElement().offsetWidth},setter:null});this.defineProp("offsetHeight",{dataType:DataType.INT,serializable:false,getter:function(){return this.getElement().offsetHeight},setter:null});this.defineProp("innerHTML",{dataType:DataType.STRING,serializable:false,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getElement().innerHTML},setter:function(f){this.getElement().innerHTML=f}});this.defineProp("style",{dataType:DataType.OBJECT,serializable:false,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getElement().style},setter:null});this.defineProp("cssText",{dataType:DataType.STRING,serializable:false,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getElement().style.cssText},setter:function(f){this.getElement().style.cssText=f}});this.defineProp("htmlClassName",{dataType:DataType.STRING,serializable:false,scope:Class.PropertyScope.PUBLIC,getter:function(){return this.getElement().className},setter:function(f){this.getElement().className=f}});this.defineProp("customHtmlClassName",{dataType:DataType.STRING,scope:Class.PropertyScope.PUBLIC,setter:function(h){var g=this.getElement();var f=this.getCustomHtmlClassName();if(g&&(f!==h)){if(f){e.removeClass(g,f)}if(h){e.addClass(g,h)}this.setPropStoreFieldValue("customHtmlClassName",h)}}});this.defineProp("visible",{dataType:DataType.BOOL,serializable:false,getter:function(){return Kekule.StyleUtils.isVisible(this.getElement())},setter:function(g,f){Kekule.StyleUtils.setVisibility(this.getElement(),g);if(!f){this.widgetShowStateChanged(this.isShown())}}});this.defineProp("displayed",{dataType:DataType.BOOL,serializable:false,getter:function(){return Kekule.StyleUtils.isDisplayed(this.getElement())},setter:function(g,f){Kekule.StyleUtils.setDisplay(this.getElement(),g);if(!f){this.widgetShowStateChanged(this.isShown())}}});this.defineProp("showHideType",{dataType:DataType.INT,serializable:false,scope:Class.PropertyScope.PRIVATE});this.defineProp("showHideCaller",{dataType:"Kekule.Widget.BaseWidget",serializable:false,scope:Class.PropertyScope.PRIVATE});this.defineProp("showHideCallerPageRect",{dataType:DataType.HASH,serializable:false,scope:Class.PropertyScope.PRIVATE});this.defineProp("finalizeAfterHiding",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC});this.defineProp("layout",{dataType:DataType.INT,setter:function(f){if(this.getPropStoreFieldValue("layout")!==f){this.setPropStoreFieldValue("layout",f);this.layoutChanged()}}});this.defineProp("useCornerDecoration",{dataType:DataType.BOOL,setter:function(f){this.setPropStoreFieldValue("useCornerDecoration",f);if(!f){this.removeClassName(c.CORNER_ALL)}else{this.addClassName(c.CORNER_ALL)}}});this.defineProp("showText",{dataType:DataType.BOOL,setter:function(f){this.setPropStoreFieldValue("showText",f);if(f){this.removeClassName(c.HIDE_TEXT);this.addClassName(c.SHOW_TEXT)}else{this.addClassName(c.HIDE_TEXT);this.removeClassName(c.SHOW_TEXT)}}});this.defineProp("showGlyph",{dataType:DataType.BOOL,setter:function(f){this.setPropStoreFieldValue("showGlyph",f);if(f){this.removeClassName(c.HIDE_GLYPH);this.addClassName(c.SHOW_GLYPH)}else{this.addClassName(c.HIDE_GLYPH);this.removeClassName(c.SHOW_GLYPH)}}});this.defineProp("allowTextWrap",{dataType:DataType.BOOL,serialzable:false,setter:function(f){if(f){this.removeClassName(c.TEXT_NO_WRAP)}else{this.addClassName(c.TEXT_NO_WRAP)}}});this.defineProp("selfEnabled",{dataType:DataType.BOOL,scope:Class.PropertyScope.PRIVATE});this.defineProp("inheritEnabled",{dataType:DataType.BOOL,setter:function(f){this.setPropStoreFieldValue("inheritEnabled",f);this.stateChanged()}});this.defineProp("enabled",{dataType:DataType.BOOL,serializable:false,getter:function(){var f=this.getPropStoreFieldValue("selfEnabled");if(this.getInheritEnabled()){var g=this.getParent();if(g){f=f&&g.getEnabled()}}return f},setter:function(g){var f=this.getElement();if(!g){f.setAttribute("disabled","true")}else{f.removeAttribute("disabled")}var f=this.getCoreElement();if(f!=this.getElement()){if(!g){f.setAttribute("disabled","true")}else{f.removeAttribute("disabled")}}this.setPropStoreFieldValue("selfEnabled",g);this.stateChanged()}});this.defineProp("selfStatic",{dataType:DataType.BOOL,scope:Class.PropertyScope.PRIVATE});this.defineProp("inheritStatic",{dataType:DataType.BOOL,setter:function(f){this.setPropStoreFieldValue("inheritStatic",f);this.stateChanged()}});this.defineProp("static",{dataType:DataType.BOOL,serializable:false,getter:function(){var f=this.getPropStoreFieldValue("selfStatic");if(this.getInheritStatic()){var g=this.getParent();if(g){f=f||g.getStatic()}}return f},setter:function(f){this.setPropStoreFieldValue("selfStatic",f);this.stateChanged()}});this.defineProp("inheritState",{dataType:DataType.BOOL,setter:function(f){this.setPropStoreFieldValue("inheritState",f);this.stateChanged()}});this.defineProp("state",{dataType:DataType.INT,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){var f;if(this.getInheritState()){var g=this.getParent();if(g){f=g.getState()}}else{if(!this.getEnabled()){f=b.DISABLED}else{f=this.getIsActive()?b.ACTIVE:this.getIsHover()?b.HOVER:this.getIsFocused()?b.FOCUSED:b.NORMAL}}return f}});this.defineElemStyleMappingProp("cursor","cursor");this.defineProp("isHover",{dataType:DataType.BOOL,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:function(f){this.setPropStoreFieldValue("isHover",f);if(!f&&!this.isCaptureMouse()){this.setPropStoreFieldValue("isActive",false)}this.stateChanged()}});this.defineProp("isActive",{dataType:DataType.BOOL,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:function(g){this.setPropStoreFieldValue("isActive",g);if(g){this.focus()}var f=this.getGlobalManager();if(f){f.notifyWidgetActiveChanged(this,g)}this.stateChanged()}});this.defineProp("isFocused",{dataType:DataType.BOOL,serializable:false,scope:Class.PropertyScope.PUBLIC,getter:function(){var g=this.getDocument();var f=this.getCoreElement();if(g&&f&&g.activeElement){return(g.activeElement===f)}},setter:function(h){this.setPropStoreFieldValue("isFocused",h);var f=this.getGlobalManager();if(f){f.notifyWidgetFocusChanged(this,h)}var g=this.getCoreElement();if(g){if(g.focus&&h){g.focus()}if(g.blur&&(!h)){g.blur()}}this.stateChanged()}});this.defineProp("isDialog",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC});this.defineProp("isPopup",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC});this.defineProp("popupCaller",{dataType:DataType.BOOL,scope:Class.PropertyScope.PRIVATE});this.defineProp("modalInfo",{dataType:DataType.HASH,scope:Class.PropertyScope.PUBLIC});this.defineProp("enablePeriodicalExec",{dataType:DataType.BOOL});this.defineProp("periodicalExecDelay",{dataType:DataType.INT});this.defineProp("periodicalExecInterval",{dataType:DataType.INT});this.defineElemAttribMappingProp("hint","title");this.defineProp("action",{dataType:"Kekule.Action",serializable:false,setter:function(g){var f=this.getAction();if(f!==g){if(f&&f.unlinkWidget){f.unlinkWidget(this);this.unlinkAction(f)}this.setPropStoreFieldValue("action",g);if(g&&g.linkWidget){g.linkWidget(this);this.linkAction(g)}}}});this.defineProp("iaControllerMap",{dataType:DataType.OBJECT,serializable:false,setter:null,scope:Class.PropertyScope.PUBLIC,getter:function(){var f=this.getPropStoreFieldValue("iaControllerMap");if(!f){f=new Kekule.HashEx();this.setPropStoreFieldValue("iaControllerMap",f)}return f}});this.defineProp("defIaControllerId",{dataType:DataType.STRING,serializable:false,scope:Class.PropertyScope.PUBLIC});this.defineProp("defIaController",{dataType:DataType.STRING,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){return this.getIaControllerMap().get(this.getDefIaControllerId())}});this.defineProp("activeIaControllerId",{dataType:DataType.STRING,serializable:false,scope:Class.PropertyScope.PUBLIC});this.defineProp("activeIaController",{dataType:DataType.STRING,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){return this.getIaControllerMap().get(this.getActiveIaControllerId())}})},doFinalize:function($super){this.setAction(null);this.setParent(null);this.releaseChildWidgets();var f=this.getElement();this.setElement(null);this.destroyElement(f);if(this.getGlobalManager()){this.getGlobalManager().notifyWidgetFinalized(this)}$super()},invokeEvent:function($super,g,h){if(!h){h={}}if(!h.widget){h.widget=this}$super(g,h);var f=Kekule.Widget.globalManager;if(f){f.notifyWidgetEventFired(this,g,h)}},getGlobalManager:function(){return Kekule.Widget.globalManager},getCoreElement:function(){return this.getElement()},getChildrenHolderElement:function(){return this.getCoreElement()},getTextSelectable:function(){return false},doPropChanged:function(f,g){if((f==="width")||(f==="height")){this.resized()}},getActualBubbleUiEvents:function(){var f=this.getParent();if(this.getBubbleUiEvents()){return true}else{if(this.getInheritBubbleUiEvents()&&f&&f.getActualBubbleUiEvents){return f.getActualBubbleUiEvents()}else{false}}},releaseChildWidgets:function(){var g=this.getChildWidgets();for(var f=g.length-1;f>=0;--f){g[f].finalize()}},defineElemAttribMappingProp:function(i,h,f){var g=Object.extend({dataType:DataType.STRING,serializable:false,getter:function(){return this.getElement()&&this.getElement().getAttribute(h)},setter:function(j){this.getElement()&&this.getElement().setAttribute(h,j)}},f||{});return this.defineProp(i,g)},defineElemStyleMappingProp:function(h,i,f){var g=Object.extend({dataType:DataType.STRING,serializable:false,getter:function(){return this.getStyleProperty(i)},setter:function(j){this.setStyleProperty(i,j)}},f||{});return this.defineProp(h,g)},getHigherLevelObj:function(){return this.getParent()},linkAction:function(f){},unlinkAction:function(f){},getChildActionClass:function(g,h){var f=Kekule.ActionManager.getActionClassOfName(g,this,h);return f},linkStyleResource:function(f,h){var g=(f instanceof Kekule.Widget.StyleResource)?f:Kekule.Widget.StyleResourceManager.getResource(f);if(g){g.linkTo(h||this)}return this},unlinkStyleResource:function(f,h){var g=(f instanceof Kekule.Widget.StyleResource)?f:Kekule.Widget.StyleResourceManager.getResource(f);if(g){g.unlinkFrom(h||this)}return this},getStyleProperty:function(f,h){var i=h||this.getElement();var g=i[this.STYLE_RES_FIELD];if(!g||!g[f]){return i.style[f]}else{return g[f]}},setStyleProperty:function(g,l,j){var k=j||this.getElement();if(k){var i;if(l instanceof Kekule.Widget.StyleResource){i=l}else{if((DataType.getType(l)===DataType.STRING)&&(l.startsWith(Kekule.Widget.StyleResourceNames.PREFIX))){i=Kekule.Widget.StyleResourceManager.getResource(l)}}if(i){var h=k[this.STYLE_RES_FIELD];if(!h){h={};k[this.STYLE_RES_FIELD]=h}var f=h[g];if(f){this.unlinkStyleResource(f,k)}if(i){this.linkStyleResource(i,k)}h[g]=i}else{k.style[g]=l;var h=k[this.STYLE_RES_FIELD];if(h&&h[g]){this.unlinkStyleResource(h[g],k)}}}},removeStyleProperty:function(f,i,g){var h=g||this.getElement();Kekule.StyleUtils.removeStyleProperty(h.style,f)},_addChild:function(g){if(!g){return}var f=this.getChildWidgets();if(f.indexOf(g)<0){f.push(g);this.childWidgetAdded(g);this.childrenModified()}},_insertChild:function(i,g){if(!i){return}var f=this.getChildWidgets();var h=g?f.indexOf(g):f.length;if(h<0){h=f.length}if(f.indexOf(i)>=0){this._moveChild(i,h-1)}else{f.splice(h-1,0,i);this.childWidgetAdded(i);this.childrenModified()}},_removeChild:function(j){if(!j){return}var g=this.getChildWidgets();var h=g.indexOf(j);if(h>=0){g.splice(h,1);var f=this.getChildrenHolderElement();var i=j.getElement();if(i&&Kekule.DomUtils.isDescendantOf(i,f)){i.parentNode.removeChild(i)}this.childWidgetRemoved(j);this.childrenModified()}},_moveChild:function(g,f){if(!g){return}if(Kekule.ArrayUtils.changeItemIndex(this.getChildWidgets(),g,f)){this.childWidgetMoved(g,f);this.childrenModified()}},childrenModified:function(){},childWidgetAdded:function(f){},childWidgetRemoved:function(f){},childWidgetMoved:function(g,f){},indexOfChild:function(f){return this.getChildWidgets().indexOf(f)},hasChild:function(g){var f=this.indexOfChild(g);return(f>=0)},_haltPrevShowHideProcess:function(){if(Kekule.Widget.showHideManager){if(this.__$showHideTransInfo){this.__$showHideTransInfo.halt()}}},show:function(f,h,g){if(!this.getElement()){return}if(this.__$isShowing){return}this._haltPrevShowHideProcess();this.doShow(f,h,g);return this},doShow:function(h,j,i){this.__$isShowing=true;var g=this;var f=function(){g.__$showHideTransInfo=null;g.widgetShowStateDone(true);g.__$isShowing=false;if(j){j()}};this.setShowHideType(i);if(Kekule.ObjUtils.notUnset(i)){this.setIsPopup((i===Kekule.Widget.ShowHideType.DROPDOWN)||(i===Kekule.Widget.ShowHideType.POPUP));if(i===Kekule.Widget.ShowHideType.DIALOG){this.setIsDialog(true);i=Kekule.Widget.ShowHideType.POPUP}else{this.setIsDialog(false)}}this.widgetShowStateBeforeChanging(true);if(i===Kekule.Widget.ShowHideType.DROPDOWN){Kekule.Widget.globalManager.preparePopupWidget(this,h,i)}if(Kekule.Widget.showHideManager){if(!this.__$showHideTransInfo){this.__$showHideTransInfo=Kekule.Widget.showHideManager.show(this,h,f,i)}}else{this.setDisplayed(true,true);this.setVisible(true,true);f()}this.setShowHideCaller(h);if(h){this.setShowHideCallerPageRect(e.getElemPageRect((h.getElement&&h.getElement())||h))}this.widgetShowStateChanged(true)},flash:function(i,h,k,j){var g=this;var f=function(){if(k){k()}setTimeout(g.hide.bind(g),i)};this.show(h,f,j);return this},hide:function(f,i,h,g){if(!this.getElement()){return}if(this.__$isHiding){return}this.__$isHiding=true;if(!f){f=this.getShowHideCaller()}if(!h){h=this.getShowHideType()}this._haltPrevShowHideProcess();this.doHide(f,i,h,g);return this},doHide:function(i,l,k,j){var h=this;var g=this.getFinalizeAfterHiding();var f=function(){h.__$showHideTransInfo=null;h.widgetShowStateDone(false);if(k===Kekule.Widget.ShowHideType.DROPDOWN){Kekule.Widget.globalManager.unpreparePopupWidget(h)}h.__$isHiding=false;if(l){l()}if(g){h.finalize()}};this.widgetShowStateBeforeChanging(false);if(Kekule.Widget.showHideManager){if(this.__$showHideTransInfo){this.__$showHideTransInfo.halt()}if(!this.__$showHideTransInfo){this.__$showHideTransInfo=Kekule.Widget.showHideManager.hide(this,i,f,k,false,{callerPageRect:this.getShowHideCallerPageRect()})}}else{if(j){this.setVisible(false,true)}else{this.setDisplayed(false,true)}f()}this.widgetShowStateChanged(false)},dismiss:function(f,i,h,g){this._isDismissed=true;return this.hide(f,i,h,g)},isShown:function(g){var f=(this.isInDomTree()||g)&&this.getElement()&&this.getVisible()&&this.getDisplayed();return f},widgetShowStateBeforeChanging:function(f){},widgetShowStateChanged:function(f){if(Kekule.ObjUtils.isUnset(f)){f=this.isShown()}if(Kekule.ObjUtils.notUnset(this._lastShown)&&(this._lastShown===f)){return}this._lastShown=f;if(f){this._isDismissed=false}if(this.getIsPopup()){if(f){Kekule.Widget.globalManager.registerPopupWidget(this)}else{Kekule.Widget.globalManager.unregisterPopupWidget(this)}}if(this.getIsDialog()){if(f){Kekule.Widget.globalManager.registerDialogWidget(this)}else{Kekule.Widget.globalManager.unregisterDialogWidget(this)}}this.doWidgetShowStateChanged(f);this.invokeEvent("showStateChange",{widget:this,isShown:f,isDismissed:this._isDismissed})},doWidgetShowStateChanged:function(f){},widgetShowStateDone:function(f){},isInDomTree:function(){var f=this.getElement();return Kekule.DomUtils.isInDomTree(f)},focus:function(){this.setIsFocused(true);return this},blur:function(){this.setIsFocused(false);return this},getBoundingClientRect:function(h){if(!this.getDisplayed()){var i=Kekule.StyleUtils.getDisplayed(this.getElement());var g=Kekule.StyleUtils.getVisibility(this.getElement());try{this.setVisible("hidden");this.setDisplayed("");var f=Kekule.HtmlElementUtils.getElemBoundingClientRect(this.getElement(),h)}finally{this.setDisplayed(i);this.setVisible(g)}return f}else{return Kekule.HtmlElementUtils.getElemBoundingClientRect(this.getElement(),h)}},getDimension:function(){return this.getBoundingClientRect(false)},setDimension:function(i,f,h){var g=false;var j=Kekule.ObjUtils.notUnset;if(j(i)){this.getStyle().width=(typeof(i)==="number")?i+"px":i;g=true}if(j(f)){this.getStyle().height=(typeof(f)==="number")?f+"px":f;g=true}if(g&&(!h)){this.resized()}this.objectChange(["width","height"]);return this},resized:function(){this.doResize();this.invokeEvent("resize",{widget:this})},doResize:function(){},layoutChanged:function(){var f=this.getLayout();if(this._layoutClassName){this.removeClassName(this._layoutClassName)}this._layoutClassName=this.getLayoutClassName(f);if(this._layoutClassName){this.addClassName(this._layoutClassName)}},getLayoutClassName:function(f){var g=Kekule.Widget.Layout;return(f===g.VERTICAL)?c.LAYOUT_V:(f===g.HORIZONTAL)?c.LAYOUT_H:null},stateChanged:function(){if(this._stateClassName){this.removeClassName(this._stateClassName)}this._stateClassName=this.getStateClassName(this.getState());if(this._stateClassName){this.addClassName(this._stateClassName)}var h=this.getChildWidgets();for(var g=0,f=h.length;g<f;++g){h[g].stateChanged()}},getStateClassName:function(h){var g=Kekule.Widget.State;var f=(h===g.ACTIVE)?c.STATE_ACTIVE:(h===g.HOVER)?c.STATE_HOVER:(h===g.FOCUSED)?c.STATE_FOCUSED:(h===g.DISABLED)?c.STATE_DISABLED:c.STATE_NORMAL;return f},createElement:function(){var g=this.getDocument();var f=this.doCreateRootElement(g);this.setElement(f);return f},doCreateRootElement:function(f){},doCreateSubElements:function(g,f){return[]},destroyElement:function(f){var f=f||this.getElement();if(f&&f.parentNode){f.parentNode.removeChild(f)}},appendToElem:function(f){if(f){f.appendChild(this.getElement())}return this},insertToElem:function(f,g){f.insertBefore(this.getElement(),g);return this},appendToWidget:function(f){this.setParent(f);this.appendToElem(f.getChildrenHolderElement());return this},insertToWidget:function(f,g){this.setParent(f);if(g){this.insertToElem(f.getChildrenHolderElement(),g.getElement())}else{this.appendToElem(f.getChildrenHolderElement())}return this},insertedToDom:function(){this.widgetShowStateChanged(this.isShown());return this.doInsertedToDom()},doInsertedToDom:function(){},removedFromDom:function(){this.widgetShowStateChanged(false);return this.doRemovedFromDom()},doRemovedFromDom:function(){},domElemAdded:function(f){return this.doDomElemAdded(f)},doDomElemAdded:function(f){},domElemRemoved:function(f){return this.doDomElemRemoved(f)},doDomElemRemoved:function(f){},getWidgetClassName:function(){var f=Kekule.Widget.HtmlClassNames.BASE;if(this.getElement()&&!Kekule.HtmlElementUtils.isFormCtrlElement(this.getCoreElement())){f+=" "+Kekule.Widget.HtmlClassNames.NORMAL_BACKGROUND}f+=" "+this.doGetWidgetClassName();return f},doGetWidgetClassName:function(){return""},hasClassName:function(f){return e.hasClass(this.getElement(),f)},addClassName:function(g,h){if(this.getElement()){if(h){var f=this.getCustomHtmlClassName();f=Kekule.StrUtils.addTokens(f,g);this.setCustomHtmlClassName(f)}else{e.addClass(this.getElement(),g)}}else{this._pendingHtmlClassNames=Kekule.StrUtils.addTokens(this._pendingHtmlClassNames,g)}return this},removeClassName:function(g,h){if(this.getElement()){if(h){var f=this.getCustomHtmlClassName();f=Kekule.StrUtils.removeTokens(f,g);this.setCustomHtmlClassName(f)}else{e.removeClass(this.getElement(),g)}}else{this._pendingHtmlClassNames=Kekule.StrUtils.removeTokens(this._pendingHtmlClassNames,g)}return this},toggleClassName:function(g,h){if(this.getElement()){if(h){var f=this.getCustomHtmlClassName();f=Kekule.StrUtils.toggleTokens(f,g);this.setCustomHtmlClassName(f)}else{e.toggleClass(this.getElement(),g)}}return this},isElementBindable:function(f){var h=this.getBindableElemTagNames();if(h){var g=f.tagName;return(h.indexOf(g.toLowerCase())>=0)}else{return true}},getBindableElemTagNames:function(){if(this.getPrototype().hasOwnProperty("BINDABLE_TAG_NAMES")){return this.BINDABLE_TAG_NAMES}else{return null}},bindElement:function(p){if(p){if(!this.isElementBindable(p)){Kekule.error(Kekule.$L("ErrorMsg.WIDGET_CAN_NOT_BIND_TO_ELEM").format(this.getClassName(),p.tagName));return}var f=p.className;if(f){this.setCustomHtmlClassName(this.getCustomHtmlClassName()||" "+f)}var u=Kekule.DomUtils;var k=Kekule.HtmlElementUtils;var o=function(h){var w=u.getDirectChildElems(h);for(var l=w.length-1;l>=0;--l){var z=w[l];if(k.hasClass(z,c.DYN_CREATED)){h.removeChild(z)}}};o(p);var y=this.doCreateSubElements(this.getDocument(),p);if(y&&y.length){for(var q=0,m=y.length;q<m;++q){var j=y[q];k.addClass(j,c.DYN_CREATED)}}this.doBindElement(p);if(Kekule.DomUtils.hasAttribute(p,"disabled")){this.setEnabled(false)}var x=p.getAttribute("width");var s=p.getAttribute("height");if(Kekule.ObjUtils.notUnset(x)||Kekule.ObjUtils.notUnset(s)){x=parseFloat((x||"").toString())||0;s=parseFloat((s||"").toString())||0;this.setDimension(x,s)}var n=Kekule.DomUtils.getDataset(p);if(n){for(var g in n){var v=n[g];try{Kekule.Widget.Utils.setWidgetPropFromElemAttrib(this,g,v)}catch(t){Kekule.warn(t)}}}var r=this.getWidgetClassName();e.addClass(p,r);r=this.getCustomHtmlClassName();if(r){e.addClass(p,r)}if(!this.getTextSelectable()){e.addClass(p,c.NONSELECTABLE)}if(this._pendingHtmlClassNames){e.addClass(p,this._pendingHtmlClassNames);this._pendingHtmlClassNames=""}if(!this.getIsDumb()){this.installUiEventHandlers(p)}p[d]=this;this.invokeEvent("bind",{widget:this,element:p})}},doBindElement:function(f){},unbindElement:function(g){if(g){if(!this.getIsDumb()){this.uninstallUiEventHandlers(g)}var f=this.getWidgetClassName();e.removeClass(g,f);this.doUnbindElement(g);g[d]=undefined;try{delete g[d]}catch(h){}this.invokeEvent("unbind",{widget:this,element:g})}},doUnbindElement:function(f){},elementChanged:function(f,g){if(g){this.unbindElement(g)}if(f){this.bindElement(f)}},observeElementAttribChangesChanged:function(g){var f=this.getElement();if(g){this._installAttribMutationObserver(f)}else{this._uninstallAttribMutationObserver(f)}},_installAttribMutationObserver:function(g){if(Kekule.X.MutationObserver){if(!this._attribMutationObserver){var f=new Kekule.X.MutationObserver(this._reactElemAttribMutationBind);this._attribMutationObserver=f}this._attribMutationObserver.observe(g,{attributes:true})}},_uninstallAttribMutationObserver:function(f){if(this._attribMutationObserver){this._attribMutationObserver.disconnect()}},_reactElemAttribMutation:function(j){var p=this.getElement();for(var n=0,h=j.length;n<h;++n){var g=j[n];if(g.type!=="attributes"){continue}if(g.target!==p){continue}var o=g.attributeName;if(o&&Kekule.DomUtils.isDataAttribName(o)){var f=Kekule.DomUtils.getDataAttribCoreName(o);if(f){var k=p.getAttribute(o);Kekule.Widget.Utils.setWidgetPropFromElemAttrib(this,f,k)}}}},createDecorationContent:function(g,h){var i=g.ownerDocument;var f=i.createElement("span");e.addClass(f,[c.PART_CONTENT,c.PART_DECORATION_CONTENT,c.DYN_CREATED]);if(h){g.insertBefore(f,h)}else{g.appendChild(f)}return f},createTextContent:function(j,g,h){var i=g.ownerDocument;var f=i.createElement("span");e.addClass(f,[c.PART_CONTENT,c.PART_TEXT_CONTENT,c.DYN_CREATED]);f.innerHTML=j;if(h){g.insertBefore(f,h)}else{g.appendChild(f)}return f},createGlyphContent:function(g,h,i){var j=g.ownerDocument;var f=j.createElement("span");e.addClass(f,[c.PART_CONTENT,c.PART_GLYPH_CONTENT,c.DYN_CREATED]);if(i){e.addClass(f,i)}if(h){g.insertBefore(f,h)}else{g.appendChild(f)}return f},installUiEventHandlers:function(j){var h=Kekule.Widget.UiLocalEvents;for(var g=0,f=h.length;g<f;++g){Kekule.X.Event.addListener(j,h[g],this.reactUiEventBind)}},uninstallUiEventHandlers:function(j){var h=Kekule.Widget.UiLocalEvents;for(var g=0,f=h.length;g<f;++g){Kekule.X.Event.removeListener(j,h[g],this.reactUiEventBind)}},reactUiEvent:function(j){if(this.getStatic()){}else{if(!this.getEnabled()){j.stopPropagation()}else{var i=false;var o=j.getType();var k=j.getTarget();var f=Kekule.Widget.Utils.getBelongedResponsiveWidget(k);var n=f===this;var t=Kekule.X.Event.KeyCode;var r;if(o==="mousemove"){this.reactPointerMoving(j);var h=this.getEventMouseRelCoord(j);var q=this.testMouseCursor(h,j);if(Kekule.ObjUtils.notUnset(q)&&this.getElement()){this.setCursor(q);i=true}}else{if(o==="touchmove"){this.reactPointerMoving(j);i=true}else{if(o==="focus"){if(n&&j.getTarget()===this.getCoreElement()){this.setIsFocused(true);i=true}}else{if(o==="blur"){if(n&&j.getTarget()==this.getCoreElement()){var s=this.getDocument().activeElement;var g=this.getElement();if(s&&(Kekule.DomUtils.isDescendantOf(s,g)||s===g)){}else{this.setIsFocused(false)}i=true}}else{if(o==="mouseover"){this.setIsHover(true);i=true}else{if(o==="mouseout"||o==="touchleave"){if(!j.ghostMouseEvent){var l=j.getRelatedTarget();if(l&&Kekule.DomUtils.isOrIsDescendantOf(l,this.getCoreElement())){}else{this.setIsHover(false);if(!this.isCaptureMouse()){this.reactDeactiviting(j);i=true}}}}else{if((o==="mousedown"&&j.getButton()===Kekule.X.Event.MouseButton.LEFT)||(o==="touchstart")){if(n&&!j.ghostMouseEvent){this.reactActiviting(j)}i=true}else{if((o==="mouseup"&&j.getButton()===Kekule.X.Event.MouseButton.LEFT)||(o==="touchend")||(o==="touchcancel")){if(n&&!j.ghostMouseEvent){this.reactDeactiviting(j)}i=true}else{if(o==="keydown"){r=j.getKeyCode();if((r===t.ENTER)||(r===t.SPACE)){if(n&&!this.getIsActive()){this.reactActiviting(j)}i=true}}else{if(o==="keyup"){r=j.getKeyCode();if((r===t.ENTER)||(r===t.SPACE)){if(n&&this.getIsActive()){this.reactDeactiviting(j)}i=true}}}}}}}}}}}var m=Kekule.Widget.getEventHandleFuncName(j.getType());if(this[m]){i=this[m](j)}else{i=this.dispatchEventToIaControllers(j)||i}this.doReactUiEvent(j);this.invokeEvent(o,{htmlEvent:j})}}if(this.getActualBubbleUiEvents()){var p=this.getParent();if(p&&p.reactUiEvent){p.reactUiEvent(j)}}},doReactUiEvent:function(f){},reactTouchGesture:function(g){var f=Kekule.Widget.getTouchGestureHandleFuncName(g.getType());if(this[f]){this[f](g)}else{this.dispatchEventToIaControllers(g)}},reactActiviting:function(f){if(!this.getIsActive()){this.setIsActive(true);this.doReactActiviting(f);this.invokeEvent("activate",{widget:this})}},doReactActiviting:function(f){},reactDeactiviting:function(f){if(this.getIsActive()){this.doReactDeactiviting(f);this.invokeEvent("deactivate",{widget:this});this.setIsActive(false)}},doReactDeactiviting:function(f){},reactPointerMoving:function(f){this.doReactPointerMoving(f)},doReactPointerMoving:function(f){},dispatchEventToIaControllers:function(h){var g=false;var f=this.getActiveIaController();if(f){g=f.handleUiEvent(h)}if(!g){f=this.getDefIaController();if(f){g=f.handleUiEvent(h)}}return g},getEventMouseRelCoord:function(f){return{x:f.getRelXToCurrTarget(),y:f.getRelYToCurrTarget()}},testMouseCursor:function(i,h){var f=this.doTestMouseCursor(i,h);if(!f){var g=this.getActiveIaController();if(g){f=g.testMouseCursor(i,h)}if(!f){g=this.getDefIaController();if(g){f=g.testMouseCursor(i,h)}}}return f},doTestMouseCursor:function(g,f){return null},setMouseCapture:function(f){if(f){Kekule.Widget.globalManager.setMouseCaptureWidget(this)}else{if(this.isCaptureMouse()){Kekule.Widget.globalManager.setMouseCaptureWidget(null)}}},isCaptureMouse:function(){return Kekule.Widget.globalManager.getMouseCaptureWidget()===this},addIaController:function(h,f,g){this.getIaControllerMap().set(h,f);if(g){this.setDefIaControllerId(h)}if(f){f.setWidget(this)}},removeIaController:function(g){var f=this.getIaControllerMap().get(g);if(f){this.getIaControllerMap().remove(g);if(g===this.getDefIaControllerId()){this.setDefIaControllerId(null)}if(g===this.getActiveIaControllerId()){this.setActiveIaControllerId(null)}f.setWidget(null)}},getIaController:function(f){return this.getIaControllerMap().get(f)},execute:function(f){this.doExecute(f);this.invokeEvent("execute",{widget:this,htmlEvent:f})},doExecute:function(f){},isPeriodicalExecuting:function(){return this._periodicalExecBind},startPeriodicalExec:function(f){var g=this.getPeriodicalExecDelay()||0;this._periodicalExecuting=true;this._periodicalExecHtmlEvent=f;setTimeout(this._periodicalExecBind,g)},stopPeriodicalExec:function(){this._periodicalExecuting=false;this._periodicalExecHtmlEvent=null},_periodicalExec:function(f){if(this.isPeriodicalExecuting()){if(!this._waitPeriodicalProcess){this._waitPeriodicalProcess=true;this.execute(this._periodicalExecHtmlEvent);this._waitPeriodicalProcess=false}setTimeout(this._periodicalExecBind,this.getPeriodicalExecInterval()||20)}}});Kekule.Widget.InteractionController=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.InteractionController",initialize:function($super,f){$super();if(f){this.setWidget(f)}},doFinalize:function($super){this.setWidget(null);$super()},initProperties:function(){this.defineProp("widget",{dataType:"Kekule.Widget.BaseWidget",serializable:false})},handleUiEvent:function(h){var f=h.getType();var g=Kekule.Widget.getEventHandleFuncName(f);if(this[g]){return this[g](h)}else{return false}},_defEventHandler:function(f){return false},testMouseCursor:function(g,f){return this.doTestMouseCursor(g,f)},doTestMouseCursor:function(g,f){return null},_getEventMouseCoord:function(i,h){var k={x:i.getClientX(),y:i.getClientY()};var g=h||this.getWidget().getElement();var j={x:g.getBoundingClientRect().left-g.scrollLeft,y:g.getBoundingClientRect().top-g.scrollTop};var f=Kekule.CoordUtils.substract(k,j);return f}});Kekule.Widget.DumbWidget=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.DumbWidget",initialize:function($super,f){$super(f,true)},doCreateRootElement:function(g){var f=g.createElement("span");return f}});Kekule.Widget.Utils={getWidgetOnElem:function(f){return f[d]},getWidgetsInsideElem:function(h,n){var p;var k=Kekule.Widget.Utils.getWidgetOnElem(h);if(k){p=[k]}else{p=[]}if(!n){return p}var o=Kekule.DomUtils.getDirectChildElems(h);for(var j=0,g=o.length;j<g;++j){var f=o[j];var m=Kekule.Widget.Utils.getWidgetsInsideElem(f,n);p=p.concat(m)}return p},getWidgetById:function(h,g){if(!g){g=document}var f=g.getElementById(h);if(f){return Kekule.Widget.Utils.getWidgetOnElem(f)}else{return undefined}},getBelongedWidget:function(g){var f=null;while(g&&(!f)){f=Kekule.Widget.Utils.getWidgetOnElem(g);g=g.parentNode}return f},getBelongedResponsiveWidget:function(g){var f=null;while(g&&(!f)){f=Kekule.Widget.Utils.getWidgetOnElem(g);if(f&&f.getStatic()){f=null}g=g.parentNode}return f},createFromHash:function(t,j){var p=["widget","widgetClass","htmlClass","children"];var r=j.widgetClass||j.widget;if(typeof(r)==="string"){r=ClassEx.findClass(r)}if(!r){Kekule.error(Kekule.$L("ErrorMsg.WIDGET_CLASS_NOT_FOUND"));return null}var u=new r(t);var o=Kekule.ObjUtils.getOwnedFieldNames(j,true);o=Kekule.ArrayUtils.exclude(o,p);for(var m=0,k=o.length;m<k;++m){var q=o[m];var s=j[q];if(q.startsWith("#")&&DataType.isFunctionValue(s)){var n=q.substr(1);u.addEventListener(n,s)}else{if(u.hasProperty(q)){u.setPropValue(q,s)}}}if(j.htmlClass){u.addClassName(j.htmlClass,true)}if(j.children){var h=j.children;if(DataType.isArrayValue(h)){for(var m=0,k=h.length;m<k;++m){var g=h[m];var f=Kekule.Widget.Utils.createFromHash(u,g);if(f){f.appendToWidget(u)}}}}return u},setWidgetPropFromElemAttrib:function(k,h,g){var j=h.camelize();var f=k.getPropertyDataType(j);if(!f){return}if(f===DataType.STRING){k.setPropValue(j,g)}else{if(Kekule.PredefinedResReferer.isResValue(g)){Kekule.PredefinedResReferer.loadResource(g,function(n,o){if(k.loadPredefinedResDataToProp){k.loadPredefinedResDataToProp(j,n,o)}},null,k.getDocument())}else{if(g.startsWith("#")&&(ClassEx.isOrIsDescendantOf(ClassEx.findClass(f),Kekule.Widget.BaseWidget))){var m=g.substr(1).trim();Kekule.Widget.Utils._setWidgetRefPropFromId(k,j,m)}else{var i=JSON.parse(g);if(Kekule.ObjUtils.notUnset(i)){var l=ObjSerializerFactory.getSerializer("json").load(null,i);k.setPropValue(j,l)}}}}},_setWidgetRefPropFromId:function(h,g,i){if(i){var f=Kekule.Widget.getWidgetById(i,h.getDocument());if(f){h.setPropValue(g,f)}}}};Kekule.Widget.getWidgetOnElem=Kekule.Widget.Utils.getWidgetOnElem;Kekule.Widget.getWidgetById=Kekule.Widget.Utils.getWidgetById;Kekule.$W=Kekule.Widget.Utils.getWidgetById;Kekule.Widget.getBelongedWidget=Kekule.Widget.Utils.getBelongedWidget;Kekule.Widget.createFromHash=Kekule.Widget.Utils.createFromHash;Kekule.Widget.GlobalManager=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.GlobalManager",INFO_FIELD:"__$info__",initialize:function($super,f){$super();this._document=f||document;this._hammertime=null;this.setPropStoreFieldValue("popupWidgets",[]);this.setPropStoreFieldValue("dialogWidgets",[]);this.setPropStoreFieldValue("modalWidgets",[]);this.setPropStoreFieldValue("widgets",[]);this.setPropStoreFieldValue("preserveWidgetList",true);this.reactUiEventBind=this.reactUiEvent.bind(this);this.reactTouchGestureBind=this.reactTouchGesture.bind(this);Kekule.X.domReady(this.domReadyInit.bind(this))},finalize:function($super){this.uninstallGlobalDomMutationHandlers(this._document.documentElement);this.uninstallGlobalEventHandlers(this._document.documentElement);this._hammertime=null;this.setPropStoreFieldValue("popupWidgets",null);this.setPropStoreFieldValue("widgets",null);$super()},initProperties:function(){this.defineProp("mouseCaptureWidget",{dataType:DataType.OBJECT,serializable:false});this.defineProp("popupWidgets",{dataType:DataType.ARRAY,serializable:false});this.defineProp("dialogWidgets",{dataType:DataType.ARRAY,serializable:false});this.defineProp("modalWidgets",{dataType:DataType.ARRAY,serializable:false});this.defineProp("preserveWidgetList",{dataType:DataType.BOOL,serializable:false,setter:function(f){this.setPropStoreFieldValue("preserveWidgetList",f);if(!f){this.setPropStoreFieldValue("widgets",[])}}});this.defineProp("widgets",{dataType:DataType.ARRAY,serializable:false,setter:null});this.defineProp("currActiveWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:false});this.defineProp("currFocusedWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:false});this.defineProp("modalBackgroundElem",{dataType:DataType.OBJECT,serializable:false,setter:null})},domReadyInit:function(){this.installGlobalEventHandlers(this._document.documentElement);this.installGlobalDomMutationHandlers(this._document.documentElement)},notifyWidgetCreated:function(f){if(this.getPreserveWidgetList()){this.getWidgets().push(f)}this.invokeEvent("widgetCreate",{widget:f})},notifyWidgetFinalized:function(f){if(this.getWidgets()){Kekule.ArrayUtils.remove(this.getWidgets(),f)}if(this.getPopupWidgets()){Kekule.ArrayUtils.remove(this.getPopupWidgets(),f)}if(this.getDialogWidgets()){Kekule.ArrayUtils.remove(this.getDialogWidgets(),f)}if(f===this.getCurrActiveWidget()){this.setCurrActiveWidget(null)}if(f===this.getCurrFocusedWidget()){this.setCurrFocusedWidget(null)}this.invokeEvent("widgetFinalize",{widget:f})},notifyWidgetActiveChanged:function(g,h){var f=this.getCurrActiveWidget();if(h){if(g!==f){if(f){f.setIsActive(false)}this.setCurrActiveWidget(g)}}else{if(f===g){this.setCurrActiveWidget(null)}}},notifyWidgetFocusChanged:function(g,h){var f=this.getCurrFocusedWidget();if(h){if(g!==f){if(f){f.setIsFocused(false)}this.setCurrFocusedWidget(g)}}else{if(f===g){this.setCurrFocusedWidget(null)}}},hasPopupWidgets:function(){return !!this.getPopupWidgets().length},hasDialogWidgets:function(){return !!this.getDialogWidgets().length},getBelongedResponsiveWidget:function(f){return Kekule.Widget.Utils.getBelongedResponsiveWidget(f)},notifyWidgetEventFired:function(h,f,g){var i=Object.extend({},g);i.widget=h;this.invokeEvent(f,i)},installGlobalEventHandlers:function(j){if(!this._globalEventInstalled){var h=Kekule.Widget.UiEvents;for(var g=0,f=h.length;g<f;++g){Kekule.X.Event.addListener(j,h[g],this.reactUiEventBind)}this._globalEventInstalled=true}},uninstallGlobalEventHandlers:function(j){var h=Kekule.Widget.UiEvents;for(var g=0,f=h.length;g<f;++g){Kekule.X.Event.removeListener(j,h[g],this.reactUiEventBind)}},installGlobalTouchHandlers:function(g){if(typeof(Hammer)!=="undefined"){var f=Hammer(g).on(Kekule.Widget.TouchGestures.join(" "),this.reactTouchGestureBind);return f}},uninstallGlobalTouchHandlers:function(f){if(this._hammertime){this._hammertime.off(Kekule.Widget.TouchGestures.join(" "),this.reactTouchGestureBind)}},installGlobalDomMutationHandlers:function(h){var g=this;if(Kekule.X.MutationObserver){var f=new Kekule.X.MutationObserver(function(p){for(var t=0,o=p.length;t<o;++t){var n=p[t];if(n.type==="childList"){var r=n.addedNodes;for(var s=0,q=r.length;s<q;++s){var u=r[s];if(u.nodeType===Node.ELEMENT_NODE){g._handleDomAddedElem(u)}}var r=n.removedNodes;for(var s=0,q=r.length;s<q;++s){var u=r[s];if(u.nodeType===Node.ELEMENT_NODE){g._handleDomRemovedElem(u)}}}}});f.observe(h,{childList:true,subtree:true});this._domMutationObserver=f}else{this._reactDomNodeInserted=function(j){var i=j.getTarget();if(i.nodeType===(Node.ELEMENT_NODE)){g._handleDomAddedElem(i)}};this._reactDomNodeRemoved=function(j){var i=j.getTarget();if(i.nodeType===(Node.ELEMENT_NODE)){g._handleDomRemovedElem(i)}};Kekule.X.Event.addListener(h,"DOMNodeInserted",this._reactDomNodeInserted);Kekule.X.Event.addListener(h,"DOMNodeRemoved",this._reactDomNodeRemoved)}},uninstallGlobalDomMutationHandlers:function(f){if(this._domMutationObserver){this._domMutationObserver.disconnect()}if(this._reactDomNodeInserted){Kekule.X.Event.removeListener(f,"DOMNodeInserted",this._reactDomNodeInserted)}if(this._reactDomNodeRemoved){Kekule.X.Event.removeListener(f,"DOMNodeRemoved",this._reactDomNodeRemoved)}},_handleDomAddedElem:function(k){var j=Kekule.Widget.Utils.getWidgetsInsideElem(k,true);for(var h=0,g=j.length;h<g;++h){var f=j[h];f.insertedToDom()}var f=Kekule.Widget.Utils.getBelongedWidget(k);if(f){f.domElemAdded(k)}},_handleDomRemovedElem:function(k){var j=Kekule.Widget.Utils.getWidgetsInsideElem(k,true);for(var h=0,g=j.length;h<g;++h){var f=j[h];f.removedFromDom()}var f=Kekule.Widget.Utils.getBelongedWidget(k);if(f){f.domElemRemoved(k)}},isMouseEvent:function(f){return f.startsWith("mouse")||(f==="click")},isTouchEvent:function(f){return f.startsWith("touch")},reactUiEvent:function(l){var h=l.getType();var j;var i;if(this.getMouseCaptureWidget()&&(this.isMouseEvent(h)||this.isTouchEvent(h))){j=this.getMouseCaptureWidget();i=true}else{var g=l.getTarget();j=this.getBelongedResponsiveWidget(g)}if(h==="touchstart"||h==="touchend"){this._touchJustStart=true;var f=this;setTimeout(function(){f._touchJustStart=false},500)}else{if(["mousedown","mouseup","mouseout","click"].indexOf(h)>=0){if(this._touchJustStart){l.ghostMouseEvent=true}}}var k=Kekule.Widget.getEventHandleFuncName(l.getType());if(this[k]){this[k](l)}if(j){j.reactUiEvent(l)}},reactTouchGesture:function(h){var g=Kekule.Widget.getTouchGestureHandleFuncName(h.getType());if(this[g]){this[g](h)}var f=Kekule.Widget.getBelongedWidget(h.target);if(f){f.reactTouchGesture(h)}else{}},react_mousedown:function(g){if(this.hasPopupWidgets()&&!g.ghostMouseEvent){var f=g.getTarget();this.hidePopupWidgets(f)}},react_keydown:function(g){var f=g.getKeyCode();if(f===Kekule.X.Event.KeyCode.ESC){if(this.hasPopupWidgets()){this.hidePopupWidgets(null,true)}else{if(this.hasDialogWidgets()){this.hideTopmostDialogWidget(null,true)}}}},react_touchstart:function(g){if(this.hasPopupWidgets()){var f=g.getTarget();this.hidePopupWidgets(f)}},unpreparePopupWidget:function(f){f.setPopupCaller(null);this.restoreElem(f.getElement())},preparePopupWidget:function(k,m,r){k.setPopupCaller(m);var x=k.getElement();var v=x.ownerDocument;var j=this.getTopmostLayer(v,true);var t=x.parentNode===j;var s=Kekule.Widget.ShowHideType;var p;if((r===s.DROPDOWN)&&m){p=this._calcDropDownWidgetPosInfo(k,m)}else{if(!t){p=this._calcPopupWidgetPosInfo(k)}}if(!t){this.moveElemToTopmostLayer(x)}if(p){var w=["left","top","right","bottom","width","height"];var o={};var g=x.style;g.position="absolute";for(var q=0,n=w.length;q<n;++q){var f=w[q];var u=p[f];if(u){o[f]=g[f]||"";g[f]=u}}var h=this._getElemStoredInfo(x);h.styles=o}},_calcPopupWidgetPosInfo:function(g){var j=Kekule.HtmlElementUtils;var f=g.getElement();var i=g.isShown();if(!i){dropElem.style.visible="hidden";dropElem.style.display=""}var h=j.getElemBoundingClientRect(f);return{top:h.top+"px",left:h.left+"px"}},_calcDropDownWidgetPosInfo:function(g,G){var F=Kekule.HtmlElementUtils;var z=Kekule.Widget.Position;var l=G.getDropPosition?G.getDropPosition():null;var C=G.getParent();var M=C&&C.getLayout()||Kekule.Widget.Layout.HORIZONTAL;var I=G.getElement();var L=F.getElemBoundingClientRect(I);var E=F.getViewportDimension(I);var n=g.getElement();n.style.visible="hidden";n.style.display="";var f=false;var O=this.getTopmostLayer(n.ownerDocument);if(!n.parentNode){O.appendChild(n);f=true}n.style.position="relative";var u=F.getElemOffsetDimension(n);var J=F.getElemScrollDimension(n);var B=F.getElemBoundingClientRect(n);n.style.position="absolute";if(f){O.removeChild(n)}if(!l||l===z.AUTO){l=0;if(M===Kekule.Widget.Layout.VERTICAL){var j=L.x;var N=E.width-j-L.width;if(N>=u.width){l|=z.RIGHT}else{l|=(j>N)?z.LEFT:z.RIGHT}}else{var A=L.y;var m=E.height-A-L.height;if(m>=u.height){l|=z.BOTTOM}else{l|=(A>m)?z.TOP:z.BOTTOM}}}var r=Kekule.StyleUtils;var L=F.getElemBoundingClientRect(I,true);var t=r.getComputedStyle(n,"width")||J.width;var K=r.getComputedStyle(n,"height")||J.height;var q;if(l&z.LEFT){q=L.left-B.width}else{if(l&z.RIGHT){q=L.right}else{var k=E.width-L.right;var i=E.width-L.left;if(i>=B.width){q=L.left}else{q=L.right-B.width}}}var o;if(l&z.TOP){o=L.top-B.height}else{if(l&z.BOTTOM){o=L.bottom}else{var H=E.height-L.bottom;var v=E.height-L.top;if(v>=B.height){o=L.bottom}else{o=L.bottom-B.height}}}q+="px";o+="px";t+="px";K+="px";var s={};s.left=q;s.top=o;s.width=t;s.height=K;return s},hidePopupWidgets:function(g,m){var o=this.getPopupWidgets();var f=Kekule.Widget.getBelongedWidget(g);var n=f?f.getPopupCaller():null;var j=n?n.getElement():null;for(var k=o.length-1;k>=0;--k){var l=o[k];var h=l.getElement();if(h){if(h===j||Kekule.DomUtils.isDescendantOf(j,h)){continue}if((!g)||((h!==g)&&(!Kekule.DomUtils.isDescendantOf(g,h)))){if(!m){l.hide()}else{l.dismiss()}}}else{Kekule.ArrayUtils.remove(this.getPopupWidgets(),l)}}},hideTopmostDialogWidget:function(j,i){var g=this.getDialogWidgets()||[];var f=g[g.length-1];if(f){var h=f.getElement();if(h){if(i){f.dismiss()}else{f.hide()}}else{Kekule.ArrayUtils.remove(this.geDialogWidgets(),f)}}},registerPopupWidget:function(f){f.addClassName(c.SHOW_POPUP);Kekule.ArrayUtils.pushUnique(this.getPopupWidgets(),f)},unregisterPopupWidget:function(f){f.removeClassName(c.SHOW_POPUP);Kekule.ArrayUtils.remove(this.getPopupWidgets(),f)},registerDialogWidget:function(f){f.addClassName(c.SHOW_DIALOG);Kekule.ArrayUtils.pushUnique(this.getDialogWidgets(),f)},unregisterDialogWidget:function(f){f.removeClassName(c.SHOW_DIALOG);Kekule.ArrayUtils.remove(this.getDialogWidgets(),f)},registerModalWidget:function(g){var f=this.getCurrModalWidget();if(f){f.removeClassName(c.SHOW_ACTIVE_MODAL)}Kekule.ArrayUtils.pushUnique(this.getModalWidgets(),g);g.addClassName(c.SHOW_ACTIVE_MODAL)},unregisterModalWidget:function(g){g.removeClassName(c.SHOW_ACTIVE_MODAL);Kekule.ArrayUtils.remove(this.getModalWidgets(),g);var f=this.getCurrModalWidget();if(f){f.addClassName(c.SHOW_ACTIVE_MODAL)}},getCurrModalWidget:function(){var f=this.getModalWidgets();if(!f||!f.length){return null}else{return f[0]}},prepareModalWidget:function(g){var i=g.getDocument();var h=this.getModalBackgroundElem();if(!h){h=i.createElement("div");h.className=c.MODAL_BACKGROUND;this.setPropStoreFieldValue("modalBackgroundElem",h)}var f=g.getElement();g.setModalInfo({oldParent:f.parentNode,oldSibling:f.nextSibling});if(f.parentNode){f.parentNode.removeChild(f)}if(h.parentNode){h.parentNode.removeChild(h)}i.body.appendChild(h);i.body.appendChild(f);this.registerModalWidget(g)},unprepareModalWidget:function(h){var j=h.getDocument();this.unregisterModalWidget(h);var g=h.getElement().parentNode;if(g){g.removeChild(h.getElement())}var l=h.getModalInfo();if(l){if(l.oldParent){l.oldParent.insertBefore(h.getElement(),l.oldSibling)}h.setModalInfo(null)}var k=this.getCurrModalWidget();var i=this.getModalBackgroundElem();if(i){if(k){if(i.parentNode){i.parentNode.removeChild(i)}var f=k.getElement().parentNode;f.insertBefore(i,k.getElement())}else{if(i.parentNode){i.parentNode.removeChild(i)}}}},getTopmostLayer:function(g,h){var f=g.body;return f},_getElemStoredInfo:function(g){var f=null;if(g){f=g[this.INFO_FIELD];if(!f){f={};g[this.INFO_FIELD]=f}}return f},_clearElemStoredInfo:function(f){if(f[this.INFO_FIELD]){f[this.INFO_FIELD]=undefined}},moveElemToTopmostLayer:function(g){var h=this._getElemStoredInfo(g);h.parentElem=g.parentNode;h.nextSibling=g.nextSibling;var f=this.getTopmostLayer(g.ownerDocument);f.appendChild(g)},restoreElem:function(j){if(!j){return}var h=this._getElemStoredInfo(j);if(!h){return}var p=h.styles;var n=Kekule.ObjUtils.getOwnedFieldNames(p);var f=j.style;for(var m=0,k=n.length;m<k;++m){var g=n[m];var o=p[g];if(o){f[g]=o}else{Kekule.StyleUtils.removeStyleProperty(f,g)}}if(h.parentElem){if(h.nextSibling){h.parentElem.insertBefore(j,h.nextSibling)}else{h.parentElem.appendChild(j)}}j[this.INFO_FIELD]=null}});Kekule.ClassUtils.makeSingleton(Kekule.Widget.GlobalManager);Kekule.Widget.globalManager=Kekule.Widget.GlobalManager.getInstance()})();(function(){var c=function(){var k=["monospace","sans-serif","serif"];var f="mmmmmmmmmmlli";var i="72px";var g=document.getElementsByTagName("body")[0];var m=document.createElement("span");m.style.fontSize=i;m.innerHTML=f;var l={};var d={};for(var j in k){m.style.fontFamily=k[j];g.appendChild(m);l[k[j]]=m.offsetWidth;d[k[j]]=m.offsetHeight;g.removeChild(m)}function e(n){var p=false;for(var o in k){m.style.fontFamily=n+","+k[o];g.appendChild(m);var h=(m.offsetWidth!=l[k[o]]||m.offsetHeight!=d[k[o]]);g.removeChild(m);p=p||h}return p}this.detect=e};var b;Kekule.Widget.FontDetector={detect:function(e){var f=b;if(!f){f=new c();b=f}return f.detect(e)}};var a=["Arial, Helvetica, sans-serif","Georgia, Times New Roman, Times, serif","Courier New, Courier, monospace","Tahoma, Geneva, sans-serif","Trebuchet MS, Arial, Helvetica, sans-serif","Arial Black, Gadget, sans-serif","Palatino Linotype, Book Antiqua, Palatino, serif","Lucida Sans Unicode, Lucida Grande, sans-serif","MS Serif, New York, serif","Lucida Console, Monaco, monospace","Comic Sans MS, cursive"];Kekule.Widget.FontEnumerator={getAvailableFontFamilies:function(e){if(!e){e=a}var d=[];for(var g=0,f=e.length;g<f;++g){var h=e[g];if(Kekule.Widget.FontDetector.detect(h)){d.push(h)}}return d}}})();(function(){Kekule.Widget.Clipboard=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.Clipboard",STORAGE_KEY:"__$kekule_widget_clipboard__",initialize:function($super){$super();this._data=new Kekule.MapEx(true);if(Kekule.BrowserFeature.localStorage){this._crossPageStorage=window.localStorage;this.setEnableCrossPageClipboard(true);var a=this;Kekule.X.Event.addListener(window,"storage",function(d){if(a.getEnableCrossPageClipboard()){var c=d.key;var b=a._extractSessionDataType(c);if(b){a.invokeEvent("setData",{dataType:b,data:a.deserializeData(d.newValue)})}}})}},finalize:function($super){this._data.finalize();$super()},initProperties:function(){this.defineProp("enableCrossPageClipboard",{dataType:DataType.BOOL})},_useSessionClipboard:function(){return this.getEnableCrossPageClipboard()&&Kekule.BrowserFeature.localStorage},_extractSessionDataType:function(a){return(a.startsWith(this.STORAGE_KEY))?a.substr(this.STORAGE_KEY.length):null},serializeData:function(b){var a;if(DataType.isSimpleValue(b)){a=JSON.stringify(b)}else{var c={};ObjSerializerFactory.getSerializer("json").save(b,c);a=JSON.stringify(c)}return a},deserializeData:function(a){var b=JSON.parse(a);if(DataType.isSimpleValue(b)){return b}else{return ObjSerializerFactory.getSerializer("json").load(null,b)}},setData:function(a,c){if(this._useSessionClipboard()){var b=this.serializeData(c);this._crossPageStorage.setItem(this.STORAGE_KEY+a,b)}else{this._data.set(a,c)}this.invokeEvent("setData",{dataType:a,data:c});return this},getData:function(a){if(this._useSessionClipboard()){var b=this._crossPageStorage.getItem(this.STORAGE_KEY+a);return b?this.deserializeData(b):null}else{return this._data.get(a)}},hasData:function(a){return Kekule.ObjUtils.notUnset(this.getData(a))},clearData:function(){if(this._useSessionClipboard()){var c=this.getTypes();for(var b=0,a=c.length;b<a;++b){this._crossPageStorage.removeItem(this.STORAGE_KEY+c[b])}}else{this._data.clear()}this.invokeEvent("setData",{dataType:null,data:null});return this},getTypes:function(){if(this._useSessionClipboard()){var a=[];for(var e=0,b=this._crossPageStorage.length;e<b;++e){var d=this._crossPageStorage.key(e);var c=this._extractSessionDataType(d);if(c){a.push(c)}}return a}else{return this._data.getKeys()}},setObjects:function(h,d){var f=[];var g=ObjSerializerFactory.getSerializer("json");for(var c=0,a=d.length;c<a;++c){var b=d[c];var j={};g.save(b,j);f.push(j)}var e=JSON.stringify(f);return this.setData(h,e)},getObjects:function(g){var c=this.getData(g);if(DataType.isSimpleValue(c)){var e=JSON.parse(c);if(!DataType.isArrayValue(e)){e=[e]}var j=[];var f=ObjSerializerFactory.getSerializer("json");for(var d=0,a=e.length;d<a;++d){var h=e[d];var b=f.load(null,h);j.push(b)}return j}else{return c}}});Kekule.ClassUtils.makeSingleton(Kekule.Widget.Clipboard);Kekule.Widget.clipboard=Kekule.Widget.Clipboard.getInstance()})();(function(){Kekule.Widget.EvokeMode={ALWAYS:0,EVOKEE_CLICK:1,EVOKEE_MOUSE_ENTER:2,EVOKEE_MOUSE_LEAVE:3,EVOKEE_MOUSE_DOWN:4,EVOKEE_MOUSE_UP:5,EVOKEE_MOUSE_MOVE:6,EVOKEE_TOUCH:7,EVOKER_CLICK:11,EVOKER_MOUSE_ENTER:12,EVOKER_MOUSE_LEAVE:13,EVOKER_MOUSE_DOWN:14,EVOKER_MOUSE_UP:15,EVOKER_MOUSE_MOVE:16,EVOKER_TOUCH:17,EVOKEE_TIMEOUT:21,EVOKER_TIMEOUT:22};var a=Kekule.Widget.EvokeMode;Kekule.Widget.DynamicEvokeHelper=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.DynamicEvokeHelper",evokeEvents:["click","mouseenter","mouseleave","mousedown","mouseup","touchstart"],DEF_TIMEOUT:5000,initialize:function($super,d,c,b,e,f){$super();this._timeoutRevokeHandle=null;this.reactEvokeEventsBind=this.reactEvokeEvents.bind(this);this.checkTimeoutRevokeBind=this.checkTimeoutRevoke.bind(this);this.setTimeout(f||this.DEF_TIMEOUT);this.setPropStoreFieldValue("evokeModes",b||[]);this.setPropStoreFieldValue("revokeModes",e||[]);this.linkWidgets(d,c)},finalize:function($super){this.unlinkWidgets(this.getEvokee(),this.getEvoker());$super()},initProperties:function(){this.defineProp("evokee",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:null});this.defineProp("evoker",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:null});this.defineProp("evokeModes",{dataType:DataType.ARRAY});this.defineProp("revokeModes",{dataType:DataType.ARRAY});this.defineProp("timeout",{dataType:DataType.INT});this.defineProp("showHideType",{dataType:DataType.INT})},evoke:function(){if(this.getEvoker()){clearTimeout(this._timeoutRevokeHandle);this.getEvoker().show(this.getEvokee(),null,this.getShowHideType());this.postponeTimeoutCheck()}},revoke:function(){if(this.getEvoker()){clearTimeout(this._timeoutRevokeHandle);var b=this.getEvoker().getDocument();b.body.focus();this.getEvoker().hide(this.getEvokee(),null,this.getShowHideType())}},doObjectChange:function($super,c){$super(c);var b=Kekule.ArrayUtils.intersect(c,["evokeModes","revokeModes"]);if(b.length>0){this.evokeModesChanged()}},linkWidgets:function(c,b){this.setPropStoreFieldValue("evokee",c);this.setPropStoreFieldValue("evoker",b);this.installEventHandlers(c,this.evokeEvents,this.reactEvokeEventsBind);this.installEventHandlers(b,this.evokeEvents,this.reactEvokeEventsBind);this.updateOnAlwaysMode()},unlinkWidgets:function(c,b){this.uninstallEventHandlers(c,this.evokeEvents,this.reactEvokeEventsBind);this.uninstallEventHandlers(b,this.evokeEvents,this.reactEvokeEventsBind)},installEventHandlers:function(f,d,e){for(var c=0,b=d.length;c<b;++c){f.addEventListener(d[c],e)}},uninstallEventHandlers:function(f,d,e){for(var c=0,b=d.length;c<b;++c){f.removeEventListener(d[c],e)}},evokeModesChanged:function(){this.updateOnAlwaysMode()},updateOnAlwaysMode:function(){if(this.getEvokeModes().indexOf(a.ALWAYS)>=0){this.evoke()}else{if(this.getRevokeModes().indexOf(a.ALWAYS)>=0){this.revoke()}}},checkTimeoutRevoke:function(j){if(!this.getEvoker()){return}var g=Kekule.DomUtils;var k=this.getEvoker().getDocument();var h=k.activeElement;var b=this.getRevokeModes();var m=[];if(b.indexOf(a.EVOKEE_TIMEOUT)>=0){m.push(this.getEvokee().getElement())}if(b.indexOf(a.EVOKER_TIMEOUT)>=0){m.push(this.getEvoker().getElement())}var f=false;for(var e=0,d=m.length;e<d;++e){var c=m[e];if((h===c)||g.isDescendantOf(h,c)){f=true;break}}if(f){this.postponeTimeoutCheck()}else{this.revoke()}},postponeTimeoutCheck:function(){if(this.hasTimeoutMode(this.getRevokeModes())){if(this.getEvokeModes().indexOf(a.ALWAYS)>=0){return}else{this._timeoutRevokeHandle=setTimeout(this.checkTimeoutRevokeBind,this.getTimeout())}}},hasTimeoutMode:function(b){return Kekule.ArrayUtils.intersect([a.EVOKEE_TIMEOUT,a.EVOKER_TIMEOUT],b).length>0},getEventTypeOfMode:function(b){switch(b){case a.EVOKEE_CLICK:case a.EVOKER_CLICK:return"click";case a.EVOKEE_MOUSE_ENTER:case a.EVOKER_MOUSE_ENTER:return"mouseenter";case a.EVOKEE_MOUSE_LEAVE:case a.EVOKER_MOUSE_LEAVE:return"mouseleave";case a.EVOKEE_MOUSE_DOWN:case a.EVOKER_MOUSE_DOWN:return"mousedown";case a.EVOKEE_MOUSE_UP:case a.EVOKER_MOUSE_UP:return"mouseup";case a.EVOKEE_MOUSE_MOVE:case a.EVOKER_MOUSE_MOVE:return"mousemove";case a.EVOKEE_TOUCH:case a.EVOKER_TOUCH:return"touchstart"}},isEvokeTargetOnEvokee:function(b){return(b>=a.EVOKEE_CLICK)&&(b<=a.EVOKEE_TOUCH)},reactEvokeEvents:function(h){var k=h.htmlEvent.getType();var g=h.target;if((g!==this.getEvokee())&&(g!==this.getEvoker())){return}var d=(h.target===this.getEvokee());var j=!this.getEvoker().isShown();if(j){if((this.getRevokeModes().indexOf(a.ALWAYS)>=0)){return}var f=this.getEvokeModes();for(var c=0,b=f.length;c<b;++c){if(d===this.isEvokeTargetOnEvokee(f[c])&&(k===this.getEventTypeOfMode(f[c]))){this.evoke();return}}}else{if(this.getEvokeModes().indexOf(a.ALWAYS)>=0){return}var f=this.getRevokeModes();for(var c=0,b=f.length;c<b;++c){if(d===this.isEvokeTargetOnEvokee(f[c])&&(k===this.getEventTypeOfMode(f[c]))){this.revoke();return}}}}})})();(function(){var c=Kekule.HtmlElementUtils;Kekule.Widget.StyleResource=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.StyleResource",initialize:function($super,f,e){$super();this.setPropStoreFieldValue("name",f);if(e){this.setCssClassName(e)}},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING,setter:null});this.defineProp("cssClassName",{dataType:DataType.STRING})},linkTo:function(e){c.addClass(this._getElement(e),this.getCssClassName());return this},unlinkFrom:function(e){c.removeClass(this._getElement(e),this.getCssClassName())},_getElement:function(e){if(e instanceof Kekule.Widget.BaseWidget){return e.getElement()}else{return e}}});Kekule.Widget.StyleResourceManager={_resources:{},register:function(f){var e=f.getName();if(e){d._resources[e]=f}return d},unregister:function(f){var e;if(typeof(f)==="string"){e=f}else{if(f.getName){e=f.getName()}}if(e){delete d._resources[e]}return d},getResource:function(e){return d._resources[e]}};Kekule.Widget.StyleResourceNames={PREFIX:"$$",CURSOR_ROTATE:"$$cursor_rotate",CURSOR_ROTATE_NE:"$$cursor_rotate_ne",CURSOR_ROTATE_NW:"$$cursor_rotate_nw",CURSOR_ROTATE_SE:"$$cursor_rotate_se",CURSOR_ROTATE_SW:"$$cursor_rotate_sw",ICON_COLOR_PICK:"$$icon_color_pick",ICON_COLOR_NOTSET:"$$icon_color_default",ICON_COLOR_MIXED:"$$icon_color_mixed",BUTTON_YES_OK:"$$btn_yes_ok",BUTTON_NO_CANCEL:"$$btn_no_cancel",BUTTON_LOAD_FILE:"$$btn_load_file"};var d=Kekule.Widget.StyleResourceManager;var b=Kekule.Widget.StyleResource;var a=Kekule.Widget.StyleResourceNames;d.register(new b(a.CURSOR_ROTATE,"K-Res-Cursor-Rotate"));d.register(new b(a.CURSOR_ROTATE_NE,"K-Res-Cursor-Rotate-NE"));d.register(new b(a.CURSOR_ROTATE_NW,"K-Res-Cursor-Rotate-NW"));d.register(new b(a.CURSOR_ROTATE_SE,"K-Res-Cursor-Rotate-SE"));d.register(new b(a.CURSOR_ROTATE_SW,"K-Res-Cursor-Rotate-SW"));d.register(new b(a.ICON_COLOR_PICK,"K-Res-Icon-Color-Pick"));d.register(new b(a.ICON_COLOR_NOTSET,"K-Res-Icon-Color-NotSet"));d.register(new b(a.ICON_COLOR_MIXED,"K-Res-Icon-Color-Mixed"));d.register(new b(a.BUTTON_YES_OK,"K-Res-Button-YesOk"));d.register(new b(a.BUTTON_NO_CANCEL,"K-Res-Button-NoCancel"));d.register(new b(a.BUTTON_LOAD_FILE,"K-Res-Button-LoadFile"))})();(function(){var b=Kekule.DomUtils;var a=Kekule.ArrayUtils;Kekule.Widget.AutoLauncher=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.AutoLauncher",WIDGET_ATTRIB:"data-widget",WIDGET_ATTRIB_ALT:"data-kekule-widget",FIELD_PARENT_WIDGET_ELEM:"__$kekule_parent_widget_elem$__",initialize:function($super){$super();this._executingFlag=0;this._pendingWidgetRefMap=new Kekule.MapEx(true);var d=this;Kekule.Widget.Utils._setWidgetRefPropFromId=function(h,g,i){if(i){var e=Kekule.Widget.getWidgetById(i,h.getDocument());if(e){h.setPropValue(g,e)}else{var f=h.getDocument().getElementById(i);if(f&&d.isExecuting()){d.addPendingWidgetRefItem(f,h,g)}}}}},finalize:function($super){this._pendingWidgetRefMap=null;$super()},getPendingWidgetRefMap:function(){return this._pendingWidgetRefMap},addPendingWidgetRefItem:function(d,f,e){this._pendingWidgetRefMap.set(d,{widget:f,propName:e})},removePendingWidgetRefItem:function(d){this._pendingWidgetRefMap.remove(d)},handlePendingWidgetRef:function(){var j=this._pendingWidgetRefMap.getKeys();for(var f=0,d=j.length;f<d;++f){var h=j[f];var e=Kekule.Widget.getWidgetOnElem(h);if(e){var g=this._pendingWidgetRefMap.get(h);g.widget.setPropValue(g.propName,e)}}},beginExec:function(){++this._executingFlag},endExec:function(){if(this._executingFlag>0){--this._executingFlag}if(this._executingFlag<=0){this.handlePendingWidgetRef()}},isExecuting:function(){return this._executingFlag>0},execute:function(d){this.beginExec();try{if(typeof(d.querySelector)==="function"){this.executeOnElemBySelector(d.ownerDocument,d,null)}else{this.executeOnElem(d.ownerDocument,d,null)}}finally{this.endExec()}},executeOnElem:function(n,g,d){if(g.isContentEditable&&!Kekule.Widget.AutoLauncher.enableOnEditable){return}var k;var m=d;k=this.createWidgetOnElem(n,g,m);if(k){m=k}if(!k||Kekule.Widget.AutoLauncher.enableCascadeLaunch){var f=b.getDirectChildElems(g);for(var j=0,h=f.length;j<h;++j){var e=f[j];this.executeOnElem(n,e,m)}}},executeOnElemBySelector:function(o,f,e){var j="["+this.WIDGET_ATTRIB+"],["+this.WIDGET_ATTRIB_ALT+"]";var d=f.querySelectorAll(j);if(d&&d.length){for(var m=0,h=d.length;m<h;++m){var g=d[m];var n=this._findParentCandidateElem(g,d,0,m-1);if(n){g[this.FIELD_PARENT_WIDGET_ELEM]=n}}for(var m=0,h=d.length;m<h;++m){var g=d[m];if(g.isContentEditable&&!Kekule.Widget.AutoLauncher.enableOnEditable){continue}var p=g[this.FIELD_PARENT_WIDGET_ELEM]||null;if(Kekule.Widget.AutoLauncher.enableCascadeLaunch||!p){var k=null;if(p){var k=Kekule.Widget.getWidgetOnElem(p)}this.createWidgetOnElem(o,g,k)}}}},_findParentCandidateElem:function(j,e,h,k){var d=null;var g=j.parentNode;while(g&&!d){for(var f=k;f>=h;--f){if(g===e[f]){d=e[f];return d}}if(!d){g=g.parentNode}}return d},createWidgetOnElem:function(i,h,e){var d=null;var f=Kekule.Widget.getWidgetOnElem(h);if(f){return f}var g=h.getAttribute(this.WIDGET_ATTRIB);if(!g){g=h.getAttribute(this.WIDGET_ATTRIB_ALT)}if(g){var j=this.getWidgetClass(g);if(j){d=new j(h);if(d){if(e){d.setParent(e)}}}}return d},getWidgetClass:function(d){return ClassEx.findClass(d)}});Kekule.ClassUtils.makeSingleton(Kekule.Widget.AutoLauncher);Kekule.Widget.autoLauncher=Kekule.Widget.AutoLauncher.getInstance();Kekule.Widget.AutoLauncher.enabled=true;Kekule.Widget.AutoLauncher.enableCascadeLaunch=true;Kekule.Widget.AutoLauncher.enableDynamicDomCheck=true;Kekule.Widget.AutoLauncher.enableOnEditable=false;var c=function(){if(c.done){return}if(!Kekule._isLoaded()){Kekule._registerAfterLoadProc(c);return}if(Kekule.Widget.AutoLauncher.enabled){Kekule.Widget.autoLauncher.execute(document.body)}if(Kekule.X.MutationObserver){var d=new Kekule.X.MutationObserver(function(g){if(Kekule.Widget.AutoLauncher.enableDynamicDomCheck){for(var p=0,f=g.length;p<f;++p){var e=g[p];if(e.type==="childList"){var o=e.addedNodes;for(var n=0,h=o.length;n<h;++n){var q=o[n];if(q.nodeType===Node.ELEMENT_NODE){Kekule.Widget.autoLauncher.execute(q)}}}}}});d.observe(document.body,{childList:true,subtree:true})}else{Kekule.X.Event.addListener(document,"DOMNodeInserted",function(g){if(Kekule.Widget.AutoLauncher.enableDynamicDomCheck){var f=g.getTarget();if(f.nodeType===(Node.ELEMENT_NODE||1)){Kekule.Widget.autoLauncher.execute(f)}}})}c.done=true};Kekule.X.domReady(c)})();(function(){var b=Kekule.Widget.Direction;SU=Kekule.StyleUtils;Kekule.Widget.BaseTransition=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.BaseTransition",initialize:function($super){$super()},initProperties:function(){this.defineProp("element",{dataType:DataType.OBJECT,serializable:false});this.defineProp("caller",{dataType:DataType.OBJECT,serializable:false})},canExecute:function(d,c){return true},prepare:function(e,d,c){},finish:function(e,d,c){},execute:function(h,g,j,f){this.setElement(h);if(g){this.setCaller(g)}var i=Object.extend({from:0,to:1},f);var e=this;var d=function(){if(d.__$applied__){return}d.__$applied__=true;e.finish(h,g,i);if(j){j()}};d.__$applied__=false;this.prepare(h,g,i);var e=this;var c={element:h,caller:g,callback:j,doneCallback:d,options:f,executor:this,halt:function(){e.halt(c)}};this.doExecute(h,g,d,i);return c},doExecute:function(e,d,f,c){},halt:function(c){if(c.executor!==this){c.executor.halt(c)}else{this.doHalt(c);if(c.doneCallback){c.doneCallback()}}},doHalt:function(c){},setElementProp:function(e,c,d){}});Kekule.Widget.Css3Transition=Class.create(Kekule.Widget.BaseTransition,{CLASS_NAME:"Kekule.Widget.Css3Transition",initialize:function($super){$super()},initProperties:function(){this.defineProp("cssProperty",{dataType:DataType.STRING});this.defineProp("timingFunc",{dataType:DataType.STRING})},getAffectedCssPropNames:function(c){},getTransCssPropNames:function(c){},storeCssInlineValues:function(g,j){var h=g.style;var c={};for(var f=0,d=j.length;f<d;++f){var e=j[f];c[e]=h[e]}return c},restoreCssInlineValues:function(g,m,k){var h=g.style;for(var f=0,c=m.length;f<c;++f){var d=m[f];if(!k[d]){try{h.removeProperty(d)}catch(j){h[d]=""}}else{h[d]=k[d]}}},storeCssComputedValues:function(g,j){var c={};for(var f=0,d=j.length;f<d;++f){var e=j[f];var h=SU.getComputedStyle(g,e);c[e]=h}return c},canExecute:function(d,c){return Kekule.BrowserFeature.cssTransition},isSupported:function(){return Kekule.BrowserFeature.cssTransition},isAppear:function(c){return !!c.isAppear},isDisappear:function(c){return !!c.isDisappear},setTransitionProp:function(g,f,e){var h=["Moz"+f.capitalizeFirst(),"Webkit"+f.capitalizeFirst(),f];for(var d=0,c=h.length;d<c;++d){g[h[d]]=e}},getOriginCssInlineValues:function(){return this._originCssInlineValues},getComputedCssValues:function(){return this._computedCssValues},prepare:function(f,e,d){this.setCssProperty(this.getTransCssPropNames(d).join(","));var c=this.getAffectedCssPropNames(d);this._affectedCssPropNames=c;this._originCssInlineValues=this.storeCssInlineValues(f,c);this._computedCssValues=this.storeCssComputedValues(f,c)},finish:function(e,d,c){if((c.to===1)||this.isAppear(c)||this.isDisappear(c)){this.restoreCssInlineValues(e,this._affectedCssPropNames,this._originCssInlineValues)}},doExecute:function(g,d,l,p){var h=Kekule.StyleUtils;var c=g.style;var j=this.isAppear(p);var k=this.isDisappear(p);if(this.isSupported()){this.setElementProp(g,p.from,p);if(!h.isDisplayed(g)){h.setDisplay(g,true)}if(!h.isVisible(g)){h.setVisibility(g,true)}var o=this.getCssProperty();this.setTransitionProp(c,"transitionProperty",o);o=this.getTimingFunc();if(o){this.setTransitionProp(c,"transitionTimingFunction",o)}o=p.duration.toString()+"ms";this.setTransitionProp(c,"transitionDuration",o);var n;var m=this;var f=function(q){Kekule.X.Event.removeListener(g,"transitionend",f);m.setTransitionProp(c,"transition","");if(n){clearTimeout(n)}if(l){l()}};this._currEventHandler=f;Kekule.X.Event.addListener(g,"transitionend",f);n=setTimeout(f,p.duration+100);setTimeout(function(){m.setElementProp(g,p.to,p)},0)}else{try{this.setElementProp(g,p.to,p)}catch(i){}if(l){setTimeout(l,0)}}},doHalt:function(c){var d=c.element;if(d){this.setTransitionProp(d.style,"transitionProperty","none")}}});Kekule.Widget.Css3OpacityTrans=Class.create(Kekule.Widget.Css3Transition,{CLASS_NAME:"Kekule.Widget.Css3OpacityTrans",getAffectedCssPropNames:function(c){return["opacity"]},getTransCssPropNames:function(c){return["opacity"]},setElementProp:function(e,c,d){var f=parseFloat(this._computedCssValues.opacity)||1;e.style.opacity=f*c}});Kekule.Widget.Css3SlideTransition=Class.create(Kekule.Widget.Css3Transition,{CLASS_NAME:"Kekule.Widget.Css3SlideTransition",initialize:function($super,c){$super();if(Kekule.ObjUtils.notUnset(c)){this.setDirection(c)}},initProperties:function(){this.defineProp("direction",{dataType:DataType.INT})},canExecute:function($super,d,c){return true},prepare:function($super,e,d,c){SU.setDisplay(e,true);this._direction=this.getActualDirection(e,c);$super(e,d,c);e.style.overflow="hidden";this._clearDimesionConstraints(e)},_clearDimesionConstraints:function(d){var c=d.style;c.minWidth="0";c.minHeight="0";c.maxWidth="none";c.maxHeight="none"},setElementProp:function(d,e,k){var f=this._direction;var j;if(b.isInHorizontal(f)){j=this.getComputedCssValues().width;var i=SU.analysisUnitsValue(j);d.style.width=i.value*e+i.units;j=this.getComputedCssValues().left;if(j){var c=SU.analysisUnitsValue(j);if(c.units===i.units){d.style.left=(i.value*(1-e)+c.value)+c.units}}}if(b.isInVertical(f)){j=this.getComputedCssValues().height;var g=SU.analysisUnitsValue(j);d.style.height=g.value*e+g.units;j=this.getComputedCssValues().top;if(j){var h=SU.analysisUnitsValue(j);if(h.units===g.units){d.style.top=(g.value*(1-e)+h.value)+h.units}}}},getAffectedCssPropNames:function(d){var c=[].concat(this.getTransCssPropNames(d));c=c.concat(["overflow","min-width","min-height","max-width","max-height"]);return c},getTransCssPropNames:function(d){var e=this.getActualDirection(this.getElement(),d);var c=[];if(b.isInHorizontal(e)){c.push("width");if(e&b.RTL){c.push("left")}}if(b.isInVertical(e)){c.push("height");if(e&b.BTT){c.push("top")}}return c},getRefRect:function(d){var c;var e=Kekule.HtmlElementUtils;if(this.getCaller()){c=e.getElemPageRect(this.getCaller());if(Kekule.RectUtils.isZero(c)){c=(d||{}).callerPageRect||null}}else{c=null}return c},getActualDirection:function(k,i){if(!k){k=this.getElement()}var c=Kekule.Widget.Direction;var j=Kekule.HtmlElementUtils;var o=this.getDirection();if(!o||(o===c.AUTO)){var d=this.getRefRect(i);if(!d){o=c.TTB}else{var m={x:d.x+d.width/2,y:d.y+d.height/2};var e=j.getElemPagePos(k);var l=j.getElemClientDimension(k);var f={x:e.x+(l.width||0)/2,y:e.y+(l.height||0)/2};var n=Kekule.CoordUtils.substract(f,m);if(d.width<1){o=(n.x>=0)?c.LTR:c.RTL}else{if(n.x<1){o=(n.y>=0)?c.TTB:c.BTT}else{var h=Math.abs(d.height/d.width);var g=Math.abs(n.y/n.x);if(h>g){o=(n.x>=0)?c.LTR:c.RTL}else{o=(n.y>=0)?c.TTB:c.BTT}}}}}return o}});Kekule.Widget.Css3GrowTransition=Class.create(Kekule.Widget.Css3Transition,{CLASS_NAME:"Kekule.Widget.Css3GrowTransition",initialize:function($super,c){$super();if(c){if(c.ownerDocument){this.setBaseElement(c)}else{this.setCaller(c)}}},initProperties:function(){this.defineProp("baseRect",{dataType:DataType.HASH})},getRefRect:function(d){var e=Kekule.HtmlElementUtils;var c=null;if(this.getBaseRect()){c=this.getBaseRect()}else{if(this.getCaller()){c=e.getElemPageRect(this.getCaller());if(Kekule.RectUtils.isZero(c)){c=(d||{}).callerPageRect||null}}}if(!c){c={x:0,y:0,width:0,height:0}}return c},canExecute:function($super,d,c){return true},prepare:function($super,f,d,j){SU.setDisplay(f,true);$super(f,d,j);f.style.overflow="hidden";Kekule.HtmlElementUtils.makePositioned(f);var c=this.getRefRect(j);var e=Kekule.HtmlElementUtils;var h=e.getElemPagePos(f);var g=e.getElemClientDimension(f);var i={x:h.x-c.x,y:h.y-c.y,width:g.width-c.width,height:g.height-c.height};this._delta=i;this._clearDimesionConstraints(f)},_clearDimesionConstraints:function(d){var c=d.style;c.minWidth="0";c.minHeight="0";c.maxWidth="none";c.maxHeight="none"},setElementProp:function(e,c,d){var j=this.getComputedCssValues();var i=this._delta;var g=1-c;var f=e.style;var h=SU.analysisUnitsValue(j.left);if(h.units==="px"){f.left=(h.value-g*i.x)+"px"}var h=SU.analysisUnitsValue(j.top);if(h.units==="px"){f.top=(h.value-g*i.y)+"px"}var h=SU.analysisUnitsValue(j.width);if(h.units==="px"){f.width=(h.value-g*i.width)+"px"}var h=SU.analysisUnitsValue(j.height);if(h.units==="px"){f.height=(h.value-g*i.height)+"px"}},getAffectedCssPropNames:function(d){var c=[].concat(this.getTransCssPropNames(d));c=c.concat(["overflow","min-width","min-height","max-width","max-height"]);return c},getTransCssPropNames:function(c){return["left","top","width","height","position"]}});Kekule.Widget.Css3TransitionSimpleClassCreator={create:function(g,e,d,f){var c=Class.create(Kekule.Widget.Css3Transition,{CLASS_NAME:g,initialize:function($super){$super();this.setCssProperty(e);this.setTimingFunc(d)}});if(f){c=ClassEx.extend(c,f)}return c}};var a=Kekule.Widget.Css3TransitionSimpleClassCreator})();(function(){SU=Kekule.StyleUtils;Kekule.Widget.ShowHideManager=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.ShowHideManager",initialize:function($super){$super();this.setEnableTransition(true);this.setShowDuration(300);this.setHideDuration(300)},initProperties:function(){this.defineProp("enableTransition",{dataType:DataType.BOOL});this.defineProp("transitionSelector",{dataType:"Kekule.Widget.ShowHideTransitionSelector",serializable:false});this.defineProp("showDuration",{dataType:DataType.INT});this.defineProp("hideDuration",{dataType:DataType.INT})},_getCallerElement:function(c){if(!c){return null}else{return c.getElement?c.getElement():Kekule.DomUtils.isElement(c)?c:null}},isUsingTransition:function(){return this.getEnableTransition()&&this.getTransitionSelector()},selectTransition:function(g,f,e){var d=this.getTransitionSelector();if(!d){return null}else{var c=d.selectTransition(g,f,e);if(c&&f){c.setCaller(this._getCallerElement(f))}}return c},show:function(h,e,j,i,g){var f=Object.extend(g||{},{from:0,to:1,isAppear:true,duration:this.getShowDuration()});var c=this.selectTransition(h,e,i);if(c&&this.isUsingTransition()&&c.canExecute(h.getElement(),f)){var d=function(k){h.setVisible(true,true);h.setDisplayed(true,true);if(j){j()}};return c.execute(h.getElement(),this._getCallerElement(e),d,f)}else{h.setVisible(true,true);h.setDisplayed(true,true);if(j){j()}}return null},hide:function(h,c,j,e,i,f){var d=Object.extend(f,{from:1,to:0,isDisappear:true,duration:this.getHideDuration()});var i=!!f.useVisible;var k=this.selectTransition(h,c,e);if(k&&this.isUsingTransition()&&k.canExecute(h.getElement(),d)){var g=function(){if(h){if(i){h.setVisible(false,true)}else{h.setDisplayed(false,true)}}if(j){j()}};return k.execute(h.getElement(),this._getCallerElement(c),g,d)}else{if(i){h.setVisible(false,true)}else{h.setDisplayed(false,true)}if(j){j()}}return null}});Kekule.ClassUtils.makeSingleton(Kekule.Widget.ShowHideManager);Kekule.Widget.showHideManager=Kekule.Widget.ShowHideManager.getInstance();Kekule.Widget.ShowHideTransitionSelector=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.ShowHideTransitionSelector",initialize:function($super){$super();this.setTransitionClassMap({})},initProperties:function(){this.defineProp("transitionClassMap",{dataType:DataType.OBJECT,serializable:false})},_getTransClassOfType:function(c){var d=this.getTransitionClassMap();return d[c]||d[Kekule.Widget.ShowHideType.DEFAULT]},addTransitionClass:function(c,d){this.getTransitionClassMap()[c]=d},selectTransition:function(g,d,c){var f;var e=Kekule.Widget.ShowHideType;if(d){f=this._getTransClassOfType(c)}else{f=this._getTransClassOfType(Kekule.Widget.ShowHideType.DEFAULT)}if(f){return new f()}else{return null}}});var b=new Kekule.Widget.ShowHideTransitionSelector();var a=Kekule.Widget.ShowHideType;b.addTransitionClass(a.DEFAULT,Kekule.Widget.Css3OpacityTrans);b.addTransitionClass(a.DROPDOWN,Kekule.Widget.Css3SlideTransition);b.addTransitionClass(a.POPUP,Kekule.Widget.Css3GrowTransition);b.addTransitionClass(a.DIALOG,Kekule.Widget.Css3GrowTransition);Kekule.Widget.showHideManager.setTransitionSelector(b)})();(function(){var c=Kekule.HtmlElementUtils;var b=Kekule.X.Event;var a=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{RESIZEGRIPPER:"K-Resize-Gripper"});var d=Class.PropertyScope;Kekule.Widget.ResizeGripper=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.ResizeGripper",BINDABLE_TAG_NAMES:["div","span"],initialize:function($super,f){this.reactMousemoveBind=this.reactMousemove.bind(this);this.reactMouseupBind=this.reactMouseup.bind(this);this.reactTouchmoveBind=this.reactTouchmove.bind(this);this.reactTouchendBind=this.reactTouchend.bind(this);$super(f);if(!this.getTarget()){if(this.getParent()){this.setTarget(this.getParent())}else{var e=this.getElement().parentNode;if(e){this.setTarget(e)}}}},initProperties:function(){this.defineProp("target",{dataType:DataType.OBJECT,serializable:false,setter:function(e){if(this.getTarget()!==e){this.setPropStoreFieldValue("target",e);this.targetChanged(e)}}});this.defineProp("retainAspectRatio",{dataType:DataType.BOOL});this.defineProp("isUnderResizing",{dataType:DataType.BOOL,serializable:false,setter:null,scope:d.PRIVATE});this.defineProp("baseCoord",{dataType:DataType.HASH,serializable:false,scope:d.PRIVATE});this.defineProp("baseDimension",{dataType:DataType.HASH,serializable:false,scope:d.PRIVATE});this.defineProp("baseAspectRatio",{dataType:DataType.FLOAT,serializable:false,scope:d.PRIVATE})},doGetWidgetClassName:function($super){return $super()+" "+a.RESIZEGRIPPER},doCreateRootElement:function(f){var e=f.createElement("span");return e},targetChanged:function(f){var e;if(this.targetIsWidget(f)){e=f.getResizerElement?f.getResizerElement():f.getCoreElement()}else{e=f}if(e){this.appendToElem(e)}},targetIsWidget:function(e){return e instanceof Kekule.Widget.BaseWidget},getTargetDimension:function(f){var e=f||this.getTarget();if(this.targetIsWidget(e)){return e.getDimension()}else{return Kekule.HtmlElementUtils.getElemBoundingClientRect(e,false)}},setTargetDimension:function(i,g,e){var h=i||this.getTarget();if(this.targetIsWidget(h)){h.setDimension(g,e)}else{var f=h.style;f.width=g+"px";f.height=e+"px"}},prepareResizing:function(f){if(!this.getIsUnderResizing()){var e=this._getMoveEventReceiverElem(this.getElement());this._installEventHandlers(e);this._setMouseCapture(this.getElement(),true);this.setBaseCoord(f);var g=this.getTargetDimension();this.setBaseDimension(g);this.setBaseAspectRatio(g.width/g.height);this.setPropStoreFieldValue("isUnderResizing",true)}},doneResizing:function(){this._setMouseCapture(this.getElement(),false);var e=this._getMoveEventReceiverElem(this.getElement());this._uninstallEventHandlers(e);this.setBaseCoord(null);this.setBaseDimension(null);this.setPropStoreFieldValue("isUnderResizing",false)},resizeTo:function(j){var k=Kekule.CoordUtils.substract(j,this.getBaseCoord());var e=this.getBaseDimension();var f=e.width+k.x;var i=e.height+k.y;if(this.getRetainAspectRatio()){var g=this.getBaseAspectRatio();if(f/i>g){f=g*i}else{if(f/i<g){i=f/g}}}this.setTargetDimension(this.getTarget(),f,i)},reactMousemove:function(f){if(this.getIsUnderResizing()){var g={x:f.getScreenX(),y:f.getScreenY()};this.resizeTo(g);f.stopPropagation();f.preventDefault()}},reactMouseup:function(f){if(f.getButton()===Kekule.X.Event.MouseButton.LEFT){if(this.getIsUnderResizing()){this.doneResizing();f.preventDefault()}}},reactTouchmove:function(f){if(this.getIsUnderResizing()){var g={x:f.getScreenX(),y:f.getScreenY()};this.resizeTo(g);f.stopPropagation();f.preventDefault()}},reactTouchend:function(f){if(this.getIsUnderResizing()){this.doneResizing();f.preventDefault()}},_elemSupportCapture:function(e){return !!e.setCapture},_setMouseCapture:function(f,e){if(f){if(e){if(f.setCapture){f.setCapture(true)}}else{if(f.releaseCapture){f.releaseCapture()}}}},_getMoveEventReceiverElem:function(e){return(this._elemSupportCapture(e))?e:e.ownerDocument.documentElement},_installEventHandlers:function(e){b.addListener(e,"mousemove",this.reactMousemoveBind);b.addListener(e,"touchmove",this.reactTouchmoveBind);b.addListener(e,"mouseup",this.reactMouseupBind);b.addListener(e,"touchend",this.reactTouchendBind)},_uninstallEventHandlers:function(e){b.removeListener(e,"mousemove",this.reactMousemoveBind);b.removeListener(e,"touchmove",this.reactTouchmoveBind);b.removeListener(e,"mouseup",this.reactMouseupBind);b.removeListener(e,"touchend",this.reactTouchendBind)},doReactActiviting:function($super,f){$super(f);var g={x:f.getScreenX(),y:f.getScreenY()};this.prepareResizing(g)}});ClassEx.extend(Kekule.Widget.BaseWidget,{resizableChanged:function(){if(this.getResizable()){var e=new Kekule.Widget.ResizeGripper(this);e.setRetainAspectRatio(this.getResizeWithAspectRatio());this.setPropStoreFieldValue("resizeGripper",e)}else{var e=this.getResizeGripper();if(e){e.finalize()}this.setPropStoreFieldValue("resizeGripper",null)}}});ClassEx.defineProps(Kekule.Widget.BaseWidget,[{name:"resizable",dataType:DataType.BOOL,setter:function(e){if(e!==this.getResizable()){this.setPropStoreFieldValue("resizable",e);this.resizableChanged()}}},{name:"resizeWithAspectRatio",dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("resizeWithAspectRatio",e);if(this.getResizeGripper()){this.getResizeGripper().setRetainAspectRatio(e)}}},{name:"isResizing",dataType:DataType.BOOL,serializable:false,scope:d.PRIVATE,setter:null,getter:function(){var e=this.getResizeGripper();return e?e.getIsUnderResizing():false}},{name:"resizeGripper",dataType:"Kekule.Widget.ResizeGripper",serializable:false,setter:null,scope:d.PRIVATE}])})();(function(){var c=Kekule.HtmlElementUtils;var a=Kekule.StyleUtils;var b=Kekule.X.Event;var d=Class.PropertyScope;Kekule.Widget.MoveHelper=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.MoveHelper",initialize:function($super,f,e){$super();this.reactMouseDownBind=this.reactMouseDown.bind(this);this.reactMouseUpBind=this.reactMouseUp.bind(this);this.reactMouseMoveBind=this.reactMouseMove.bind(this);this.reactTouchDownBind=this.reactTouchDown.bind(this);this.reactTouchEndBind=this.reactTouchEnd.bind(this);this.reactTouchMoveBind=this.reactTouchMove.bind(this);this.__$K_initialMoverInfo__={};this.setCssPropX("left").setCssPropY("top").setMovingCursor("move").setMovingCursorDelay(500);this.setTarget(f);this.setGripper(e);this.setEnabled(true)},doFinalize:function($super){this.setGripper(null);$super()},initProperties:function(){this.defineProp("enabled",{dataType:DataType.BOOL});this.defineProp("target",{dataType:DataType.OBJECT,serializable:false});this.defineProp("gripper",{dataType:DataType.OBJECT,serializable:false,getter:function(){return this.getPropStoreFieldValue("gripper")||this.getTarget()},setter:function(f){var e=this.getPropStoreFieldValue("gripper");if(f!==e){this.setPropStoreFieldValue("gripper",f);this.gripperChanged(f,e)}}});this.defineProp("isMoving",{dataType:DataType.BOOL,serializable:false});this.defineProp("cssPropX",{dataType:DataType.STRING});this.defineProp("cssPropY",{dataType:DataType.STRING});this.defineProp("movingCursor",{dataType:DataType.STRING});this.defineProp("movingCursorDelay",{dataType:DataType.INT});this.defineProp("movable",{dataType:DataType.BOOL,setter:null,getter:function(){return this.getEnabled()&&this.getGripper()}})},_objIsWidget:function(e){return e instanceof Kekule.Widget.BaseWidget},_getElement:function(e){if(this._objIsWidget(e)){return e.getElement()}else{return e}},getTargetElement:function(){var e=this.getTarget();return this._objIsWidget(e)?e.getElement():e},getGripperElement:function(){var e=this.getGripper();return this._objIsWidget(e)?e.getElement():e},gripperChanged:function(f,e){if(e){this.installEventHandlers(this._getElement(e))}if(f){this.installEventHandlers(this._getElement(f))}},installEventHandlers:function(e){if(e){b.addListener(e,"mousedown",this.reactMouseDownBind);b.addListener(e,"touchstart",this.reactTouchDownBind)}},uninstallEventHandlers:function(e){if(e){b.removeListener(e,"mousedown",this.reactMouseDownBind);b.removeListener(e,"touchstart",this.reactTouchDownBind)}},_elemSupportCapture:function(e){return !!e.setCapture},_getMoveEventReceiverElem:function(e){return(this._elemSupportCapture(e))?e:e.ownerDocument.documentElement},setMouseCapture:function(e){var f=this.getGripperElement();if(f){if(e){if(f.setCapture){f.setCapture(true)}}else{if(f.releaseCapture){f.releaseCapture()}}}},beginMoving:function(f){if(this.getIsMoving()){return}var g=this.getTargetElement();c.makePositioned(g);this.saveInitialInformation(f);var e=this._getMoveEventReceiverElem(this.getGripperElement());b.addListener(e,"mousemove",this.reactMouseMoveBind);b.addListener(e,"touchmove",this.reactTouchMoveBind);b.addListener(e,"mouseup",this.reactMouseUpBind);b.addListener(e,"touchend",this.reactTouchEndBind);this.setMouseCapture(true);this._setCursorHandle=this.delaySetMoveCursor();this.setIsMoving(true)},endMoving:function(){this.setIsMoving(false);this.setMouseCapture(false);var e=this.getGripperElement();var f=this._getMoveEventReceiverElem(e);b.removeListener(f,"mousemove",this.reactMouseMoveBind);b.removeListener(f,"touchmove",this.reactTouchMoveBind);b.removeListener(f,"mouseup",this.reactMouseUpBind);b.removeListener(f,"touchend",this.reactTouchEndBind);this.clearCursorSetter();if(e){var g=this.__$K_initialMoverInfo__.cursor;e.style.cursor=g||"";this.__$K_initialMoverInfo__.cursor=null}},moveTo:function(f){this.clearCursorSetter();this.doSetMoveCursor();var h=this.getTargetElement();if(!h){return}var e=this.__$K_initialMoverInfo__;var g=Kekule.CoordUtils.substract(f,e.pointerCoord);if((this.getCssPropX()||"").toLowerCase()==="right"){h.style.right=(e.elemCoord.x-g.x)+"px"}else{h.style.left=(e.elemCoord.x+g.x)+"px"}if((this.getCssPropY()||"").toLowerCase()==="bottom"){h.style.bottom=(e.elemCoord.y-g.y)+"px"}else{h.style.top=(e.elemCoord.y+g.y)+"px"}},delaySetMoveCursor:function(){return setTimeout(this.doSetMoveCursor.bind(this),this.getMovingCursorDelay()||0)},doSetMoveCursor:function(){var e=this.getGripperElement();if(e&&this.getMovingCursor()){e.style.cursor=this.getMovingCursor()}},clearCursorSetter:function(){if(this._setCursorHandle){clearTimeout(this._setCursorHandle)}},saveInitialInformation:function(m){var g=this.getTargetElement();if(g){this.__$K_initialMoverInfo__.pointerCoord=m;var j;var e=(a.getComputedStyle(g,"position")||"").toLowerCase();var k=(this.getCssPropX()||"left").toLowerCase();var i=(this.getCssPropY()||"top").toLowerCase();if(e==="relative"){var f=a.analysisUnitsValue(a.getComputedStyle(g,"left")).value||0;var l=a.analysisUnitsValue(a.getComputedStyle(g,"top")).value||0;j={x:f,y:l};k="left";i="top"}else{j={x:g.offsetLeft,y:g.offsetTop}}var h=c.getElemOffsetDimension(g);if(k==="right"){j.x+=h.width}if(i==="bottom"){j.y+=h.height}this.__$K_initialMoverInfo__.elemCoord=j;if(this.getGripperElement()){this.__$K_initialMoverInfo__.cursor=this.getGripperElement().style.cursor}}},reactMouseDown:function(f){if(this.getTargetElement()&&this.getEnabled()){if(f.getButton()===b.MouseButton.LEFT){this.beginMoving({x:f.getScreenX(),y:f.getScreenY()},f.getTarget());f.preventDefault()}}},reactMouseUp:function(f){if(f.getButton()===b.MouseButton.LEFT){if(this.getIsMoving()){this.endMoving();f.preventDefault()}}},reactMouseMove:function(g){if(this.getIsMoving()){var f={x:g.getScreenX(),y:g.getScreenY()};this.moveTo(f);g.preventDefault()}},reactTouchDown:function(f){if(this.getEnabled()){this.beginMoving({x:f.getScreenX(),y:f.getScreenY()},f.getTarget());f.preventDefault()}},reactTouchEnd:function(f){if(this.getIsMoving()){this.endMoving();f.preventDefault()}},reactTouchMove:function(f){if(this.getIsMoving()){var g={x:f.getScreenX(),y:f.getScreenY()};this.moveTo(g);f.preventDefault()}}});ClassEx.extend(Kekule.Widget.BaseWidget,{_getMoveHelper:function(f){var e=this.getMoveHelper();if(!e&&f){e=new Kekule.Widget.MoveHelper(this)}return e},movingGripperChanged:function(){var e=this.getMovingGripper();if(e){var f=this._getMoveHelper(true);f.setGripper(e)}else{var f=this._getMoveHelper(false);if(f){f.setGripper(null)}}}});ClassEx.defineProps(Kekule.Widget.BaseWidget,[{name:"movable",dataType:DataType.BOOL,getter:function(){return this._getMoveHelper()&&this._getMoveHelper().getMovable()},setter:function(g){var e=this.getMovable();if(g!==e){if(g){this.setMovingGripper((this.getDefaultMovingGripper&&this.getDefaultMovingGripper())||this)}else{var f=this._getMoveHelper();if(f){f.setEnabled(false)}}}}},{name:"movingGripper",dataType:DataType.OBJECT,setter:function(e){if(e!==this.getMovingGripper()){this.setPropStoreFieldValue("movingGripper",e);this.movingGripperChanged()}}},{name:"isMoving",dataType:DataType.BOOL,serializable:false,scope:d.PRIVATE,setter:null,getter:function(){var e=this.getMoveHelper();return e?e.getIsMoving():false}},{name:"moveHelper",dataType:"Kekule.Widget.MoveHelper",serializable:false,setter:null,scope:d.PRIVATE}])})();(function(){var b=Kekule.HtmlElementUtils;var a=Kekule.Widget.HtmlClassNames;Kekule.Widget.Glyph=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.Glyph",initialize:function($super,c,d){this._imgElem=null;$super(c);if(d){this.setNormalInfo(d)}},initProperties:function(){this.defineImgInfoProp("normalInfo",{dataType:DataType.HASH});this.defineImgInfoProp("hoverInfo",{dataType:DataType.HASH});this.defineImgInfoProp("focusedInfo",{dataType:DataType.HASH});this.defineImgInfoProp("activeInfo",{dataType:DataType.HASH});this.defineImgInfoProp("disabledInfo",{dataType:DataType.HASH})},defineImgInfoProp:function(e,c){var d=Object.extend({setter:function(f){if(f){this.setPropStoreFieldValue(e,Object.extend({},f))}else{this.setPropStoreFieldValue(e,null)}this.imgInfoChanged()}},c);return this.defineProp(e,d)},doGetWidgetClassName:function(){return"K-Glyph"},doCreateRootElement:function(d){var c=d.createElement("span");return c},doBindElement:function($super,c){$super();this.createImgContainer(c)},createImgContainer:function(c,e){var d=c.ownerDocument;this._imgElem=d.createElement("span");this._imgElem.className=a.FULLFILL;c.innerHTML="";c.appendChild(this._imgElem)},imgInfoChanged:function(){this.updateImg()},stateChanged:function($super){$super();this.updateImg()},updateImg:function(){var c=Kekule.Widget.State;var d=this.getState();var e=(d===c.DISABLED)?this.getDisabledInfo():(d===c.ACTIVE)?this.getActiveInfo()||this.getHoverInfo()||this.getFocusedInfo():(d===c.HOVER)?this.getHoverInfo():(d===c.FOCUSED)?this.getFocusedInfo():this.getNormalInfo();e=e||this.getNormalInfo();this.showImgOfInfo(e)},showImgOfInfo:function(d){var c=this._imgElem;if(c){if(d){if(d.className){c.className=a.FULLFILL;b.addClass(c,d.className)}else{c.className=a.FULLFILL}c.style.backgroundImage=d.src?"url("+d.src+")":"";c.style.backgroundPosition=d.position||"";c.style.backgroundRepeat=d.repeat||"no-repeat"}else{c.style.backgroundImage=""}}}})})();(function(){Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{CONTAINER:"K-Container",PANEL:"K-Panel",TOOLBAR:"K-Toolbar"});var b=Kekule.HtmlElementUtils;var a=Kekule.Widget.HtmlClassNames;Kekule.Widget.Container=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.Container",initialize:function($super,c){$super(c);this.reactShowStateChangeBind=this.reactShowStateChange.bind(this);this.addEventListener("showStateChange",this.reactShowStateChangeBind)},finalize:function($super){this.removeEventListener("showStateChange",this.reactShowStateChangeBind);this.clearWidgets();$super()},initProperties:function(){this.defineChildDimensionRelatedProp("childWidth");this.defineChildDimensionRelatedProp("childHeight");this.defineChildDimensionRelatedProp("childMargin");this.defineProp("firstChild",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:null,scope:Class.PropertyScope.PUBLIC});this.defineProp("lastChild",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:null,scope:Class.PropertyScope.PUBLIC});this.defineProp("allowChildWrap",{dataType:DataType.BOOL,serializable:false,setter:function(c){this.setPropStoreFieldValue("allowChildWrap",c);if(c){this.removeClassName(a.NOWRAP)}else{this.addClassName(a.NOWRAP)}}})},initPropValues:function($super){$super();this.setAllowChildWrap(true)},defineChildDimensionRelatedProp:function(e,c){var d=Object.extend({dataType:DataType.STRING,setter:function(f){this.setPropStoreFieldValue(e,f);this.updateChildSizes()}},c||{});return this.defineProp(e,d)},doGetWidgetClassName:function(){return a.CONTAINER},doCreateRootElement:function(d){var c=d.createElement("span");return c},getContainerElement:function(){return this.getElement()},appendWidget:function(c){c.setParent(this);return this},insertWidgetBefore:function(d,c){d.insertToWidget(this,c);return this},removeWidget:function(d,c){d.setParent(null);if(!c){d.finalize()}},clearWidgets:function(c){var e=this.getChildWidgets();for(var d=e.length-1;d>=0;--d){var f=e[d];this.removeWidget(f,c)}},_insertChildWidget:function(f,e){var d=e?e.getElement():null;var c=this.getContainerElement();if(c){if(d){c.insertBefore(f.getElement(),d)}else{c.appendChild(f.getElement())}}},reactShowStateChange:function(c){this.childrenModified()},childrenModified:function($super){$super();var h=this.getChildWidgets();var c=h.length;var e=0;var j=h[e];while(j&&(!j.isShown(true))&&(e<c)){++e;j=h[e]}var g=(e<c)?j:null;var e=c-1;var j=h[c-1];while(j&&(!j.isShown(true))&&(e>=0)){--e;j=h[e]}var d=(e>=0)?j:null;var f=this.getFirstChild();var i=this.getLastChild();if(g!==f){if(f){f.removeClassName(a.FIRST_CHILD)}if(g){g.addClassName(a.FIRST_CHILD)}this.setPropStoreFieldValue("firstChild",g)}if(d!==i){if(i){i.removeClassName(a.LAST_CHILD)}if(d){d.addClassName(a.LAST_CHILD)}this.setPropStoreFieldValue("lastChild",d)}},childWidgetAdded:function($super,f){$super(f);var c=this.getChildWidth();if(c){f.setWidth(c)}var d=this.getChildHeight();if(d){f.setHeight(d)}var e=this.getChildMargin();if(e){f.getStyle().margin=e}this._insertChildWidget(f,null)},childWidgetRemoved:function($super,c){$super(c)},childWidgetMoved:function($super,g,e){$super(g,e);var f=g.getElement();var d=this.getChildWidgets()[e+1];var c=d?d.getElement():null;if(c){this.getContainerElement().insertBefore(f,c)}else{this.getContainerElement().appendChild(f)}},updateChildSizes:function(){var f=this.getChildWidgets();var d=this.getChildWidth()||"";var g=this.getChildHeight()||"";var m=this.getChildMargin()||"";var j=this.getLayout();for(var e=0,c=f.length;e<c;++e){var k=f[e];k.setWidth(d);k.setHeight(g);k.getStyle().margin=m}}});Kekule.Widget.Panel=Class.create(Kekule.Widget.Container,{CLASS_NAME:"Kekule.Widget.Panel",initPropValues:function($super){$super();this.setUseCornerDecoration(true)},doGetWidgetClassName:function($super){return $super()+" "+a.PANEL}});Kekule.Widget.WidgetGroup=Class.create(Kekule.Widget.Container,{CLASS_NAME:"Kekule.Widget.WidgetGroup",initialize:function($super,c){$super(c)},initPropValues:function($super){$super();this.setUseCornerDecoration(true)},doObjectChange:function($super,c){$super(c);if(c.indexOf("useCornerDecoration")>=0){this._updateChildStyles()}},childWidgetAdded:function($super,c){if(c.setUseCornerDecoration){c.setUseCornerDecoration(false)}$super(c)},layoutChanged:function($super){$super();this._updateChildStyles()},childrenModified:function($super){$super();this._updateChildStyles()},_updateChildStyles:function(){var f=Kekule.Widget.Layout;var j=this.getLayout();var h=this.getFirstChild();var n=this.getLastChild();var m=this.getUseCornerDecoration();var d=this.getChildWidgets();var k=[a.CORNER_LEADING,a.CORNER_TAILING];for(var g=0,e=d.length;g<e;++g){var c=d[g];c.removeClassName(k);if(c===h){if(m){c.addClassName(a.CORNER_LEADING)}}if(c===n){if(m){c.addClassName(a.CORNER_TAILING)}}}}});Kekule.Widget.Toolbar=Class.create(Kekule.Widget.WidgetGroup,{CLASS_NAME:"Kekule.Widget.Toolbar",finalize:function($super){var c=this.getChildWidgetInternalNameMap();if(c){c.finalize()}$super()},initProperties:function(){this.defineProp("childDefs",{dataType:DataType.ARRAY,setter:function(c){this.setPropStoreFieldValue("childDefs",c);this.recreateChildrenByDefs()}});this.defineProp("childWidgetInternalNameMap",{dataType:DataType.OBJECT,serializable:false})},doGetWidgetClassName:function($super){return $super()+" "+a.TOOLBAR},doSetShowText:function($super,c){$super(c);this._updateAllChildTextGlyphStyles()},doSetShowGlyph:function($super,c){$super(c);this._updateAllChildTextGlyphStyles()},childWidgetAdded:function($super,c){$super(c);this._updateChildTextGlyphStyles(c)},_updateChildTextGlyphStyles:function(c){if(c.setShowText){c.setShowText(this.getShowText())}if(c.setShowGlyph){c.setShowGlyph(this.getShowGlyph())}},_updateAllChildTextGlyphStyles:function(){var d=this.getChildWidgets();for(var c=d.length-1;c>=0;--c){this._updateChildTextGlyphStyles(d[c])}},recreateChildrenByDefs:function(){var c=this.getChildDefs()||[];this.clearWidgets();var g=new Kekule.MapEx(true);this.setChildWidgetInternalNameMap(g);var h=this.getDefaultChildWidgetClassName();for(var f=0,e=c.length;f<e;++f){var j=c[f];if(!j.widget&&!j.widgetClass&&h){j=Object.extend({widget:h},j)}var d=Kekule.Widget.createFromHash(this,j);if(d){d.appendToWidget(this);if(j.internalName){g.set(j.internalName,d)}}}},getDefaultChildWidgetClassName:function(){return null},getChildWidgetByInternalName:function(c){var d=this.getChildWidgetInternalNameMap();return d?d.get(c):null}})})();(function(){var b=Kekule.DomUtils;var c=Kekule.HtmlElementUtils;var a=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{MENU:"K-Menu",POPUPMENU:"K-PopupMenu",MENUBAR:"K-MenuBar",MENUITEM:"K-MenuItem",MENUITEM_NORMAL:"K-MenuItem-Normal",MENUITEM_SEPARATOR:"K-MenuItem-Separator",SUBMENU_MARKER:"K-SubMenu-Marker",CHECKMENU_MARKER:"K-CheckMenu-Marker"});Kekule.Widget.MenuItem=Class.create(Kekule.Widget.Container,{CLASS_NAME:"Kekule.Widget.MenuItem",BINDABLE_TAG_NAMES:["li"],SUB_MENU_TAGS:["ol","ul"],initialize:function($super,d,e){$super(d);if(e){this.setText(e)}this._subMenuMarker=null;this._checkMarker=null},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,getter:function(){return Kekule.HtmlElementUtils.getInnerText(this.getElement())},setter:function(d){if(d===Kekule.Widget.MenuItem.SEPARATOR_TEXT){this.setIsSeparator(true)}else{if(!!d){this.setIsSeparator(false)}this.changeContentText(d)}}});this.defineProp("checked",{dataType:DataType.BOOL,setter:function(d){if(this.getPropStoreFieldValue("checked")!==d){this.setPropStoreFieldValue("checked",d);this.checkChanged()}}});this.defineProp("autoCheck",{dataType:DataType.BOOL});this.defineProp("isSeparator",{dataType:DataType.BOOL,setter:function(d){this.setPropStoreFieldValue("isSeparator",d);this.isSeparatorChanged(d)}})},initPropValues:function($super){$super();this.setUseCornerDecoration(false);this.setIsSeparator(false)},doGetWidgetClassName:function($super){return $super()+" "+a.MENUITEM},doCreateRootElement:function(e){var d=e.createElement("li");return d},changeContentText:function(d){this.getElement().innerHTML=d||""},isSeparatorChanged:function(d){if(d){this.setText("&nbsp;");this.removeClassName(a.MENUITEM_NORMAL);this.addClassName(a.MENUITEM_SEPARATOR);this.setStatic(true)}else{this.removeClassName(a.MENUITEM_SEPARATOR);this.addClassName(a.MENUITEM_NORMAL);this.setStatic(false)}},doBindElement:function($super,g){$super(g);var f=b.getDirectChildElems(g);for(var e=0,d=f.length;e<d;++e){var h=f[e];if(h.nodeType===Node.ELEMENT_NODE){this.bindSubMenu(h)}h=h.nextSibling}},doDomElemAdded:function(d){if(!Kekule.Widget.getWidgetOnElem(d)){this.bindSubMenu(d)}},checkChanged:function(){var d=this.getChecked();if(d){this._createCheckMarker();this.addClassName(a.STATE_CHECKED);this.invokeEvent("check")}else{this.removeClassName(a.STATE_CHECKED)}},_createCheckMarker:function(){var d=this._checkMarker;if(!d){var d=this.getDocument().createElement("span");d.className=a.CHECKMENU_MARKER;this.getElement().appendChild(d);this._checkMarker=d}return d},_removeCheckMarker:function(){if(this._checkMarker){this._checkMarker.parentNode.removeChild(this._checkMarker);this._checkMarker=null}},childWidgetAdded:function($super,d){$super(d);if(d instanceof Kekule.Widget.Menu){d.setIsSubMenu(true)}else{if(d instanceof Kekule.Widget.MenuItem){var e=this.getSubMenu(true);(function(){d.setParent(e);d.appendToWidget(e)}).defer(10)}}},childrenModified:function($super){$super();this.subMenuChanged()},bindSubMenu:function(f){var e=f.tagName.toLowerCase();if(e==="ul"||e==="ol"){var d=new Kekule.Widget.PopupMenu(f);this.addSubMenu(d);return d}},subMenuChanged:function(){var d=this.getSubMenu();if(d){this._createSubMenuMarker(d)}else{this._removeSubMenuMarker()}},getSubMenu:function(h){var g=this.getChildWidgets();for(var f=0,e=g.length;f<e;++f){var d=g[f];if(d instanceof Kekule.Widget.Menu){return d}}if(h){return this.createSubMenu()}else{return null}},addSubMenu:function(d){d.appendToWidget(this);return this},removeSubMenu:function(d){d.setParent(null);return d},createSubMenu:function(){var d=new Kekule.Widget.PopupMenu(this);this.addSubMenu(d);return d},_createSubMenuMarker:function(e){var d=this._subMenuMarker;if(!d){var d=this.getDocument().createElement("span");d.className=a.SUBMENU_MARKER;this.getElement().appendChild(d);this._subMenuMarker=d}return d},_removeSubMenuMarker:function(){if(this._subMenuMarker){this._subMenuMarker.parentNode.removeChild(this._subMenuMarker);this._subMenuMarker=null}},isLeafItem:function(){var d=this.getElement();return !(d.getElementsByTagName("ul").length||d.getElementsByTagName("ol").length)},isPeriodicalExecuting:function($super){return $super()&&this.getIsActive()},doReactActiviting:function($super,d){$super(d);if(this.isLeafItem()){if(this.getEnablePeriodicalExec()){this.startPeriodicalExec(d)}}},doReactDeactiviting:function($super,d){if(this.isLeafItem()){this.stopPeriodicalExec();if(this.getIsActive()){this.execute(d);if(this.getAutoCheck()){this.setChecked(!this.getChecked())}this.notifyDeactivated()}}},notifyDeactivated:function(){var d=this.getParent();if(d&&d.childDeactivated){d.childDeactivated(this)}},childDeactivated:function(d){var e=this.getParent();if(e&&e.childDeactivated){e.childDeactivated(this)}}});Kekule.Widget.MenuItem.SEPARATOR_TEXT="-";Kekule.Widget.MenuItem.createFromHash=function(d,f){var e=f;if(DataType.isSimpleValue(e)){if(e===Kekule.Widget.MenuItem.SEPARATOR_TEXT){e={isSeparator:true}}else{e={text:e}}}if(!e.widget&&!e.widgetClass){e.widget=Kekule.Widget.MenuItem}return Kekule.Widget.createFromHash(d,e)};Kekule.Widget.Menu=Class.create(Kekule.Widget.Container,{CLASS_NAME:"Kekule.Widget.Menu",BINDABLE_TAG_NAMES:["ol","ul"],MENU_ITEM_TAG:"li",initialize:function($super,d){$super(d)},initProperties:function(){this.defineProp("isSubMenu",{dataType:DataType.BOOL,serializable:false,setter:function(d){this.setPropStoreFieldValue("isSubMenu",d);if(d){this.setLayout(Kekule.Widget.Layout.VERTICAL)}}})},initPropValues:function($super){$super();this.setUseCornerDecoration(true)},doGetWidgetClassName:function($super){return $super()+" "+a.MENU},doCreateRootElement:function(e){var d=e.createElement("ul");return d},doBindElement:function($super,g){$super(g);var f=Kekule.DomUtils.getDirectChildElems(g);for(var e=0,d=f.length;e<d;++e){var h=f[e];if(h.nodeType===Node.ELEMENT_NODE){this.bindMenuItem(h)}h=h.nextSibling}},doDomElemAdded:function(d){this.bindMenuItem(d)},bindMenuItem:function(e){if(e.tagName.toLowerCase()==="li"){var d=new Kekule.Widget.MenuItem(e);d.setParent(this);return d}},getSubMenuTagName:function(){return this.getElement().tagName},getMenuItems:function(j){if(!j){j=this.getElement()}var g=b.getDirectChildElems(menuElem,this.MENU_ITEM_TAG);var d=[];for(var h=0,f=g.length;h<f;++h){var e=Kekule.Widget.getWidgetOnElem(g[h]);if(e&&(e instanceof Kekule.Widget.MenuItem)){d.push(e)}}return d},insertMenuItem:function(e,d){e.insertToWidget(this,d);return this},appendMenuItem:function(d){d.appendToWidget(this);return this},removeMenuItem:function(e,d){e.setParent(null);if(!d){e.finalize()}},clearMenuItems:function(d){this.clearWidgets(d);return this},isTopLevel:function(){var d=this.getParent();return !d||!((d instanceof Kekule.Widget.MenuItem)||(d instanceof Kekule.Widget.Menu))},childDeactivated:function(d){var e=this.getParent();if(e){if(e.childDeactivated){e.childDeactivated(this)}}},createChildrenByDefs:function(d){for(var f=0,e=d.length;f<e;++f){var h=d[f];var g=Kekule.Widget.MenuItem.createFromHash(this,h)}return this}});Kekule.Widget.PopupMenu=Class.create(Kekule.Widget.Menu,{CLASS_NAME:"Kekule.Widget.PopupMenu",initPropValues:function($super){$super();this.setLayout(Kekule.Widget.Layout.VERTICAL)},doGetWidgetClassName:function($super){return $super()+" "+a.POPUPMENU},childDeactivated:function(d){}});Kekule.Widget.MenuBar=Class.create(Kekule.Widget.Menu,{CLASS_NAME:"Kekule.Widget.MenuBar",doGetWidgetClassName:function($super){return $super()+" "+a.MENUBAR}})})();(function(){var b=Kekule.HtmlElementUtils;var a=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{BUTTON:"K-Button",BUTTON_KINDED:"K-Button-Kinded",BUTTON_GROUP:"K-Button-Group",COMPACT_BUTTON:"K-Compact-Button",BTN_COMPACT_MARK:"K-Compact-Mark"});Kekule.Widget.Button=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.Button",BINDABLE_TAG_NAMES:["input","button","a","label"],CSS_DROPDOWN_CLASS_NAME:"K-DropDownMark",DEF_GLYPH_WIDTH:"16px",DEF_GLYPH_HEIGHT:"16px",initialize:function($super,c,d){this._elemTextPart=null;this._elemLeadingGlyphPart=null;this._elemTailingGlyphPart=null;$super(c);if(d){this.setText(d)}},initProperties:function(){this.defineElemAttribMappingProp("actionType","type");this.defineProp("text",{dataType:DataType.STRING,serializable:false,getter:function(){var c=(this._elemTextPart||this.getElement());return c?c.innerHTML:null},setter:function(c){this.changeContentText(c)}});this.defineProp("leadingGlyph",{dataType:"Kekule.Widget.Glyph",serializable:false,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(d){var c=this.getPropStoreFieldValue("leadingGlyph");if(!c&&d){c=this._createDefaultGlyphWidget(this._elemLeadingGlyphPart);this.setPropStoreFieldValue("leadingGlyph",c)}return c}});this.defineProp("tailingGlyph",{dataType:"Kekule.Widget.Glyph",serializable:false,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(d){var c=this.getPropStoreFieldValue("tailingGlyph");if(!c&&d){c=this._createDefaultGlyphWidget(this._elemTailingGlyphPart);this.setPropStoreFieldValue("tailingGlyph",c)}return c}});this.defineProp("showLeadingGlyph",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC,setter:function(c){this.setPropStoreFieldValue("showLeadingGlyph",c);this._elemLeadingGlyphPart.style.display=(c&&this.getShowGlyph())?"":"none"}});this.defineProp("showTailingGlyph",{dataType:DataType.BOOL,scope:Class.PropertyScope.PUBLIC,setter:function(c){this.setPropStoreFieldValue("showTailingGlyph",c);this._elemTailingGlyphPart.style.display=(c&&this.getShowGlyph())?"":"none"}});this.defineProp("buttonKind",{dataType:DataType.STRING,setter:function(d){var c=this.getButtonKind();if(d!==c){this.cancelButtonKind(c);this.applyButtonKind(d);this.setPropStoreFieldValue("buttonKind",d)}}})},initPropValues:function($super){$super();this.setPropStoreFieldValue("showText",true);this.setPropStoreFieldValue("showGlyph",true);this.setPropStoreFieldValue("showLeadingGlyph",true);this.setPropStoreFieldValue("showTailingGlyph",true);this.setPropStoreFieldValue("useCornerDecoration",true);this.setAllowTextWrap(false)},_createDefaultGlyphWidget:function(c){var d=new Kekule.Widget.Glyph(this);d.setWidth(this.DEF_GLYPH_WIDTH).setHeight(this.DEF_GLYPH_HEIGHT);d.setStatic(true).setInheritState(true).setInheritStatic(true).setInheritEnabled(true);d.appendToElem(c);return d},doGetWidgetClassName:function($super){return $super()+" "+a.BUTTON},doCreateRootElement:function(d){var c=d.createElement("button");c.setAttribute("type","button");return c},doBindElement:function($super,c){$super(c);var d=c.innerHTML||"";c.innerHTML="";this._elemTextPart=this.createTextContent(d,c);this._elemLeadingGlyphPart=this.createGlyphContent(c,this._elemTextPart,a.PART_PRI_GLYPH_CONTENT);this._elemTailingGlyphPart=this.createGlyphContent(c,null,a.PART_ASSOC_GLYPH_CONTENT);if(this.getUseCornerDecoration()){b.addClass(c,a.CORNER_ALL)}},changeContentText:function(c){this._elemTextPart.innerHTML=c||""},isPeriodicalExecuting:function($super){return $super()&&this.getIsActive()},doReactActiviting:function($super,c){$super(c);if(this.getEnablePeriodicalExec()){this.startPeriodicalExec(c)}},doReactDeactiviting:function($super,c){this.stopPeriodicalExec();if(this.getIsActive()){this.execute(c)}},cancelButtonKind:function(c){if(c){this.removeClassName(c);this.removeClassName(a.BUTTON_KINDED)}},applyButtonKind:function(c){if(c){this.addClassName(a.BUTTON_KINDED);this.addClassName(c)}}});Kekule.Widget.Button.Kinds={DROPDOWN:"K-Kind-DropDown",POPUP:"K-Kind-Popup",SEARCH:"K-Kind-Search",EDIT:"K-Kind-Edit"};Kekule.Widget.CheckButton=Class.create(Kekule.Widget.Button,{CLASS_NAME:"Kekule.Widget.CheckButton",initialize:function($super,c,d){$super(c,d)},initProperties:function(){this.defineProp("checked",{dataType:DataType.BOOL,setter:function(c){if(this.getPropStoreFieldValue("checked")!==c){this.setPropStoreFieldValue("checked",c);this.checkChanged();this.stateChanged()}}});this.defineProp("autoCheck",{dataType:DataType.BOOL})},initPropValues:function($super){$super();this.setAutoCheck(true)},checkChanged:function(){if(this.getChecked()){this.invokeEvent("check")}else{this.invokeEvent("uncheck")}this.invokeEvent("checkChange",{checked:this.getChecked()})},getStateClassName:function($super,d){var c=this.getChecked()?Kekule.Widget.State.ACTIVE:d;return $super(c)},doReactDeactiviting:function($super,d){var c=this.getChecked();$super(d);if(this.getAutoCheck()){this._doToggleCheckOnSelf(c)}},_doToggleCheckOnSelf:function(c){if(this.getEnabled()){this.setChecked(!c)}}});Kekule.Widget.RadioButton=Class.create(Kekule.Widget.CheckButton,{CLASS_NAME:"Kekule.Widget.RadioButton",initialize:function($super,c,d){$super(c,d)},initProperties:function(){this.defineProp("group",{dataType:DataType.STRING})},checkChanged:function($super){$super();if(this.getChecked()){this.uncheckSiblings()}},uncheckSiblings:function(){var g=this.getParent();var h=this.getGroup();if(g){var e=g.getChildWidgets();for(var f=0,d=e.length;f<d;++f){var c=e[f];if((c!==this)&&c.getGroup&&c.setChecked&&(c.getGroup()===h)){c.setChecked(false)}}}},doReactDeactiviting:function($super,c){$super(c)},_doToggleCheckOnSelf:function($super,c){if(c){return}else{$super(c)}},_doCheckOnSelf:function(){if(this.getEnabled()){this.setChecked(true)}}});Kekule.Widget.DropDownButton=Class.create(Kekule.Widget.Button,{CLASS_NAME:"Kekule.Widget.DropDownButton",doFinalize:function($super){$super()},initProperties:function(){this.defineProp("dropDownWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:function(c){this.setPropStoreFieldValue("dropDownWidget",c);if(c){c.setDisplayed(false)}}});this.defineProp("dropPosition",{dataType:DataType.INT})},doCreateRootElement:function($super,c){return $super(c)},calcActualDropPosition:function(){var d=Kekule.Widget.Position;var k=this.getDropPosition();if(!k){var e=this.getParent();var i=e?e.getLayout():Kekule.Widget.Layout.HORIZONTAL;var h=Kekule.HtmlElementUtils.getElemBoundingClientRect(this.getElement());var g=Kekule.HtmlElementUtils.getViewportDimension(this.getElement());var l=this.getDropDownWidget().getElement();l.style.visible="hidden";l.style.display="";this.getElement().appendChild(l);var m=Kekule.HtmlElementUtils.getElemOffsetDimension(l);this.getElement().removeChild(l);if(i){if(i===Kekule.Widget.Layout.VERTICAL){var f=h.x;var n=g.width-f-h.width;if(n>=m.width){k=d.RIGHT}else{k=(f>n)?d.LEFT:d.RIGHT}}else{var j=h.y;var c=g.height-j-h.height;if(c>=m.height){k=d.BOTTOM}else{k=(j>c)?d.TOP:d.BOTTOM}}}}return k},showDropDownWidget:function(){var e=this.getDropDownWidget();var c=e.getElement();c.style.position="absolute";var d=this.getElement();e.show(this,null,Kekule.Widget.ShowHideType.DROPDOWN);this.invokeEvent("dropDown",{dropDown:e})},hideDropDownWidget:function(){this.getDropDownWidget().hide(this)},isDropDownWidgetShown:function(){var d=this.getDropDownWidget();var c=d&&d.isShown();return c},doExecute:function($super,c){if(this.getDropDownWidget()){if(this.isDropDownWidgetShown()){this.hideDropDownWidget()}else{this.showDropDownWidget()}}$super(c)}});Kekule.Widget.ButtonGroup=Class.create(Kekule.Widget.Toolbar,{CLASS_NAME:"Kekule.Widget.ButtonGroup",initialize:function($super,c){$super(c)},initPropValues:function($super){$super();this.setPropStoreFieldValue("showText",true);this.setPropStoreFieldValue("showGlyph",true);this.setAllowChildWrap(false)},doGetWidgetClassName:function($super){return $super()+" "+a.BUTTON_GROUP},doCreateRootElement:function(d){var c=d.createElement("span");return c},getDefaultChildWidgetClassName:function(){return"Kekule.Widget.Button"}});Kekule.Widget.CompactButtonSet=Class.create(Kekule.Widget.DropDownButton,{CLASS_NAME:"Kekule.Widget.CompactButtonSet",initialize:function($super,c,d){this.reactSetButtonExecuteBind=this.reactSetButtonExecute.bind(this);this.setPropStoreFieldValue("showCompactMark",true);this.setPropStoreFieldValue("cloneSelectedOutlook",true);$super(c,d);if(!this.getButtonSet()){this.initButtonGroup()}},initProperties:function(){this.defineProp("buttonSet",{dataType:"Kekule.Widget.ButtonGroup",serializable:false,setter:function(d){var c=this.getButtonSet();if(c!==d){if(c){c.finalize()}this.initButtonGroup(d)}}});this.defineProp("buttonSetLayout",{dataType:DataType.INT});this.defineProp("selected",{dataType:"Kekule.Widget.Button",serializable:false,setter:function(d){if(d){if(this.getButtonSet().hasChild(d)){if(this.getCloneSelectedOutlook()){this.cloneSetButton(d)}if(d.setChecked){d.setChecked(true)}}}else{var c=this.getSelected();if(c){c.setChecked(false)}}this.setPropStoreFieldValue("selected",d)}});this.defineProp("cloneSelectedOutlook",{dataType:DataType.BOOL});this.defineProp("showCompactMark",{dataType:DataType.BOOL,setter:function(d){var c=this.getShowCompactMark();if(c!==d){this.setPropStoreFieldValue("showCompactMark",d);if(d){this.createCompactMark()}else{this.removeCompactMark()}}}})},doGetWidgetClassName:function($super){return $super()+" "+a.COMPACT_BUTTON},doSetShowText:function($super,c){if(this.getButtonSet()){this.getButtonSet().setShowText(c)}return $super(c)},doSetShowGlyph:function($super,c){if(this.getButtonSet()){this.getButtonSet().setShowGlyph(c)}return $super(c)},createCompactMark:function(){var c=this.getElement();if(this._compactMark){c.removeChild(this._compactMark)}var d=this.getDocument().createElement("span");d.className=a.BTN_COMPACT_MARK;c.appendChild(d);this._compactMark=d;return d},removeCompactMark:function(){var c=this.getElement();if(this._compactMark){c.removeChild(this._compactMark)}},initButtonGroup:function(d){if(!d){d=new Kekule.Widget.ButtonGroup(this)}else{var c=this._getCheckedButtonInGroup(d)}d.setDisplayed(false);d.setShowText(this.getShowText());d.setShowGlyph(this.getShowGlyph());this.setPropStoreFieldValue("buttonSet",d);this.setDropDownWidget(d);d.addEventListener("execute",this.reactSetButtonExecuteBind);d.addEventListener("check",this.reactSetButtonExecuteBind);if(c){this.cloneSetButton(c)}},_getCheckedButtonInGroup:function(g){var e=g.getChildWidgets();for(var f=0,d=e.length;f<d;++f){var c=e[f];if(c.getChecked&&c.getChecked()){return c}}return null},cloneSetButton:function(d){if(!this.getCloneSelectedOutlook()){return}var f=this.getElement();var n=this.getButtonSet().getElement();var m=Kekule.DomUtils;var g=m.getDirectChildElems(f);var j=m.getDirectChildElems(d.getElement());var k=false;for(var h=0,e=g.length;h<e;++h){var c=g[h];if(c!==n){f.removeChild(c)}else{k=true}}for(var h=0,e=j.length;h<e;++h){var c=j[h].cloneNode(true);if(k){f.insertBefore(c,n)}else{f.appendChild(c)}}if(this._clonedCustomHtmlClassName){this.removeClassName(this._clonedCustomHtmlClassName)}this._clonedCustomHtmlClassName=d.getCustomHtmlClassName();if(this._clonedCustomHtmlClassName){this.addClassName(this._clonedCustomHtmlClassName)}this._compactMark=null;this.createCompactMark()},calcActualButtonSetLayout:function(){var d=Kekule.Widget.Layout;var c=this.getButtonSetLayout();if(!c){var f=this.getParent();var e=f?f.getLayout():d.HORIZONTAL;c=(e===d.VERTICAL)?d.HORIZONTAL:d.VERTICAL}return c},showDropDownWidget:function($super){var c=this.calcActualButtonSetLayout();this.getButtonSet().setLayout(c);$super()},reactSetButtonExecute:function(c){if(c.target instanceof Kekule.Widget.Button){if(c.target!==this.getSelected()){c.target.setIsFocused(false);c.target.setIsHover(false);c.target.setIsActive(false);this.setSelected(c.target);if(this.getButtonSet().isShown()){this.getButtonSet().hide()}this.invokeEvent("select",{selected:c.target})}}},append:function(c,d){this.getButtonSet().appendWidget(c);if(d){this.setSelected(c)}return this},insertBefore:function(c,e,d){this.getButtonSet().insertWidgetBefore(c);if(d){this.setSelected(c)}return this},remove:function(d,c){this.getButtonSet().removeWidget(d,c);return this}})})();(function(){var c=Kekule.DomUtils;var d=Kekule.HtmlElementUtils;var a=Kekule.Widget.HtmlClassNames;var b=Kekule.ObjUtils;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{OVERLAP:"K-Overlap",FORMCONTROL:"K-FormControl",CHECKBOX:"K-CheckBox",TEXTBOX:"K-TextBox",COMBOTEXTBOX:"K-ComboTextBox",COMBOTEXTBOX_ASSOC_WIDGET:"K-ComboTextBox-Assoc-Widget",BUTTONTEXTBOX:"K-ButtonTextBox",TEXTAREA:"K-TextArea",SELECTBOX:"K-SelectBox",COMBOBOX:"K-ComboBox",COMBOBOX_TEXTWRAPPER:"K-ComboBox-TextWrapper"});Kekule.Widget.FormWidget=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.FormWidget",initialize:function($super,e,f){this.reactValueChangeBind=this.reactValueChange.bind(this);this.reactInputBind=this.reactInput.bind(this);this.setPropStoreFieldValue("isDirty",false);$super(e,f)},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING,getter:function(){return this.getCoreElement().name},setter:function(e){this.getCoreElement().name=e}});this.defineProp("value",{dataType:DataType.VARIANT,serializable:false,getter:function(){return this.getCoreElement().value},setter:function(e){this.getCoreElement().value=e}});this.defineProp("isDirty",{dataType:DataType.BOOL,serializable:false});this.defineProp("readOnly",{dataType:DataType.BOOL,serializable:false,getter:function(){return this.getCoreElement().readOnly},setter:function(e){this.getCoreElement().readOnly=e}})},getTextSelectable:function(){return true},doGetWidgetClassName:function($super){return $super()+" "+a.FORMCONTROL},doBindElement:function($super,f){$super(f);var e=this.getCoreElement();if(e){Kekule.X.Event.addListener(e,"change",this.reactValueChangeBind);Kekule.X.Event.addListener(e,"input",this.reactInputBind)}},doUnbindElement:function($super,f){var e=this.getCoreElement();if(e){Kekule.X.Event.removeListener(e,"change",this.reactValueChangeBind);Kekule.X.Event.removeListener(e,"input",this.reactInputBind)}$super(f)},notifyValueChanged:function(){this.setIsDirty(true);this.invokeEvent("valueChange",{widget:this})},selectAll:function(){var e=this.getCoreElement();if(e&&e.select){e.select()}return this},reactValueChange:function(){this.notifyValueChanged()},reactInput:function(){this.setIsDirty(true)}});Kekule.Widget.CheckBox=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.CheckBox",BINDABLE_TAG_NAMES:["div","span"],initialize:function($super,e,f){$super(e);if(Kekule.ObjUtils.notUnset(f)){this.setChecked(!!f)}},initProperties:function(){this.defineProp("checked",{dataType:DataType.BOOL,getter:function(){var e=this.getCoreElement();return e?e.checked:false},setter:function(f){var e=this.getCoreElement();if(e){e.checked=!!f}}});this.defineProp("text",{dataType:DataType.STRING,getter:function(){return Kekule.DomUtils.getElementText(this.getLabelElem())},setter:function(e){Kekule.DomUtils.setElementText(this.getLabelElem(),e)}})},getCoreElement:function(){return this.getInputElem()},doGetWidgetClassName:function($super){return $super()+" "+a.CHECKBOX},getInputElem:function(){var f=this.getElement();if(f){var e=f.getElementsByTagName("input");if(e&&e.length){return e[0]}}return null},getLabelElem:function(){var e=this.getElement();if(e){if(e.tagName.toLowerCase()==="label"){return e}else{var f=e.getElementsByTagName("label");if(f&&f.length){return f[0]}}}return null},doCreateRootElement:function(f){var e=f.createElement("span");return e},doCreateSubElements:function(h,e){var f=h.createElement("label");e.appendChild(f);var g=h.createElement("input");g.setAttribute("type","checkbox");f.appendChild(g);return[f,g]}});Kekule.Widget.TextBox=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.TextBox",BINDABLE_TAG_NAMES:["input"],initialize:function($super,e,f){$super(e);if(f){this.setText(f)}},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,getter:function(){return this.getElement().value},setter:function(e){if(e){this.getElement().value=e}else{this.getElement().value=""}}});this.defineProp("placeholder",{dataType:DataType.STRING,getter:function(){return this.getElement().placeholder},setter:function(e){this.getElement().placeholder=e}})},doGetWidgetClassName:function($super){return $super()+" "+a.TEXTBOX},doCreateRootElement:function(f){var e=f.createElement("input");e.setAttribute("type","text");return e},doBindElement:function($super,e){$super(e)}});Kekule.Widget.ComboTextBox=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.ComboTextBox",BINDABLE_TAG_NAMES:["div","span"],initialize:function($super,e,f){$super(e);if(f){this.setText(f)}},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,serializable:false,getter:function(){var e=this.getTextBox();return e?e.getText():null},setter:function(e){var f=this.getTextBox();if(f){f.setText(e)}}});this.defineProp("placeholder",{dataType:DataType.STRING,getter:function(){return this.getTextBox().getPlaceholder()},setter:function(e){this.getTextBox().setPlaceholder(e)}});this.defineProp("overlapOnTextBox",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("overlapOnTextBox",e);if(e){this.addClassName(a.OVERLAP)}else{this.removeClassName(a.OVERLAP)}this.adjustWidgetsSize()}});this.defineProp("textBox",{dataType:"Kekule.Widget.TextBox",serializable:false,setter:null});this.defineProp("headingWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:function(g){var e=this.getHeadingWidget();if(g!==e){this.setPropStoreFieldValue("headingWidget",g);if(e){e.setParent(null);e.removeClassName(a.COMBOTEXTBOX_ASSOC_WIDGET)}if(g){var f=this.getTextBox()?this.getTextBox().getElement():this.getTailingWidget()?this.getTailingWidget().getElement():null;g.setParent(this);g.addClassName(a.COMBOTEXTBOX_ASSOC_WIDGET);g.insertToElem(this.getElement(),f)}}}});this.defineProp("tailingWidget",{dataType:"Kekule.Widget.BaseWidget",serializable:false,setter:function(f){var e=this.getTailingWidget();if(f!==e){this.setPropStoreFieldValue("tailingWidget",f);if(e){e.setParent(null);e.removeClassName(a.COMBOTEXTBOX_ASSOC_WIDGET)}if(f){f.setParent(this);f.addClassName(a.COMBOTEXTBOX_ASSOC_WIDGET);f.appendToElem(this.getElement())}}}})},finalize:function($super){this._finalizeSubWidgets();$super()},_finalizeSubWidgets:function(){var f=this.getTextBox();if(f){f.finalize()}var e=this.getHeadingWidget();if(e){e.finalize()}var e=this.getTailingWidget();if(e){e.finalize()}},getCoreElement:function($super){var e=this.getTextBox();if(e){return e.getElement()}else{return $super()}},doGetWidgetClassName:function($super){return $super()+" "+a.COMBOTEXTBOX},doCreateRootElement:function(f){var e=f.createElement("span");return e},doCreateSubElements:function($super,h,g){var e=$super(h,g);var f=this;this._finalizeSubWidgets();var i=new Kekule.Widget.TextBox(this);i.addClassName(a.TEXTBOX);i.appendToElem(this.getElement());this.setPropStoreFieldValue("textBox",i);e.push(i.getElement());return e},relayEvent:function($super,f,g){var e=g.widget;if((e===this.getTextBox())||(e===this.getHeadingWidget())||(e===this.getTailingWidget())){g.widget=this}return $super(f,g)},doSetEnabled:function(f){var g=this.getTextBox();if(g){g.setEnabled(f)}var e=this.getHeadingWidget();if(e){e.setEnabled(f)}e=this.getTailingWidget();if(e){e.setEnabled(f)}},doResize:function(){this.adjustWidgetsSize()},widgetShowStateChanged:function($super,e){$super(e);if(e){this.adjustWidgetsSize()}},doInsertedToDom:function(){if(this.isShown()){this.adjustWidgetsSize()}},assocWidgetChanged:function(){this.adjustWidgetsSize()},adjustWidgetsSize:function(){var h=Kekule.StyleUtils;var m=this.getOverlapOnTextBox();var j=m?"absolute":"relative";var g=this.getTextBox().getElement();if(!g){return}var l=Kekule.HtmlElementUtils.getElemBoundingClientRect(g);var i=this.getHeadingWidget();var f=i?i.getElement():null;if(f&&i.isShown()){var e=f.style;e.position=j;if(m){var k=Kekule.HtmlElementUtils.getElemBoundingClientRect(f);e.left=0;e.top=((l.height-k.height)/2)+"px";g.style.paddingLeft=k.width+"px"}else{h.removeStyleProperty(e,"left");h.removeStyleProperty(e,"top");h.removeStyleProperty(g.style,"paddingLeft")}}else{h.removeStyleProperty(g.style,"paddingLeft")}var i=this.getTailingWidget();var f=i?i.getElement():null;if(f&&i.isShown()){var e=f.style;e.position=j;if(m){var k=Kekule.HtmlElementUtils.getElemBoundingClientRect(f);e.right=0;e.top=((l.height-k.height)/2)+"px";g.style.paddingRight=k.width+"px"}else{h.removeStyleProperty(e,"right");h.removeStyleProperty(e,"top");h.removeStyleProperty(g.style,"paddingRight")}}else{h.removeStyleProperty(g.style,"paddingRight")}}});Kekule.Widget.ButtonTextBox=Class.create(Kekule.Widget.ComboTextBox,{CLASS_NAME:"Kekule.Widget.ButtonTextBox",initialize:function($super,e,f){$super(e,f);this.setOverlapOnTextBox(true)},initProperties:function(){this.defineProp("button",{dataType:"Kekule.Widget.Button",serializable:false,setter:null,getter:function(){return this.getTailingWidget()}});this.defineProp("buttonKind",{dataType:DataType.STRING,getter:function(){return this.getButton().getButtonKind()},setter:function(e){this.getButton().setButtonKind(e)}});this.defineProp("buttonText",{dataType:DataType.STRING,getter:function(){return this.getButton().getText()},setter:function(e){this.getButton().setText(e)}})},doGetWidgetClassName:function($super){return $super()+" "+a.BUTTONTEXTBOX},doCreateSubElements:function($super,h,f){var e=$super(h,f);var g=this.createAssocButton();if(g){e.push(g.getElement())}return e},createAssocButton:function(){var e=new Kekule.Widget.Button(this);this.setTailingWidget(e);e.addEventListener("change",this.adjustWidgetsSize,this);e.addEventListener("execute",function(f){this.invokeEvent("buttonExecute",{widget:this})},this);return e},execBtn:function(g){var f=this.getButton();if(f){f.execute(g);return true}},react_keypress:function(f){if(f.getKeyCode()===13){this.execBtn(f)}},react_keydown:function(g){if(this.getButtonKind()===Kekule.Widget.Button.Kinds.DROPDOWN){var f=Kekule.X.Event.KeyCode;if(g.getKeyCode()===f.DOWN){this.execBtn(g)}}}});Kekule.Widget.TextArea=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.TextArea",BINDABLE_TAG_NAMES:["textarea"],initialize:function($super,e,f){$super(e);if(f){this.setText(f)}},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,getter:function(){return this.getValue()},setter:function(e){this.setValue(e);this.adjustAutoSize()}});this.defineProp("placeholder",{dataType:DataType.STRING,getter:function(){return this.getElement().placeholder},setter:function(e){this.getElement().placeholder=e}});this.defineProp("autoSizeX",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("autoSizeX",e);this._autoSizeChanged()}});this.defineProp("autoSizeY",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("autoSizeY",e);this._autoSizeChanged()}});this.defineProp("wrap",{dataType:DataType.STRING,getter:function(){return this.getElement().wrap},setter:function(e){this.getElement().wrap=e}})},doGetWidgetClassName:function($super){return $super()+" "+a.TEXTAREA},doCreateRootElement:function(f){var e=f.createElement("textarea");return e},doBindElement:function($super,e){$super(e);this.adjustAutoSize()},setValue:function($super,e){$super(e);this.adjustAutoSize()},widgetShowStateChanged:function($super,e){$super(e);if(e){this.adjustAutoSize()}},reactValueChange:function($super){this.adjustAutoSize();$super()},react_keyup:function(){this.adjustAutoSize()},react_keypress:function(){this.adjustAutoSize()},doWidgetShowStateChanged:function(e){if(e){this.adjustAutoSize()}},_autoSizeChanged:function(){var e=this.getCoreElement().style;if(this.getAutoSizeX()){e.overflowX="hidden";this.setWrap("off")}else{e.overflowX="auto";this.setWrap("")}if(this.getAutoSizeY()){e.overflowY="hidden"}else{e.overflowY="auto"}this.adjustAutoSize()},adjustAutoSize:function(){if(this.getAutoSizeX()||this.getAutoSizeY()){this.adjustSizeByContent()}},adjustSizeByContent:function(){var f=this.getCoreElement();var i=this.getText();var h=!i;var e=f.style;if(this.getAutoSizeX()){e.width="1px"}if(this.getAutoSizeY()){e.height="1px"}var g=Kekule.HtmlElementUtils.getElemScrollDimension(f);var j=Kekule.HtmlElementUtils.getElemClientDimension(f);if(this.getAutoSizeX()){if(h){e.width="1em"}else{if(g.width>j.width){e.width=g.width+"px"}}}if(this.getAutoSizeY()){if(h){e.height="1em"}if(g.height>j.height){e.height=g.height+"px"}}}});Kekule.Widget.SelectBox=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.SelectBox",BINDABLE_TAG_NAMES:["select"],ITEM_DATA_FIELD:"__$item_data__",ITEM_VALUE_FIELD:"__$item_value__",initialize:function($super,e,f){$super(e);if(f){this.setItems(f)}},initProperties:function(){this.defineProp("items",{dataType:DataType.ARRAY,serializable:false,getter:function(){var g=this.getAllItemElems();var e=[];for(var h=0,f=g.length;h<f;++h){var j=g[h];var k=this._getBoxItemInfo(j);e.push(k)}return e},setter:function(k){var f=this.getElement();this.clear();if(k){var g=Kekule.ArrayUtils.toArray(k);for(var h=0,e=g.length;h<e;++h){var m=g[h];if(m){var j=this._createBoxItemElem(f);this._setBoxItemInfo(j,m)}}}}});this.defineProp("index",{dataType:DataType.INT,getter:function(){return this.getElement().selectedIndex},setter:function(e){this.getElement().selectedIndex=e}})},doGetWidgetClassName:function($super){return $super()+" "+a.SELECTBOX},doCreateRootElement:function(f){var e=f.createElement("select");return e},_createBoxItemElem:function(f,g){var h=f.ownerDocument;var e=h.createElement("option");if(g){f.insertBefore(e,g)}else{f.appendChild(e)}return e},doBindElement:function($super,e){$super(e)},doGetValue:function(){var e=this.getSelectedItemElem();if(e){var f=this._getBoxItemInfo(e);return f.value}else{return undefined}},doSetValue:function(k){var f=this.getAllItemElems();var g;for(var h=0,e=f.length;h<e;++h){var j=f[h];var m=this._getBoxItemInfo(j);if(m.value===k){this.setIndex(h);return}}this.setIndex(-1)},getAllItemElems:function(){return c.getDirectChildElems(this.getElement(),"option")},getSelectedItemElem:function(){var f=this.getAllItemElems();for(var g=0,e=f.length;g<e;++g){var h=f[g];if(h.selected){return h}}return null},clear:function(){this.getElement().innerHTML=""},dropDown:function(){var g=this.getDocument();var f=this.getElement();var e=this.getDocument().createEvent("MouseEvents");e.initEvent("mousedown",true,true);this.getElement().dispatchEvent(e)},_getBoxItemInfo:function(f){var e={};e.text=d.getInnerText(f);e.value=f[this.ITEM_VALUE_FIELD];if(b.notUnset(f.title)){e.title=f.title}if(b.notUnset(f[this.ITEM_DATA_FIELD])){e.data=f[this.ITEM_DATA_FIELD]}return e},_setBoxItemInfo:function(g,e){if(DataType.isSimpleValue(e)){e={value:e}}var f=e.text||e.value;if(b.notUnset(f)){Kekule.DomUtils.setElementText(g,f)}g.value=""+e.value;g[this.ITEM_VALUE_FIELD]=e.value;if(b.notUnset(e.title)){g.title=e.title}if(b.notUnset(e.data)){g[this.ITEM_DATA_FIELD]=e.data}if(e.selected){g.setAttribute("selected","selected")}else{g.selected=false}return this}});Kekule.Widget.ComboBox=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.ComboBox",BINDABLE_TAG_NAMES:["div","span"],initialize:function($super,e){$super(e)},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,serializable:false,getter:function(){var e=this.getTextBox();return e?e.getText():null},setter:function(e){var f=this.getTextBox();if(f){f.setText(e);this.textChanged()}}});this.defineProp("items",{dataType:DataType.ARRAY,serializable:false,getter:function(){var e=this.getSelectBox();return e?e.getItems():null},setter:function(e){var f=this.getSelectBox();if(f){f.setItems(e)}}});this.defineProp("textBox",{dataType:"Kekule.Widget.TextBox",serializable:false,setter:null,scope:Class.PropertyScope.PRIVATE});this.defineProp("selectBox",{dataType:"Kekule.Widget.SelectBox",serializable:false,setter:null,scope:Class.PropertyScope.PRIVATE})},finalize:function($super){this._finalizeSubElements();$super()},_finalizeSubElements:function(){var f=this.getTextBox();if(f){f.finalize()}var e=this.getSelectBox();if(e){e.finalize()}},getCoreElement:function($super){var e=this.getTextBox();if(e){return e.getElement()}else{return $super()}},doGetWidgetClassName:function($super){return $super()+" "+a.COMBOBOX},doCreateRootElement:function(f){var e=f.createElement("span");return e},doCreateSubElements:function(h,f){var e=this;this._finalizeSubElements();var j=h.createElement("span");j.className=a.COMBOBOX_TEXTWRAPPER;f.appendChild(j);var i=new Kekule.Widget.TextBox(this);i.appendToElem(j);this.setPropStoreFieldValue("textBox",i);var g=new Kekule.Widget.SelectBox(this);g.appendToElem(f);this.setPropStoreFieldValue("selectBox",g);g.addEventListener("valueChange",function(l){var n=g.getSelectedItemElem();if(n){var k=n.value;var m=n.text||n.value;if(m!==i.getText()){i.setText(m);e.notifyValueChanged()}i.selectAll();i.focus();e.invokeEvent("valueSelect",{widget:e,value:k})}});i.addEventListener("valueChange",function(k){e.textChanged()});Kekule.X.Event.addListener(i.getElement(),"keydown",function(l){var k=l.getKeyCode();if(k===Kekule.X.Event.KeyCode.DOWN){g.dropDown()}});return[j]},relayEvent:function($super,f,g){var e=g.widget;if((e===this.getTextBox())||(e===this.getSelectBox())){g.widget=this}return $super(f,g)},textChanged:function(){var f=this.getText();var e=this._getValueOfText(f);this.getSelectBox().setValue(e)},_getValueOfText:function(j){var f=this.getSelectBox().getItems();for(var g=0,e=f.length;g<e;++g){var h=f[g];if(h.text&&(h.text===j)){return h.value}}return j},doSetEnabled:function(e){var g=this.getTextBox();if(g){g.setEnabled(e)}var f=this.getSelectBox();if(f){f.setEnabled(e)}},doGetValue:function($super){var f=$super();var e=this._getValueOfText(f);return e},doSetValue:function($super,j){var k=j;var f=this.getSelectBox().getItems();this.getSelectBox().setIndex(-1);for(var g=0,e=f.length;g<e;++g){var h=f[g];if(h.value===j){k=h.text||h.value;this.getSelectBox().setIndex(g);break}}$super(k)}})})();(function(){Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{STATE_COLLAPSED:"K-State-Collapsed",STATE_EMPTY:"K-State-Empty",NESTED_CONTAINER:"K-NestedContainer",NESTED_CONTAINER_ITEM:"K-NestedContainer-Item"});Kekule.Widget.NestedContainer=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.NestedContainer",DEF_CONTAINER_TAG:"ul",DEF_ITEM_TAG:"li",ITEM_DATA_FIELD:"__$itemData__",initialize:function($super,a){$super(a)},initProperties:function(){this.defineProp("itemInitialExpanded",{dataType:DataType.BOOL})},doCreateRootElement:function(b){var a=b.createElement("div");return a},doBindElement:function($super,a){$super(a)},getContainerElemTag:function(){return this.DEF_CONTAINER_TAG},getItemElemTag:function(){return this.DEF_ITEM_TAG},_createChildItemElem:function(){var a=this.doCreateChildItemElem();Kekule.HtmlElementUtils.addClass(a,Kekule.Widget.HtmlClassNames.NESTED_CONTAINER_ITEM);Kekule.HtmlElementUtils.addClass(a,Kekule.Widget.HtmlClassNames.STATE_EMPTY);return a},doCreateChildItemElem:function(){return this.getDocument().createElement(this.getItemElemTag())},_createChildContainerElem:function(){var a=this.doCreateChildContainerElem();Kekule.HtmlElementUtils.addClass(a,Kekule.Widget.HtmlClassNames.NESTED_CONTAINER);return a},doCreateChildContainerElem:function(){return this.getDocument().createElement(this.getContainerElemTag())},getChildContainerElem:function(d,c){if(!d){d=this.getElement()}var b=d.getElementsByTagName(this.getContainerElemTag());var a=b.length?b[0]:null;if(!a&&c){a=this._createChildContainerElem();d.appendChild(a)}return a},getItemData:function(a){return a[this.ITEM_DATA_FIELD]},setItemData:function(f,d){this.doSetItemData(f,d);f[this.ITEM_DATA_FIELD]=d;var e=d.children;if(e&&Kekule.ArrayUtils.isArray(e)){this.clearChildItems(f);for(var b=0,a=e.length;b<a;++b){var c=e[b];this.appendChildItem(f,c)}}return this},doSetItemData:function(b,a){},hasChildItem:function(a){return this.getChildItemCount(a)>0},getChildItemCount:function(a){return this.getChildren(a).length},getChildren:function(c){var b=this.getChildContainerElem(c);if(b){var a=Kekule.DomUtils.getDirectChildElems(b,this.getItemElemTag());return a}else{return[]}},getChildItemAt:function(a,b){var c=this.getChildren(a);return(c.length&&(c.length>b))?c[b]:null},insertChildItem:function(e,d,f){var b;var a=this.getChildContainerElem(e,true);if(d&&Kekule.DomUtils.isElement(d)){b=d}else{var b=this._createChildItemElem();if(!this.getItemInitialExpanded()){Kekule.HtmlElementUtils.addClass(b,Kekule.Widget.HtmlClassNames.STATE_COLLAPSED)}if(d){this.setItemData(b,d)}}var c=DataType.isSimpleType(f)?this.getChildren(e)[index]:f;if(c){a.insertBefore(b,c)}else{a.appendChild(b)}this.childItemsChanged(e);return b},appendChildItem:function(b,a){return this.insertChildItem(b,a)},removeChildItem:function(c,b){var a=this.getChildContainerElem(c);if(a){a.removeChild(b);if(!this.hasChildItem(c)){c.removeChild(a)}this.childItemsChanged(c)}return this},removeChildItemAt:function(b,a){var c=this.getChildItemAt(b,a);if(c){this.removeChildItem(b,c)}return this},clearChildItems:function(b){var a=this.getChildContainerElem(b);if(!b){b=this.getElement()}if(a){b.removeChild(a)}this.childItemsChanged(b)},childItemsChanged:function(a){if(a){var b=Kekule.Widget.HtmlClassNames.STATE_EMPTY;if(this.hasChildItem(a)){Kekule.HtmlElementUtils.removeClass(a,b)}else{Kekule.HtmlElementUtils.addClass(a,b)}}},expandItem:function(a){Kekule.HtmlElementUtils.removeClass(a,Kekule.Widget.HtmlClassNames.STATE_COLLAPSED);return this},collapseItem:function(a){Kekule.HtmlElementUtils.addClass(a,Kekule.Widget.HtmlClassNames.STATE_COLLAPSED);return this},toggleExpandStateOfItem:function(a){Kekule.HtmlElementUtils.toggleClass(a,Kekule.Widget.HtmlClassNames.STATE_COLLAPSED);return this},isChildItem:function(a){return Kekule.HtmlElementUtils.hasClass(a,Kekule.Widget.HtmlClassNames.NESTED_CONTAINER_ITEM)},getBelongedChildItem:function(d){var b=d;var c=this.getElement();var a=this.getDocument().body;while((b!==c)&&(b!==a)){b=b.parentNode;if(this.isChildItem(b)){return b}}return null},getAllChildItems:function(e){var b=[];var a=this.getChildContainerElem(e,false);if(a){var g=Kekule.DomUtils.getDirectChildElems(a);for(var f=0,c=g.length;f<c;++f){var h=g[f];if(this.isChildItem(h)){b.push(h);var d=this.getAllChildItems(h);b=b.concat(d)}}}return b},getChildItemRange:function(c,b,g){var f=this.getAllChildItems(g);var e=f.indexOf(c);var d=f.indexOf(b);if((e>=0)&&(d>=0)){if(e>d){var a=true;var h=e;e=d;d=h}var i=f.slice(e,d+1);if(a){i=i.reverse()}return i}else{return[]}}})})();(function(){var b=Kekule.HtmlElementUtils;var a=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{TREEVIEW:"K-TreeView",TREEVIEW_EXPANDMARK:"K-TreeView-ExpandMark",TREEVIEW_ITEMCONTENT:"K-TreeView-ItemContent"});Kekule.Widget.TreeView=Class.create(Kekule.Widget.NestedContainer,{CLASS_NAME:"Kekule.Widget.TreeView",BELONGED_ITEM_FIELD:"__$treeItem__",initProperties:function(){this.defineProp("selection",{dataType:DataType.ARRAY,serializable:false,scope:Class.PropertyScope.PUBLIC,getter:function(){var c=this.getPropStoreFieldValue("selection");if(!c){c=[];this.setPropStoreFieldValue("selection",c)}return c},setter:function(c){this.select(c)}});this.defineProp("selectedItem",{dataType:DataType.OBJECT,serializable:false,getter:function(){var c=this.getSelection();return c.length?c[c.length-1]:null},setter:function(c){this.select(c)}});this.defineProp("enableMultiSelected",{dataType:DataType.BOOL})},doGetWidgetClassName:function(){return a.TREEVIEW},doCreateChildItemElem:function($super){var c=$super();if(c){var d=this.createGlyphContent(c,null,a.TREEVIEW_EXPANDMARK);d[this.BELONGED_ITEM_FIELD]=c;c._expandMarkerElem=d;var e=this.getDocument().createElement("span");e.className=a.TREEVIEW_ITEMCONTENT;c.appendChild(e);e[this.BELONGED_ITEM_FIELD]=c;c._contentElem=e}return c},doSetItemData:function(d,c){this.setItemText(d,c.text)},getExpandMarkerElem:function(c){return c._expandMarkerElem},getItemContentElem:function(c){return c._contentElem},getTextPartElem:function(e,d){var c=e._textPartElem;if(!c&&d){c=this.createTextContent("",this.getItemContentElem(e));e._textPartElem=c}return c},setItemText:function(d,e){var c=this.getTextPartElem(d,true);c.innerHTML=e},isItemSelected:function(d){var c=this.getSelection();return c?(c.indexOf(d)>=0):false},selectionChanged:function(){this.notifyPropSet("selection",this.getSelection())},clearSelection:function(){var e=this.getSelection();if(e.length){for(var d=0,c=e.length;d<c;++d){var f=e[d];Kekule.HtmlElementUtils.removeClass(this.getItemContentElem(f),a.STATE_SELECTED)}this.setPropStoreFieldValue("selection",[]);this.selectionChanged()}return this},removeFromSelection:function(d){if(d){var f=Kekule.ArrayUtils.toArray(d);if(f&&f.length){var g=this.getSelection();for(var e=0,c=f.length;e<c;++e){var h=f[e];if(Kekule.ArrayUtils.remove(g,h)){Kekule.HtmlElementUtils.removeClass(this.getItemContentElem(h),a.STATE_SELECTED)}}this.selectionChanged()}}return this},addToSelection:function(d){if(d){var h=Kekule.ArrayUtils.toArray(d);if(h&&h.length){if(!this.getEnableMultiSelected()){this.clearSelection();h=[h[h.length-1]]}var f=this.getSelection();for(var e=0,c=h.length;e<c;++e){var g=h[e];if(!this.isItemSelected(g)){Kekule.HtmlElementUtils.addClass(this.getItemContentElem(g),a.STATE_SELECTED);f.push(g)}}this.selectionChanged()}}return this},toggleSelectionState:function(d){if(d){this.beginUpdate();try{var h=Kekule.ArrayUtils.toArray(d);var f=this.getSelection();if(h&&h.length){for(var e=0,c=h.length;e<c;++e){var g=h[e];if(this.isItemSelected(g)){this.removeFromSelection(g)}else{this.addToSelection(g)}}}}finally{this.endUpdate()}}},select:function(c){this.beginUpdate();try{this.clearSelection();if(c){if(this.getEnableMultiSelected()){this.addToSelection(c)}else{var d=Kekule.ArrayUtils.toArray(c);this.addToSelection(d[d.length-1])}}}finally{this.endUpdate()}},react_click:function(h){var g=h.getTarget();var f=g[this.BELONGED_ITEM_FIELD];if(f&&this.isChildItem(f)){this.toggleExpandStateOfItem(f)}else{f=this.getBelongedChildItem(g);if(h.getShiftKey()){var d=this.getSelectedItem();if(d){var c=this.getChildItemRange(d,f);if(c.length){if(h.getCtrlKey()){this.addToSelection(c)}else{this.select(c)}}}else{this.select(f)}}else{if(h.getCtrlKey()){this.toggleSelectionState(f)}else{if(f){this.select(f)}}}}},react_dblclick:function(f){var d=f.getTarget();var c=this.getBelongedChildItem(d);if(c){this.toggleExpandStateOfItem(c)}}})})();(function(){var c=Kekule.DomUtils;var d=Kekule.HtmlElementUtils;var b=Kekule.StyleUtils;var a=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{DIALOG:"K-Dialog",DIALOG_INSIDE:"K-Dialog-Inside",DIALOG_OVERFLOW:"K-Dialog-Overflow",DIALOG_CLIENT:"K-Dialog-Client",DIALOG_CAPTION:"K-Dialog-Caption",DIALOG_BTN_PANEL:"K-Dialog-Button-Panel"});Kekule.Widget.DialogButtons={OK:"ok",CANCEL:"cancel",YES:"yes",NO:"no",isPositive:function(f){var e=Kekule.Widget.DialogButtons;return([e.OK,e.YES].indexOf(f)>=0)},isNegative:function(f){var e=Kekule.Widget.DialogButtons;return([e.CANCEL,e.NO].indexOf(f)>=0)}};Kekule.Widget.Location={DEFAULT:1,CENTER:2,FULLFILL:3,CENTER_OR_FULLFILL:4};Kekule.Widget.Dialog=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.Dialog",BINDABLE_TAG_NAMES:["div","span"],BTN_NAME_FIELD:"__$btnName__",initialize:function($super,e,f,g){this._dialogCallback=null;this._modalInfo=null;this._childButtons=[];this.setPropStoreFieldValue("location",Kekule.Widget.Location.CENTER);$super(e);this._dialogOpened=false;this.setUseCornerDecoration(true);if(f){this.setCaption(f)}if(g){this.setButtons(g)}this.setDisplayed(false)},doFinalize:function($super){this.unprepareModal();$super()},initProperties:function(){this.defineProp("caption",{dataType:DataType.STRING,getter:function(){return c.getElementText(this.getCaptionElem())},setter:function(e){c.setElementText(this.getCaptionElem(),e);b.setDisplay(this.getCaptionElem(),!!e)}});this.defineProp("buttons",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("buttons",e);if(this.getBtnPanelElem()){b.setDisplay(this.getBtnPanelElem(),e&&e.length)}this.buttonsChanged()}});this.defineProp("result",{dataType:DataType.STRING,serializable:false,scope:Class.PropertyScope.PUBLIC});this.defineProp("location",{dataType:DataType.INT});this.defineProp("clientElem",{dataType:DataType.OBJECT,serializable:false,setter:null,scope:Class.PropertyScope.PUBLIC});this.defineProp("captionElem",{dataType:DataType.OBJECT,serializable:false,setter:null,scope:Class.PropertyScope.PUBLIC});this.defineProp("btnPanelElem",{dataType:DataType.OBJECT,serializable:false,setter:null,scope:Class.PropertyScope.PUBLIC})},initPropValues:function($super){$super();if(this.setMovable){this.setMovable(true)}},getDefaultMovingGripper:function(){return this.getCaptionElem()},getCoreElement:function(){return this.getClientElem()},doGetWidgetClassName:function(){return a.DIALOG},doCreateRootElement:function(f){var e=f.createElement("div");return e},doCreateSubElements:function(h,f){var e=[];var g=h.createElement("div");g.className=a.DIALOG_CAPTION;f.appendChild(g);this.setPropStoreFieldValue("captionElem",g);e.push(g);if(this.setMovingGripper){this.setMovingGripper(g)}var g=h.createElement("div");g.className=a.DIALOG_CLIENT;f.appendChild(g);this.setPropStoreFieldValue("clientElem",g);this.doCreateClientContents(g);e.push(g);var g=h.createElement("div");g.className=a.DIALOG_BTN_PANEL;f.appendChild(g);this.setPropStoreFieldValue("btnPanelElem",g);e.push(g);this.buttonsChanged();return e},doCreateClientContents:function(e){},buttonsChanged:function(){for(var g=this._childButtons.length-1;g>=0;--g){var f=this._childButtons[g];f.finalize()}var h=this.getButtons()||[];for(var g=0,e=h.length;g<e;++g){this.createDialogButton(h[g])}},createDialogButton:function(k,f,j,g){var i=this._getPredefinedButtonInfo(k);if(!i){i={text:k}}if(i){var h=new Kekule.Widget.Button(this,i.text);h[this.BTN_NAME_FIELD]=k;h.addEventListener("execute",this._reactDialogBtnExec,this);h.appendToElem(this.getBtnPanelElem());h.__$name__=k;var e=f||this._getDialogButtonResName(k);if(e){h.linkStyleResource(e)}this._childButtons.push(h);return h}else{return null}},_getDialogButtonResName:function(f){var e=Kekule.Widget.DialogButtons;if([e.OK,e.YES].indexOf(f)>=0){return Kekule.Widget.StyleResourceNames.BUTTON_YES_OK}else{if([e.CANCEL,e.NO].indexOf(f)>=0){return Kekule.Widget.StyleResourceNames.BUTTON_NO_CANCEL}else{return null}}},_reactDialogBtnExec:function(i){var f=Kekule.Widget.DialogButtons;var h=[f.OK,f.YES,f.CANCEL,f.NO];var g=i.target;if(g){var j=g.__$name__;if(h.indexOf(j)>=0){this.setResult(j);this.close(j)}}},_getPredefinedButtonInfo:function(i){var f=Kekule.Widget.DialogButtons;var h=[f.OK,f.CANCEL,f.YES,f.NO];var g=[Kekule.$L("WidgetTexts.CAPTION_OK"),Kekule.$L("WidgetTexts.CAPTION_CANCEL"),Kekule.$L("WidgetTexts.CAPTION_YES"),Kekule.$L("WidgetTexts.CAPTION_NO")];var e=h.indexOf(i);return(e>=0)?{text:g[e]}:null},getDialogButton:function(g){for(var f=this._childButtons.length-1;f>=0;--f){var e=this._childButtons[f];if(e[this.BTN_NAME_FIELD]===g){return e}}return null},needAdjustPosition:function(){var f=this.getShowHideType();var g=Kekule.Widget.ShowHideType;var e=(f!==g.DROPDOWN);return e},_storePositionInfo:function(){if(!this.needAdjustPosition()){return}var f=this.getElement();var e=f.style;this._posInfo={left:e.left,top:e.top,right:e.right,bottom:e.bottom,width:e.width,height:e.height,position:e.position}},_restorePositionInfo:function(){if(!this.needAdjustPosition()){return}var f=this.getElement();var e=f.style;var g=this._posInfo;if(g){e.left=g.left;e.top=g.top;e.right=g.right;e.bottom=g.bottom;e.width=g.width;e.height=g.height;e.position=g.position}},adjustLocation:function(){if(!this.needAdjustPosition()){return}this._storePositionInfo();var i=Kekule.Widget.Location;var e=this.getLocation()||i.DEFAULT;var q=false;if(e!==i.DEFAULT){var s,m,k,v,o,y;var z=this.getDisplayed();var C=this.getVisible();try{this.setDisplayed(true,true);this.setVisible(true,true);var p=Kekule.DocumentUtils.getClientDimension(this.getDocument());var A=Kekule.HtmlElementUtils.getElemBoundingClientRect(this.getElement());var g=A.right-A.left;var B=A.bottom-A.top;var j=this.getOffsetParent();var f=j?Kekule.HtmlElementUtils.getElemBoundingClientRect(j):{left:0,top:0,width:0,height:0};q=(g>=p.width)||(B>=p.height)}finally{this.setVisible(C,true);this.setDisplayed(z,true)}if(e===i.CENTER_OR_FULLFILL){if(q){if(g>=p.width){s=0;o=0}else{s=(p.width-g)/2}if(B>=p.height){m=0;y=0}else{m=(p.height-B)/2}}else{e=i.CENTER}}if(e===i.FULLFILL){s=0;m=0;o=0;y=0}else{if(e===i.CENTER){s=(p.width-g)/2;m=(p.height-B)/2}}if(q){this.removeClassName(a.DIALOG_INSIDE);this.addClassName(a.DIALOG_OVERFLOW);var n=Kekule.DocumentUtils.getScrollPosition(this.getDocument());s+=n.left;m+=n.top;if(s<0){s=0}if(m<0){m=0}}else{this.removeClassName(a.DIALOG_OVERFLOW);this.addClassName(a.DIALOG_INSIDE)}var u=this.getElement().style;var x=Kekule.ObjUtils.notUnset;if(x(s)){u.left=s+"px"}if(x(m)){u.top=m+"px"}if(x(o)){u.right=o+"px"}if(x(y)){u.bottom=o+"px"}if(x(k)){u.width=k+"px"}if(x(v)){u.height=v+"px"}this.adjustClientSize(k,v,q)}this._posAdjusted=true},adjustClientSize:function(f,e,g){},prepareShow:function(g){var f=this.getElement();if(!f.parentNode){this.getDocument().body.appendChild(f)}var e=this;setTimeout(function(){e._dialogCallback=g},0)},openModal:function(f,e){this.getGlobalManager().prepareModalWidget(this);return this.open(f,e)},openPopup:function(f,e){return this.open(f,e,Kekule.Widget.ShowHideType.POPUP)},open:function(g,e,f){this.prepareShow(g);this.show(e,null,f||Kekule.Widget.ShowHideType.DIALOG);this._dialogOpened=true;return this},close:function(e){this.setResult(e);this.hide()},isPositiveResult:function(e){return Kekule.Widget.DialogButtons.isPositive(e||this.getResult())},isNegativeResult:function(e){return Kekule.Widget.DialogButtons.isNegative(e||this.getResult())},widgetShowStateBeforeChanging:function($super,e){$super(e);if(e){this.adjustLocation();this.setResult(null)}else{}},doWidgetShowStateChanged:function($super,e){$super(e);if(!e){if(this._dialogCallback){this._dialogCallback(this.getResult());this._dialogCallback=null}}},widgetShowStateDone:function($super,e){$super(e);if(!e&&this._dialogOpened){if(this.getModalInfo()){this.getGlobalManager().unprepareModalWidget(this)}if(!this.isShown()){this._restorePositionInfo()}this._dialogOpened=false}}})})();(function(){var b=Kekule.HtmlElementUtils;var a=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{MSGPANEL:"K-MsgPanel",MSGPANEL_CONTENT:"K-MsgPanel-Content",MSGGROUP:"K-MsgGroup",MSGGROUP_FOR_WIDGET:"K-Widget-MsgGroup",MSG_NORMAL:"K-Msg-Normal",MSG_INFO:"K-Msg-Info",MSG_WARNING:"K-Msg-Warning",MSG_ERROR:"K-Msg-Error"});Kekule.Widget.MsgType={NORMAL:"",INFO:"info",WARNING:"warning",ERROR:"error"};Kekule.Widget.MsgPanel=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.MsgPanel",BINDABLE_TAG_NAMES:["span","div"],initialize:function($super,c,e,d){this._contentElem=null;this._elemTextPart=null;this._elemLeadingGlyphPart=null;this._elemTailingGlyphPart=null;this.setPropStoreFieldValue("showText",true);$super(c);if(e){this.setText(e)}if(d){this.setMsgType(d)}this.setUseCornerDecoration(true)},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,serializable:false,getter:function(){return Kekule.HtmlElementUtils.getInnerText(this.getElement())},setter:function(c){this.changeContentText(c)}});this.defineProp("showLeadingGlyph",{dataType:DataType.BOOL,setter:function(c){this.setPropStoreFieldValue("showLeadingGlyph",c);this._elemLeadingGlyphPart.style.display=c?"":"none"}});this.defineProp("showTailingGlyph",{dataType:DataType.BOOL,setter:function(c){this.setPropStoreFieldValue("showTailingGlyph",c);this._elemTailingGlyphPart.style.display=c?"":"none"}});this.defineProp("msgType",{dataType:DataType.STRING,setter:function(e){var c=this.getMsgType();if(c!==e){var d=this.getClassNameForMsgType(c);var f=this.getClassNameForMsgType(e);if(d!==f){this.removeClassName(d);this.addClassName(f)}this.setPropStoreFieldValue("msgType",e)}}})},doGetWidgetClassName:function($super){return $super()+" "+a.MSGPANEL},doCreateRootElement:function(d){var c=d.createElement("span");return c},doCreateSubElements:function($super,e,c){var f=b.getInnerText(c);c.innerHTML="";var d=e.createElement("span");d.className=a.MSGPANEL_CONTENT;c.appendChild(d);this._contentElem=d;this._elemTextPart=this.createTextContent(f,d);this._elemLeadingGlyphPart=this.createGlyphContent(d,this._elemTextPart,a.PART_PRI_GLYPH_CONTENT);this._elemTailingGlyphPart=this.createGlyphContent(d,null,a.PART_ASSOC_GLYPH_CONTENT)},doSetUseCornerDecoration:function($super,c){$super(c);if(c){Kekule.HtmlElementUtils.addClass(this._contentElem,a.CORNER_ALL)}else{Kekule.HtmlElementUtils.removeClass(this._contentElem,a.CORNER_ALL)}},getTextSelectable:function(){return true},changeContentText:function(c){Kekule.DomUtils.setElementText(this._elemTextPart,c||"")},getClassNameForMsgType:function(c){var d=Kekule.Widget.MsgType;switch(c){case d.INFO:return a.MSG_INFO;case d.WARNING:return a.MSG_WARNING;case d.ERROR:return a.MSG_ERROR;default:return a.MSG_NORMAL}}});Kekule.Widget.MsgGroup=Class.create(Kekule.Widget.WidgetGroup,{CLASS_NAME:"Kekule.Widget.MsgGroup",BINDABLE_TAG_NAMES:["span","div"],initialize:function($super,c){$super(c);this.setLayout(Kekule.Widget.Layout.VERTICAL)},initProperties:function(){this.defineProp("reversedOrder",{dataType:DataType.BOOL});this.defineProp("maxMsgCount",{dataType:DataType.INT,setter:function(c){this.setPropStoreFieldValue("maxMsgCount",c);this.clearExcessiveMsgs()}});this.defineProp("msgFlashTime",{dataType:DataType.INT})},initPropValues:function($super){$super();this.setMsgFlashTime(6000)},doGetWidgetClassName:function($super){return $super()+" "+a.MSGGROUP},doCreateRootElement:function(d){var c=d.createElement("div");return c},addMessage:function(i,d,h,e){if(i||d){var c=new Kekule.Widget.MsgPanel(this,i,d);c.setFinalizeAfterHiding(true);if(e){c.addClassName(e)}var g=this.getReversedOrder();if(g){c.insertToWidget(this,this.getChildAt(0))}else{c.appendToWidget(this)}var f=Kekule.ObjUtils.isUnset(h)?this.getMsgFlashTime():h;if(f){c.flash(f,this)}else{c.show(this)}this.clearExcessiveMsgs();return c}},clearExcessiveMsgs:function(){var h=this.getMaxMsgCount();if(h&&h>0){var g=this.getChildWidgets().length;var f=g-h;if(f>0){var e=0;var d=this;var c;var i=function(){if(e<f){c=d.getOldestMsgPanel();d.hideMsgPanel(c,i);++e}};i()}}},getOldestMsgPanel:function(){return this.getReversedOrder()?this.getLastChild():this.getFirstChild()},hideMsgPanel:function(c,d){c.hide(this,d);return c}});ClassEx.defineProp(Kekule.Widget.BaseWidget,"msgReporter",{dataType:"Kekule.Widget.MsgGroup",serializable:false,setter:null,getter:function(d){var c=this.getPropStoreFieldValue("msgReporter");if(!c&&d){c=new Kekule.Widget.MsgGroup(this);c.addClassName(a.MSGGROUP_FOR_WIDGET);c.appendToWidget(this);this.setPropStoreFieldValue("msgReporter",c)}return c}});ClassEx.extend(Kekule.Widget.BaseWidget,{reportMessage:function(h,d,g,f){var e=this.getMsgReporter(true);var c=e.addMessage(h,d,g||0,f);e.setDisplayed(true);return c},flashMessage:function(f,c,e,d){return this.reportMessage(f,c,e||this.getMsgReporter(true).getMsgFlashTime(),d)},removeMessage:function(c){c.hide()}})})();(function(){var c=Kekule.HtmlElementUtils;var b=Kekule.Widget.HtmlClassNames;var a=Kekule.ArrayUtils;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{TABVIEW:"K-TabView",TABVIEW_TABBUTTON:"K-TabView-TabButton",TABVIEW_CLIENT:"K-TabView-Client",TABVIEW_PAGE:"K-TabView-Page",TABVIEW_ACTIVE_PAGE:"K-TabView-Active-Page",TABVIEW_TABBUTTON_CONTAINER:"K-TabView-TabButton-Container",TABVIEW_PAGE_CONTAINER:"K-TabView-Page-Container",TABBUTTONGROUP:"K-TabButtonGroup",TAB_AT_LEFT:"K-TabAtLeft",TAB_AT_RIGHT:"K-TabAtRight",TAB_AT_TOP:"K-TabAtTop",TAB_AT_BOTTOM:"K-TabAtBottom"});Kekule.Widget.TabPage=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.TabPage",initProperties:function(){this.defineProp("text",{dataType:DataType.STRING})},doGetWidgetClassName:function($super){return $super()+" "+b.TABVIEW_PAGE},doCreateRootElement:function(e){var d=e.createElement("div");return d}});Kekule.Widget.TabButtonGroup=Class.create(Kekule.Widget.ButtonGroup,{CLASS_NAME:"Kekule.Widget.TabButtonGroup",initialize:function($super,d){$super(d);this.addEventListener("execute",function(g){var f=g.target;if((f instanceof Kekule.Widget.RadioButton)){this.invokeEvent("switch",{button:f})}},this);this.tabButtonPosChanged()},initProperties:function(){this.defineProp("tabButtonPosition",{dataType:DataType.INT,enumSource:Kekule.Widget.Position,setter:function(d){if(this.getTabButtonPosition()!==d){this.setPropStoreFieldValue("tabButtonPosition",d);this.tabButtonPosChanged()}}})},initPropValues:function($super){$super();this.setUseCornerDecoration(false)},doGetWidgetClassName:function($super){return $super()+" "+b.TABBUTTONGROUP},tabButtonPosChanged:function(){var e=Kekule.Widget.Position;var g=this.getTabButtonPosition();var f=(g&e.LEFT)||(g&e.RIGHT);var d=(g&e.RIGHT)?b.TAB_AT_RIGHT:(g&e.BOTTOM)?b.TAB_AT_BOTTOM:(g&e.LEFT)?b.TAB_AT_LEFT:b.TAB_AT_TOP;if(this._lastTabBtnPosClassName){this.removeClassName(this._lastTabBtnPosClassName)}this._lastTabBtnPosClassName=d;this.addClassName(this._lastTabBtnPosClassName);this.setLayout(f?Kekule.Widget.Layout.VERTICAL:Kekule.Widget.Layout.HORIZONTAL)}});Kekule.Widget.TabView=Class.create(Kekule.Widget.Container,{CLASS_NAME:"Kekule.Widget.TabView",TAB_BTN_FIELD:"__$tabButton__",initialize:function($super,d){this._tabBtnContainer=null;this._pageContainer=null;$super(d);if(Kekule.ObjUtils.isUnset(this.getUseCornerDecoration())){this.setUseCornerDecoration(true)}this.tabButtonPosChanged();this.addEventListener("change",this.reactTabPagePropChange,this)},doFinalize:function($super){if(this.getTabGroup()){this.getTabGroup().finalize()}$super()},initProperties:function(){this.defineProp("tabPages",{dataType:DataType.ARRAY,serializable:false,getter:function(){var d=this.getPropStoreFieldValue("tabPages");if(!d){d=[];this.setPropStoreFieldValue("tabPages",d)}return d},setter:null});this.defineProp("activeTabPage",{dataType:"Kekule.Widget.TabPage",serializable:false,setter:function(e){var d=this.getActiveTabPage();if(d!==e){if(this.hasChild(e)){this.setPropStoreFieldValue("activeTabPage",e);if(d){d.removeClassName(b.TABVIEW_ACTIVE_PAGE);this._getPageTabButton(d).setChecked(false)}if(e){e.addClassName(b.TABVIEW_ACTIVE_PAGE);this._getPageTabButton(e).setChecked(true);this.invokeEvent("switchTab",{tabPage:e})}}}}});this.defineProp("activeTabIndex",{dataType:DataType.INT,serializable:false,getter:function(){return this.getTabPages().indexOf(this.getActiveTabPage())},setter:function(e){var d=this.getTabPages()[e];if(d){this.setActiveTabPage(d)}}});this.defineProp("tabButtonPosition",{dataType:DataType.INT,enumSource:Kekule.Widget.Position,setter:function(d){if(this.getTabButtonPosition()!==d){this.setPropStoreFieldValue("tabButtonPosition",d);this.tabButtonPosChanged()}}});this.defineProp("showTabButtons",{dataType:DataType.BOOL,getter:function(){var d=this.getTabGroup();return d&&d.getDisplayed()},setter:function(e){var d=this.getTabGroup();if(d){d.setDisplayed(e)}}});this.defineProp("tabGroup",{dataType:"Kekule.Widget.ButtonGroup",serializable:false,setter:null,scope:Class.PropertyScope.PRIVATE})},doGetWidgetClassName:function($super){return $super()+" "+b.TABVIEW},doCreateRootElement:function(e){var d=e.createElement("div");return d},doCreateSubElements:function(g,e){var d=[];var h=g.createElement("div");h.className=b.TABVIEW_TABBUTTON_CONTAINER;var f=g.createElement("div");f.className=b.TABVIEW_PAGE_CONTAINER;this._tabBtnContainer=h;this._pageContainer=f;e.appendChild(h);e.appendChild(f);this.setPropStoreFieldValue("tabGroup",this.doCreateTabbar(g,h));return d},doCreateTabbar:function(f,e){var d=new Kekule.Widget.TabButtonGroup(f);d.appendToElem(e);d.addEventListener("switch",function(i){var g=i.button;var h=this._getPageOfTabButton(g);if(h){this.setActiveTabPage(h)}},this);return d},getChildrenHolderElement:function(){return this._pageContainer},getContainerElement:function(){return this._pageContainer},_getPageTabButton:function(d){return d[this.TAB_BTN_FIELD]},_setPageTabButton:function(d,e){d[this.TAB_BTN_FIELD]=e},_getPageOfTabButton:function(g){var d=this.getTabPages();for(var f=0,e=d.length;f<e;++f){var h=d[f];if(this._getPageTabButton(h)===g){return h}}return null},childWidgetAdded:function($super,e){$super(e);if(e instanceof Kekule.Widget.TabPage){var d=!this.getTabPages().length;e.appendToElem(this._pageContainer);this.getTabPages().push(e);this._insertTabButtonBefore(e);if(d){this.setActiveTabPage(e)}}},childWidgetRemoved:function($super,d){$super(d);if(d instanceof Kekule.Widget.TabPage){a.remove(this.getTabPages(),d);this._removeTabButton(d)}},childWidgetMoved:function($super,e,d){$super(e,d);if(e instanceof Kekule.Widget.TabPage){this._changeTabIndex(e,d)}},_insertTabButtonBefore:function(d,g){var f=this.getTabGroup();var e=new Kekule.Widget.RadioButton(this.getDocument());this._updateTabButton(d,e);this._setPageTabButton(d,e);if(g){e.insertToWidget(f,g)}else{e.appendToWidget(f)}},_updateTabButton:function(d,e){if(!e){e=this._getPageTabButton(d)}e.setText(d.getText()||"");if(d.getHint()){e.setHint(d.getHint())}},_removeTabButton:function(d){var e=this._getPageTabButton(d);if(e){e.finalize()}},_changeTabIndex:function(e,g){var f=this._getPageTabButton(e);this.getTabGroup()._moveChild(f,g);var d=this.getTabPages();var h=d.indexOf(e);if(h>=0&&h!==g){a.changeItemIndex(d,e,g)}},reactTabPagePropChange:function(g){var f=g.target;if(f instanceof Kekule.Widget.TabPage){var d=this._getPageTabButton(f);if(d){this._updateTabButton(f,d)}}},tabButtonPosChanged:function(){var f=Kekule.Widget.Position;var h=this.getTabButtonPosition();var e=(h&f.BOTTOM)||(h&f.RIGHT);var g=(h&f.LEFT)||(h&f.RIGHT);var d=(h&f.RIGHT)?b.TAB_AT_RIGHT:(h&f.BOTTOM)?b.TAB_AT_BOTTOM:(h&f.LEFT)?b.TAB_AT_LEFT:b.TAB_AT_TOP;if(this._lastTabBtnPosClassName){this.removeClassName(this._lastTabBtnPosClassName)}this._lastTabBtnPosClassName=d;this.addClassName(this._lastTabBtnPosClassName);this.getTabGroup().setTabButtonPosition(h);if(e){this.getElement().appendChild(this._tabBtnContainer)}else{this.getElement().insertBefore(this._tabBtnContainer,this._pageContainer)}},createNewTabPage:function(i,h,e){var g=this.getDocument();var d=new Kekule.Widget.TabPage(g);d.setText(i);d.setHint(h);d.appendToWidget(this);if(e){var f=this.getChildWidgets().indexOf(e);this._moveChild(d,f)}return d}})})();(function(){var c=Kekule.DomUtils;var d=Kekule.HtmlElementUtils;var b=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{VALUELISTEDITOR:"K-ValueListEditor",VALUELISTEDITOR_ROW:"K-ValueListEditor-Row",VALUELISTEDITOR_CELL:"K-ValueListEditor-Cell",VALUELISTEDITOR_INDICATORCELL:"K-ValueListEditor-IndicatorCell",VALUELISTEDITOR_KEYCELL:"K-ValueListEditor-KeyCell",VALUELISTEDITOR_VALUECELL:"K-ValueListEditor-ValueCell",VALUELISTEDITOR_CELL_CONTENT:"K-ValueListEditor-CellContent",VALUELISTEDITOR_VALUECELL_TEXT:"K-ValueListEditor-ValueCellText",VALUELISTEDITOR_INLINE_EDIT:"K-ValueListEditor-InlineEdit",VALUELISTEDITOR_EXPANDMARK:"K-ValueListEditor-ExpandMark",VALUELISTEDITOR_ACTIVE_ROW:"K-ValueListEditor-ActiveRow"});Kekule.Widget.ValueListEditor=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.ValueListEditor",BINDABLE_TAG_NAMES:["table"],ROW_ELEM_TAG:"tr",CELL_ELEM_TAG:"td",ROW_DATA_FIELD:"__$row_data__",ROW_EDIT_INFO_FIELD:"__$row_edit_info__",initialize:function($super,e){$super(e);this._inlineEdit=null;this._isActivitingRow=false},initProperties:function(){this.defineProp("hash",{dataType:DataType.HASH,getter:function(){return this._getTotalHash()},setter:function(e){this._setTotalHash(e);this.setPropStoreFieldValue("hash",e)}});this.defineProp("readOnly",{dataType:DataType.BOOL});this.defineProp("useKeyHint",{dataType:DataType.BOOL});this.defineProp("valueDisplayMode",{dataType:DataType.INT,enumSource:Kekule.Widget.ValueListEditor.ValueDisplayMode,setter:function(e){if(this.getValueDisplayMode()!==e){this.setPropStoreFieldValue("valueDisplayMode",e);this.valueDisplayModeChanged()}}});this.defineProp("activeRow",{dataType:DataType.OBJECT,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:function(f){var e=this.getActiveRow();if(e!==f){if(e){this.finishEditing();d.removeClass(e,b.VALUELISTEDITOR_ACTIVE_ROW);this._showValueCellText(e)}if(this._inlineEdit){this._inlineEdit.finalize()}if(f){d.addClass(f,b.VALUELISTEDITOR_ACTIVE_ROW);if(!this.getReadOnly()){this.createValueEditWidget(f)}}this.setPropStoreFieldValue("activeRow",f);this.invokeEvent("activeRowChange",{row:f})}}})},doGetWidgetClassName:function(){return b.VALUELISTEDITOR},doCreateRootElement:function(f){var e=f.createElement("table");return e},doBindElement:function($super,e){$super(e)},getRootElem:function(){return this.getElement()},createRowElem:function(f){var e=f.createElement(this.ROW_ELEM_TAG);d.addClass(e,b.VALUELISTEDITOR_ROW);return e},createCellElem:function(f){var e=f.createElement(this.CELL_ELEM_TAG);d.addClass(e,b.VALUELISTEDITOR_CELL);return e},createIndicatorCellElem:function(g){var e=this.createCellElem(g);d.addClass(e,b.VALUELISTEDITOR_INDICATORCELL);var f=g.createElement("span");e.appendChild(f);return e},createKeyCellElem:function(f){var e=this.createCellElem(f);d.addClass(e,b.VALUELISTEDITOR_KEYCELL);return e},createValueCellElem:function(f){var e=this.createCellElem(f);d.addClass(e,b.VALUELISTEDITOR_VALUECELL);return e},createValueEditWidget:function(h){var f=null;if(h===this.getActiveRow()){f=this._inlineEdit}else{if(this._inlineEdit){this._inlineEdit.finalize();this._inlineEdit=null}}if(!f){f=this.doCreateValueEditWidget(h);f.setBubbleUiEvents(true);d.addClass(f.getElement(),b.VALUELISTEDITOR_INLINE_EDIT);var e=this.getValueCell(h);var g=this.getCellContentWrapper(e,true);f.appendToElem(g)}if(f){if(f.focus){f.focus()}if(f.selectAll){f.selectAll()}this._inlineEdit=f;this._hideValueCellText(h)}return f},doCreateValueEditWidget:function(j){var i=this.getRowData(j);var h=this.getValueCellText(j,i);var f=this.getValueEditWidgetInfo(j);var g=f.widgetClass;var e=new g(this);if(f.propValues){e.setPropValues(f.propValues)}e.setValue(h);return e},getDefaultValueEditWidgetInfo:function(){return{widgetClass:Kekule.Widget.TextBox}},getValueEditWidgetInfo:function(e){return this.getRowEditInfo(e)||this.getDefaultValueEditWidgetInfo()},getRowElems:function(){if(this.getRootElem()){return c.getDirectChildElems(this.getRootElem(),this.ROW_ELEM_TAG)}else{return[]}},getRows:function(){return this.getRowElems()},getRowCount:function(){var e=this.getRowElems();return e?e.length:0},getRowAt:function(e){var f=this.getRowElems();return f?f[e]:null},getPrevRow:function(g){var f=this.ROW_ELEM_TAG.toLowerCase();var e=g.previousSibling;while(e&&((e.nodeType!==Node.ELEMENT_NODE)||(e.tagName.toLowerCase()!==f))){e=e.previousSibling}return e},getNextRow:function(g){var f=this.ROW_ELEM_TAG.toLowerCase();var e=g.nextSibling;while(e&&((e.nodeType!==Node.ELEMENT_NODE)||(e.tagName.toLowerCase()!==f))){e=e.nextSibling}return e},getKeyCell:function(f){var e=c.getDirectChildElems(f,this.CELL_ELEM_TAG);return e[1]},getCellContentWrapper:function(f,h){var g=c.getDirectChildElems(f);var e=g?g[0]:null;if(!e&&h){e=f.ownerDocument.createElement("span");f.appendChild(e);d.addClass(e,b.VALUELISTEDITOR_CELL_CONTENT)}return e},getValueCellTextWrapper:function(f,i){var e=null;var h=this.getCellContentWrapper(f,i);if(h){var g=h.getElementsByTagName("span");e=g?g[0]:null;if(!e&&i){e=f.ownerDocument.createElement("span");h.appendChild(e);d.addClass(e,b.VALUELISTEDITOR_VALUECELL_TEXT)}}return e},_hideValueCellText:function(f){var e=this.getValueCellTextWrapper(this.getValueCell(f));if(e){e.style.visibility="hidden"}},_showValueCellText:function(f){var e=this.getValueCellTextWrapper(this.getValueCell(f));if(e){e.style.visibility="visible"}},getValueCell:function(f){var e=c.getDirectChildElems(f,this.CELL_ELEM_TAG);return e[2]},getParentCell:function(f){var e=c.getNearestAncestorByTagName(f,this.CELL_ELEM_TAG,true);return e},getParentRow:function(f){var e=c.getNearestAncestorByTagName(f,this.ROW_ELEM_TAG,true);return e},_createNewRow:function(h){var j=this.getDocument();var e=this.createRowElem(j);if(e){var i=this.createIndicatorCellElem(j);e.appendChild(i);var f=this.createKeyCellElem(j);e.appendChild(f);var g=this.createValueCellElem(j);e.appendChild(g);if(h){this.setRowData(e,h)}}return e},insertRowBefore:function(f,e){var g=this._createNewRow(f);if(g){this.getRootElem().insertBefore(g,e||null)}return g},appendRow:function(e){return this.insertRowBefore(e,null)},removeRow:function(e){if(e===this.getActiveRow()){this.setActiveRow(null)}this.getRootElem().removeChild(e);return this},removeRowAt:function(e){var f=this.getRowAt(e);if(f){this.removeRow(f)}return this},clear:function(){this.setActiveRow(null);if(this.getRootElem()){Kekule.DomUtils.clearChildContent(this.getRootElem())}},updateAll:function(){var h=this.getRowElems();for(var f=0,e=h.length;f<e;++f){var j=h[f];var g=this.getRowData(j);this.setRowData(j,g)}return this},valueDisplayModeChanged:function(){this.updateAll()},getKeyCellText:function(f,e){return e.title||e.key},getKeyCellHint:function(f,e){return e.hint||this.getKeyCellText(f,e)},getValueCellText:function(h,f){var g=this.getValueDisplayMode();var e=(g===a.JSON)?JSON.stringify(f.value):""+f.value;return e},valueCellTextToValue:function(e,h,g){var f=this.getValueDisplayMode();return(f===a.JSON)?JSON.parse(e):e},setValueCellText:function(e,h){var g=this.getRowData(h);var f=this.valueCellTextToValue(e,h,g);g.value=f;this.setRowData(h,g);return this},getRowData:function(e){return e[this.ROW_DATA_FIELD]},setRowData:function(f,e){f[this.ROW_DATA_FIELD]=e;this.setRowKeyCellContent(f,this.getKeyCellText(f,e),this.getKeyCellHint(f,e));this.setRowValueCellContent(f,this.getValueCellText(f,e));if(f===this.getActiveRow()&&this._inlineEdit){this.createValueEditWidget(f)}},setRowKeyCellContent:function(i,g,f){var e=this.getKeyCell(i);var h=this.getCellContentWrapper(e,true);h.innerHTML=g;if(this.getUseKeyHint()){h.title=f}},setRowValueCellContent:function(h,f){var e=this.getValueCell(h);var i=this.getValueCellTextWrapper(e,true);var g=f;if(g===""){i.innerHTML="&nbsp;"}else{Kekule.DomUtils.setElementText(i,g)}},getRowEditInfo:function(e){return e[this.ROW_EDIT_INFO_FIELD]},setRowEditInfo:function(f,e){f[this.ROW_EDIT_INFO_FIELD]=e;if(f===this.getActiveRow()){this.setActiveRow(null);this.setActiveRow(activeRow)}},editRow:function(e){this.setActiveRow(e)},finishEditing:function(){var e=this.getActiveRow();if(e&&this._inlineEdit){this.setValueCellText(this._inlineEdit.getValue(),e);this.invokeEvent("editFinish",{row:e})}return this},cancelEditing:function(){var f=this.getActiveRow();if(f&&this._inlineEdit){var e=this.getRowData(f);this.setRowData(f,e);this.invokeEvent("editCancel",{row:f})}return this},_getTotalHash:function(){var e={};var j=this.getRowElems();for(var g=0,f=j.length;g<f;++g){var k=j[g];var h=this.getRowData(k);if(h){e[h.key]=h.value}}return e},_setTotalHash:function(g){var p=this.getRowElems();var e=p.length;var n=Kekule.ObjUtils.getOwnedFieldNames(g);var f=n.length;for(var h=0;h<f;++h){var m=n[h];var j=g[m];var o;if(h<e){o=this.getRowAt(h);this.setRowData(o,{key:m,value:j})}else{o=this.appendRow({key:m,value:j})}}if(e>f){for(var h=e-1;h>=f;--h){this.removeRow(p[h])}}var k=this.getActiveRow();if(k){this.setActiveRow(null);this.setActiveRow(k)}return this},react_click:function(g){var f=g.getTarget();var h=this.getParentRow(f);if(h){this.setActiveRow(h)}},react_keydown:function(i){var h=i.getKeyCode();var f=!(i.getAltKey()||i.getShiftKey()||i.getCtrlKey());if(f){var g=this.getActiveRow();if(g){var j;if(h===Kekule.X.Event.KeyCode.UP){j=this.getPrevRow(g)}else{if(h===Kekule.X.Event.KeyCode.DOWN){j=this.getNextRow(g)}}if(j){this.setActiveRow(j)}}}},react_keyup:function(g){var f=g.getKeyCode();if(f===Kekule.X.Event.KeyCode.ESC){this.cancelEditing()}else{if(f===Kekule.X.Event.KeyCode.ENTER){this.finishEditing()}}},react_blur:function(f){return;this.finishEditing();this.setActiveRow(null)}});Kekule.Widget.ValueListEditor.ValueDisplayMode={SIMPLE:0,JSON:1};var a=Kekule.Widget.ValueListEditor.ValueDisplayMode})();(function(){var b=Kekule.DomUtils;var c=Kekule.HtmlElementUtils;var a=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{COLORPICKER:"K-ColorPicker",COLORPICKER_HEADER:"K-ColorPicker-Header",COLORPICKER_SPEC_COLOR_PALETTE:"K-ColorPicker-Spec-Color-Palette",COLORPICKER_HEXBOX:"K-ColorPicker-HexBox",COLORPICKER_PREVIEWER:"K-ColorPicker-Previewer",COLORPICKER_INPUT:"K-ColorPicker-Input",COLORPICKER_BROWSE_BTN:"K-ColorPicker-Browse-Btn",COLORPICKER_PALETTE:"K-ColorPicker-Palette",COLORPICKER_PALETTE_LINE:"K-ColorPicker-Palette-Line",COLORPICKER_PALETTE_CELL:"K-ColorPicker-Palette-Cell",COLORPICKER_PALETTE_CELL_TRANSPARENT:"K-ColorPicker-Palette-Cell-Transparent",COLORPICKER_SPEC_COLOR_UNSET:"K-Color-Unset",COLORPICKER_SPEC_COLOR_DEFAULT:"K-Color-Default",COLORPICKER_SPEC_COLOR_MIXED:"K-Color-Mixed",COLORPICKER_SPEC_COLOR_TRANSPARENT:"K-Color-Transparent",COLORDROPTEXTBOX:"K-ColorDropTextBox",COLORDROPBUTTON:"K-ColorDropButton",COLORPREVIEWER:"K-ColorPreviewer"});Kekule.Widget.ColorPicker=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.ColorPicker",COLOR_VALUE_FIELD:"__$colorValue__",COLOR_TEXT_FIELD:"__$colorText__",COLOR_CLASS_FIELD:"__ $colorClass__",BINDABLE_TAG_NAMES:["div","span"],initialize:function($super,d){$super(d);this.setUseCornerDecoration(true);this.setValue("#000000")},initProperties:function(){this.defineProp("value",{dataType:DataType.STRING,setter:function(d){this.setPropStoreFieldValue("value",d);this.getHexBox().innerHTML=d||"&nbsp;";this.getPreviewer().style.backgroundColor=d;if(this.getColorInput()){this.getColorInput().value=d}}});this.defineProp("colorClassName",{dataType:DataType.STRING});this.defineProp("specialColors",{dataType:DataType.ARRAY,setter:function(d){this.setPropStoreFieldValue("specialColors",d);this._recreateSpecialColorPaletteCells(this.getDocument(),this.getSpecialColorPalette())}});this.defineProp("isDirty",{dataType:DataType.BOOL,serializable:false});this.defineProp("hexBox",{dataType:DataType.OBJECT,serializable:false,scope:Class.PropertyScope.PRIVATE});this.defineProp("palette",{dataType:DataType.OBJECT,serializable:false,scope:Class.PropertyScope.PRIVATE});this.defineProp("previewer",{dataType:DataType.OBJECT,serializable:false,scope:Class.PropertyScope.PRIVATE});this.defineProp("colorInput",{dataType:DataType.OBJECT,serializable:false,scope:Class.PropertyScope.PRIVATE});this.defineProp("specialColorPalette",{dataType:DataType.OBJECT,serializable:false,scope:Class.PropertyScope.PRIVATE});this.defineProp("isPicking",{dataType:DataType.BOOL,serializable:false,scope:Class.PropertyScope.PRIVATE})},doGetWidgetClassName:function($super){return $super()+" "+a.COLORPICKER},doCreateRootElement:function(e){var d=e.createElement("div");return d},doCreateSubElements:function(f,e){var d=[];d.push(this.doCreateHeader(f,e));d.push(this.doCreatePalette(f,e));return d},doCreateHeader:function(h,e){var d=h.createElement("div");d.className=a.COLORPICKER_HEADER;d.appendChild(this.doCreateSpecialColorPalette(h));d.appendChild(this.doCreateHexBox(h));d.appendChild(this.doCreatePreviewer(h));var g=this.doCreateColorInput(h);if(g){d.appendChild(g);var f=this.doCreateColorDialogBtn(h);if(f){f.appendToElem(d)}}e.appendChild(d);return d},doCreateSpecialColorPalette:function(e){var d=e.createElement("div");d.className=a.COLORPICKER_SPEC_COLOR_PALETTE;this._recreateSpecialColorPaletteCells(e,d);this.setSpecialColorPalette(d);return d},_isPredefinedSpecialColor:function(d){var f=Kekule.Widget.ColorPicker.SpecialColors;var e=[f.UNSET,f.DEFAULT,f.MIXED,f.TRANSPARENT];return e.indexOf(d)>=0},_getPredefinedSpecialColorInfo:function(e){var j=Kekule.Widget.ColorPicker.SpecialColors;var g=[j.UNSET,j.DEFAULT,j.MIXED,j.TRANSPARENT];var i=[a.COLORPICKER_SPEC_COLOR_UNSET,a.COLORPICKER_SPEC_COLOR_DEFAULT,a.COLORPICKER_SPEC_COLOR_MIXED,a.COLORPICKER_SPEC_COLOR_TRANSPARENT];var h=[Kekule.$L("WidgetTexts.S_COLOR_UNSET"),Kekule.$L("WidgetTexts.S_COLOR_DEFAULT"),Kekule.$L("WidgetTexts.S_COLOR_MIXED"),Kekule.$L("WidgetTexts.S_COLOR_TRANSPARENT"),];var d={value:e};var f=g.indexOf(e);if(f>=0){d.text=h[f];d.className=i[f]}return d},_recreateSpecialColorPaletteCells:function(m,d){Kekule.DomUtils.clearChildContent(d);var f=this.getSpecialColors();if(f&&f.length){for(var h=0,e=f.length;h<e;++h){var g=f[h];var k;var j={};if(DataType.isObjectValue(g)){j=g}else{if(this._isPredefinedSpecialColor(g)){j=this._getPredefinedSpecialColorInfo(g)}else{j.value=g}}k=this.doCreatePaletteCell(m,j.value,j.text,j.className);if(j.className){Kekule.HtmlElementUtils.addClass(k,j.className)}d.appendChild(k)}}},doCreateHexBox:function(e){var d=e.createElement("span");d.className=a.COLORPICKER_HEXBOX;d.innerHTML="&nbsp";this.setHexBox(d);return d},doCreatePreviewer:function(e){var d=e.createElement("span");d.className=a.COLORPICKER_PREVIEWER;d.innerHTML="&nbsp";this.setPreviewer(d);return d},doCreateColorInput:function(f){if(Kekule.BrowserFeature.html5Form.supportType("color")){var d=f.createElement("input");d.setAttribute("type","color");d.className=a.COLORPICKER_INPUT;var e=this;Kekule.X.Event.addListener(d,"change",function(h){var g=d.value;e.setValue(g);e.notifyColorSet()});this.setColorInput(d);return d}else{return null}},doCreateColorDialogBtn:function(e){if(Kekule.BrowserFeature.html5Form.supportType("color")){var d=new Kekule.Widget.Button(e);d.setText(Kekule.$L("WidgetTexts.CAPTION_BROWSE_COLOR"));d.setHint(Kekule.$L("WidgetTexts.HINT_BROWSE_COLOR"));d.setShowText(false);d.doSetShowGlyph(true);d.linkStyleResource(Kekule.Widget.StyleResourceNames.ICON_COLOR_PICK);d.addClassName(a.COLORPICKER_BROWSE_BTN);d.addEventListener("execute",this.openColorDialog,this);return d}},doCreatePalette:function(n,m){var q=n.createElement("div");q.className=a.COLORPICKER_PALETTE;var o=["00","00","11","22","33","44","55","66","77","88","99","AA","BB","CC","DD","EE","FF",null];var p=o.length;var d=this.doCreatePaletteLine(n);for(var l=0;l<p;l++){var h=o[l]?"#"+o[l]+o[l]+o[l]:"transparent";var f=this.doCreatePaletteCell(n,h);d.appendChild(f)}q.appendChild(d);o=["00","33","66","99","CC","FF"];var p=o.length;for(var l=0;l<p;l++){var d=this.doCreatePaletteLine(n);for(var g=0;g<(p>>1);g++){for(var e=0;e<p;e++){var h="#"+o[g]+o[l]+o[e];var f=this.doCreatePaletteCell(n,h);d.appendChild(f)}}q.appendChild(d)}for(var l=0;l<p;l++){var d=this.doCreatePaletteLine(n);for(var g=(p>>1);g<p;g++){for(var e=0;e<p;e++){var h="#"+o[g]+o[l]+o[e];var f=this.doCreatePaletteCell(n,h);d.appendChild(f)}}q.appendChild(d)}m.appendChild(q);this.setPalette(q);return q},doCreatePaletteCell:function(k,i,g,f){var d=k.createElement("span");var h=a.COLORPICKER_PALETTE_CELL;if(i==="transparent"){h+=" "+a.COLORPICKER_PALETTE_CELL_TRANSPARENT}else{try{d.style.backgroundColor=i}catch(j){}}d[this.COLOR_VALUE_FIELD]=i;d[this.COLOR_TEXT_FIELD]=g||i;d[this.COLOR_CLASS_FIELD]=f;d.className=h;d.title=g||i;return d},doCreatePaletteLine:function(e){var d=e.createElement("div");d.className=a.COLORPICKER_PALETTE_LINE;return d},_isPaletteCellElem:function(d){return Kekule.HtmlElementUtils.hasClass(d,a.COLORPICKER_PALETTE_CELL)},openColorDialog:function(){if(this.getColorInput()){this.getColorInput().click()}return this},applyColor:function(g){var d=g[this.COLOR_VALUE_FIELD];if(d){this.setValue(d)}var e=g[this.COLOR_TEXT_FIELD];if(e){this.getHexBox().innerHTML=e}var f=g[this.COLOR_CLASS_FIELD];this.setColorClassName(f)},notifyColorSet:function(){this.setIsDirty(true);this.invokeEvent("valueSet",{value:this.getValue(),colorClassName:this.getColorClassName()});this.invokeEvent("valueChange",{value:this.getValue(),colorClassName:this.getColorClassName()})},doReactActiviting:function($super,f){$super(f);var d=f.getTarget();if(this._isPaletteCellElem(d)){this.setIsPicking(true);this.applyColor(d);return true}},doReactDeactiviting:function($super,f){if(this.getIsPicking()){this.setIsPicking(false);var d=f.getTarget();if(this._isPaletteCellElem(d)){this.applyColor(d)}this.notifyColorSet();return true}$super(f)},reactPointerMoving:function($super,g){$super(g);if(this.getIsPicking()){var f=g.getTarget();if(g.getTouches()){var h={x:g.getWindowX(),y:g.getWindowY()};var d=this.getDocument();f=(d.elementFromPoint&&d.elementFromPoint(h.x,h.y))||f;g.preventDefault()}if(f&&this._isPaletteCellElem(f)){this.applyColor(f)}return true}}});Kekule.Widget.ColorPicker.SpecialColors={UNSET:"(unset)",DEFAULT:"(default)",MIXED:"(mixed)",TRANSPARENT:"transparent"};Kekule.Widget.ColorDropTextBox=Class.create(Kekule.Widget.ButtonTextBox,{CLASS_NAME:"Kekule.Widget.ColorDropTextBox",initialize:function($super,d,e){$super(d);this.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN);this.addEventListener("buttonExecute",this.reactDropbuttonExecute,this);this.setShowPreview(true);if(e){this.setValue(e)}},initProperties:function(){this.defineProp("showPreview",{dataType:DataType.BOOL,setter:function(d){this.getPreviewElem().style.display=d?"inherit":""}});this.defineProp("colorClassName",{dataType:DataType.STRING,setter:function(f){var e=this.getPreviewElem();if(e){var d=this.getColorClassName();if(d){Kekule.HtmlElementUtils.removeClass(e,d)}if(f){Kekule.HtmlElementUtils.addClass(e,f)}}this.setPropStoreFieldValue("colorClassName",f)}});this.defineProp("colorPicker",{dataType:"Kekule.Widget.ColorPicker",setter:null,serializable:false,scope:Class.PropertyScope.PUBLIC,getter:function(){var d=this.getPropStoreFieldValue("colorPicker");if(!d){d=new Kekule.Widget.ColorPicker(this);d.setDisplayed(false);d.getElement().style.position="absolute";d.setSpecialColors(this.getSpecialColors());d.addEventListener("valueChange",this.reactColorPickerValueSet,this);d.appendToElem(this.getElement());this.setPropStoreFieldValue("colorPicker",d)}return d}});this.defineProp("specialColors",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("specialColors",e);var d=this.getPropStoreFieldValue("colorPicker");if(d){d.setSpecialColors(e)}}})},doFinalize:function($super){var d=this.getPropStoreFieldValue("colorPicker");if(d){d.finalize()}$super()},doGetWidgetClassName:function($super){return $super()+" "+a.COLORDROPTEXTBOX},doCreateSubElements:function($super,f,d){$super(f,d);var e=new Kekule.Widget.DumbWidget(this);e.addClassName(a.COLORPREVIEWER);this.setHeadingWidget(e);return[e.getElement()]},getPreviewElem:function(){var d=this.getHeadingWidget();if(d){return d.getElement()}},showColorPicker:function(){var d=this.getColorPicker();if(!d.isShown()){d.setValue(this.getValue());d.show(this,null,Kekule.Widget.ShowHideType.DROPDOWN)}},hideColorPicker:function(){var d=this.getPropStoreFieldValue("colorPicker");if(d&&d.isShown()){d.hide()}},reactDropbuttonExecute:function(d){this.showColorPicker()},reactColorPickerValueSet:function(f){var d=f.value;this.setValue(d);this.setIsDirty(this.getIsDirty()||this.getColorPicker().getIsDirty());this.setColorClassName(f.colorClassName);this.hideColorPicker();f.stopPropagation()},doSetValue:function($super,e){$super(e);var d=this.getPreviewElem();if(d){d.style.backgroundColor="transparent";d.style.backgroundColor=e}}});Kekule.Widget.ColorDropButton=Class.create(Kekule.Widget.DropDownButton,{CLASS_NAME:"Kekule.Widget.ColorDropButton",initialize:function($super,d,e){$super(d);this.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN);this.setShowPreview(true);if(e){this.setValue(e)}},initProperties:function(){this.defineProp("showPreview",{dataType:DataType.BOOL,setter:function(d){this.getPreviewElem().style.display=d?"inherit":""}});this.defineProp("value",{dataType:DataType.STRING,getter:function(){return this.getText()},setter:function(d){this.setText(d);this.updateColorPreview(d)}});this.defineProp("colorClassName",{dataType:DataType.STRING,setter:function(f){var e=this.getPreviewElem();if(e){var d=this.getColorClassName();if(d){Kekule.HtmlElementUtils.removeClass(e,d)}if(f){Kekule.HtmlElementUtils.addClass(e,f)}}this.setPropStoreFieldValue("colorClassName",f)}});this.defineProp("colorPicker",{dataType:"Kekule.Widget.ColorPicker",setter:null,serializable:false,scope:Class.PropertyScope.PUBLIC,getter:function(){var d=this.getPropStoreFieldValue("colorPicker");if(!d){d=new Kekule.Widget.ColorPicker(this);d.setDisplayed(false);d.getElement().style.position="absolute";d.setSpecialColors(this.getSpecialColors());d.addEventListener("valueChange",this.reactColorPickerValueSet,this);this.setPropStoreFieldValue("colorPicker",d)}return d}});this.defineProp("specialColors",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("specialColors",e);var d=this.getPropStoreFieldValue("colorPicker");if(d){d.setSpecialColors(e)}}});this.defineProp("isDirty",{dataType:DataType.BOOL,serializable:false,getter:function(){return this.getColorPicker().getIsDirty()},setter:function(d){this.getColorPicker().setIsDirty(d)}})},doFinalize:function($super){var d=this.getPropStoreFieldValue("colorPicker");if(d){d.finalize()}$super()},doGetWidgetClassName:function($super){return $super()+" "+a.COLORDROPBUTTON},doGetDropDownWidget:function(){return this.getColorPicker()},getPreviewElem:function(){return this._elemLeadingGlyphPart},showColorPicker:function(){var d=this.getColorPicker();if(!d.isShown()){d.setValue(this.getValue());d.show(this,null,Kekule.Widget.ShowHideType.DROPDOWN)}},hideColorPicker:function(){var d=this.getPropStoreFieldValue("colorPicker");if(d&&d.isShown()){d.hide()}},reactColorPickerValueSet:function(g){var f=g.value;var d=g.colorClassName;this.setValue(f);this.setColorClassName(d);this.hideColorPicker();this.invokeEvent("valueChange",{value:f});g.stopPropagation()},updateColorPreview:function(e){var d=this.getPreviewElem();if(d){d.style.backgroundColor="transparent";d.style.backgroundColor=e}}})})();(function(){var b=Kekule.DomUtils;var c=Kekule.HtmlElementUtils;var a=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{TEXTEDITOR:"K-TextEditor",TEXTEDITOR_TOOLBAR:"K-TextEditor-Toolbar",TEXTEDITOR_TEXTAREA:"K-TextEditor-TextArea",TEXTEDITOR_FONTBOX:"K-TextEditor-FontBox",TEXTEDITOR_BTN_FONTSIZEINC:"K-TextEditor-Btn-FontSizeInc",TEXTEDITOR_BTN_FONTSIZEDEC:"K-TextEditor-Btn-FontSizeDec",TEXTEDITOR_BTN_TEXTWRAP:"K-TextEditor-Btn-TextWrap"});Kekule.Widget.TextEditor=Class.create(Kekule.Widget.FormWidget,{CLASS_NAME:"Kekule.Widget.TextEditor",BINDABLE_TAG_NAMES:["div","span"],DEF_TOOLBAR_COMPONENTS:["fontFamily","fontSizeInc","fontSizeDec","textWrap"],initialize:function($super,d){this._toolCompWidgets=[];this.setPropStoreFieldValue("showToolbar",true);$super(d)},initProperties:function(){this.defineProp("text",{dataType:DataType.STRING,serializable:false,getter:function(){var d=this.getTextArea();return d?d.getText():null},setter:function(d){var e=this.getTextArea();if(e){e.setText(d)}}});this.defineProp("readOnly",{dataType:DataType.BOOL,serializable:false,getter:function(){return this.getTextArea().getReadOnly()},setter:function(d){return this.getTextArea().setReadOnly(d)}});this.defineProp("wrap",{dataType:DataType.STRING,serializable:false,getter:function(){return this.getTextArea().getWrap()},setter:function(e){var d=this.getTextArea().setWrap(e);this.updateToolButtonStates();return d}});this.defineProp("textArea",{dataType:"Kekule.Widget.TextArea",serializable:false,setter:null,scope:Class.PropertyScope.PRIVATE,getter:function(){var d=this.getPropStoreFieldValue("textArea");if(!d){d=this.createTextArea();this.setPropStoreFieldValue("textArea",d)}return d}});this.defineProp("toolbar",{dataType:"Kekule.Widget.Toolbar",serializable:false,setter:null,scope:Class.PropertyScope.PRIVATE,getter:function(){var d=this.getPropStoreFieldValue("toolbar");if(!d){if(this.getShowToolbar()){d=this.createToolbar();this.setPropStoreFieldValue("styleToolbar",d)}}return d}});this.defineProp("showToolbar",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("showToolbar",e);var d=this.getToolbar();d.setDisplayed(e)}});this.defineProp("toolbarPos",{dataType:DataType.INT,setter:function(d){this.setPropStoreFieldValue("toolbarPos",d);this.updateChildWidgetPos()}});this.defineProp("toolbarComponents",{dataType:DataType.ARRAY,serializable:false,getter:function(){var d=this.getPropStoreFieldValue("toolbarComponents");if(!d){d=null;this.setPropStoreFieldValue("toolbarComponents",d)}return d},setter:function(d){this.setPropStoreFieldValue("toolbarComponents",d);this.recreateToolbarComponents(d)}});this.defineProp("candidateFontFamilies",{dataType:DataType.ARRAY});this.defineProp("fontSizeLevel",{dataType:DataType.FLOAT,setter:function(d){this.setPropStoreFieldValue("fontSizeLevel",d);this.setTextStyle({fontSize:""+d+"em"})}})},finalize:function($super){this._finalizeSubElements();$super()},_finalizeSubElements:function(){var d=this.getTextArea();if(d){d.finalize()}},getCoreElement:function($super){var d=this.getTextArea();if(d){return d.getElement()}else{return $super()}},doGetWidgetClassName:function($super){return $super()+" "+a.TEXTEDITOR},doCreateRootElement:function(e){var d=e.createElement("span");return d},doCreateSubElements:function(f,d){var e=this.createToolbar();if(e){e.appendToElem(d)}var g=this.createTextArea();g.appendToElem(d);this.updateChildWidgetPos();return[e.getElement(),g.getElement()]},doWidgetShowStateChanged:function($super,d){$super(d);if(d){this.updateChildWidgetPos();this.updateToolButtonStates()}},createToolbar:function(){if(this.getShowToolbar()){var d=new Kekule.Widget.Toolbar(this);this.setPropStoreFieldValue("toolbar",d);d.addClassName(a.TEXTEDITOR_TOOLBAR);this.recreateToolbarComponents();return d}else{return null}},recreateToolbarComponents:function(k){if(!k){k=this.getToolbarComponents()}var h=k||this.DEF_TOOLBAR_COMPONENTS;var g=this.getToolbar();if(g){this._toolCompWidgets.length=0;g.clearWidgets();g.setShowText(false);g.setShowGlyph(true);var j;for(var f=0,d=h.length;f<d;++f){var e=h[f];if(e==="fontFamily"){j=this.createFontFamilyComboBox(g)}else{j=this.createToolButton(g,e)}this._toolCompWidgets[e]=j}this.updateToolButtonStates()}},createFontFamilyComboBox:function(h){var d=new Kekule.Widget.ComboBox(h);var j=Kekule.Widget.FontEnumerator.getAvailableFontFamilies(this.getCandidateFontFamilies());var f=[];for(var g=0,e=j.length;g<e;++g){f.push({text:j[g],value:j[g]})}d.setHint(Kekule.$L("WidgetTexts.HINT_CHOOSE_FONT_FAMILY"));d.addClassName(a.TEXTEDITOR_FONTBOX);d.setItems(f);d.appendToWidget(h);d.addEventListener("valueChange",function(i){this.setTextStyle({fontFamily:d.getValue()})},this);return d},createToolButton:function(g,j){var f,i;var e;var h=(j==="textWrap")?Kekule.Widget.CheckButton:Kekule.Widget.Button;var d=new h(g);d.appendToWidget(g);if(j==="textWrap"){f=Kekule.$L("WidgetTexts.CAPTION_TOGGLE_TEXTWRAP");i=Kekule.$L("WidgetTexts.HINT_TOGGLE_TEXTWRAP");e=a.TEXTEDITOR_BTN_TEXTWRAP;d.setChecked(this.getWrap()!=="off");d.addEventListener("checkChange",function(l){var k=d.getChecked();this.setWrap(k?"virtual":"off")},this)}else{if(j==="fontSizeInc"){f=Kekule.$L("WidgetTexts.CAPTION_INC_TEXT_SIZE");i=Kekule.$L("WidgetTexts.HINT_INC_TEXT_SIZE");e=a.TEXTEDITOR_BTN_FONTSIZEINC;d.addEventListener("execute",this.increaseTextSize,this)}else{if(j==="fontSizeDec"){f=Kekule.$L("WidgetTexts.CAPTION_DEC_TEXT_SIZE");i=Kekule.$L("WidgetTexts.HINT_DEC_TEXT_SIZE");e=a.TEXTEDITOR_BTN_FONTSIZEDEC;d.addEventListener("execute",this.decreaseTextSize,this)}}}d.setText(f);d.setHint(i);d.addClassName(e);return d},createToolCheckButton:function(e,f){var d=new Kekule.Widget.CheckButton(e);d.appendToWidget(e);return d},createTextArea:function(){var d=new Kekule.Widget.TextArea(this);this.setPropStoreFieldValue("textArea",d);d.addClassName(a.TEXTEDITOR_TEXTAREA);return d},updateChildWidgetPos:function(){var f=this.getToolbarPos();var g=this.getToolbar().getElement();var e=this.getTextArea().getElement();var d=g.parentNode;if(f===Kekule.Widget.Position.BOTTOM){d.insertBefore(e,g)}else{d.insertBefore(g,e)}},updateToolButtonStates:function(){var d=this._toolCompWidgets.textWrap;if(d){d.setChecked(this.getWrap()!=="off")}},setTextStyle:function(j){var h=this.getTextArea();if(h){var f=Kekule.ObjUtils.getOwnedFieldNames(j);for(var e=0,d=f.length;e<d;++e){var g=f[e];h.setStyleProperty(g,j[g])}}return this},increaseTextSize:function(){var e=this.getFontSizeLevel()||1;var d=Kekule.ZoomUtils.getNextZoomInRatio(e);this.setFontSizeLevel(d)},decreaseTextSize:function(){var e=this.getFontSizeLevel()||1;var d=Kekule.ZoomUtils.getNextZoomOutRatio(e);this.setFontSizeLevel(d)}})})();(function(){var a=Kekule.ArrayUtils;var c=Kekule.StyleUtils;var d=Kekule.DomUtils;var e=Kekule.HtmlElementUtils;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{WIDGET_GRID:"K-Widget-Grid",WIDGET_GRID_CELL:"K-Widget-Grid-Cell",WIDGET_GRID_ADD_CELL:"K-Widget-Grid-Add-Cell",WIDGET_GRID_INTERACTION_AREA:"K-Widget-Grid-Interaction-Area",WIDGET_GRID_WIDGET_PARENT:"K-Widget-Grid-Widget-Parent",WIDGET_GRID_BUTTON_REMOVE:"K-Widget-Grid-Button-Remove",WIDGET_GRID_ENABLE_CELL_INTERACTION:"K-Widget-Grid-Enable-Cell-Interaction"});var b=Kekule.Widget.HtmlClassNames;Kekule.Widget.WidgetGrid=Class.create(Kekule.Widget.Container,{CLASS_NAME:"Kekule.Widget.WidgetGrid",CELL_FIELD:"__$cell__",WIDGET_FIELD:"__$cellWidget__",INTERACTION_AREA_FIELD:"__$interactionArea__",EXCEED_TOPRIGHT_FIELD:"__$exceedTopRight__",BTN_REMOVE_CELL_FIELD:"__$removeCell__",initialize:function($super,f){this._floatClearer=null;this.reactCellMouseEnterBind=this.reactCellMouseEnter.bind(this);this.reactCellMouseLeaveBind=this.reactCellMouseLeave.bind(this);this.reactCellClickBind=this.reactCellClick.bind(this);$super(f);this.addEventListener("change",this.reactChildWidgetChange,this)},initProperties:function(){this.defineProp("childWidgetClass",{dataType:DataType.CLASS,serializable:false});this.defineProp("cellWidth",{dataType:DataType.STRING});this.defineProp("cellHeight",{dataType:DataType.STRING});this.defineProp("widgetPos",{dataType:DataType.INT,enumSource:Kekule.Widget.Position});this.defineProp("autoShrinkWidgets",{dataType:DataType.BOOL});this.defineProp("keepWidgetAspectRatio",{dataType:DataType.BOOL});this.defineProp("restoreWidgetSizeOnHotTrack",{dataType:DataType.BOOL});this.defineProp("enableAdd",{dataType:DataType.BOOL,setter:function(g){this.setPropStoreFieldValue("enableAdd",g);if(g){this.setAddingCell(this.createAddCell())}else{var f=this.getAddingCell();if(f){this.getContainerElement().removeChild(f)}}}});this.defineProp("enableRemove",{dataType:DataType.BOOL,getter:function(){return this.hasClassName(b.WIDGET_GRID_ENABLE_CELL_INTERACTION)},setter:function(f){if(f){this.addClassName(b.WIDGET_GRID_ENABLE_CELL_INTERACTION)}else{this.removeClassName(b.WIDGET_GRID_ENABLE_CELL_INTERACTION)}}});this.defineProp("hotCell",{dataType:DataType.OBJECT,serializable:false,setter:function(f){if(this.getHotCell()!==f){this.hotCellChanged(this.getHotCell(),f);this.setPropStoreFieldValue("hotCell",f)}}});this.defineProp("addingCell",{dataType:DataType.OBJECT,serializable:false})},initPropValues:function(){this.setPropStoreFieldValue("autoShrinkWidgets",true);this.setPropStoreFieldValue("keepWidgetAspectRatio",true);this.setPropStoreFieldValue("restoreWidgetSizeOnHotTrack",true);this.setEnableRemove(true);this.setUseCornerDecoration(true)},doGetWidgetClassName:function($super){return $super()+" "+b.WIDGET_GRID},doCreateRootElement:function(g){var f=g.createElement("div");return f},doSetUseCornerDecoration:function($super,f){$super(f);this.updateAllCells()},doObjectChange:function($super,g){$super(g);var f=a.intersect(g,["autoShrinkWidgets","keepWidgetAspectRatio","cellWidth","cellHeight","widgetPos"]);if(f.length>0){this.updateAllCells()}},doWidgetShowStateChanged:function($super,f){if(f){this.updateAllCells()}return $super(f)},each:function(f){var h=Kekule.ArrayUtils.clone(this.getChildWidgets());for(var j=0,g=h.length;j<g;++j){f(h[j])}},addWidget:function(f){f.setParent(this)},removeWidget:function(g,f){if(!this.hasChild(g)){return}g.setParent(null);if(f){g.finalize()}},createWidget:function(){var f=this.doCreateNewChildWidget(this.getDocument());if(f){f.setParent(this);return f}},doCreateNewChildWidget:function(f){return null},getFloatClearer:function(){if(!this._floatClearer){this._floatClearer=this.getDocument().createElement("div");this._floatClearer.style.clear="both";this.getContainerElement().appendChild(this._floatClearer)}return this._floatClearer},createCell:function(i){var h=!i;var k=this.getDocument();var g=k.createElement("div");g.className=b.WIDGET_GRID_CELL+" "+b.DYN_CREATED+(h?" "+b.WIDGET_GRID_ADD_CELL:"");g[this.WIDGET_FIELD]=i;Kekule.X.Event.addListener(g,"mouseenter",this.reactCellMouseEnterBind);Kekule.X.Event.addListener(g,"mouseleave",this.reactCellMouseLeaveBind);Kekule.X.Event.addListener(g,"click",this.reactCellClickBind);var j=k.createElement("div");j.className=b.WIDGET_GRID_WIDGET_PARENT+" "+b.DYN_CREATED;j[this.WIDGET_FIELD]=i;if(h){j.innerHTML=Kekule.$L("WidgetTexts.CAPTION_ADD_CELL");j.title=Kekule.$L("WidgetTexts.HINT_ADD_CELL")}g.appendChild(j);if(i){i.appendToElem(j);i[this.CELL_FIELD]=g}if(!h){var f=k.createElement("div");f.className=b.WIDGET_GRID_INTERACTION_AREA+" "+b.DYN_CREATED;g.appendChild(f);j[this.INTERACTION_AREA_FIELD]=f;g[this.INTERACTION_AREA_FIELD]=f;this.createCellInteractionWidgets(f,g)}if(this.getAddingCell()&&!h){this.getContainerElement().insertBefore(g,this.getAddingCell())}else{this.getContainerElement().insertBefore(g,this.getFloatClearer())}this.updateCell(g);return g},createAddCell:function(){return this.createCell(null)},createCellInteractionWidgets:function(f,g){var h=new Kekule.Widget.Button(f.ownerDocument);h.setText(Kekule.$L("WidgetTexts.CAPTION_REMOVE_CELL"));h.setHint(Kekule.$L("WidgetTexts.HINT_REMOVE_CELL"));h.addClassName(b.WIDGET_GRID_BUTTON_REMOVE);h[this.BTN_REMOVE_CELL_FIELD]=true;var i=this.getContainingWidget(g);h[this.WIDGET_FIELD]=i;h.setShowText(false);h.setShowGlyph(true);h.addEventListener("execute",function(l){var j=l.widget;var k=j[this.WIDGET_FIELD];this.removeWidget(k,true)},this);h.appendToElem(f)},getWidgetCell:function(f){return f[this.CELL_FIELD]},getWidgetParentElem:function(g){var f=g.getElement();return f&&f.parentNode},getWidgetParentElemOfCell:function(f){return f.children[0]},getInteractionAreaElemOfCell:function(f){return f[this.INTERACTION_AREA_FIELD]},getContainingWidget:function(f){return f[this.WIDGET_FIELD]},childWidgetAdded:function($super,f){$super(f);this.createCell(f)},childWidgetRemoved:function($super,g){$super(g);var f=this.getWidgetCell(g);this.getContainerElement().removeChild(f)},childWidgetMoved:function($super,j,h){$super(j,h);var i=this.getWidgetCell(j);var g=this.getChildWidgets()[h+1];var f=g?this.getWidgetCell(g):null;if(f){this.getContainerElement().insertBefore(i,f)}else{this.getContainerElement().appendChild(i)}},childrenModified:function($super){this.getContainerElement().appendChild(this.getFloatClearer())},getAllCells:function(){var j=this.getChildWidgets();var f=[];for(var h=0,g=j.length;h<g;++h){f.push(this.getWidgetCell(j[h]))}if(this.getAddingCell()){f.push(this.getAddingCell())}return f},updateCell:function(g,i){var k=g.style;var f=this.getCellWidth();var j=this.getCellHeight();if(f){k.width=f}else{c.removeStyleProperty(k,"width")}if(j){k.height=j}else{c.removeStyleProperty(k,"height")}if(this.getUseCornerDecoration()){e.addClass(g,b.CORNER_ALL)}else{e.removeClass(g,b.CORNER_ALL)}this.adjustCellWidgetPos(g,i);this.adjustInteractionArea(g,i)},adjustCellWidgetPos:function(o,m){var C=this.getWidgetParentElemOfCell(o);var k=e.getElemOffsetDimension(C);var g=e.getElemClientDimension(o);var v=["top","right","bottom","left"];var h={};for(var x=0,w=v.length;x<w;++x){var t=c.getComputedStyle(o,"padding-"+v[x]);h[v[x]]=c.analysisUnitsValue(t).value||0}var E=Object.extend({},g);E.width-=(h.left+h.right);E.height-=(h.top+h.bottom);var n=this.getWidgetPos();var B=Kekule.Widget.Position;var j=(n&B.LEFT)?h.left:(n&B.RIGHT)?g.width-k.width-h.right:(E.width-k.width)/2+h.left;var s=(n&B.TOP)?h.top:(n&B.BOTTOM)?g.height-k.height-h.bottom:(E.height-k.height)/2+h.top;C.style.left=j+"px";C.style.top=s+"px";var u=this.getInteractionAreaElemOfCell(o);if(u){var p=e.getElemClientDimension(u);var z=j+k.width;var f=(z+p.width>=g.width)&&(s<=p.height);o[this.EXCEED_TOPRIGHT_FIELD]=f}if((this.getAutoShrinkWidgets()&&!m)||!this.getRestoreWidgetSizeOnHotTrack()){var A=(k.width>E.width)?E.width/k.width:null;var y=(k.height>E.height)?E.height/k.height:1;if(this.getKeepWidgetAspectRatio()){var D=(A&&y)?Math.min(A,y):A||y;A=D;y=D}C.style.transform="scale("+A+", "+y+")";var r=(n&B.LEFT)?"0":(n&B.RIGHT)?"100%":"50%";var q=(n&B.TOP)?"0":(n&B.BOTTOM)?"100%":"50%";C.style.transformOrigin=r+" "+q}else{C.style.transform="none"}},adjustInteractionArea:function(g,i){var h=this.getInteractionAreaElemOfCell(g);if(h){if(!i){g.appendChild(h)}else{if(g[this.EXCEED_TOPRIGHT_FIELD]){var f=this.getWidgetParentElemOfCell(g);f.appendChild(h)}}}},updateAllCells:function(){var g=this.getAllCells();for(var h=0,f=g.length;h<f;++h){this.updateCell(g[h],g[h]===this.getHotCell())}},restoreCellShrink:function(f){var g=this.getWidgetParentElemOfCell(f);if(g){g.style.transform="none"}},hotCellChanged:function(f,g){if(f){this.updateCell(f,false);e.removeClass(f,b.STATE_HOVER)}if(g){e.addClass(g,b.STATE_HOVER);if(this.getRestoreWidgetSizeOnHotTrack()){this.restoreCellShrink(g);this.adjustInteractionArea(g,true)}}},reactCellMouseEnter:function(g){var f=g.getTarget();this.setHotCell(f)},reactCellMouseLeave:function(g){var f=g.getTarget();if(this.getHotCell()===f){this.setHotCell(null)}},reactCellClick:function(g){var f=g.getTarget();if(d.isDescendantOf(f,this.getAddingCell())||f===this.getAddingCell()){this.createWidget()}},reactChildWidgetChange:function(g){var f=g.widget;if(f&&this.hasChild(f)){this.updateCell(this.getWidgetCell(f),this.getHotCell()===this.getWidgetCell(f))}}})})();(function(){var c=Kekule.DomUtils;var d=Kekule.HtmlElementUtils;var b=Kekule.StyleUtils;var a=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{PROPLISTEDITOR:"K-PropListEditor",PROPLISTEDITOR_PROPEXPANDMARKER:"K-PropListEditor-PropExpandMarker",PROPLISTEDITOR_PROPEXPANDED:"K-PropListEditor-PropExpanded",PROPLISTEDITOR_PROPCOLLAPSED:"K-PropListEditor-PropCollapsed",PROPLISTEDITOR_INDENTDECORATOR:"K-PropListEditor-IndentDecorator",PROPLISTEDITOR_READONLY:"K-PropListEditor-ReadOnly",OBJINSPECTOR:"K-ObjInspector",OBJINSPECTOR_SUBPART:"K-ObjInspector-SubPart",OBJINSPECTOR_OBJSINFOPANEL:"K-ObjInspector-ObjsInfoPanel",OBJINSPECTOR_PROPINFOPANEL:"K-ObjInspector-PropInfoPanel",OBJINSPECTOR_PROPINFO_TITLE:"K-ObjInspector-PropInfoPanel-Title",OBJINSPECTOR_PROPINFO_DESCRIPTION:"K-ObjInspector-PropInfoPanel-Description",OBJINSPECTOR_PROPLISTEDITOR_CONTAINER:"K-ObjInspector-PropListEditorContainer"});Kekule.Widget.ObjPropListEditor=Class.create(Kekule.Widget.ValueListEditor,{CLASS_NAME:"Kekule.Widget.ObjPropListEditor",PARENT_ROW_FIELD:"__$parentRow__",SUB_ROWS_FIELD:"__$subRows__",initialize:function($super,e){$super(e);this.setValueDisplayMode(Kekule.Widget.ValueListEditor.ValueDisplayMode.SIMPLE);this.setPropStoreFieldValue("displayedPropScopes",[Class.PropertyScope.PUBLISHED]);this.setEnableLiveUpdate(true);this.setSubPropNamePadding("1em");this.setUseKeyHint(true)},initProperties:function(){this.defineProp("objects",{dataType:DataType.ARRAY,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:function(f){var g=Kekule.ArrayUtils.toArray(f);var e=this.getObjects();this.setPropStoreFieldValue("objects",g);this.inspectedObjectsChanged(g,e)}});this.defineProp("displayedPropScopes",{dataType:DataType.ARRAY,setter:function(e){this.setPropStoreFieldValue("displayedPropScopes",e);this.updateAll()}});this.defineProp("enableLiveUpdate",{dataType:DataType.BOOL});this.defineProp("subPropNamePadding",{dataType:DataType.STRING});this.defineProp("activePropEditor",{dataType:DataType.OBJECT,serializable:false,setter:null,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getActiveRow();if(e){return this.getRowPropEditor(e)}else{return null}}});this.defineProp("keyField",{dataType:DataType.STRING});this.defineProp("sortField",{dataType:DataType.STRING});this.defineProp("enableOperHistory",{dataType:DataType.BOOL,serializable:false});this.defineProp("operHistory",{dataType:"Kekule.OperationHistory",serializable:false,scope:Class.PropertyScope.PUBLIC})},doFinalize:function($super){$super()},initPropValues:function($super){$super();this.setKeyField("title");this.setSortField("key")},doGetWidgetClassName:function($super){return $super()+" "+a.PROPLISTEDITOR},inspectedObjectsChanged:function(f,e){var g=Kekule.ArrayUtils.toArray(f);if(e){this._uninstallObjectsEventHandlers(e)}if(f){this._installObjectsEventHandlers(g)}this.updateAll(g)},_installObjectsEventHandlers:function(g){for(var f=0,e=g.length;f<e;++f){var h=g[f];if(h.addEventListener){h.addEventListener("change",this.reactObjectsChange,this)}}},_uninstallObjectsEventHandlers:function(g){for(var f=0,e=g.length;f<e;++f){var h=g[f];if(h.removeEventListener){h.removeEventListener("change",this.reactObjectsChange,this)}}},reactObjectsChange:function(g){if(this.getEnableLiveUpdate()){var f=g.changedPropNames;this.updateValues(f)}},getKeyCellExpandMarker:function(n,m){var p=null;var e=this.getCellContentWrapper(n,m);if(e){var g=c.getDirectChildElems(e)||[];for(var j=0,h=g.length;j<h;++j){var f=g[j];if(d.hasClass(f,a.PROPLISTEDITOR_PROPEXPANDMARKER)){p=f;break}}if(!p&&m){var o=this.getDocument();p=o.createElement("span");d.addClass(p,a.PROPLISTEDITOR_PROPEXPANDMARKER);var k=c.getChildNodesOfTypes(e,[Node.ELEMENT_NODE,Node.TEXT_NODE])[0];e.insertBefore(p,k)}}return p},getKeyCellIndentDecorator:function(n,m){var p=null;var e=this.getCellContentWrapper(n,m);if(e){var g=c.getDirectChildElems(e)||[];for(var j=0,h=g.length;j<h;++j){var f=g[j];if(d.hasClass(f,a.PROPLISTEDITOR_INDENTDECORATOR)){p=f;break}}if(!p&&m){var o=this.getDocument();p=o.createElement("div");d.addClass(p,a.PROPLISTEDITOR_INDENTDECORATOR);var k=c.getChildNodesOfTypes(e,[Node.ELEMENT_NODE,Node.TEXT_NODE])[0];e.insertBefore(p,k)}}return p},setRowKeyCellContent:function($super,n,k,g){var o=$super(n,k,g);var m=this.getKeyCell(n);var i=this.getKeyCellExpandMarker(m,true);var l=this.getRowSubLevel(n);var e=this.getSubPropNamePadding();if(e){var h=Kekule.StyleUtils.multiplyUnitsValue(e,l);e=Kekule.StyleUtils.multiplyUnitsValue(e,l);var j=this.getKeyCell(n);var f=this.getCellContentWrapper(j,true);f.style.paddingLeft=e}return o},updateAll:function(j){if(!j){j=this.getObjects()}if(!j||!j.length){this.clear();return}this.setActiveRow(null);this.collapseAllRows();var f=j[0];var m=this.getDisplayPropEditors(j);this.sortPropEditors(m);var r=j.length>1;var q=this.getRows();var n=q.length;var e=m.length;var g=0;var h=0;var k=this.getValueDisplayMode();for(var g=0;g<e;++g){var o=m[g];o.setValueTextMode(k);if(!this.isPropEditorVisible(o)){continue}var p=(h<n)?q[h]:this.appendRow();this.setRowPropEditor(p,o);++h}if(n>h){for(var g=n-1;g>=h;--g){this.removeRow(q[g])}}return this},updateValues:function(m){var k=m&&m.length;var h=this.getRows();for(var f=0,e=h.length;f<e;++f){var j=h[f];if(k){var g=this.getRowPropEditor(j);if(!g||(m.indexOf(g.getPropertyName())<0)){continue}}this.updateRowPropValue(j)}},updateRowPropValue:function(m){var h=this.getRowPropEditor(m);var k=h.getValueText();var j=this.getRowData(m);j.value=k;this.setRowData(m,j);this.updateRowExpandState(m);var e=this.getSubPropRows(m);if(e){for(var g=0,f=e.length;g<f;++g){this.updateRowPropValue(e[g])}}},setRowPropEditor:function(j,g){var i;var f=this.getKeyField()||"title";if(f){if(f==="name"){i=g.getPropertyName()}else{if(f==="title"){i=g.getTitle()}else{var e=g.getPropertyInfo();i=e[f]}}}if(!i){i=g.getTitle()||g.getPropertyName()}var h={key:g.getPropertyName(),value:g.getValueText(),title:i,hint:g.getHint(),propEditor:g,expanded:false};var k=g.isReadOnly();if(k){d.addClass(j,a.PROPLISTEDITOR_READONLY)}else{d.removeClass(j,a.PROPLISTEDITOR_READONLY)}this.setRowData(j,h);this.updateRowExpandState(j)},getRowCascadeKey:function(g){if(g&&this.getRowData(g)){var e=this.getRowData(g).key;var f=this.getParentPropRow(g);if(f){e=this.getRowCascadeKey(f)+"."+e}return e}else{return null}},getActiveRowCascadeKey:function(){var e=this.getActiveRow();return e&&this.getRowCascadeKey(e)},getRowPropEditor:function(f){var e=this.getRowData(f);if(e){return e.propEditor}else{return null}},getPropEditor:function(f,e){var g=Kekule.PropertyEditor.findEditorClass(f,e);if(g){return new g()}else{return null}},getPropEditorForType:function(f,e){var g=Kekule.PropertyEditor.findEditorClassForType(f,e);if(g){return new g()}else{return null}},isPropEditorVisible:function(i){var f=true;var k=i.getObjects();var e=k.length>1;f=!e||(i.getAttributes()&Kekule.PropertyEditor.EditorAttributes.MULTIOBJS);if(f){var h=i.getPropertyInfo();if(h){var j=h.scope||Class.PropertyScope.DEFAULT;if(j){var g=this.getDisplayedPropScopes();if(g){f=g.indexOf(j)>=0}}}}return f},isRowExpandable:function(f){var e=this.getRowPropEditor(f);return e?e.hasSubPropertyEditors():false},isRowExpanded:function(f){var e=this.getRowData(f);return !!e.expanded},updateRowExpandState:function(f){var e=this.isRowExpandable(f);if(!e){this.removeSubPropertyRows(f)}d.removeClass(f,a.PROPLISTEDITOR_PROPCOLLAPSED);d.removeClass(f,a.PROPLISTEDITOR_PROPEXPANDED);if(e){if(this.isRowExpanded(f)){d.addClass(f,a.PROPLISTEDITOR_PROPEXPANDED)}else{d.addClass(f,a.PROPLISTEDITOR_PROPCOLLAPSED)}}},expandRow:function(e){this._doExpandRow(e);return this},_doExpandRow:function(h){if(this.isRowExpandable(h)&&(!this.isRowExpanded(h))){d.removeClass(h,a.PROPLISTEDITOR_PROPCOLLAPSED);d.addClass(h,a.PROPLISTEDITOR_PROPEXPANDED);var g=this.getRowData(h);g.expanded=true;var f=this.getRowPropEditor(h);var e=f.getSubPropertyEditors(this.getDisplayedPropScopes());h[this.SUB_ROWS_FIELD]=this.addSubPropertyRows(h,e);return h[this.SUB_ROWS_FIELD]}else{return null}},collapseRow:function(f){if(this.isRowExpandable(f)&&this.isRowExpanded(f)){d.removeClass(f,a.PROPLISTEDITOR_PROPEXPANDED);d.addClass(f,a.PROPLISTEDITOR_PROPCOLLAPSED);var e=this.getRowData(f);e.expanded=false;this.removeSubPropertyRows(f)}return this},toggleRowExpandState:function(e){if(this.isRowExpanded(e)){this.collapseRow(e)}else{this.expandRow(e)}return this},collapseAllRows:function(){var g=this.getRows();for(var f=0,e=g.length;f<e;++f){this.collapseRow(g[f])}return this},expandAllRows:function(g){var f=this;var e=function(o,m){for(var n=0,j=o.length;n<j;++n){var k=f._doExpandRow(o[n]);if(k&&m){e(k,m)}}};var h=this.getRows();e(h,g);return this},addSubPropertyRows:function(j,m){var h=this.getNextRow(j);var e=[];if(m&&m.length){this.sortPropEditors(m);for(var g=0,f=m.length;g<f;++g){var k=m[g];if(!this.isPropEditorVisible(k)){continue}e.push(this.addSubPropRow(j,k,h))}}return e},addSubPropRow:function(h,g,f){var e=this.insertRowBefore(null,f);e[this.PARENT_ROW_FIELD]=h;this.setRowPropEditor(e,g);return e},removeSubPropertyRows:function(g){var e=this.getSubPropRows(g);for(var f=e.length-1;f>=0;--f){this.removeSubPropertyRows(e[f]);this.removeRow(e[f])}g[this.SUB_ROWS_FIELD]=null},getSubPropRows:function(e){return e[this.SUB_ROWS_FIELD]||[]},getParentPropRow:function(e){return e[this.PARENT_ROW_FIELD]},getRowSubLevel:function(g){var e=0;var f=this.getParentPropRow(g);while(f){++e;f=this.getParentPropRow(f)}return e},getValueCellText:function($super,f,e){return e.value},finishEditing:function(){var j=this.getActiveRow();var h=this.getRowPropEditor(j);if(h){var e=this.getOperHistory();var i=this.getEnableOperHistory()&&e;var g=h.getValue();var f=h.saveEditValue();if(f){if(i){var k=new Kekule.Widget.PropEditorModifyOperation(h,h.getValue(),g);e.push(k)}this.updateValues();this.invokeEvent("propertyChange",{propertyEditor:h,propertyInfo:h.getPropertyInfo(),oldValue:g,newValue:h.getValue()});this.invokeEvent("editFinish",{row:j})}}return this},doCreateValueEditWidget:function($super,g){var f=this.getRowPropEditor(g);var e=f.createEditWidget(this);if(e){if(f.isReadOnly()){if(e.setReadOnly){e.setReadOnly(true)}}}else{e=this.doCreateDefaultValueEditWidget(g)}return e},doCreateDefaultValueEditWidget:function(g){var e=new Kekule.Widget.TextBox(this);e.setReadOnly(true);var f=this.getRowData(g).value;e.setValue(f);return e},isOperHistoryAvailable:function(){return this.getOperHistory()&&this.getEnableOperHistory()},undo:function(){if(this.isOperHistoryAvailable()){this.getOperHistory().undo()}return this},redo:function(){if(this.isOperHistoryAvailable()){this.getOperHistory().redo()}return this},getCommonSuperClass:function(e){return ClassEx.getCommonSuperClass(e)},getCommonPropNames:function(m){var f=[];var k=this.getCommonSuperClass(m);if(k){var e=ClassEx.getPropListOfScopes(k,this.getDisplayedPropScopes());for(var j=0,h=e.getLength();j<h;++j){var g=e.getPropInfoAt(j);f.push(g.name)}}else{}return f},getDisplayPropNames:function(e){return this.getCommonPropNames(e)},getDisplayPropEditors:function(g){var e=[];var f=this.getCommonSuperClass(g);if(f){var i=this.getPropEditor(null,{dataType:ClassEx.getClassName(f)});if(i){i.setObjects(g);e=e.concat(i.getSubPropertyEditors(this.getDisplayedPropScopes())||[])}}else{if(g.length===1){var h=g[0];if(DataType.isObjectValue(h)){var i=this.getPropEditorForType("object");if(i){i.setObjects(h);e=e.concat(i.getSubPropertyEditors()||[])}}}}return e},sortPropEditors:function(g){var e=this.getSortField();if(!e){return}if(e==="key"){e===this.getKeyField()||"title"}var f=function(h,i){return h[i]||h.name};g.sort(function(k,i){var j=f(k.getPropertyInfo(),e);var h=f(i.getPropertyInfo(),e);return(j<h)?-1:(j>h)?1:0})},getObjPropValue:function(f,e){if(f instanceof ObjectEx){return f.getPropValue(e)}else{if(f instanceof Object){return f[e]}else{return undefined}}},getObjsPropValue:function(k,j){var m=k[0];var e=this.getObjPropValue(m,j);for(var g=1,f=k.length;g<f;++g){var m=k[g];var h=this.getObjPropValue(m,j);if(h!==e){return undefined}}return e},react_click:function($super,h){var g=h.getTarget();var i=this.getParentRow(g);if(i){var f=this.getKeyCellExpandMarker(this.getKeyCell(i),false);if(g===f){this.toggleRowExpandState(i)}}$super(h)},react_dblclick:function(i){var h=i.getTarget();var f=this.getParentCell(h);var g=false;if(f){var j=this.getParentRow(f);if(f===this.getKeyCell(j)){this.toggleRowExpandState(j);g=true}}},react_keydown:function($super,i){$super(i);var h=i.getKeyCode();var f=!(i.getAltKey()||i.getShiftKey()||i.getCtrlKey());if(f){var g=this.getActiveRow();if(g){if(h===Kekule.X.Event.KeyCode.RIGHT){this.expandRow(g)}else{if(h===Kekule.X.Event.KeyCode.LEFT){this.collapseRow(g)}}}}}});Kekule.Widget.ObjectInspector=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.ObjectInspector",initialize:function($super,e){this._propListElem=null;this._objsInfoElem=null;this._propInfoElem=null;this.setPropStoreFieldValue("showObjsInfoPanel",true);this.setPropStoreFieldValue("showPropInfoPanel",true);$super(e)},initProperties:function(){this.defineProp("objects",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,setter:function(e){var f=Kekule.ArrayUtils.toArray(e);this.setPropStoreFieldValue("objects",f);this.inspectedObjectsChanged(f)}});this.defineProp("propEditor",{dataType:"Kekule.Widget.ObjPropListEditor",serializable:false,setter:null,scope:Class.PropertyScope.PRIVATE});this.defineProp("showObjsInfoPanel",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("showObjsInfoPanel",e);b.setDisplay(this._objsInfoElem,!!e);this._updateChildElemSize()}});this.defineProp("showPropInfoPanel",{dataType:DataType.BOOL,setter:function(e){this.setPropStoreFieldValue("showPropInfoPanel",e);b.setDisplay(this._propInfoElem,!!e);this._updateChildElemSize()}});this.defineProp("keyField",{dataType:DataType.STRING,getter:function(){var e=this.getPropEditor();return e&&e.getKeyField()},setter:function(f){var e=this.getPropEditor();if(e){e.setKeyField(f)}}});this.defineProp("sortField",{dataType:DataType.STRING,getter:function(){var e=this.getPropEditor();return e&&e.getSortField()},setter:function(f){var e=this.getPropEditor();if(e){e.setSortField(f)}}});this.defineProp("activeRow",{dataType:DataType.OBJECT,serializable:false,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getPropEditor();return e&&e.getActiveRow()},setter:function(f){var e=this.getPropEditor();if(e){e.setActiveRow(f)}}});this.defineProp("enableOperHistory",{dataType:DataType.BOOL,serializable:false,getter:function(){var e=this.getPropEditor();return e?e.getEnableOperHistory():false},setter:function(f){var e=this.getPropEditor();return e?e.setEnableOperHistory(f):null}});this.defineProp("operHistory",{dataType:"Kekule.OperationHistory",serializable:false,scope:Class.PropertyScope.PUBLIC,getter:function(){var e=this.getPropEditor();return e?e.getOperHistory():null},setter:function(f){var e=this.getPropEditor();return e?e.setOperHistory(f):null}});this.defineProp("sortField",{dataType:DataType.STRING,getter:function(){return this.getPropEditor().getSortField()},setter:function(e){this.getPropEditor().setSortField(e)}})},doFinalize:function($super){this._finalizeChildWidgets();$super()},getChildrenHolderElement:function($super){return this._propListElem||$super()},doGetWidgetClassName:function(){return a.OBJINSPECTOR},doBindElement:function($super,e){$super(e);this._updateChildElemSize()},doCreateRootElement:function(f){var e=f.createElement("div");return e},doCreateSubElements:function($super,i,g){$super(i,g);var h=this._createSubPartElem(i);d.addClass(h,a.OBJINSPECTOR_OBJSINFOPANEL);g.appendChild(h);this._objsInfoElem=h;var f=this._createSubPartElem(i);d.addClass(f,a.OBJINSPECTOR_PROPINFOPANEL);g.appendChild(f);this._propInfoElem=f;var e=this._createSubPartElem(i);d.addClass(e,a.OBJINSPECTOR_PROPLISTEDITOR_CONTAINER);g.appendChild(e);this._propListElem=e;this._createChildWidgets(e);return[h,f,e]},_createSubPartElem:function(f){var e=f.createElement("div");e.className=a.OBJINSPECTOR_SUBPART;return e},_createChildWidgets:function(e){this._finalizeChildWidgets();var g=new Kekule.Widget.ObjPropListEditor(this);g.appendToWidget(this);var f=this;g.addEventListener("activeRowChange",function(h){f._updatePropInfo()});this.setPropStoreFieldValue("propEditor",g)},_finalizeChildWidgets:function(){var e=this.getPropEditor();if(e){e.finalize()}},inspectedObjectsChanged:function(f){var e=this.getPropEditor();if(e){e.setObjects(f)}this._updateObjectsInfo(f);this._updatePropInfo()},_updateObjectsInfo:function(h){if(this._objsInfoElem){var g;if(h.length<=0){g=Kekule.$L("WidgetTexts.S_INSPECT_NONE")}else{if(h.length===1){var f=h[0];var i=f.getId?f.getId():null;var e=DataType.getType(f);g=i?Kekule.$L("WidgetTexts.S_INSPECT_ID_OBJECT").format(i,e):Kekule.$L("WidgetTexts.S_INSPECT_ANONYMOUS_OBJECT").format(e)}else{g=Kekule.$L("WidgetTexts.S_INSPECT_OBJECTS").format(h.length)}}c.setElementText(this._objsInfoElem,g)}},_updatePropInfo:function(){if(this._propInfoElem){this._propInfoElem.innerHTML="";var g=this.getPropEditor().getActivePropEditor();if(g){var i=g.getTitle();var f=g.getDescription()||g.getPropertyType()||"";var h=this._propInfoElem.ownerDocument;var e=h.createElement("div");e.className=a.OBJINSPECTOR_PROPINFO_TITLE;c.setElementText(e,i);this._propInfoElem.appendChild(e);var e=h.createElement("div");e.className=a.OBJINSPECTOR_PROPINFO_DESCRIPTION;c.setElementText(e,f);this._propInfoElem.appendChild(e)}}},undo:function(){if(this.getPropEditor()){this.getPropEditor().undo()}return this},redo:function(){if(this.getPropEditor()){this.getPropEditor().redo()}return this},getRowCascadeKey:function(f){var e=this.getPropEditor();return e&&e.getRowCascadeKey(f)},getActiveRowCascadeKey:function(){var e=this.getPropEditor();return e&&e.getActiveRowCascadeKey()},isRowExpandable:function(f){var e=this.getPropEditor();return e&&e.isRowExpandable(f)},isRowExpanded:function(f){var e=this.getPropEditor();return e&&e.isRowExpanded(f)},expandRow:function(f){var e=this.getPropEditor();if(e){e.expandRow(f)}return this},collapseRow:function(f){var e=this.getPropEditor();if(e){e.collapseRow(f)}return this},toggleRowExpandState:function(f){var e=this.getPropEditor();if(e){e.toggleRowExpandState(f)}return this},collapseAllRows:function(){var e=this.getPropEditor();if(e){e.collapseAllRows()}return this},expandAllRows:function(f){var e=this.getPropEditor();if(e){e.expandAllRows(f)}return this},_updateChildElemSize:function(){var e=this;setTimeout(function(){var g;if(e.getShowObjsInfoPanel()){g=b.getComputedStyle(e._objsInfoElem,"height")}else{g=0}var f;if(e.getShowPropInfoPanel()){f=b.getComputedStyle(e._propInfoElem,"height")}else{f=0}e._propListElem.style.top=g;e._propListElem.style.bottom=f},100)},setUseCornerDecoration:function($super,f){var e=$super(f);if(f){}return e}})})();(function(){var a=Kekule.ArrayUtils;Kekule.Widget.PropertyEditor={};Kekule.PropertyEditor=Kekule.Widget.PropertyEditor;Kekule.PropertyEditor.BaseEditor=Class.create(ObjectEx,{CLASS_NAME:"Kekule.PropertyEditor.BaseEditor",initialize:function($super){$super();this._editWidget=null},initProperties:function(){this.defineProp("objects",{dataType:DataType.ARRAY,serializable:false,setter:function(d){var c=Kekule.ArrayUtils;this.setPropStoreFieldValue("objects",c.clone(c.toArray(d)))}});this.defineProp("propertyInfo",{dataType:DataType.OBJECT,serializable:false});this.defineProp("propertyName",{dataType:DataType.VARIANT,serializable:false,setter:null,getter:function(){var c=this.getPropertyInfo();return c?c.name:null}});this.defineProp("propertyType",{dataType:DataType.VARIANT,serializable:false,setter:null,getter:function(){var c=this.getPropertyInfo();return c?c.dataType:null}});this.defineProp("parentEditor",{dataType:"Kekule.PropertyEditor.BaseEditor",serializable:false});this.defineProp("valueTextMode",{dataType:DataType.INT});this.defineProp("readOnly",{dataType:DataType.BOOL});this.defineProp("allowEmpty",{dataType:DataType.BOOL})},finalize:function($super){this.finalizeWidget();$super()},finalizeWidget:function(){if(this._editWidget){this._editWidget.finalize();this._editWidget=null}},getEditWidget:function(){return this._editWidget},getObjPropValue:function(d,c){if(Kekule.ObjUtils.isUnset(c)){return d}if(d instanceof ObjectEx){return d.getPropValue(c)}else{if(DataType.isArrayValue(d)){return d[c]}else{if(d instanceof Object){return d[c]}else{return undefined}}}},setObjPropValue:function(d,c,e){if(d instanceof ObjectEx){d.setPropValue(c,e)}else{if(d instanceof Object){d[c]=e}}return this},getObjsPropValue:function(h,g){if(!h){return undefined}if(Kekule.ObjUtils.isUnset(g)){return h}var j=h[0];var c=this.getObjPropValue(j,g);for(var e=1,d=h.length;e<d;++e){var j=h[e];var f=this.getObjPropValue(j,g);if(f!==c){return undefined}}return c},setObjsPropValue:function(f,e,h){if(!f||!e){return this}for(var d=0,c=f.length;d<c;++d){var g=f[d];this.setObjPropValue(g,e,h)}return this},isReadOnly:function(){return !!(this.getAttributes()&b.READONLY)},hasSubPropertyEditors:function(){var c=this.getAttributes();return !!(c&b.SUBPROPS)},getAttributes:function(){var c=b.MULTIOBJS|b.SIMPLEVALUE;var d=this.getPropertyInfo();if(Kekule.ObjUtils.isUnset(this.getReadOnly())){if(d&&!d.setter){c=c|b.READONLY}}else{if(this.getReadOnly()){c=c|b.READONLY}}return c},getSubPropertyEditors:function(c){return null},getTitle:function(){var c=this.getPropertyInfo();if(c){return(c.title||c.name)}else{return""}},getHint:function(){return this.getTitle()},getDescription:function(){var c=this.getPropertyInfo();return c.description},getValue:function(){return this.getObjsPropValue(this.getObjects(),this.getPropertyName())},getValueText:function(){var d=Kekule.Widget.ValueListEditor.ValueDisplayMode;var f=this.getValue();var h=this.getValueTextMode();try{var c=(h===d.JSON)?JSON.stringify(f):Kekule.ObjUtils.isUnset(f)?"":""+f}catch(g){return""+f}return c},setValue:function(d){var c=this.setObjsPropValue(this.getObjects(),this.getPropertyName(),d);if(this.getParentEditor()&&this.getParentEditor().notifyChildEditorValueChange){this.getParentEditor().notifyChildEditorValueChange(this.getPropertyName(),d)}return c},createEditWidget:function(d){var e=this.getValue();var c=this.doCreateEditWidget(d,e);if(c&&c.setIsDirty){c.setIsDirty(false)}this._editWidget=c;return c},doCreateEditWidget:function(c){},saveEditValue:function(){if(this._editWidget){if(!this._editWidget.getIsDirty||this._editWidget.getIsDirty()){var c=this.doSaveEditValue();if(this._editWidget.setIsDirty){this._editWidget.setIsDirty(false)}return c}else{return false}}else{return false}},doSaveEditValue:function(){},notifyChildEditorValueChange:function(d,c){}});Kekule.PropertyEditor.EditorAttributes={MULTIOBJS:1,SUBPROPS:2,SIMPLEVALUE:4,VALUELIST:8,CUSTOMEDIT:16,READONLY:32,INLINE_EDIT:128,DROP_EDIT:256,POPUP_EDIT:512};var b=Kekule.PropertyEditor.EditorAttributes;Kekule.PropertyEditor.EditorMananger=Class.create({initialize:function(){this._registeredItems=[];this._defaultItems=[]},register:function(c,g,d,f,h){var e={editorClass:c,propType:g,objClass:d,propName:f,matchFunc:h};this._registeredItems.push(e);if(!g&&!d&&!f&&!h){this._defaultItems.push(e)}return this},unregister:function(c){var d=this._registeredItems;for(var e=d.length-1;e>=0;--e){var f=d[e];if(f.editorClass===c){d.splice(e,1)}}var d=this._defaultItems;for(var e=d.length-1;e>=0;--e){var f=d[e];if(f.editorClass===c){d.splice(e,1)}}return this},_getDefaultItem:function(){var c=this._defaultItems;return c[c.length-1]},_getSuperiorItem:function(f,e){var c=["matchFunc","propName","objClass","propType"];for(var g=0,d=c.length;g<d;++g){if(!!f[c]===!!e[c]){continue}else{return f[c]?f:e}}return f},_isMatchedPropType:function(f,e){var d=(f===e);if(!d){if(DataType.isObjectExType(f)&&DataType.isObjectExType(e)){var c=ClassEx.findClass(f);var g=ClassEx.findClass(e);d=ClassEx.isOrIsDescendantOf(c,g)}}return d},_testOnPropType:function(d,c){if(!d.propType||!c.dataType){return 0}if(this._isMatchedPropType(c.dataType,d.propType)){return 1}else{return -1}},_testOnObjClass:function(c,d){if(!c.objClass||!d){return 0}else{if(ClassEx.isOrIsDescendantOf(d,c.objClass)){return 1}else{return -1}}},_testOnPropName:function(d,c){if(!d.propName||!c.name){return 0}else{if(d.propName===c.name){return 1}else{return -1}}},_testOnMatchFunc:function(d,e,c){if(!d.matchFunc){return 0}else{if(d.matchFunc(e,c)){return 1}else{return -1}}},findEditorClass:function(n,k){var o=null;var l=this._registeredItems;var e=false;var j=[];for(var h=l.length-1;h>=0;--h){var m=l[h];var g=this._testOnPropType(m,k);if(g<0){continue}var f=this._testOnObjClass(m,n);if(f<0){continue}var d=this._testOnPropName(m,k);if(d<0){continue}var c=this._testOnMatchFunc(m,n,k);if(c<0){continue}e=(g+f+d+c)>0;if(e){if(o){o=this._getSuperiorItem(o,m.editorClass)}else{o=m.editorClass}if(o&&m.matchFunc){break}}}if(!o){var m=this._getDefaultItem();o=m?m.editorClass:null}return o},findEditorClassForType:function(e,d){var c={dataType:e,name:d};return this.findEditorClass(null,c)}});Kekule.ClassUtils.makeSingleton(Kekule.PropertyEditor.EditorMananger);Kekule.PropertyEditor.findEditorClass=Kekule.PropertyEditor.EditorMananger.getInstance().findEditorClass.bind(Kekule.PropertyEditor.EditorMananger.getInstance());Kekule.PropertyEditor.findEditorClassForType=Kekule.PropertyEditor.EditorMananger.getInstance().findEditorClassForType.bind(Kekule.PropertyEditor.EditorMananger.getInstance());Kekule.PropertyEditor.register=Kekule.PropertyEditor.EditorMananger.getInstance().register.bind(Kekule.PropertyEditor.EditorMananger.getInstance());Kekule.PropertyEditor.unregister=Kekule.PropertyEditor.EditorMananger.getInstance().unregister.bind(Kekule.PropertyEditor.EditorMananger.getInstance());Kekule.PropertyEditor.SimpleEditor=Class.create(Kekule.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.SimpleEditor",convertStrToValue:function(d,c){if(DataType.isSimpleType(c)){if(!d&&this.getAllowEmpty()){return null}else{return Kekule.StrUtils.convertToType(d,c)}}else{return d}},setValueText:function(c){if(c===this._originValueText){return false}var e;var d=this.getPropertyType();if(d&&!DataType.isSimpleType(d)){return false}if(d){e=this.convertStrToValue(c,d)}else{e=c}this.setValue(e);return true},doCreateEditWidget:function(d){var e=this.getValueText();this._originValueText=e;var c=new Kekule.Widget.TextBox(d,e);return c},doSaveEditValue:function(){return this.setValueText(this.getEditWidget().getValue())}});Kekule.PropertyEditor.register(Kekule.PropertyEditor.SimpleEditor);Kekule.PropertyEditor.TextEditor=Class.create(Kekule.PropertyEditor.SimpleEditor,{CLASS_NAME:"Kekule.PropertyEditor.TextEditor",LINE_BREAK_REPLACER:"\\n",textToSingleLine:function(c){return c.split("\n").join(this.LINE_BREAK_REPLACER)},textToMultiLine:function(c){return c.split(this.LINE_BREAK_REPLACER).join("\n")},doCreateEditWidget:function(d){this._parentWidget=d;var e=this.getValueText();this._originValueText=e;var c=new Kekule.Widget.ButtonTextBox(d,this.textToSingleLine(e));this._textbox=c;c.setButtonKind(Kekule.Widget.Button.Kinds.POPUP);c.addEventListener("buttonExecute",this.reactButtonExecute,this);return c},reactButtonExecute:function(c){this.openPopupEditor()},openPopupEditor:function(){var d=this._popupDialog;if(!d){d=this.createPopupDialog();this._popupDialog=d}var e=this._popupEditor;e.setValue(this.getValueText());var c=this;d.openPopup(function(f){if(f===Kekule.Widget.DialogButtons.OK){c._textbox.setValue(c.textToSingleLine(e.getValue()));c._textbox.setIsDirty(true);c.saveEditValue()}},this._textbox)},createPopupDialog:function(){var f=this._parentWidget.getDocument();var d=new Kekule.Widget.Dialog(f,this.getPropertyName(),[Kekule.Widget.DialogButtons.OK,Kekule.Widget.DialogButtons.CANCEL]);d.setLocation(Kekule.Widget.Location.CENTER_OR_FULLFILL);var c=Kekule.Widget.TextArea;var g=new c(f);var e=g.getElement().style;e.width="40em";e.height="20em";g.appendToWidget(d);this._popupEditor=g;return d},doSaveEditValue:function(){var c=this.getEditWidget().getValue();c=this.textToMultiLine(c);if(c!==this._originValueText){this.setValueText(c);return true}else{return false}}});Kekule.PropertyEditor.register(Kekule.PropertyEditor.TextEditor,DataType.STRING);Kekule.PropertyEditor.BoolEditor=Class.create(Kekule.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.BoolEditor",boolToStr:function(c){return Kekule.StrUtils.boolToStr(c)},doCreateEditWidget:function(d){this._originValue=this.getValue();var c=new Kekule.Widget.CheckBox(d,this._originValue);c.setText(this.boolToStr(this._originValue));var e=this;c.addEventListener("valueChange",function(g){var f=c.getChecked();c.setText(e.boolToStr(f))});return c},getValueText:function($super){var c=this.getValue();if(Kekule.ObjUtils.isUnset(c)){return Kekule.$L("WidgetTexts.S_VALUE_UNSET")}else{return $super()}},doSaveEditValue:function(){var c=this.getEditWidget().getChecked();if(c!==this._originValue){this.setValue(c);return true}else{return false}}});Kekule.PropertyEditor.register(Kekule.PropertyEditor.BoolEditor,DataType.BOOL);Kekule.PropertyEditor.SelectEditor=Class.create(Kekule.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.SelectEditor",getValueText:function($super){var e=this.getValue();var d=this.getSelectItems()||[];for(var f=0,c=d.length;f<c;++f){var g=d[f];if(g.value===e){return g.text}}return $super()},getSelectItems:function(){return[]},doCreateEditWidget:function(d){var c=new Kekule.Widget.SelectBox(d,this.getSelectItems());this._originalValue=this.getValue();c.setValue(this._originalValue);return c},doSaveEditValue:function(){var c=this.getEditWidget().getValue();if(c!==this._originalValue){this.setValue(c);return true}else{return false}}});Kekule.PropertyEditor.EnumEditor=Class.create(Kekule.PropertyEditor.SelectEditor,{CLASS_NAME:"Kekule.PropertyEditor.EnumEditor",initialize:function($super){$super();this.enumInfos=[]},setPropertyInfo:function($super,f){$super(f);if(f){var g=f.enumSource;if(g&&DataType.isObjectValue(g)){var c=Kekule.ObjUtils.getOwnedFieldNames(g);this.enumInfos=[];for(var e=0,d=c.length;e<d;++e){this.enumInfos.push({text:c[e],value:g[c[e]]})}}}},getSelectItems:function(){var d=this.getValue();if(Kekule.ObjUtils.isUnset(d)){var c=Kekule.ArrayUtils.clone(this.enumInfos);c.unshift({text:Kekule.$L("WidgetTexts.S_VALUE_UNSET"),value:d});return c}return this.enumInfos}});Kekule.PropertyEditor.register(Kekule.PropertyEditor.EnumEditor,null,null,null,function(d,c){return !!c.enumSource});Kekule.PropertyEditor.ObjectExEditor=Class.create(Kekule.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.ObjectExEditor",getAttributes:function($super){var c=$super();c=c|b.SUBPROPS;return c},hasSubPropertyEditors:function($super){return $super()&&this.getValue()},getSubPropertyEditors:function(c){var n=[];var g=this.getValue();if(g){if(g instanceof ObjectEx){var e=g;var m=e.getClass()}else{var m=ClassEx.getCommonSuperClass(g)}var o=ClassEx.getPropListOfScopes(m,c);for(var f=0,d=o.getLength();f<d;++f){var k=o.getPropInfoAt(f);var h=Kekule.PropertyEditor.findEditorClass(m,k);if(h){var j=new h();j.setObjects(Kekule.ArrayUtils.toArray(g));j.setPropertyInfo(k);j.setValueTextMode(this.getValueTextMode());n.push(j)}}}return n},getValueText:function($super){var c=this.getValue();if(Kekule.ObjUtils.notUnset(c)){if(c.getClassName){return"["+c.getClassName()+"]"}else{return $super()}}else{return Kekule.$L("WidgetTexts.S_OBJECT_UNSET")}}});Kekule.PropertyEditor.register(Kekule.PropertyEditor.ObjectExEditor,"ObjectEx");Kekule.PropertyEditor.ObjectFieldEditor=Class.create(Kekule.PropertyEditor.SimpleEditor,{CLASS_NAME:"Kekule.PropertyEditor.ObjectFieldEditor",initialize:function(){},doCreateEditWidget:function($super,d){if(!this.getPropertyType()){var e=this.getValue();this.getPropertyInfo().dataType=DataType.getType(e)}var c=$super(d);return c}});Kekule.PropertyEditor.ObjectEditor=Class.create(Kekule.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.ObjectEditor",initialize:function($super){$super();this._initialObjValue=undefined},getFieldEditorClass:function(d,c){return Kekule.PropertyEditor.findEditorClass(null,c)||Kekule.PropertyEditor.ObjectFieldEditor},getFieldValueType:function(d,e){var c=d[e];if(Kekule.ObjUtils.notUnset(c)){return DataType.getType(c)}else{return null}},createFieldEditor:function(f,e){var g=this.getFieldEditorClass(f,e);var d=new g();d.setParentEditor(this);d.setReadOnly(false);d.setAllowEmpty(this.getAllowEmpty());d.setPropertyInfo(e);d.setObjects(f);d.setValueTextMode(this.getValueTextMode());return d},getObjFields:function(c){if(c){return Kekule.ObjUtils.getOwnedFieldNames(c)}else{return[]}},getObjFieldInfos:function(h){var d=this.getObjFields(h);var c=[];for(var f=0,e=d.length;f<e;++f){var g={name:d[f],dataType:this.getFieldValueType(h,d[f])};c.push(g)}return c},notifyChildEditorValueChange:function(e,d){var c=this.getValue()||this._initialObjValue;c[e]=d;this.setValue(c)},getAttributes:function($super){var c=$super();c=c|b.SUBPROPS;return c},hasSubPropertyEditors:function($super){return $super()&&this.getObjFieldInfos(this.getValue()).length},getValueText:function($super){var c=Kekule.Widget.ValueListEditor.ValueDisplayMode;var e=this.getValueTextMode();if(e===c.JSON){return $super()}var d=this.getValue();if(d){return"["+Kekule.$L("WidgetTexts.S_OBJECT")+"]"}else{return""}},setValue:function($super,d){var c=$super(d);this._initialObjValue=d;return c},getSubPropertyEditors:function(d){var m=[];var h=a.toArray(this.getValue());if(h.length>1){return[]}var f=h[0];if(!f){this._initialObjValue={}}else{this._initialObjValue=f}var c=this.getObjFieldInfos(f);var k=[this._initialObjValue];for(var g=0,e=c.length;g<e;++g){var j=this.createFieldEditor(k,c[g]);m.push(j)}return m}});Kekule.PropertyEditor.register(Kekule.PropertyEditor.ObjectEditor,DataType.OBJECT);Kekule.PropertyEditor.ArrayEditor=Class.create(Kekule.PropertyEditor.BaseEditor,{CLASS_NAME:"Kekule.PropertyEditor.ArrayEditor",getAttributes:function($super){var c=$super();c=c|b.SUBPROPS;return c},hasSubPropertyEditors:function($super){var c=this.getValue();return $super()&&c&&c.length},getSubPropertyEditors:function(c){var o=[];var m=this.getValue();if(DataType.isArrayValue(m)&&m.length){var j=this.getPropertyInfo().elementType;for(var e=0,d=m.length;e<d;++e){var n=m[e];var h=j||DataType.getType(n);var f=Kekule.PropertyEditor.findEditorClassForType(h);if(f){var g=new f();g.setParentEditor(this);g.setObjects([m]);var k={name:e,title:e,dataType:h};g.setPropertyInfo(k);g.setValueTextMode(this.getValueTextMode());o.push(g)}}}return o},getValueText:function($super){var c=this.getValue();if(DataType.isArrayValue(c)){return"["+c.length+" "+Kekule.$L("WidgetTexts.S_ITEMS")+"]"}else{return $super()}}});Kekule.PropertyEditor.register(Kekule.PropertyEditor.ArrayEditor,DataType.ARRAY);Kekule.PropertyEditor.ColorEditor=Class.create(Kekule.PropertyEditor.SimpleEditor,{CLASS_NAME:"Kekule.PropertyEditor.ColorEditor",doCreateEditWidget:function(d){this._parentWidget=d;var e=this.getValue();this._originValue=e;var c=new Kekule.Widget.ColorDropTextBox(d,e);c.setSpecialColors([Kekule.Widget.ColorPicker.SpecialColors.UNSET]);c.addEventListener("valueSet",function(f){this.saveEditValue()},this);this._textbox=c;return c},doSaveEditValue:function(){var c=this.getEditWidget().getValue();if(c===Kekule.Widget.ColorPicker.SpecialColors.UNSET){c=undefined}else{if(c===""){c=undefined}}if(c!==this._originValue){this.setValue(c);return true}else{return false}}});Kekule.PropertyEditor.register(Kekule.PropertyEditor.ColorEditor,DataType.STRING,null,null,function(d,c){var e=c.name;return e&&(e.toLowerCase().indexOf("color")>=0)})})();(function(){Kekule.Widget.PropEditorModifyOperation=Class.create(Kekule.Operation,{CLASS_NAME:"Kekule.Widget.PropEditorModifyOperation",initialize:function($super,b,c,a){$super();this.setPropEditor(b);this.setNewValue(c);this.setOldValue(a)},initProperties:function(){this.defineProp("propEditor",{dataType:"Kekule.PropertyEditor.BaseEditor",serializable:false});this.defineProp("newValue",{dataType:DataType.VARIANT,serializable:false});this.defineProp("oldValue",{dataType:DataType.VARIANT,serializable:false})},doExecute:function(){var a=this.getPropEditor();if(this.getOldValue()===undefined){this.setOldValue(a.getValue())}a.setValue(this.getNewValue())},doReverse:function(){this.getPropEditor().setValue(this.getOldValue())}})})();(function(){Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{WIDGET_CONFIGURATOR:"K-Widget-Configurator",WIDGET_CONFIGURATOR_CLIENT:"K-Widget-Configurator-Client",ACTION_OPEN_CONFIGURATOR:"K-Action-Open-Configurator"});var a=Kekule.Widget.HtmlClassNames;Kekule.Widget.Configurator=Class.create(Kekule.Widget.Panel,{CLASS_NAME:"Kekule.Widget.Configurator",TAB_BTN_DATA_FIELD:"__$data__",DEF_TAB_POSITION:Kekule.Widget.Position.RIGHT,initialize:function($super,b){this.setPropStoreFieldValue("widget",b);this._objInspector=null;this._tabGroup=null;$super(b)},initProperties:function(){this.defineProp("widget",{dataType:"Kekule.Widget.BaseWidget",serializable:false});this.defineProp("autoUpdate",{dataType:DataType.BOOL});this.defineProp("tabPosition",{dataType:DataType.INT,setter:function(b){this.setPropStoreFieldValue("tabPosition",b);if(this._tabGroup){this._tabGroup.setTabButtonPosition(b||this.DEF_TAB_POSITION)}}})},initPropValues:function($super){$super();this.setLayout(Kekule.Widget.Layout.HORIZONTAL)},doGetWidgetClassName:function($super){return $super()+" "+a.WIDGET_CONFIGURATOR},doCreateRootElement:function(c){var b=c.createElement("div");return b},doCreateSubElements:function($super,o,h){var p=[];var d=o.createElement("div");d.className=a.WIDGET_CONFIGURATOR_CLIENT;p.push(d);var n=new Kekule.Widget.ObjectInspector(this);n.setShowObjsInfoPanel(false);n.setSortField(null);n.appendToElem(d);this._objInspector=n;n.addEventListener("propertyChange",function(c){this.invokeEvent("configChange",{obj:n.getObjects()[0],propertyName:c.propertyInfo.name,oldValue:c.oldValue,newValue:c.newValue})},this);var j=this.getCategoryInfos();var f=new Kekule.Widget.TabButtonGroup(this);this._tabGroup=f;f.setTabButtonPosition(this.getTabPosition()||this.DEF_TAB_POSITION);var k;for(var g=0,e=j.length;g<e;++g){var m=j[g];var b=new Kekule.Widget.RadioButton(f);b.setText(m.title||m.name);b.setHint(m.description||"");b[this.TAB_BTN_DATA_FIELD]=m.obj;b.appendToWidget(f);if(g===0){k=b}}f.addEventListener("execute",function(i){var c=i.widget;if(c instanceof Kekule.Widget.RadioButton){this._switchToTab(c)}},this);f.appendToElem(d);if(j.length<=1){f.setDisplayed("none")}k.setChecked(true);this._switchToTab(k);h.appendChild(d);return p},doWidgetShowStateChanged:function($super,b){$super(b);if(this.getAutoUpdate()){if(b){this.loadConfigValues()}else{this.saveConfigValues()}}},loadConfigValues:function(){},saveConfigValues:function(){},getCategoryInfos:function(){var e=this.getWidget();var b=[];var d=e.getSettingFacade();if(d){var c=e.getPropInfo("settingFacade");b.push({obj:d,name:c.name,title:c.title,descrption:c.description})}return b},_switchToTab:function(c){var b=c[this.TAB_BTN_DATA_FIELD];this._objInspector.setObjects(b)}});Kekule.Widget.ActionOpenConfigWidget=Class.create(Kekule.Action,{CLASS_NAME:"Kekule.Widget.ActionOpenConfigWidget",HTML_CLASSNAME:a.ACTION_OPEN_CONFIGURATOR,initialize:function($super,b){$super();this.setWidget(b);this.setText(Kekule.$L("WidgetTexts.CAPTION_CONFIG"));this.setHint(Kekule.$L("WidgetTexts.HINT_CONFIG"))},initProperties:function(){this.defineProp("widget",{dataType:"Kekule.Widget.BaseWidget",serializable:false})},doUpdate:function(){var b=this.getWidget();this.setEnabled(b&&b.getEnabled())},doExecute:function(b){this.getWidget().openConfigurator(b)}});ClassEx.extend(Kekule.Widget.BaseWidget,{getSettingFacadeClass:function(){var e=this.getClass();var b=null;do{var d=ClassEx.getClassName(e)+".Settings";b=ClassEx.findClass(d);e=ClassEx.getSuperClass(e)}while(e&&!b);return b},getConfiguratorClass:function(){var e=this.getClass();var b=null;do{var d=ClassEx.getClassName(e)+".Configurator";b=ClassEx.findClass(d);e=ClassEx.getSuperClass(e)}while(e&&!b);return b},createConfigurator:function(){var b=this.getConfiguratorClass();return new b(this)},getConfigurator:function(){if(!this._configurator){this._configurator=this.createConfigurator()}return this._configurator},openConfigurator:function(b){var d=this.getConfigurator();d.show(b||this,null,Kekule.Widget.ShowHideType.DROPDOWN)}});ClassEx.defineProp(Kekule.Widget.BaseWidget,"settingFacade",{dataType:DataType.OBJECTEX,serializable:false,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(){var b=this.getPropStoreFieldValue("settingFacade");if(!b){var d=this.getSettingFacadeClass();if(d){b=new d(this);this.setPropStoreFieldValue("settingFacade",b)}}return b}});Kekule.Widget.BaseWidget.Settings=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.BaseWidget.Settings",initialize:function($super,b){this._basedClass=null;$super();this.setWidget(b)},initProperties:function(){this.defineProp("widget",{dataType:"Kekule.Widget.BaseWidget",serializable:false,scope:Class.PropertyScope.PUBLIC})},getBasedClass:function(){if(!this.hasOwnProperty("_basedClass")||!this._basedClass){var c=this.getClassName();var b=c.split(".");b.pop();c=b.join(".");this._basedClass=ClassEx.findClass(c)}return this._basedClass},defineDelegatedProp:function(d,e){if(!e){e=d}var b=ClassEx.getPropInfo(this.getBasedClass(),e);var c=Object.create(b);c.setter=null;c.getter=null;if(b.getter){c.getter=function(){return this.getWidget().getPropValue(e)}}if(b.setter){c.setter=function(f){this.getWidget().setPropValue(e,f)}}this.defineProp(d,c)},defineDelegatedProps:function(g,d){if(!d){d=[]}for(var c=0,b=g.length;c<b;++c){var e=g[c];var f=d[c]||e;this.defineDelegatedProp(e,f)}}})})();(function(){Kekule.Widget.BaseDataSet=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.BaseDataSet",PREFIX_SORT_DESC:"!",initProperties:function(){this.defineProp("enableCache",{dataType:DataType.BOOL,getter:function(){return this.getPropStoreFieldValue("enableCache")&&this.getCacheAvailable()},setter:function(a){this.setPropStoreFieldValue("enableCache",a);if(!a){this.clearCache()}}});this.defineProp("defaultTimeout",{dataType:DataType.INT});this.defineProp("sortFields",{dataType:DataType.ARRAY,setter:function(c){var b=c?Kekule.ArrayUtils.toArray(c):null;this.setPropStoreFieldValue("sortFields",b);this.sortFieldsChanged(b)}});this.defineProp("cache",{dataType:DataType.ARRAY})},initPropValues:function($super){$super();this.setEnableCache(true);this.setCache([]);this.setDefaultTimeout(20000)},finalize:function($super){this.clearCache();this.setCache(null);$super()},dataChanged:function(){this.clearCache();this.invokeEvent("dataChange")},sortFieldsChanged:function(a){this.clearCache();this.doSortFieldsChanged(a)},doSortFieldsChanged:function(a){},getTotalCount:function(){return this.doGetTotalCount()||0},doGetTotalCount:function(){},totalCountChanged:function(a){this.invokeEvent("totalCountChange",{totalCount:a})},getFirstIndex:function(){return 0},getLastIndex:function(){return(this.getTotalCount()||0)-1},getCacheAvailable:function(){return true},clearCache:function(){this.getCache().length=0;return this},saveCacheData:function(d,c){var a=this.getCache();var e=c;for(var b=0;b<d.length;++b){a[e]=d[b]||null;++e}},loadCacheData:function(e,g){if(!this.getEnableCache()){return null}else{var c=this.getCache();if(c.length<e+g){return null}var a=[];for(var d=e,b=e+g;d<b;++d){var f=c[d];if(f===undefined){return null}else{a.push(f)}}return a}},fetch:function(j){var d=Object.extend({fromIndex:0,count:0},j);d.timeout=d.timeout||this.getDefaultTimeout();if(this.getEnableCache()){var c=this.loadCacheData(d.fromIndex,d.count);if(c){d.callback(c);return}}var h=this;var a=false;var b=function(k){if(a){return}if(g){clearTimeout(g)}if(j.callback){j.callback(k)}if(h.getEnableCache()){h.saveCacheData(k,d.fromIndex)}};var e=function(k){if(a){return}if(g){clearTimeout(g)}if(j.errCallback){j.errCallback(k)}};if(d.timeout>0){var f=function(){if(g){clearTimeout(g)}a=true;if(d.timeoutCallback){d.timeoutCallback()}else{if(j.errCallback){j.errCallback(Kekule.$L("ErrorMsg.FETCH_DATA_TIMEOUT"))}}};var g=setTimeout(f,d.timeout)}d.callback=b;d.errCallback=e;var i=this.doFetch(d.fromIndex,d.count,d.callback,d.errCallback)},doFetch:function(b,c,d,a){}});Kekule.Widget.ArrayDataSet=Class.create(Kekule.Widget.BaseDataSet,{CLASS_NAME:"Kekule.Widget.ArrayDataSet",initialize:function($super,a){$super();this.setData(a)},initProperties:function(){this.defineProp("data",{dataType:DataType.ARRAY,setter:function(b){this.setPropStoreFieldValue("data",b);var a=this.getSortFields();if(a){this.doSortFieldsChanged(a)}this.dataChanged()}})},getCacheAvailable:function(){return false},doSortFieldsChanged:function(a){var b=this.getData()||[];Kekule.ArrayUtils.sortHashArray(b,a);this.dataChanged();return this},doGetTotalCount:function(){return(this.getData()||[]).length},doFetch:function(f,d,g,e){var j=[];var b=this.getData()||[];for(var c=f,a=Math.min(f+d,b.length);c<a;++c){var h=b[c];j.push(h)}g(j)}});Kekule.Widget.DataPager=Class.create(ObjectEx,{CLASS_NAME:"Kekule.Widget.DataPager",initialize:function($super,a){$super();this.setDataSet(a)},initProperties:function(){this.defineProp("dataSet",{dataType:"Kekule.Widget.BaseDataSet",setter:function(b){var a=this.getDataSet();if(b!==a){this.setPropStoreFieldValue("dataSet",b);this.dataSetChange(a,b);this.switchToPage(this.getCurrPageIndex()||0)}}});this.defineProp("pageSize",{dataType:DataType.INT,setter:function(a){if(a!==this.getPageSize()){this.setPropStoreFieldValue("pageSize",a);this.pageCountChanged(this.getPageCount());this.switchToPage(this.getCurrPageIndex()||0)}}});this.defineProp("currPageIndex",{dataType:DataType.INT});this.defineProp("currPageData",{dataType:DataType.ARRAY});this.defineProp("sortFields",{dataType:DataType.ARRAY,serializable:false,getter:function(){return this.getDataSet()&&this.getDataSet().getSortFields()},setter:function(a){if(this.getDataSet()){this.getDataSet().setSortFields(a)}}})},initPropValues:function($super){$super();this.setCurrPageIndex(0)},dataSetChange:function(a,b){if(a){a.RemoveEventListener("dataChange",this.reactDataSetDataChange,this);a.RemoveEventListener("totalCountChange",this.reactDataSetTotalCountChange,this)}if(b){b.addEventListener("dataChange",this.reactDataSetDataChange,this);b.addEventListener("totalCountChange",this.reactDataSetTotalCountChange,this)}this.pageCountChanged(this.getPageCount())},reactDataSetDataChange:function(a){this.dataChanged()},dataChanged:function(){this.pageCountChanged(this.getPageCount());this.switchToPage(this.getCurrPageIndex()||0)},reactDataSetTotalCountChange:function(a){this.pageCountChanged(this.getPageCount())},getPageCount:function(){var b=this.getDataSet();var a=b?(b.getTotalCount()||0):0;return Math.ceil(a/this.getPageSize())},pageCountChanged:function(a){this.invokeEvent("pageCountChange",{pageCount:a})},fetchPageData:function(c){var b=this.getPageSize();var a=Kekule.ObjUtils.isUnset(c.pageIndex)?this.getCurrPageIndex():c.pageIndex;var e=b*a;var f=this.getPageSize();var d=Object.create(c);Object.extend(d,{fromIndex:e,count:f});this.getDataSet().fetch(d);return this},switchToPage:function(a,d){var b=this;var c={pageIndex:a,timeout:d,callback:function(e){b.setCurrPageData(e);b.setCurrPageIndex(a);b.invokeEvent("dataFetched",{pageIndex:a,data:e})},errCallback:function(e){b.invokeEvent("dataError",{error:e});Kekule.error(e)}};this.invokeEvent("pageRetrieve",{pageIndex:a});this.fetchPageData(c)}})})();(function(){var d=Kekule.DomUtils;var e=Kekule.HtmlElementUtils;var b=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{DATAGRID:"K-DataGrid",DATATABLE:"K-DataTable",DATATABLE_ROW_ODD:"K-Odd",DATATABLE_ROW_EVEN:"K-Even",DATATABLE_CELL_WRAPPER:"K-DataTable-CellWrapper",DATATABLE_HEADCELL_INTERACTABLE:"K-DataTable-HeadCellInteractable",DATATABLE_OPER_COL:"K-DataTable-OperCol",DATATABLE_OPER_CELL:"K-DataTable-OperCell",DATATABLE_CHECK_COL:"K-DataTable-CheckCol",DATATABLE_CHECK_CELL:"K-DataTable-CheckCell",DATATABLE_DATA_COL:"K-DataTable-DataCol",DATATABLE_DATA_CELL:"K-DataTable-DataCell",DATATABLE_SORTMARK:"K-DataTable-SortMark",DATATABLE_SORTASC:"K-Sort-Asc",DATATABLE_SORTDESC:"K-Sort-Desc",DATATABLE_EDIT:"K-DataTable-Edit",DATATABLE_DELETE:"K-DataTable-Delete",DATATABLE_INSERT:"K-DataTable-Insert",PAGENAVIGATOR:"K-PageNavigator",PAGENAVIGATOR_FIRST:"K-PageNavigator-First",PAGENAVIGATOR_LAST:"K-PageNavigator-Last",PAGENAVIGATOR_PREV:"K-PageNavigator-Prev",PAGENAVIGATOR_NEXT:"K-PageNavigator-Next",PAGENAVIGATOR_PAGEINDEXER:"K-PageNavigator-PageIndexer",PAGENAVIGATOR_PAGEINPUT:"K-PageNavigator-PageInput",PAGENAVIGATOR_PAGESELECTOR:"K-PageNavigator-PageSelector"});Kekule.Widget.DataTableColNames={OPER:"OPER",CHECK:"CHECK",ALL:"*"};var c=Kekule.Widget.DataTableColNames;Kekule.Widget.DataTable=Class.create(Kekule.Widget.BaseWidget,{CLASS_NAME:"Kekule.Widget.DataTable",BINDABLE_TAG_NAMES:["div","span"],PREFIX_SORT_DESC:"!",COLDEF_FIELD:"__$colDef__",ROWDATA_FIELD:"__$rowData__",ROW_OPER_TOOLBAR_FIELD:"__$rowOperToolbar__",ROW_CHECKBOX_FIELD:"__$rowCheckBox__",COLNAME_OPER:c.OPER,COLNAME_CHECK:c.CHECK,COLNAME_ALL:c.ALL,initialize:function($super,g){this._displayData=null;this.setPropStoreFieldValue("showTableHead",true);$super(g)},initProperties:function(){this.defineProp("data",{dataType:DataType.ARRAY});this.defineProp("columns",{dataType:DataType.ARRAY});this.defineProp("operColShowMode",{dataType:DataType.STRING});this.defineProp("operWidgets",{dataType:DataType.ARRAY});this.defineProp("sortFields",{dataType:DataType.ARRAY,setter:function(h){var g=h?Kekule.ArrayUtils.toArray(h):null;this.setPropStoreFieldValue("sortFields",g);if(this.getDataPager()){this.getDataPager().setSortFields(g)}}});this.defineProp("sortFunc",{dataType:DataType.FUNCTION});this.defineProp("showTableHead",{dataType:DataType.BOOL});this.defineProp("enableHeadInteraction",{dataType:DataType.BOOL});this.defineProp("enableActiveRow",{dataType:DataType.BOOL,setter:function(g){this.setPropStoreFieldValue("enableActiveRow",g);if(!g){this.setActiveCell(null)}}});this.defineProp("activeCell",{dataType:DataType.OBJECT,setter:function(h){var g=this.getActiveCell();if(g!==h){if(g){e.removeClass(g,b.STATE_ACTIVE)}this.setPropStoreFieldValue("activeCell",h);if(h){e.addClass(h,b.STATE_ACTIVE);var i=this.getParentRow(h);if(i){this.setActiveRow(i)}}else{this.setActiveRow(null)}}}});this.defineProp("activeRow",{dataType:DataType.OBJECT,setter:function(h){var g=this.getActiveRow();if(g!==h){this.activeRowChanged(g,h);this.setPropStoreFieldValue("activeRow",h)}}});this.defineProp("hoverCell",{dataType:DataType.OBJECT,setter:function(h){var g=this.getHoverCell();if(g!==h){if(g){e.removeClass(g,b.STATE_HOVER)}this.setPropStoreFieldValue("hoverCell",h);if(h){e.addClass(h,b.STATE_HOVER);var i=this.getParentRow(h);if(i){this.setHoverRow(i)}}else{this.setHoverRow(null)}}}});this.defineProp("hoverRow",{dataType:DataType.OBJECT,setter:function(h){var g=this.getHoverRow();if(g!==h){this.hoverRowChanged(g,h);this.setPropStoreFieldValue("hoverRow",h)}}});this.defineProp("dataPager",{dataType:"Kekule.Widget.DataPager",setter:function(h){var g=this.getDataPager();if(g!==h){this.setPropStoreFieldValue("dataPager",h);this.dataPagerChanged(h,g)}}})},initPropValues:function($super){$super();this.reactOperEditBind=this.reactOperEdit.bind(this);this.reactOperDeleteBind=this.reactOperDelete.bind(this);this.reactOperInsertBind=this.reactOperInsert.bind(this)},doObjectChange:function($super,h){$super(h);var g=["data","columns","sortFields","sortFunc","showTableHead","enableHeadInteraction","operColShowMode","operWidgets"];if(Kekule.ArrayUtils.intersect(h,g).length){this.recreateChildContent()}},doGetWidgetClassName:function($super){return $super()+" "+b.DATATABLE},doCreateRootElement:function(h){var g=h.createElement("div");return g},doCreateSubElements:function(h,g){return this.doCreateDataTable(h,g)},doCreateDataTable:function(i,h){var g=i.createElement("table");this.recreateChildContent(i,g);h.appendChild(g);return g},getTableElement:function(){return this.getElement()&&this.getElement().getElementsByTagName("table")[0]},getShowOperCol:function(){var g=this.getOperColShowMode()||Kekule.Widget.DataTable.OperColShowMode.NONE;return g!==Kekule.Widget.DataTable.OperColShowMode.NONE},recreateChildContent:function(k,h){this.setActiveCell(null);this.setHoverCell(null);var j=this.prepareData();var i=h||this.getTableElement();var g=[];if(i){d.clearChildContent(i);if(!k){var k=i.ownerDocument}g.push(this.doCreateDataTableColGroup(k,i,j.columns));if(this.getShowTableHead()){g.push(this.doCreateDataTableHead(k,i,j.columns))}g.push(this.doCreateDataTableBody(k,i,j.columns,j.data))}return g},doCreateDataTableColGroup:function(o,k,g){var m=g||[];var q=o.createElement("colgroup");for(var j=0,h=m.length;j<h;++j){var n=m[j]||{};var p=o.createElement("col");if(n.colClassName){p.className=n.colClassName}if(n.colStyle){p.style.cssText=n.colStyle}q.appendChild(p)}k.appendChild(q);return q},doCreateDataTableCellWrapper:function(i,h){var g=i.createElement("span");g.className=b.DATATABLE_CELL_WRAPPER;h.appendChild(g);return g},doCreateDataTableHead:function(q,n,k){var o=k||[];var g=this.getEnableHeadInteraction();var r=q.createElement("thead");var h=q.createElement("tr");for(var m=0,j=o.length;m<j;++m){var p=o[m]||{};this.doCreateDataTableHeadCell(q,h,p,g)}r.appendChild(h);n.appendChild(r);return r},doCreateDataTableHeadCell:function(n,g,j,m){var i=n.createElement("th");if(j.className){i.className=j.className}if(j.style){i.style.cssText=j.style}var l=this.doCreateDataTableCellWrapper(n,i);var k=Kekule.ObjUtils.notUnset(j.disableInteract)?!j.disableInteract:m;if(k){e.addClass(i,b.DATATABLE_HEADCELL_INTERACTABLE)}d.setElementText(l,j.text||j.name);var h=this.doCreateDataTableHeadCellSortMark(n,i);if(j.sorting===1){e.addClass(h,b.DATATABLE_SORTASC)}else{if(j.sorting===-1){e.addClass(h,b.DATATABLE_SORTDESC)}else{}}l.title=j.hint||"";i[this.COLDEF_FIELD]=j;g.appendChild(i);return i},doCreateDataTableHeadCellSortMark:function(i,h){var g=i.createElement("span");g.className=b.DATATABLE_SORTMARK;h.appendChild(g);return g},doCreateDataTableBody:function(G,v,m,E){var s=m||[];var E=E||[];var r=G.createElement("tbody");if(this.getShowOperCol()){var x=this.getOperWidgetDefinitions()}var u=true;for(var C=0,z=E.length;C<z;++C){var n=G.createElement("tr");n.className=u?b.DATATABLE_ROW_ODD:b.DATATABLE_ROW_EVEN;u=!u;var p=E[C]||{};n[this.ROWDATA_FIELD]=p;for(var B=0,A=s.length;B<A;++B){var t=s[B];var F=t.name;var y=p[F];var o=G.createElement("td");if(t.className){o.className=t.className}if(t.style){o.style.cssText=t.style}var g=this.doCreateDataTableCellWrapper(G,o);if(t.isOperCol){var h={rowData:p,rowIndex:C,colIndex:B,childWidgetDefinitions:x};var q=this.doCreateOperCellContent(g,h);n[this.ROW_OPER_TOOLBAR_FIELD]=q}else{if(t.isCheckCol){var h={rowData:p,rowIndex:C,colIndex:B};var D=this.doCreateCheckCellContent(g,h);n[this.ROW_CHECKBOX_FIELD]=D}else{var h={rowData:p,cellKey:F,cellValue:y,rowIndex:C,colIndex:B};this.doCreateDataCellContent(g,h)}}o.appendChild(g);n.appendChild(o)}r.appendChild(n)}v.appendChild(r);return r},doCreateDataCellContent:function(g,h){var i="";if(Kekule.ObjUtils.notUnset(h.cellValue)){i=""+h.cellValue}d.setElementText(g,i)},doCreateCheckCellContent:function(h,i){var g=new Kekule.Widget.CheckBox(this);g.appendToElem(h);return g},doCreateOperCellContent:function(h,i){var j=this.doCreateOperToolbar(h,i.childWidgetDefinitions);var g=Kekule.Widget.DataTable.OperColShowMode;var k=this.getOperColShowMode();if(k!==g.ALL){j.setVisible(false)}return j},doCreateOperToolbar:function(h,i){var g=new Kekule.Widget.ButtonGroup(this);g.setChildDefs(i);g.appendToElem(h);return g},getDefaultOperButtons:function(){var g=Kekule.Widget.DataTable.Components;return[g.EDIT,g.DELETE]},getOperWidgetDefinitions:function(){var g=[];var n=this.getOperWidgets()||this.getDefaultOperButtons();for(var k=0,h=n.length;k<h;++k){var j=n[k];if(DataType.isObjectValue(j)){g.push(j)}else{var m=this.getDefaultComponentDefinitionHash(j);if(m){g.push(m)}}}return g},getDefaultComponentDefinitionHash:function(h){var i=Kekule.Widget.DataTable.Components;var g;if(h===i.EDIT){g={widget:"Kekule.Widget.Button",htmlClass:b.DATATABLE_EDIT,text:Kekule.$L("WidgetTexts.CAPTION_DATATABLE_EDIT"),hint:Kekule.$L("WidgetTexts.HINT_DATATABLE_EDIT"),"#execute":this.reactOperEditBind}}else{if(h===i.DELETE){g={widget:"Kekule.Widget.Button",htmlClass:b.DATATABLE_DELETE,text:Kekule.$L("WidgetTexts.CAPTION_DATATABLE_DELETE"),hint:Kekule.$L("WidgetTexts.HINT_DATATABLE_DELETE"),"#execute":this.reactOperDeleteBind}}else{if(h===i.INSERT){g={widget:"Kekule.Widget.Button",htmlClass:b.DATATABLE_INSERT,text:Kekule.$L("WidgetTexts.CAPTION_DATATABLE_INSERT"),hint:Kekule.$L("WidgetTexts.HINT_DATATABLE_INSERT"),"#execute":this.reactOperInsertBind}}}}if(g){g.internalName=h}return g},hasExternalDataProvider:function(){return !!this.getDataPager()},needSort:function(){return this.getSortFields()||this.getSortFunc()},sortData:function(){var h=this.getData()||[];if(this.needSort()){if(!this.hasExternalDataProvider()){var g=Kekule.ArrayUtils.clone(h);Kekule.ArrayUtils.sortHashArray(g,this.getSortFields());return g}}return h},prepareData:function(){var s={};var m=this.sortData();s.data=m;var o=function(y){var t=[];for(var x=0,u=y.length;x<u;++x){var w=Kekule.ObjUtils.getOwnedFieldNames(y[x]);Kekule.ArrayUtils.pushUnique(t,w)}var v=[];for(var x=0,u=t.length;x<u;++x){v.push({name:t[x],text:t[x]})}return v};if(this.getColumns()){s.columns=Kekule.ArrayUtils.clone(this.getColumns())}else{s.columns=o(m)}var n=0;while(n<s.columns.length){var g=s.columns[n];if(typeof(g)==="string"){g={name:g}}if(g.name===this.COLNAME_OPER){s.columns[n]={name:"",text:"",disableInteract:true,isOperCol:true,colClassName:b.DATATABLE_OPER_COL,className:b.DATATABLE_OPER_CELL}}else{if(g.name===this.COLNAME_CHECK){s.columns[n]={name:"",text:"",disableInteract:true,isCheckCol:true,colClassName:b.DATATABLE_CHECK_COL,className:b.DATATABLE_CHECK_CELL}}else{if(g.name===this.COLNAME_ALL){var j=o(m);var r=j;r.unshift(1);r.unshift(n);s.columns.splice.apply(s.columns,r)}else{g.colClassName=b.DATATABLE_DATA_COL+" "+(g.colClassName||"");g.className=b.DATATABLE_DATA_CELL+" "+(g.className||"")}}}++n}if(this.needSort()&&!this.getSortFunc()){var k=this.getSortFields();for(var n=0,h=s.columns.length;n<h;++n){var p=s.columns[n];var q=p.name;if(k.indexOf(q)>=0){s.columns[n].sorting=1}else{if(k.indexOf(this.PREFIX_SORT_DESC+q)>=0){s.columns[n].sorting=-1}else{s.columns[n].sorting=0}}}}return s},activeRowChanged:function(h,j){var g=Kekule.Widget.DataTable.OperColShowMode;var i=this.getOperColShowMode();if(h){e.removeClass(h,b.STATE_ACTIVE);if(i===g.ACTIVE||i===g.HOVER){this.hideRowOperToolbar(h)}}if(j){e.addClass(j,b.STATE_ACTIVE);if(i===g.ACTIVE||i===g.HOVER){this.showRowOperToolbar(j)}}},hoverRowChanged:function(h,j){var g=Kekule.Widget.DataTable.OperColShowMode;var i=this.getOperColShowMode();if(h){e.removeClass(h,b.STATE_HOVER);if(i===g.HOVER&&h!==this.getActiveRow()){this.hideRowOperToolbar(h)}}if(j){e.addClass(j,b.STATE_HOVER);if(i===g.HOVER){this.showRowOperToolbar(j)}}},getParentCell:function(g){if(d.isDescendantOf(g,this.getElement())){return d.getNearestAncestorByTagName(g,"td",true)}else{return null}},getParentHeadCell:function(g){if(d.isDescendantOf(g,this.getElement())){return d.getNearestAncestorByTagName(g,"th",true)}else{return null}},getParentRow:function(g){if(d.isDescendantOf(g,this.getElement())){return d.getNearestAncestorByTagName(g,"tr",true)}else{return null}},getColCount:function(){return(this.getColumns()||[]).length},getRowCount:function(){return(this.getData()||[]).length},getDataRows:function(){var g=[];var h=this.getElement().getElementsByTagName("tbody")[0];return h&&h.getElementsByTagName("tr")},getCheckedRows:function(){var g=[];var k=this.getDataRows();for(var j=0,h=k.length;j<h;++j){if(this.isRowChecked(k[j])){g.push(k[j])}}return g},getRowData:function(g){return g?g[this.ROWDATA_FIELD]:null},isRowChecked:function(g){var h=this.getRowCheckBox(g);return h&&h.getChecked&&h.getChecked()},getRowCheckBox:function(g){return g&&g[this.ROW_CHECKBOX_FIELD]},getRowOperToolbar:function(g){return g?g[this.ROW_OPER_TOOLBAR_FIELD]:null},showRowOperToolbar:function(h){var g=this.getRowOperToolbar(h);if(g){g.setVisible(true)}},hideRowOperToolbar:function(h){var g=this.getRowOperToolbar(h);if(g){g.setVisible(false)}},dataPagerChanged:function(g,h){if(h){h.removeEventListener("pageRetrieve",this.reactPagerRetrieve,this);h.removeEventListener("dataFetched",this.reactPagerFetched,this);h.removeEventListener("dataError",this.reactPagerError,this)}if(g){g.addEventListener("pageRetrieve",this.reactPagerRetrieve,this);g.addEventListener("dataFetched",this.reactPagerFetched,this);g.addEventListener("dataError",this.reactPagerError,this);this.setData(g.getCurrPageData())}},reactPagerRetrieve:function(g){if(this.reportMessage){this._loadingDataMsg=this.reportMessage(Kekule.$L("WidgetTexts.MSG_RETRIEVING_DATA"),Kekule.Widget.MsgType.INFO)}},reactPagerFetched:function(g){this.setData(g.data);if(this._loadingDataMsg&&this.removeMessage){this.removeMessage(this._loadingDataMsg)}},reactPagerError:function(g){if(this._loadingDataMsg&&this.removeMessage){this.removeMessage(this._loadingDataMsg)}if(this.flashMessage){this.flashMessage(g.error.message||g.error,Kekule.Widget.MsgType.ERROR)}},reactOperEdit:function(g){return this.reactOperExecute(a.EDIT,g)},reactOperDelete:function(g){return this.reactOperExecute(a.DELETE,g)},reactOperInsert:function(g){return this.reactOperExecute(a.INSERT,g)},reactOperExecute:function(g,k){var j=k.target;var h=this.getParentRow(j.getElement());var i=this.getRowData(h);return this.doReactOperExecute(g,i,h,k)},doReactOperExecute:function(g,i,h,j){},react_click:function($super,j){$super(j);var h=j.getTarget();var g=this.getParentHeadCell(h);if(g){this._autoSortOnHeadCell(g)}else{if(this.getEnableActiveRow()){var i=this.getParentCell(h);if(i){this.setActiveCell(i)}}}},react_mouseover:function($super,i){$super(i);var g=i.getTarget();if(this.getEnableActiveRow()){var h=this.getParentCell(g);if(h){this.setHoverCell(h)}else{this.setHoverCell(null)}}},react_mouseleave:function($super,h){$super(h);var g=h.getTarget();if(this.getEnableActiveRow()){this.setHoverCell(null)}},_autoSortOnHeadCell:function(g){if(g&&this.getEnableHeadInteraction()){var i=g[this.COLDEF_FIELD];if(i&&!i.disableInteract){var h=i.name;if(i.sorting===1){h=this.PREFIX_SORT_DESC+h}this.setSortFields([h])}}},load:function(i,h,g,j){this.beginUpdate();try{this.setData(i);this.setColumns(h);this.setSortFields(g?Kekule.ArrayUtils.toArray(g):null);this.setSortFunc(j)}finally{this.endUpdate()}return this},reload:function(){this.recreateChildContent();return this}});Kekule.Widget.DataTable.OperColShowMode={NONE:"none",ACTIVE:"active",HOVER:"hover",ALL:"all"};Kekule.Widget.DataTable.Components={EDIT:"edit",DELETE:"delete",INSERT:"insert"};var a=Kekule.Widget.DataTable.Components;Kekule.Widget.PageNavigator=Class.create(Kekule.Widget.ButtonGroup,{CLASS_NAME:"Kekule.Widget.PageNavigator",initProperties:function(){this.defineProp("components",{dataType:DataType.ARRAY});this.defineProp("firstIndex",{dataType:DataType.INT});this.defineProp("lastIndex",{dataType:DataType.INT});this.defineProp("currIndex",{dataType:DataType.INT});this.defineProp("dataPager",{dataType:"Kekule.Widget.DataPager",setter:function(h){var g=this.getDataPager();if(g!==h){this.setPropStoreFieldValue("dataPager",h);this.dataPagerChanged(h,g)}}})},initPropValues:function($super){$super();this.setShowText(true);this.setShowGlyph(true);this.setFirstIndex(1);this.reactFirstBind=this.reactFirst.bind(this);this.reactLastBind=this.reactLast.bind(this);this.reactPrevBind=this.reactPrev.bind(this);this.reactNextBind=this.reactNext.bind(this);this.reactPageInputChangeBind=this.reactPageInputChange.bind(this)},doObjectChange:function($super,g){$super(g);if(Kekule.ArrayUtils.intersect(g,["firstIndex","lastIndex","currIndex"]).length){this.updateChildComponent()}if(g.indexOf("currIndex")>=0){this.invokeEvent("pageChange",{currIndex:this.getCurrIndex()})}},doGetWidgetClassName:function($super){return $super()+" "+b.PAGENAVIGATOR},doCreateSubElements:function(h,g){return this.recreateChildContent(h,g)},getDefaultComponents:function(){return[f.FIRST,f.PREV,f.PAGESELECTOR,f.NEXT,f.LAST]},recreateChildContent:function(){var n=this.getComponents()||this.getDefaultComponents();var j=[];for(var k=0,g=n.length;k<g;++k){var h=n[k];if(DataType.isObjectValue(h)){j.push(h)}else{var m=this.getDefaultComponentDefinitionHash(h);if(m){j.push(m)}}}this.setChildDefs(j);this.updateChildComponent()},getDefaultComponentDefinitionHash:function(h){var g;if(h===f.FIRST){g={widget:"Kekule.Widget.Button",htmlClass:b.PAGENAVIGATOR_FIRST,text:Kekule.$L("WidgetTexts.CAPTION_FIRST_PAGE"),hint:Kekule.$L("WidgetTexts.HINT_FIRST_PAGE"),"#execute":this.reactFirstBind}}else{if(h===f.LAST){g={widget:"Kekule.Widget.Button",htmlClass:b.PAGENAVIGATOR_LAST,text:Kekule.$L("WidgetTexts.CAPTION_LAST_PAGE"),hint:Kekule.$L("WidgetTexts.HINT_LAST_PAGE"),"#execute":this.reactLastBind}}else{if(h===f.PREV){g={widget:"Kekule.Widget.Button",htmlClass:b.PAGENAVIGATOR_PREV,text:Kekule.$L("WidgetTexts.CAPTION_PREV_PAGE"),hint:Kekule.$L("WidgetTexts.HINT_PREV_PAGE"),"#execute":this.reactPrevBind}}else{if(h===f.NEXT){g={widget:"Kekule.Widget.Button",htmlClass:b.PAGENAVIGATOR_NEXT,text:Kekule.$L("WidgetTexts.CAPTION_NEXT_PAGE"),hint:Kekule.$L("WidgetTexts.HINT_NEXT_PAGE"),"#execute":this.reactNextBind}}else{if(h===f.PAGEINPUT){g={widget:"Kekule.Widget.TextBox",htmlClass:[b.PAGENAVIGATOR_PAGEINPUT,b.PAGENAVIGATOR_PAGEINDEXER],hint:Kekule.$L("WidgetTexts.HINT_CURR_PAGE"),"#valueChange":this.reactPageInputChangeBind}}else{if(h===f.PAGESELECTOR){g={widget:"Kekule.Widget.SelectBox",htmlClass:[b.PAGENAVIGATOR_PAGESELECTOR,b.PAGENAVIGATOR_PAGEINDEXER],hint:Kekule.$L("WidgetTexts.HINT_CURR_PAGE"),"#valueChange":this.reactPageInputChangeBind}}else{g=null}}}}}}if(g){g.internalName=h}return g},getComponent:function(g){return this.getChildWidgetByInternalName(g)},setChildComponentEnabled:function(i,h){var g=this.getComponent(i);if(g){g.setEnabled(h)}},updateChildComponent:function(){var h=this.getFirstIndex()||0;var n=this.getLastIndex()||0;var g=this.getCurrIndex()||0;var j=g<=h;var l=g>=n;this.setChildComponentEnabled(f.FIRST,!j);this.setChildComponentEnabled(f.PREV,!j);this.setChildComponentEnabled(f.NEXT,!l);this.setChildComponentEnabled(f.LAST,!l);this.setChildComponentEnabled(f.PAGEINPUT,n>h);this.setChildComponentEnabled(f.PAGESELECTOR,n>h);var m=this.getComponent(f.PAGEINPUT);if(m){m.setValue(g)}var p=this.getComponent(f.PAGESELECTOR);if(p){var o=[];for(var k=h;k<=n;++k){o.push({value:k})}p.setItems(o);p.setValue(g)}},dataPagerChanged:function(g,h){if(h){h.removeEventListener("dataFetched",this.reactPagerFetched,this);g.removeEventListener("pageCountChange",this.reactPagerPageCountChange,this)}if(g){g.addEventListener("dataFetched",this.reactPagerFetched,this);g.addEventListener("pageCountChange",this.reactPagerPageCountChange,this);this.updatePageDetails(g);this.setCurrIndex(g.getCurrPageIndex()+this.getFirstIndex())}},reactPagerFetched:function(g){this.setCurrIndex(g.pageIndex+this.getFirstIndex())},reactPagerPageCountChange:function(g){this.updatePageDetails(this.getDataPager())},updatePageDetails:function(h){var g=this.getFirstIndex();this.setLastIndex(h.getPageCount()+g-1)},requestChangeCurrIndex:function(h){var g=this.getDataPager();if(g){g.switchToPage(h-this.getFirstIndex())}else{this.setCurrIndex(h)}},reactFirst:function(g){this.requestChangeCurrIndex(this.getFirstIndex()||0)},reactLast:function(g){this.requestChangeCurrIndex(this.getLastIndex()||0)},reactPrev:function(h){var g=this.getFirstIndex()||0;var i=this.getCurrIndex()||0;this.requestChangeCurrIndex(Math.max(i-1,g))},reactNext:function(g){var i=this.getLastIndex()||0;var h=this.getCurrIndex()||0;this.requestChangeCurrIndex(Math.min(h+1,i))},reactPageInputChange:function(i){var h=i.target.getValue();if(typeof(h)==="string"){h=parseInt(h)}var g=this.getFirstIndex()||0;var j=this.getLastIndex()||0;if(h>=g&&h<=j){this.requestChangeCurrIndex(h)}else{Kekule.error(Kekule.$L("ErrorMsg.PAGE_INDEX_OUTOF_RANGE"))}}});Kekule.Widget.PageNavigator.Components={FIRST:"first",LAST:"last",PREV:"prev",NEXT:"next",PAGEINPUT:"pageInput",PAGESELECTOR:"pageSelector"};var f=Kekule.Widget.PageNavigator.Components})();(function(){var b=Kekule.HtmlElementUtils;var a=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{SYSMSGGROUP:"K-SysMsgGroup"});Kekule.Widget.SysMsgGroup=Class.create(Kekule.Widget.MsgGroup,{CLASS_NAME:"Kekule.Widget.SysMsgGroup",initialize:function($super,c){$super(c)},initPropValues:function($super){$super();this.setMaxMsgCount(6)},doGetWidgetClassName:function($super){return $super()+" "+a.SYSMSGGROUP}});Kekule.Widget.ExceptionHandler=Class.create(Kekule.ExceptionHandler,{CLASS_NAME:"Kekule.Widget.ExceptionHandler",initProperties:function(){this.defineProp("document",{dataType:DataType.OBJECT,serializable:false,getter:function(){return this.getPropStoreFieldValue("document")||document}});this.defineProp("sysMsgGroup",{dataType:"Kekule.Widget.SysMsgGroup",serializable:false,setter:null,getter:function(){var c=this.getPropStoreFieldValue("sysMsgGroup");if(!c){c=new Kekule.Widget.SysMsgGroup(this.getDocument());c.appendToElem(this.getDocument().body);this.setPropStoreFieldValue("sysMsgGroup",c)}return c}})},throwException:function($super,h,f){var g=Kekule.ExceptionLevel;var d=Kekule.Widget.MsgType;if(!f){f=g.ERROR}var i;if(typeof(h)==="string"){i=h}else{i=h.message}if(i){var c=(f===g.ERROR)||!f?d.ERROR:(f===g.WARNING)?d.WARNING:(f===g.NOTE)?d.INFO:d.NORMAL;this.getSysMsgGroup().addMessage(i,c)}return $super(h,f)}});Kekule.ClassUtils.makeSingleton(Kekule.Widget.ExceptionHandler);Kekule.X.domReady(function(){Kekule.exceptionHandler=Kekule.Widget.ExceptionHandler.getInstance()})})();(function(){var a=Kekule.Widget.HtmlClassNames;Kekule.Widget.HtmlClassNames=Object.extend(Kekule.Widget.HtmlClassNames,{OPER_HISTORY_TREE_VIEW:"K-OperHistory-TreeView"});Kekule.Widget.OperHistoryTreeView=Class.create(Kekule.Widget.TreeView,{CLASS_NAME:"Kekule.Widget.OperHistoryTreeView",initialize:function($super,b,c){$super(b);this.setPropStoreFieldValue("objMap",new Kekule.MapEx(true));this.setEnableLiveUpdate(true);this.setEnableMultiSelected(true);this.setOperHistory(c)},initProperties:function(){this.defineProp("operHistory",{dataType:"Kekule.OperationHistory",serializable:false,setter:function(c){var b=this.getPropStoreFieldValue("operHistory");this.setPropStoreFieldValue("operHistory",c);this.operHistoryChanged(c,b)}});this.defineProp("enableLiveUpdate",{dataType:DataType.BOOL});this.defineProp("objMap",{dataType:"Kekule.MapEx",setter:null,serializable:false})},doGetWidgetClassName:function($super){return $super()+" "+a.OPER_HISTORY_TREE_VIEW},operHistoryChanged:function(c,b){this.clearChildItems();this.getObjMap().clear();if(b){this._uninstallRootEventHandler(b)}if(c){this._fillTree(c);this._installRootEventHandler(c)}},_installRootEventHandler:function(b){b.addEventListener("operChange",this.reactOperChange,this)},_uninstallRootEventHandler:function(b){b.removeEventListener("operChange",this.reactOperChange,this)},reactOperChange:function(c){if(this.getEnableLiveUpdate()){var b=c.target;this._fillTree(c.target)}},_fillTree:function(c){if(c){this.clearChildItems();this._updateTreeItem(this.appendChildItem(),c);var d=c.getCurrOperation();var b=d?this.getObjMap().get(d):null;this.select(b)}},_getOperChildCount:function(b){if(b instanceof Kekule.OperationHistory){return b.getOperationCount()}else{if(b instanceof Kekule.MacroOperation){return b.getChildCount()}else{return 0}}},_getChildOperAt:function(c,b){if(c instanceof Kekule.OperationHistory){return c.getOperationAt(b)}else{if(c instanceof Kekule.MacroOperation){return c.getChildAt(b)}else{return null}}},_updateTreeItem:function(h,d){var k=this._getOperDisplayTitle(d);var f={text:k,obj:d};this.setItemData(h,f);this.getObjMap().set(d,h);var b=this.getChildItemCount(h);var e=this._getOperChildCount(d);for(var g=0;g<e;++g){var c=this._getChildOperAt(d,g);var j;if(g<b){j=this.getChildItemAt(h,g)}else{j=this.appendChildItem(h)}this._updateTreeItem(j,c)}if(b>e){for(var g=b-1;g>=e;--g){this.removeChildItemAt(h,g)}}},_getOperDisplayTitle:function(d){var b=d.getClassName();var c=d.getTarget?d.getTarget():null;if(c&&c.getId){b+="(target: "+c.getId()+")"}return b}})})();