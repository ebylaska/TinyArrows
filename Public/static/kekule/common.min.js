"use strict";(function(){if(Kekule.PROP_AUTO_TITLE){var d=ClassEx.getPrototype(ObjectEx).defineProp;var b="TITLE_";var c="DES_";var a=function(f,m){if(!m.title&&!m.description){var h=this.getClassName();if(h.startsWith("Kekule.")){h=h.substr(7)}var e=b;var k=c;var g=e+f;var i=k+f;var j=Kekule.Localization.findValue("OBJDEF_TEXTS."+h+"."+g);var l=Kekule.Localization.findValue("OBJDEF_TEXTS."+h+"."+i);m.title=j;m.description=l}return d.apply(this,[f,m])};ClassEx.getPrototype(ObjectEx).defineProp=a}Kekule.ExceptionLevel={ERROR:-1,WARNING:-2,NOTE:-3,LOG:-4};Kekule.throwException=function(h,f){if(Kekule.exceptionHandler){return Kekule.exceptionHandler.throwException(h,f)}else{var g=Kekule.ExceptionLevel;if((!f)||(f===g.ERROR)){if(typeof(h)==="string"){h=new Kekule.Exception(h)}throw h}else{if(typeof(console)!=="undefined"){if(typeof(h)!=="string"){h=h.message}var i=(f===g.WARNING)?console.warn:(f===g.NOTE)?console.info:console.log;if(i){i(h)}else{console.log(h)}}}}};Kekule.getExceptionMsg=function(f){if(typeof(f)==="string"){return f}else{if(typeof(f)==="object"){return f.message}else{return""}}};Kekule.raise=Kekule.throwException;Kekule.error=function(f){return Kekule.raise(f,Kekule.ExceptionLevel.ERROR)};Kekule.chemError=function(f){if(typeof(f)=="string"){f=new Kekule.ChemError(f)}return Kekule.error(f)};Kekule.warn=function(f){return Kekule.raise(f,Kekule.ExceptionLevel.WARNING)};Kekule.notify=function(f){return Kekule.raise(f,Kekule.ExceptionLevel.NOTE)};Kekule.log=function(f){return Kekule.raise(f,Kekule.ExceptionLevel.LOG)};Kekule.hasLocalRes=function(){return !!Kekule.LOCAL_RES};Kekule.globalOptions={add:function(e,f){Object.setCascadeFieldValue(e,f,Kekule.globalOptions,true)}};Kekule.HashEx=Class.create({CLASS_NAME:"Kekule.HashEx",PROP_NAME_PREFIX:"__$key$__",initialize:function(){this._map={}},finalize:function(){this._map=null},keyToPropName:function(e){return this.PROP_NAME_PREFIX+e},has:function(e){return this._map.hasOwnProperty(this.keyToPropName(e))},set:function(e,f){this._map[this.keyToPropName(e)]=f;return this},get:function(f,e){var g=this.keyToPropName(f);if(this._map.hasOwnProperty(g)){return this._map[g]}else{return e}},remove:function(e){var f=this.keyToPropName(e);if(this._map.hasOwnProperty(f)){delete this._map[f]}return this},clear:function(){this._map={}}});Kekule.MapEx=Class.create({CLASS_NAME:"Kekule.MapEx",initialize:function(e){this.isWeak=!e;if(!Kekule.MapEx._inited){Kekule.MapEx._init()}if((!Kekule.MapEx._implementation)||(!this.isWeak)){this.keys=[];this.values=[]}else{this._implementation=new Kekule.MapEx._implementation()}},finalize:function($super){if(!this._implementation){this.keys=null;this.values=null}},set:function(f,g){if(this._implementation){this._implementation.set(f,g)}else{var e=this.keys.indexOf(f);if(e>=0){this.values[e]=g}else{this.keys.push(f);this.values.push(g)}}return this},get:function(g,e){if(this._implementation){return this._implementation.get(g,e)}else{var f=this.keys.indexOf(g);if(f>=0){return this.values[f]}else{return e}}},has:function(f){if(this._implementation){return this._implementation.has(f)}else{var e=this.keys.indexOf(f);return e>=0}},remove:function(f){if(this._implementation){return this._implementation["delete"](f)}else{var e=this.keys.indexOf(f);if(e>=0){this.keys.splice(e,1);this.values.splice(e,1)}}return this},clear:function(){if(!this._implementation){this.keys=[];this.values=[]}else{Kekule.error(Kekule.$L("ErrorMsg.CANNOT_CLEAR_WEAKMAP"))}return this},getKeys:function(){if(!this._implementation){return[].concat(this.keys)}else{Kekule.error(Kekule.$L("ErrorMsg.CANNOT_GET_KEY_LIST_IN_WEAKMAP"));return[]}},getValues:function(){if(!this._implementation){return this.values}else{Kekule.error(Kekule.$L("ErrorMsg.CANNOT_GET_VALUE_LIST_IN_WEAKMAP"));return[]}}});Kekule.MapEx._init=function(){if(Kekule.$jsRoot.WeakMap){Kekule.MapEx._implementation=Kekule.$jsRoot.WeakMap}else{Kekule.MapEx._implementation=null}Kekule.MapEx._inited=true};Kekule.MapEx._inited=false;Kekule.TwoTupleMapEx=Class.create({CLASS_NAME:"Kekule.TwoTupleMapEx",initialize:function(e){this.nonWeak=e;this.map=new Kekule.MapEx(e)},finalize:function(){this.map.finalize()},getSecondLevelMap:function(f,g){var e=this.map.get(f);if((!e)&&g){e=new Kekule.MapEx(this.nonWeak);this.map.set(f,e)}return e},set:function(f,e,g){var h=this.getSecondLevelMap(f,true);h.set(e,g);return this},get:function(g,f,e){var h=this.getSecondLevelMap(g,false);if(h){return h.get(f,e)}else{return e}},has:function(f,e){var g=this.getSecondLevelMap(f,false);if(g){return g.has(e)}else{return false}},remove:function(f,e){var g=this.getSecondLevelMap(f,false);if(g){return g.remove(e)}},clear:function(){this.map.clear()}});Kekule.CoordMode={UNKNOWN:0,COORD2D:2,COORD3D:3};Kekule.ClassDefineUtils={CommonSizeMethods:{getSizeOfMode:function(f,e){if(f===Kekule.CoordMode.COORD3D){return this.getSize3D(e)}else{return this.getSize2D(e)}},setSizeOfMode:function(f,e){if(e===Kekule.CoordMode.COORD3D){return this.setSize3D(f)}else{return this.setSize2D(f)}},getBoxOfMode:function(f,e){if(f===Kekule.CoordMode.COORD3D){return this.getBox3D(e)}else{return this.getBox2D(e)}}},Size2DMethods:{fetchSize2D:function(){var e=this.getPropStoreFieldValue("size2D");if(!e){e={};this.setPropStoreFieldValue("size2D",e)}return e},notifySize2DChanged:function(e){this.notifyPropSet("size2D",e)},hasSize2D:function(f){var g=this.getPropStoreFieldValue("size2D");var e=(g)&&((typeof(g.x)!="undefined")||(typeof(g.y)!="undefined"));if((!e)&&f){e=this.hasSize3D?this.hasSize3D():false}return e},getBox2D:function(e){var h=this.getCoord2D(e)||{x:0,y:0};var f=this.getSize2D(e);if(f&&(f.x||f.y)){var i={x:f.x,y:-f.y};var g=Kekule.CoordUtils.add(h,i);return{x1:h.x,y1:h.y,x2:g.x,y2:g.y}}else{return{x1:h.x,y1:h.y,x2:h.x,y2:h.y}}},get2DSizeX:function(e){var f=this.getSize2D(e);return f?f.x||0:0},set2DSizeX:function(e){var f=fetchSize2D();if(f.x!=e){f.x=e;notifySize2DChanged(f)}},get2DSizeY:function(e){var f=this.getSize2D(e);return f?f.y||0:0},set2DSizeY:function(f){var e=fetchSize2D();if(e.y!=f){e.y=f;notifySize2DChanged(e)}}},Size3DMethods:{fetchSize3D:function(){var e=this.getPropStoreFieldValue("size3D");if(!e){e={};this.setPropStoreFieldValue("size3D",e)}return e},notifySize3DChanged:function(e){this.notifyPropSet("size3D",e)},hasSize3D:function(f){var g=this.getPropStoreFieldValue("size3D");var e=(g)&&((typeof(g.x)!=="undefined")||(typeof(g.y)!=="undefined")||(typeof(g.z)!=="undefined"));if((!e)&&f){e=this.hasSize2D?this.hasSize2D():false}return e},getBox3D:function(e){var h=this.getCoord3D(e);var f=this.getSize3D(e);if(h&&f){var g=Kekule.CoordUtils.add(h,f);return{x1:h.x,y1:h.y,z1:h.z,x2:g.x,y2:g.y,z2:g.z}}},get3DSizeX:function(e){var f=this.getSize3D(e);return f?f.x||0:0},set3DSizeX:function(e){var f=fetchSize3D();if(f.x!=e){f.x=e;notifySize3DChanged(f)}},get3DSizeY:function(e){var f=this.getSize3D(e);return f?f.y||0:0},set3DSizeY:function(f){var e=fetchSize3D();if(e.y!=f){e.y=f;notifySize3DChanged(e)}},get3DSizeZ:function(e){var f=this.getSize3D(e);return f?f.z||0:0},set3DSizeZ:function(e){var f=fetchSize3D();if(f.z!=e){f.z=e;notifySize3DChanged(f)}}},addStandardSizeSupport:function(f,e){ClassEx.extend(f,Kekule.ClassDefineUtils.CommonSizeMethods);if((!e)||(e.indexOf("size2D")>=0)){ClassEx.defineProp(f,"size2D",{dataType:DataType.HASH,getter:function(h,i){var j=this.getPropStoreFieldValue("size2D");if((!j)&&h){if(this.hasSize3D()){j=this.getSize3D()}}if((!j)&&i){j={x:0,y:0};this.setPropStoreFieldValue("size2D",j)}var g=j?{x:j.x,y:j.y}:undefined;if(g){g=Kekule.CoordUtils.absValue(g)}return g},setter:function(g){var h=this.fetchSize2D();if(g.x!==undefined){h.x=g.x}if(g.y!==undefined){h.y=g.y}this.notifySize2DChanged(h)}});ClassEx.extend(f,Kekule.ClassDefineUtils.Size2DMethods)}if((!e)||(e.indexOf("size3D")>=0)){ClassEx.defineProp(f,"size3D",{dataType:DataType.HASH,getter:function(h,i){var j=this.getPropStoreFieldValue("size3D");if((!j)&&h){if(this.hasSize2D()){j=this.getSize2D();j.z=0}}if((!j)&&i){j={x:0,y:0,z:0};this.setPropStoreFieldValue("size3D",j)}var g=j?{x:j.x,y:j.y,z:j.z}:undefined;return g},setter:function(g){var h=this.fetchSize3D();if(g.x!==undefined){h.x=g.x}if(g.y!==undefined){h.y=g.y}if(g.z!==undefined){h.z=g.z}this.notifySize3DChanged(h)}});ClassEx.extend(f,Kekule.ClassDefineUtils.Size3DMethods)}},CommonCoordMethods:{getCoordOfMode:function(f,e){if(f===Kekule.CoordMode.COORD3D){return this.getCoord3D(e)}else{return this.getCoord2D(e)}},setCoordOfMode:function(f,e){if(e===Kekule.CoordMode.COORD3D){return this.setCoord3D(f)}else{return this.setCoord2D(f)}},getAbsCoordOfMode:function(f,e){if(f===Kekule.CoordMode.COORD3D){return this.getAbsCoord3D(e)}else{return this.getAbsCoord2D(e)}},setAbsCoordOfMode:function(f,e){if(e===Kekule.CoordMode.COORD3D){return this.setAbsCoord3D(f)}else{return this.setAbsCoord2D(f)}}},Coord2DMethods:{fetchCoord2D:function(){var e=this.getPropStoreFieldValue("coord2D");if(!e){e={};this.setPropStoreFieldValue("coord2D",e)}return e},notifyCoord2DChanged:function(e){this.notifyPropSet("coord2D",e)},hasCoord2D:function(f){var g=this.getPropStoreFieldValue("coord2D");var e=(g)&&((typeof(g.x)!="undefined")||(typeof(g.y)!="undefined"));if((!e)&&f){e=this.hasCoord3D?this.hasCoord3D():false}return e},get2DX:function(e){var f=this.getCoord2D(e);return f?f.x||0:0},set2DX:function(e){var f=this.fetchCoord2D();if(f.x!=e){f.x=e;this.notifyCoord2DChanged(f)}},get2DY:function(e){var f=this.getCoord2D(e);return f?f.y||0:0},set2DY:function(f){var e=this.fetchCoord2D();if(e.y!=f){e.y=f;this.notifyCoord2DChanged(e)}}},Coord3DMethods:{fetchCoord3D:function(){var e=this.getPropStoreFieldValue("coord3D");if(!e){e={};this.setPropStoreFieldValue("coord3D",e)}return e},notifyCoord3DChanged:function(e){this.notifyPropSet("coord3D",e)},hasCoord3D:function(f){var g=this.getPropStoreFieldValue("coord3D");var e=(g)&&((typeof(g.x)!="undefined")||(typeof(g.y)!="undefined")||(typeof(g.z)!="undefined"));if((!e)&&f){e=this.hasCoord2D?this.hasCoord2D():false}return e},get3DX:function(e){var f=this.getCoord3D(e);return f?f.x||0:0},set3DX:function(e){var f=this.fetchCoord3D();if(f.x!=e){f.x=e;this.notifyCoord3DChanged(f)}},get3DY:function(e){var f=this.getCoord3D(e);return f?f.y||0:0},set3DY:function(f){var e=this.fetchCoord3D();if(e.y!=f){e.y=f;this.notifyCoord3DChanged(e)}},get3DZ:function(e){var f=this.getCoord3D(e);return f?f.z||0:0},set3DZ:function(e){var f=this.fetchCoord3D();if(f.z!=e){f.z=e;this.notifyCoord3DChanged(f)}}},addStandardCoordSupport:function(f,e){ClassEx.extend(f,Kekule.ClassDefineUtils.CommonCoordMethods);if((!e)||(e.indexOf("coord2D")>=0)){ClassEx.defineProp(f,"coord2D",{dataType:DataType.HASH,getter:function(h,i){var j=this.getPropStoreFieldValue("coord2D");if((!j)&&h){if(this.hasCoord3D()){j=this.getCoord3D()}}if((!j)&&i){j={x:0,y:0};this.setPropStoreFieldValue("coord2D",j)}var g=j?{x:j.x,y:j.y}:undefined;return g},setter:function(g){var h=this.fetchCoord2D();if(g.x!==undefined){h.x=g.x}if(g.y!==undefined){h.y=g.y}this.notifyCoord2DChanged(h)}});ClassEx.extend(f,Kekule.ClassDefineUtils.Coord2DMethods)}if((!e)||(e.indexOf("coord3D")>=0)){ClassEx.defineProp(f,"coord3D",{dataType:DataType.HASH,getter:function(h,i){var j=this.getPropStoreFieldValue("coord3D");if((!j)&&h){if(this.hasCoord2D()){j=this.getCoord2D();j.z=0}}if((!j)&&i){j={x:0,y:0,z:0};this.setPropStoreFieldValue("coord3D",j)}var g=j?{x:j.x,y:j.y,z:j.z}:undefined;return g},setter:function(g){var h=this.fetchCoord3D();if(g.x!==undefined){h.x=g.x}if(g.y!==undefined){h.y=g.y}if(g.z!==undefined){h.z=g.z}this.notifyCoord3DChanged(h)}});ClassEx.extend(f,Kekule.ClassDefineUtils.Coord3DMethods)}if((!e)||(e.indexOf("absCoord2D")>=0)){ClassEx.defineProp(f,"absCoord2D",{dataType:DataType.HASH,serializable:false,getter:function(h){var j=this.getCoord2D(h)||{};var i=this.getParent?this.getParent():null;var g;if(i&&i.getAbsCoord2D){return Kekule.CoordUtils.add(j,i.getAbsCoord2D(h)||{})}else{return Object.extend({},j)}},setter:function(g){var h=g;if(this.getParent&&this.getParent()&&this.getParent().getAbsCoord2D){h=Kekule.CoordUtils.substract(g,this.getParent().getAbsCoord2D())}this.setCoord2D(h)}})}if((!e)||(e.indexOf("absCoord3D")>=0)){ClassEx.defineProp(f,"absCoord3D",{dataType:DataType.HASH,serializable:false,getter:function(g){var i=this.getCoord3D(g)||{};var h=this.getParent?this.getParent():null;if(h&&h.getAbsCoord3D){return Kekule.CoordUtils.add(i,h.getAbsCoord3D(g)||{})}else{return Object.extend({},i)}},setter:function(g){var h=g;if(this.getParent&&this.getParent()){h=Kekule.CoordUtils.substract(g,this.getParent().getAbsCoord3D())}this.setCoord3D(h)}})}},ExtraObjMapMethods:{getExtraProp:function(g,e){var f=this.getExtraObjMap().get(g);if(f){return e?f[e]:f}else{return undefined}},setExtraProp:function(g,e,h){var f=this.getExtraProp(g);if(f){f[e]=h}else{var f={};f[e]=h;this.getExtraObjMap().set(g,f)}},removeExtraProp:function(g,e){if(e){var f=this.getExtraProp(g);f[e]=undefined;delete f[e]}else{this.getExtraObjMap().remove(g)}}},addExtraObjMapSupport:function(f){var e="extraObjMap";ClassEx.defineProp(f,e,{dataType:"Kekule.MapEx",serializable:false,getter:function(){var g=this.getPropStoreFieldValue(e);if(!g){g=new Kekule.MapEx(true);this.setPropStoreFieldValue(e,g)}return g}});ClassEx.extend(f,Kekule.ClassDefineUtils.ExtraObjMapMethods)},ExtraTwoTupleObjMapMethods:{getExtraProp2:function(h,g,e){var f=this.getExtraTwoTupleObjMap().get(h,g);if(f){return e?f[e]:f}else{return undefined}},setExtraProp2:function(i,g,e,h){var f=this.getExtraProp2(i,g);if(f){f[e]=h}else{var f={};f[e]=h;this.getExtraTwoTupleObjMap().set(i,g,f)}},removeExtraProp2:function(h,g,e){if(e){var f=this.getExtraProp2(h,g);f[e]=undefined;delete f[e]}else{this.getExtraTwoTupleObjMap().remove(h,g)}}},addExtraTwoTupleObjMapSupport:function(f){var e="extraTwoTupleObjMap";ClassEx.defineProp(f,e,{dataType:"Kekule.TwoTupleMapEx",serializable:false,getter:function(){var g=this.getPropStoreFieldValue(e);if(!g){g=new Kekule.TwoTupleMapEx(true);this.setPropStoreFieldValue(e,g)}return g}});ClassEx.extend(f,Kekule.ClassDefineUtils.ExtraTwoTupleObjMapMethods)}};Kekule.ObjPropSettingManager={_items:new Kekule.MapEx(true),register:function(e,f){Kekule.ObjPropSettingManager._items.set(e,f)},unregister:function(e){Kekule.ObjPropSettingManager._items.remove(e)},getSetting:function(e){return Kekule.ObjPropSettingManager._items.get(e)}};ClassEx.defineProp(ObjectEx,"predefinedSetting",{dataType:DataType.STRING,scope:Class.PropertyScope.PUBLIC,setter:function(k){var n=Kekule.StrUtils.splitTokens(k||"",",");if(n.length){for(var g=0,f=n.length;g<f;++g){var j=this.getClass();var m=n[g];var o=null;var e="";while(j&&!o){var h=ClassEx.getClassName(j);var e=h+"."+m;var o=Kekule.ObjPropSettingManager.getSetting(e);j=ClassEx.getSuperClass(j)}if(!o){o=Kekule.ObjPropSettingManager.getSetting(m)}if(o){this.setPropValues(o)}}this.setPropStoreFieldValue("predefinedSetting",e)}}});Kekule.ChemObjInteractMode={DEFAULT:0,HIDDEN:-1};Kekule.ComparisonMethod={DEFAULT:0,PROPERTIES:1,CHEM_STRUCTURE:10};Kekule.ObjComparer={equal:function(g,f,e){return Kekule.ObjComparer.compare(g,f,e)===0},compare:function(g,f,e){return Kekule.ObjComparer._compareValue(g,f,e)},_compareValue:function(p,n,s){var e=DataType;if(p===n){return 0}if(p<n&&!(p>n)){return -1}else{if(p>n&&!(p<n)){return 1}else{var t=null;var j=e.getType(p);var g=e.getType(n);if(j!==g){var r=[e.UNKNOWN,e.VARIANT,e.UNDEFINED,e.BOOL,e.NUMBER,e.INT,e.FLOAT,e.STRING,e.ARRAY,e.FUNCTION,e.DATE,e.OBJECT,e.OBJECTEX,e.CLASS];var m=r.indexOf(j);var k=r.indexOf(g);if(m<0&&k<0){t=null}else{t=m-k}}else{if(!p&&n){t=-1}else{if(p&&!n){t=1}else{if(p.doCompare){t=p.doCompare(n,s)}else{if(n.doCompare){t=-n.doCompare(p,s)}else{if(j===DataType.ARRAY){t=p.length-n.length;if(!t){for(var h=0,f=p.length;h<f;++h){t=Kekule.ObjComparer._compareValue(p[h],n[h],s);if(!!t){break}}}}else{if(j===DataType.OBJECT){var q=JSON.toString(p);var o=JSON.toString(n);t=(q<o)?-1:(q>o)?1:0}else{t=null}}}}}}}if(t===null){var q=(p.toString&&p.toString())||"";var o=(n.toString&&n.toString())||"";t=(q<o)?-1:(q>o)?1:null;if(t===null){t=-1}}return t}}}};Kekule.ChemObject=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ChemObject",initialize:function($super,e){$super();if(e){this.setId(e)}this.setBubbleEvent(true);this.addEventListener("change",function(m){var o=this.getPropStoreFieldValue("srcInfo");if(o&&o.data){var k=m.target;var n=m.changedPropNames;var f=false;for(var j=0,g=n.length;j<g;++j){var h=n[j];if(h&&h!=="srcInfo"&&k.isPropertySerializable(h)){f=true;break}else{if(h==="[children]"){f=true;break}}}if(f){o.data=null}}},this)},doFinalize:function($super){this.removeSelf();$super()},initProperties:function(){this.defineProp("id",{dataType:DataType.STRING});this.defineProp("interactMode",{dataType:DataType.INT});this.defineProp("info",{dataType:DataType.HASH,getter:function(f){var e=this.getPropStoreFieldValue("info");if((!e)&&f){e={};this.setPropStoreFieldValue("info",e)}return e}});this.defineProp("scalarAttribs",{dataType:DataType.ARRAY,setter:null});this.defineProp("parent",{dataType:"Kekule.ChemObject",serializable:false,scope:Class.PropertyScope.PUBLIC,setter:function(f){var e=this.getParent();if(e===f){return}if(e&&e._removeChildObj){e._removeChildObj(this)}this.setPropStoreFieldValue("parent",f);if(f&&f._appendChildObj){f._appendChildObj(this)}this.parentChanged(f)}});this.defineProp("owner",{dataType:"Kekule.ChemSpace",serializable:false,scope:Class.PropertyScope.PUBLIC,setter:function(f){var e=this.getOwner();if(e===f){return}if(e){e._removeOwnedObj(this)}this.setPropStoreFieldValue("owner",f);if(f){f._appendOwnedObj(this)}this.ownerChanged(f)}});this.defineProp("srcInfo",{dataType:DataType.OBJECT,serializable:false,scope:Class.PropertyScope.PUBLISHED,getter:function(){var e=this.getPropStoreFieldValue("srcInfo");if(!e){e={};this.setPropStoreFieldValue("srcInfo",e)}return e}})},getHigherLevelObj:function(){return this.getParent()||this.getOwner()},getAutoIdPrefix:function(){return"o"},isSelectable:function(){return this.getInteractMode()!==Kekule.ChemObjInteractMode.HIDDEN},getNearestSelectableObject:function(){return this.isSelectable()?this:this.getParent()?this.getParent().getNearestSelectableObject():null},removeSelf:function(){this.setParent(null);this.setOwner(null)},notifyScalarAttribsChange:function(){this.notifyPropSet("scalarAttribs",this.getPropStoreFieldValue("scalarAttribs"))},notifyInfoChange:function(){this.notifyPropSet("info",this.getPropStoreFieldValue("info"))},ownerChanged:function(f){for(var g=0,e=this.getScalarAttribCount();g<e;++g){this.getScalarAttribAt(g).setOwner(f)}},parentChanged:function(e){},isChildOf:function(f){var e=this.getParent();while(e&&(e!==f)){e=e.getParent?e.getParent():null}return(!!e)},getNextSibling:function(){var e=this.getParent();if(e&&e.getNextSiblingOfChild){return e.getNextSiblingOfChild(this)}else{return null}},getChildCount:function(){return 0},getChildAt:function(e){return null},indexOfChild:function(e){return -1},cascadeOnChildren:function(g){if(!g){return this}for(var f=0,e=this.getChildCount();f<e;++f){var h=this.getChildAt(f);if(h.cascadeOnChildren){h.cascadeOnChildren(g)}g(h)}return this},cascade:function(e){if(!e){return this}this.cascadeOnChildren(e);e(this);return this},isEmpty:function(){return false},clearIds:function(){this.setId(undefined);for(var f=0,e=this.getChildCount();f<e;++f){var g=this.getChildAt(f);if(g.clearIds){g.clearIds()}}},assignTo:function($super,g,f){var e=$super(g);if(!f&&g.clearIds){g.clearIds()}return e},assign:function(f,e){return f.assignTo(this,e)},clone:function(f){var g=this.getClass();var e=new g();this.assignTo(e,f);return e},getScalarAttribCount:function(){var e=this.getScalarAttribs();return e?e.length:0},getScalarAttribAt:function(f){var e=this.getScalarAttribs();return e?e[f]:null},appendScalarAttrib:function(e){if(!this.getScalarAttribs()){this.setPropStoreFieldValue("scalarAttribs",[])}var f=Kekule.ArrayUtils.pushUniqueEx(this.getScalarAttribs(),e);if(f.isPushed){e.setParent(this);this.notifyScalarAttribsChange()}return f.index},removeScalarAttribAt:function(e){if(!this.getScalarAttribs()){return null}else{var f=Kekule.ArrayUtils.removeAt(this.getScalarAttribs(),e);if(f){f.setParent(null);this.notifyScalarAttribsChange()}return f}},removeScalarAttrib:function(e){if(!this.getScalarAttribs()){return null}else{var f=Kekule.ArrayUtils.remove(this.getScalarAttribs(),e);if(f){f.setParent(null);this.notifyScalarAttribsChange()}return f}},getInfoKeys:function(){return this.getInfo()?Kekule.ObjUtils.getOwnedFieldNames(this.getInfo()):[]},getInfoValue:function(e){return this.getInfo()?this.getInfo()[e]:null},setInfoValue:function(e,f){this.doGetInfo(true)[e]=f;this.notifyInfoChange()},getContainerBox:function(f,e){return null},equal:function(f,e){return this.compare(f,e)===0},compare:function(g,f){if(g===this){return 0}if(!g){return 1}var h=this.doGetActualCompareOptions(f);var e;if(h.customMethod){e=h.customMethod(this,g,h)}else{e=this.doCompare(g,h)}return(e===0)?0:(e<0)?-1:1},doGetActualCompareOptions:function(e){return e||{}},doCompare:function(h,g){if(h===this){return 0}else{var f=this.getClass();var i=h.getClass&&h.getClass();if(f!==i){var j=this.getClassName();var e=(h.getClassName&&h.getClassName())||"";return(j<e)?-1:1}else{return this.doCompareOnProperties(h,g)}}},doCompareOnProperties:function(j,g){var k;if(g.properties){k=g.properties}else{k=this.doGetComparisonPropNames(g);if(!k){k=this.doGetDefaultComparisonPropNames()}}var e=0;for(var h=0,f=k.length;h<f;++h){e=this.doCompareProperty(j,k[h],g);if(e!==0){return e}}return 0},doGetComparisonPropNames:function(e){return null},doGetDefaultComparisonPropNames:function(){var j=[];var h=this.getPropListOfScopes([Class.PropertyScope.PUBLIC,Class.PropertyScope.PUBLISHED]);for(var g=0,f=h.getLength();g<f;++g){var e=h.getPropInfoAt(g);j.push(e.name)}return j},doCompareProperty:function(g,h,f){var i=g.getPropValue&&g.getPropValue(h);var j=this.getPropValue(h);if(j===i){return 0}else{var e=this.doCompareOnValue(j,i,f);return e}},doCompareOnValue:function(g,f,e){return Kekule.ObjComparer._compareValue(g,f,e)}});Kekule.Scalar=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.Scalar",initialize:function($super,h,e,g,f){$super(h);if(e){this.setName(e)}if(typeof(g)!=="undefined"){this.setValue(g)}if(f){this.setUnit(f)}},initProperties:function(){this.defineProp("name",{dataType:DataType.STRING});this.defineProp("value",{dataType:DataType.PRIMARY});this.defineProp("errorValue",{dataType:DataType.PRIMARY});this.defineProp("unit",{dataType:DataType.STRING});this.defineProp("title",{dataType:DataType.STRING})}});Kekule.ChemObjList=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.ChemObjList",initialize:function($super,g,e,f){$super(g);this.setPropStoreFieldValue("itemBaseClass",e);this._transparent=!!f},initProperties:function(){this.defineProp("itemBaseClass",{dataType:DataType.CLASS,serializable:false,scope:Class.PropertyScope.PUBLIC});this.defineProp("items",{dataType:DataType.ARRAY,scope:Class.PropertyScope.PUBLIC,setter:null,getter:function(f){var e=this.getPropStoreFieldValue("items");if((!e)&&f){e=[];this.setPropStoreFieldValue("items",e)}return e}})},loaded:function($super){this.ownerChanged(this.getOwner());this.parentChanged(this.getParent())},ownerChanged:function($super,e){this.changeAllItemsOwner();$super(e)},parentChanged:function($super,e){this.changeAllItemsParent();$super(e)},isEmpty:function(){return result&&(this.getItemCount()<=0)},checkItemType:function(f){var g=this.getItemBaseClass();var e=g?f instanceof g:true;if(!e){Kekule.raise(Kekule.$L("ErrorMsg.LIST_ITEM_CLASS_MISMATCH"))}return e},notifyItemsChange:function(){this.notifyPropSet("items",this.getPropStoreFieldValue("items"))},getItemOwner:function(){return this.getOwner()},changeAllItemsOwner:function(){var g=this.getItems();if(g){var e=this.getItemOwner();for(var h=0,f=g.length;h<f;++h){var j=g[h];if(j&&j.setOwner){j.setOwner(e)}}}},getItemParent:function(){return this._transparent?this.getParent()||this:this},changeAllItemsParent:function(){var f=this.getItems();if(f){var h=this.getItemParent();for(var g=0,e=f.length;g<e;++g){var j=f[g];if(j&&j.setParent){j.setParent(h)}}}},getItemCount:function(){var e=this.getPropStoreFieldValue("items");return e?e.length:0},getItemAt:function(f){var e=this.getPropStoreFieldValue("items");return e?e[f]:null},indexOf:function(f){var e=this.getPropStoreFieldValue("items");return e?e.indexOf(f):-1},getNextSiblingOfChild:function(f){var e=this.indexOf(f);return(e>=0)?this.getItemAt(e+1):null},getChildCount:function(){return this.getItemCount()},getChildAt:function(e){return this.getItemAt(e)},indexOfChild:function(e){return this.indexOf(e)},append:function(f){this.checkItemType(f);if(f){var e=Kekule.ArrayUtils.pushUniqueEx(this.doGetItems(true),f);if(e.isPushed){this.notifyItemsChange();if(f.setOwner){f.setOwner(this.getItemOwner())}if(f.setParent){f.setParent(this.getItemParent())}}return e.index}else{return -1}},insert:function(g,e){this.checkItemType(g);if(g){var f=Kekule.ArrayUtils.insertUniqueEx(this.doGetItems(true),g,e);if(f.isInserted){this.notifyItemsChange();if(g.setOwner){g.setOwner(this.getItemOwner())}if(g.setParent){g.setParent(this.getItemParent())}}return f.index}else{return -1}},insertBefore:function(g,e){if(!e){return this.append(g)}else{var f=this.indexOf(e);return(f>=0)?this.insert(g,f):this.append(g)}},removeAt:function(e){if(this.getItems()){var f=Kekule.ArrayUtils.removeAt(this.getItems(),e);if(f){if(f.setOwner){f.setOwner(null)}if(f.setParent){f.setParent(null)}this.notifyItemsChange()}return f}},remove:function(f){if(this.getItems()){var e=Kekule.ArrayUtils.remove(this.getItems(),f);if(e){if(e.setOwner){e.setOwner(null)}if(e.setParent){e.setParent(null)}this.notifyItemsChange()}return e}},removeChild:function(e){return this.remove(e)},toArray:function(){return this.getItems()},getContainerBox:function(k,g){var e;var m=this.toArray();for(var h=0,f=m.length;h<f;++h){var n=m[h];var j=n.getContainerBox?n.getContainerBox(k,g):null;if(j){if(!e){e=Object.extend({},j)}else{e=Kekule.BoxUtils.getContainerBox(e,j)}}}return e}});Kekule.ChemSpaceElement=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.ChemSpaceElement",initialize:function($super,f){$super(f);var e=new Kekule.ChemObjList(null,Kekule.ChemObject,true);e.setParent(this);e.addEventListener("change",function(){this.objectChange(["children"])},this);this.setPropStoreFieldValue("children",e)},initProperties:function(){this.defineProp("children",{dataType:"Kekule.ChemObjList",scope:Class.PropertyScope.PUBLIC,setter:function(f){var e=this.getChildren();if(e){e.finalize()}if(f){f.setParent(this);f.setOwner(this.getOwner())}this.setPropStoreFieldValue("children",f)}})},ownerChanged:function($super,e){this.getChildren().setOwner(e)},_removeChildObj:function(f){var e=this.indexOfChild(f);if(e>=0){this.removeChildAt(e)}},getChildCount:function(){return this.getChildren().getItemCount()},getChildAt:function(e){return this.getChildren().getItemAt(e)},indexOfChild:function(e){return this.getChildren().indexOf(e)},getNextSiblingOfChild:function(e){return this.getChildren().getNextSiblingOfChild(e)},appendChild:function(e){return this.getChildren().append(e)},insertChild:function(f,e){return this.getChildren().insert(f,e)},insertBefore:function(f,e){return this.getChildren().insertBefore(f,e)},removeChildAt:function(e){return this.getChildren().removeChildAt(e)},removeChild:function(e){return this.getChildren().removeChild(e)}});Kekule.ChemSpace=Class.create(Kekule.ChemObject,{CLASS_NAME:"Kekule.ChemSpace",initialize:function($super,f){$super(f);this._autoIdMap={};this.setPropStoreFieldValue("enableAutoId",true);this.setPropStoreFieldValue("ownedObjs",[]);var e=new Kekule.ChemSpaceElement();this.setPropStoreFieldValue("root",e);e.setParent(this);e.setOwner(this)},initProperties:function(){this.defineProp("ownedObjs",{dataType:DataType.ARRAY,serializable:false,setter:null,scope:Class.PropertyScope.PUBLIC});this.defineProp("root",{dataType:"Kekule.ChemSpaceElement",setter:null});this.defineProp("enableAutoId",{dataType:DataType.BOOL});this.defineProp("objScreenLengthRatio",{dataType:DataType.FLOAT,serializable:false,scope:Class.PropertyScope.PRIVATE});this.defineProp("screenSize",{dataType:DataType.HASH,getter:function(){var e=this.getPropStoreFieldValue("screenSize")||{};return{x:e.x,y:e.y}},setter:function(e){var f=this.getPropStoreFieldValue("screenSize");if(!f){f={};this.setPropStoreFieldValue("screenSize",f)}f.x=e.x;f.y=e.y}})},loaded:function($super){$super();var e=this.getRoot();if(e){e.setParent(this);e.setOwner(this)}},notifyOwnedObjsChange:function(){this.notifyPropSet("ownedObjs",this.getPropStoreFieldValue("ownedObjs"))},getChildren:function(){return this.getRoot().getChildren().toArray()},getChildCount:function(){return this.getRoot().getChildCount()},getChildAt:function(e){return this.getRoot().getChildAt(e)},indexOfChild:function(e){return this.getRoot().indexOfChild(e)},getNextSiblingOfChild:function(e){return this.getRoot().getNextSiblingOfChild(e)},appendChild:function(e){return this.getRoot().appendChild(e)},insertChild:function(f,e){return this.getRoot().insertChild(f,e)},insertBefore:function(f,e){return this.getRoot().insertBefore(f,e)},removeChildAt:function(e){return this.getRoot().removeChildAt(e)},removeChild:function(e){return this.getRoot().removeChild(e)},getObjById:function(h){for(var f=0,e=this.getOwnedObjCount();f<e;++f){var g=this.getOwnedObjAt(f);if(g.getId){if(g.getId()==h){return g}}}return null},getAutoId:function(h,f){var g;if(h){g=h.getAutoIdPrefix?h.getAutoIdPrefix():"o"}else{g="o"}var g=h.getAutoIdPrefix?h.getAutoIdPrefix():"o";var e;if(Kekule.ObjUtils.notUnset(f)){e=f}else{e=this._autoIdMap[g]||0;++e}var e=this._getAutoIdIndex(g,e);this._autoIdMap[g]=e;return g+Number(e).toString()},_getAutoIdIndex:function(g,f){var j=f||0;var e=j;var h=g+Number(e).toString();while(this.getObjById(h)){++e;h=g+Number(e).toString()}return e},assignAutoIdToObj:function(e){if(e.setId){var f=this.getAutoId(e);e.setId(f)}},getOwnedObjCount:function(){return this.getOwnedObjs().length},getOwnedObjAt:function(e){return this.getOwnedObjs()[e]},indexOfOwnedObj:function(e){return this.getOwnedObjs().indexOf(e)},_appendOwnedObj:function(e){if(this.indexOfOwnedObj(e)>=0){return}else{if(this.getEnableAutoId()){if(e.getId&&!e.getId()){this.assignAutoIdToObj(e)}}this.getOwnedObjs().push(e);this.notifyOwnedObjsChange()}},_removeOwnedObjAt:function(e){var f=this.getOwnedObjAt(e);if(f){this.getOwnedObjs().splice(e,1);this.notifyOwnedObjsChange()}},_removeOwnedObj:function(f){var e=this.getOwnedObjs().indexOf(f);if(e>=0){this._removeOwnedObjAt(e)}}});Kekule.ClassDefineUtils.addStandardSizeSupport(Kekule.ChemSpace);Kekule.ChemDocument=Class.create(Kekule.ChemSpace,{CLASS_NAME:"Kekule.ChemDocument",initProperties:function(){}})})();Kekule.ExceptionHandler=Class.create(ObjectEx,{CLASS_NAME:"Kekule.ExceptionHandler",initProperties:function(){this.defineEvent("exceptionThrown")},notifyExceptionThrown:function(b,a){var c={exception:b,level:a};this.invokeEvent("exceptionThrown",c);return c},throwException:function(d,b){var c=Kekule.ExceptionLevel;if(!b){b=c.ERROR}var g=this.notifyExceptionThrown(d,b||c.ERROR);if(!g.stop){if((!b)||(b===c.ERROR)){var a=d;if(typeof(d)==="string"){a=new Kekule.Exception(d)}throw a}else{if(typeof(console)!=="undefined"){if(typeof(d)!=="string"){d=d.message}var f=(b===c.WARNING)?"warn":(b===c.NOTE)?"info":"log";if(f){console[f](d)}else{console.log(d)}}}}},raise:function(b,a){return this.throwException(b,a||Kekule.ExceptionLevel.ERROR)}});Kekule.ExceptionHandler.getInstance=function(){if(!this.instance){this.instance=new Kekule.ExceptionHandler()}return this.instance};Kekule.exceptionHandler=Kekule.ExceptionHandler.getInstance();Kekule.Exception=function(b,a){this.message=b;this.name=a};Kekule.Exception.prototype=new Error();Kekule.Exception.prototype.constructor=Kekule.Exception;Object.extend(Kekule.Exception.prototype,{getMessage:function(){return this.message}});Kekule.Error=function(b,a){this.message=b;this.name=a};Kekule.Error.prototype=Kekule.Exception.prototype;Kekule.Error.prototype.constructor=Kekule.Error;Kekule.ChemError=function(b,a){this.message=b;this.name=a};Kekule.ChemError.prototype=Kekule.Error.prototype;Kekule.ChemError.prototype.constructor=Kekule.ChemError;if(typeof(console)=="undefined"){console={log:function(){},warn:function(){},info:function(){},error:function(){}}}Kekule.oneOf=function(){var b=arguments;var d=Kekule.ObjUtils.notUnset;for(var c=0,a=b.length;c<a;++c){if(d(b[c])){return b[c]}}return null};Kekule.ClassUtils={getShortClassName:function(a){var b=a.indexOf(".");if(b>=0){return a.substring(b+1)}else{return a}},getLastClassName:function(a){var b=a.lastIndexOf(".");return(b>=0)?a.substring(b+1):a},makeSingleton:function(a){return Object.extend(a,{_instance:null,getInstance:function(k,j,i,h,g,f,e,d,c,b){if(!a._instance){a._instance=new a(k,j,i,h,g,f,e,d,c,b)}return a._instance}})}};Kekule.NumUtils={isInteger:function(a){return(typeof(a)==="number")&&(parseInt(a,10)===parseFloat(a))},toDecimals:function(a,e){if(Kekule.NumUtils.isInteger(a)){return a.toString()}var g=Math.pow(10,e);var h=Math.round(a*g);h=h/g;var b=parseInt(h);var d=h-b;var c=d.toString();if(c.length>e+2){c=c.substr(2,e);return b.toString()+"."+c}else{return h.toString()}},isFloatEqual:function(b,c,a){if(Kekule.ObjUtils.isUnset(a)){a=1e-100}return Math.abs(b-c)<=a}};Kekule.ObjUtils={getPrototypeOf:function(a){return Object.getPrototypeOf?Object.getPrototypeOf(a):(a.prototype||a.__proto__)},getOwnedFieldNames:function(c,b){var a=[];for(var d in c){if(c.hasOwnProperty(d)&&(b||typeof(c[d])!="function")){a.push(d)}}return a},replacePropName:function(c,b,a){if(c[b]!==undefined){if(c.hasOwnProperty(b)){c[a]=c[b];delete c[b]}else{Kekule.raise(Kekule.$L("ErrorMsg.NON_OWN_PROPERTY_CANNOT_BE_REPLACED"))}}return c},isUnset:function(a){return(a===null)||(typeof(a)=="undefined")},notUnset:function(a){return(a!==null)&&(typeof(a)!=="undefined")},equal:function(c,a,b){for(var d in c){if(b&&(b.indexOf(d)>=0)){continue}if(c[d]!==a[d]){return false}}return true},match:function(a,c){for(var b in c){if(c.hasOwnProperty(b)){if(a[b]!==c[b]){return false}}}return true},isInstanceOf:function(d,c){if(!DataType.isArrayValue(c)){return(d instanceof c)}else{for(var b=0,a=c.length;b<a;++b){if(d instanceof c[b]){return true}}return false}},getLeafFieldCascadeNames:function(c,b){var d=function(i,g,h,e){for(var j in h){if(h.hasOwnProperty(j)&&(e||typeof(h[j])!="function")){var f=h[j];if(typeof(f)==="object"){d(i,g+j+".",f,e)}else{i.push(g+j)}}}};var a=[];d(a,"",c,b);return a}};Kekule.ArrayUtils={isArray:function(a){if(a){return((typeof(a)=="object")&&(a.length!==undefined))}else{return false}},toArray:function(a){if(Kekule.ArrayUtils.isArray(a)){return a}else{return[a]}},clone:function(a){return a.slice(0)},divide:function(g,c){var a=[];var e=[];var f=0;for(var d=0,b=g.length;d<b;++d){e.push(g[d]);++f;if(f>=c){a.push(e);e=[];f=0}}if(e.length){a.push(e)}return a},pushUnique:function(c,b){var a=Kekule.ArrayUtils.pushUniqueEx(c,b);return a?a.index:null},pushUniqueEx:function(f,e){if(DataType.isArrayValue(e)){var d;for(var c=0,a=e.length;c<a;++c){if(Kekule.ObjUtils.isUnset(d)){d=Kekule.ArrayUtils.pushUniqueEx(f,e[c])}else{Kekule.ArrayUtils.pushUniqueEx(f,e[c])}}return d}else{if(!e){return{index:-1,isPushed:false}}var b=f.indexOf(e);if(b<0){return{index:f.push(e),isPushed:true}}else{return{index:b,isPushed:false}}}},insertUnique:function(c,b,a){return Kekule.ArrayUtils.insertUniqueEx(c,b,a).index},insertUniqueEx:function(d,c,a){if(!c){return{index:-1,isInserted:false}}if(Kekule.ObjUtils.isUnset(a)||(a<0)){a=d.length}var b=d.indexOf(c);if(b<0){d.splice(a,0,c);return{index:a,isInserted:true}}else{if(b!=a){d.splice(b,1);d.splice(a,0,c);return{index:a,isInserted:false}}}},removeAt:function(c,a){var b=c[a];if(typeof(b)!="undefined"){c.splice(a,1);return b}else{return null}},remove:function(d,c,b){var a=d.indexOf(c);if(a>=0){Kekule.ArrayUtils.removeAt(d,a);if(b){Kekule.ArrayUtils.remove(d,c,b)}return c}else{return null}},replace:function(e,b,c,a){var d=e.indexOf(b);if(d>=0){e[d]=c;if(a){Kekule.ArrayUtils.replace(e,b,c,a)}return b}else{return null}},changeIndex:function(c,d,a){if((d>=0)&&(d<=c.length)){var b=c[d];c.splice(d,1);c.splice(a,0,b);return b}else{return null}},changeItemIndex:function(d,c,b){var a=d.indexOf(c);return Kekule.ArrayUtils.changeIndex(d,a,b)},toUnique:function(f){var c=[];for(var g=0,d=f.length;g<d;++g){var h=f[g];if(c.indexOf(h)<0){c.push(h)}}return c},getUniqueElemCount:function(d){var c=Kekule.ArrayUtils.toUnique(d);return c.length},reverse:function(d){var b=[];for(var e=0,c=d.length;e<c;++e){if(Kekule.ObjUtils.notUnset(d[e])){b[c-e-1]=d[e]}}return b},randomize:function(d){if(!d){return null}if(!d.length){return[]}var a=[];var c=d.slice(0);while(c.length>1){var b=Math.round(Math.random()*(c.length-1));a.push(c.splice(b,1)[0])}a.push(c[0]);return a},exclude:function(f,g){var a=[];var e=Kekule.ArrayUtils.toArray(g);for(var c=0,b=f.length;c<b;++c){var d=f[c];if(e.indexOf(d)<0){a.push(d)}}return a},intersect:function(d,b){var a=[];for(var e=0,c=d.length;e<c;++e){if(b.indexOf(d[e])>=0){a.push(d[e])}}return a},compare:function(d,a,g){if(!g){g=function(j,i){return(j>i)?1:(j<i)?-1:0}}var c=Math.min(d.length,a.length);for(var h=0;h<c;++h){var e=d[h];var b=a[h];var f=g(e,b);if(f!==0){return f}}if(d.length>c){return 1}else{if(a.length>c){return -1}else{return 0}}},compareNestedArray:function(c,b,a){var d=Math.min(c.length,b.length);if(!a){a=function(m,l){return m-l}}for(var e=0;e<d;++e){var k=0;var g=c[e];var f=b[e];var j=DataType.isArrayValue(g);var h=DataType.isArrayValue(f);if(j&&h){k=Kekule.ArrayUtils.compareNestedArray(g,f,a)}else{if(j){k=1}else{if(h){k=-1}else{k=a(g,f)}}}if(k!=0){return k}}if(c.length>d){return 1}else{if(b.length>d){return -1}else{return 0}}},group:function(e,a){if(!a){a=function(k,i){return(k<i)?-1:(k>i)?1:0}}var g=Kekule.ArrayUtils.clone(e);g.sort(a);var j=[];var b;for(var d=0,c=g.length;d<c;++d){var h=g[d];if(b&&a(h,b)===0){var f=j.length?j[j.length-1]:null;if(!Kekule.ArrayUtils.isArray(f)){j.pop();f=[b];j.push(f)}f.push(h)}else{j.push(h)}b=h}return j},getMedian:function(b){var d=[].concat(b);var c=d.length;if(c===0){return null}if(c<=1){return d[0]}else{d.sort(function(f,e){return f-e});return(c%2)?d[(c+1)>>1]:(d[c>>1]+d[(c>>1)-1])/2}},sortHashArray:function(g,c){var d="!";var e=[];for(var f=0,b=c.length;f<b;++f){var a={};var h=c[f]||"";if(h.startsWith(d)){a.field=h.substr(1);a.desc=true}else{a.field=h;a.desc=false}e.push(a)}var j=function(r,p){var k=0;for(var n=0,m=e.length;n<m;++n){var o=e[n].field;var s=r[o]||"";var q=p[o]||"";k=(s>q)?1:(s<q)?-1:0;if(e[n].desc){k=-k}if(k!==0){break}}return k};g.sort(j);return g}};Kekule.StrUtils={STR_TRUES:["true","yes","t","y"],STR_FALSES:["false","no","f","n"],trim:function(a){return a.replace(/^\s*|\s*$/g,"")},normalizeSpace:function(a){return a.replace(/^\s*|\s(?=\s)|\s*$/g,"")},convertToStr:function(a){return""+a},convertToType:function(a,b){if(typeof(a)!="string"){return a}switch(b){case DataType.FLOAT:case DataType.NUMBER:return parseFloat(a);break;case DataType.INT:return parseInt(a);break;case DataType.BOOL:return Kekule.StrUtils.strToBool(a);break;default:return a}},boolToStr:function(a){if(a){return Kekule.StrUtils.STR_TRUES[0]}else{return Kekule.StrUtils.STR_FALSES[0]}},strToBool:function(d){var b=d.toLowerCase();for(var c=0,a=Kekule.StrUtils.STR_FALSES.length;c<a;++c){if(b==Kekule.StrUtils.STR_FALSES[c]){return false}}return !!d},removeAroundPair:function(c,b,a){if(c.startsWith(b)&&c.endsWith(a)){return c.substring(b.length,c.length-b.length-a.length+1)}else{return c}},unquote:function(c){var b=Kekule.StrUtils.removeAroundPair;var a=c;a=b(a,"'","'");a=b(a,'"','"');return a},splitTokens:function(c,b){if(!c){return[]}if(DataType.isArrayValue(c)){return c}else{var a=b?new RegExp(b,"g"):/\s+/g;return c.split(a)}},hasToken:function(d,a,c){var b=Kekule.StrUtils.splitTokens(d,c);return(b.indexOf(a)>=0)},addTokens:function(g,e,d){var c=Kekule.StrUtils.splitTokens(g,d);var f=Kekule.StrUtils.splitTokens(e,d);for(var b=0,a=f.length;b<a;++b){if(c.indexOf(f[b])<0){c.push(f[b])}}return c.join(d||" ")},removeTokens:function(h,g,f){var e=Kekule.StrUtils.splitTokens(h,f);var d=Kekule.StrUtils.splitTokens(g,f);for(var c=0,a=d.length;c<a;++c){var b=e.indexOf(d[c]);if(b>=0){e.splice(b,1)}}return e.join(f||" ")},toggleTokens:function(g,h,d){var f=Kekule.StrUtils.splitTokens(g,d);var a=Kekule.StrUtils.splitTokens(h,d);var j=[];for(var c=0,b=a.length;c<b;++c){var e=f.indexOf(a[c]);if(e>=0){f.splice(e,1)}else{j.push(a[c])}}f=f.concat(j);return f.join(d||" ")},getLineCount:function(c,b){if(!b){b="\n"}var a=c.split(b);return a.length},getMaxLineCharCount:function(g,f){if(!f){f="\n"}var d=g.split(f);var a=0;for(var e=0,c=d.length;e<c;++e){var b=d[e];a=Math.max(b.length,a)}return a}};Kekule.RoleMapUtils={KEY_ITEM:"item",KEY_ROLE:"role",NON_EXPLICIT_ROLE:null,createMap:function(b,c){var a={};c=c||Kekule.RoleMapUtils.NON_EXPLICIT_ROLE;a[Kekule.RoleMapUtils.KEY_ITEM]=b;a[Kekule.RoleMapUtils.KEY_ROLE]=c;return a},getItem:function(a){return a[Kekule.RoleMapUtils.KEY_ITEM]},setItem:function(b,a){b[Kekule.RoleMapUtils.KEY_ITEM]=a},getRole:function(a){return a[Kekule.RoleMapUtils.KEY_ROLE]},setRole:function(a,b){a[Kekule.RoleMapUtils.KEY_ROLE]=b}};Kekule.FactoryUtils={MATCH_EXACTLY:0,MATCH_BY_CLASS:1,DEF_ITEM_STORE_FIELD_NAME:"_items",createSimpleFactory:function(b){var c=Kekule.FactoryUtils;var a={_items:new Kekule.MapEx(true),_matchMethod:b||Kekule.FactoryUtils.MATCH_EXACTLY,register:function(d,e){a._items.set(d,e)},unregister:function(d){a._items.remove(d)},getClass:function(d){if(a._matchMethod===c.MATCH_EXACTLY){return a._items.get(d)}else{if(a._matchMethod===c.MATCH_BY_CLASS){var f=a._items.get(d);if(!f){var e=ClassEx.getSuperClass(d);if(e){f=a.getClass(e)}}return f}}},getInstance:function(m,n,l,j,i,h,g,f,e,d){var k=a.getClass(m);if(k){return new k(n,l,j,i,h,g,f,e,d)}}};return a}};Kekule.UrlUtils={EXT_DELIMITER:".",PATH_DELIMITER:"/",SEARCH_DELIMITER:"?",SEARCH_PAIR_DELIMITER:"&",KEY_VALUE_DELIMITER:"=",HASH_DELIMITER:"#",extractFileName:function(a){if(!a){return null}var b=a.lastIndexOf(Kekule.UrlUtils.PATH_DELIMITER);if(b>=0){return a.substr(b+1)}else{return a}},extractFileExt:function(a){var c=Kekule.UrlUtils.extractFileName(a);if(c){var b=c.lastIndexOf(Kekule.UrlUtils.EXT_DELIMITER);if(b>=0){return c.substr(b+1)}else{return""}}else{return null}},extractFileCoreName:function(a){var c=Kekule.UrlUtils.extractFileName(a);if(c){var b=c.lastIndexOf(Kekule.UrlUtils.EXT_DELIMITER);if(b>=0){return c.substr(0,b)}else{return""}}else{return null}},extractSearch:function(a){if(!a){return null}var b=a.lastIndexOf(Kekule.UrlUtils.SEARCH_DELIMITER);if(b>=0){return a.substr(b)}else{return null}},analysisSearch:function(b,e){var j=Kekule.UrlUtils.extractSearch(b)||"";j=j.substr(1);var c=j.split(Kekule.UrlUtils.SEARCH_PAIR_DELIMITER);var k=e?{}:[];for(var g=0,d=c.length;g<d;++g){var f=c[g];var h=f.split(Kekule.UrlUtils.KEY_VALUE_DELIMITER);if(h[0]){if(e){k[h[0]]=h[1]}else{k.push({key:h[0],value:h[1]})}}}return k},generateSearchString:function(h){var b=Kekule.UrlUtils;var g=[];var e=Kekule.ObjUtils.getOwnedFieldNames(h);for(var d=0,a=e.length;d<a;++d){var c=e[d];var f=h[c];if(Kekule.ObjUtils.notUnset(f)){var f=encodeURIComponent(""+f);g.push(c+b.KEY_VALUE_DELIMITER+f)}}return g.join(b.SEARCH_PAIR_DELIMITER)},generateUrl:function(d,f,e){var c=Kekule.UrlUtils;var b=d;if(f){var a=c.generateSearchString(f);b+=c.SEARCH_DELIMITER+a}if(e){b+=c.HASH_DELIMITER+e}return b}};Kekule.MatrixUtils={create:function(n,q,h){var s=false;var p=false;var o=Kekule.ObjUtils;if(o.notUnset(h)){s=true;if(Kekule.ArrayUtils.isArray(h)){p=true}}var g=0;var b=new Array(n);for(var f=0,c=b.length;f<c;++f){var a=new Array(q);if(s){for(var e=0,d=a.length;e<d;++e){if(p&&o.notUnset(h[g])){a[e]=h[g];++g}else{a[e]=h}}}b[f]=a}return b},createIdentity:function(b){var a=Kekule.MatrixUtils.create(b,b,0);for(var c=0;c<b-1;++c){a[c][c]=1}return a},getRowCount:function(a){return a.length},getColCount:function(a){return(Kekule.MatrixUtils.getRowCount(a)>0)?a[0].length:0},getValue:function(a,c,b){return a[c-1][b-1]||0},setValue:function(a,d,b,c){a[d-1][b-1]=c},transpose:function(b){var h=Kekule.MatrixUtils;var c=h.getColCount(b);var g=h.getRowCount(b);var a=h.create(c,g);for(var e=1;e<=c;++e){var f=a[e-1];for(var d=1;d<=g;++d){f[d-1]=h.getValue(b,d,e)}}return a},minus:function(g){var e=Kekule.MatrixUtils;var f=e.getRowCount(g);var h=e.getColCount(g);var k=this.create(f,h);for(var d=0;d<f;++d){var a=k[d];var b=g[d];for(var c=0;c<h;++c){a[c]=-(b[c]||0)}}},add:function(e,c){var h=Kekule.MatrixUtils;var b=h.getRowCount(e);var g=h.getColCount(e);var a=this.create(b,g);for(var f=1;f<=b;++f){for(var d=1;d<=g;++d){h.setValue(a,f,d,h.getValue(e,f,d)+h.getValue(c,f,d))}}return a},substract:function(b,a){var c=Kekule.MatrixUtils;return c.add(b,c.minus(a))},multiply:function(l,h){var e=Kekule.MatrixUtils;var f=e.getRowCount(l);var g=e.getColCount(h);var m=e.create(f,g);for(var c=1;c<=f;++c){for(var b=1;b<=g;++b){var d=0;for(var a=1;a<=f;++a){d+=e.getValue(l,c,a)*e.getValue(h,a,b)}e.setValue(m,c,b,d)}}return m}};Kekule.CoordUtils={create:function(b,d,c){var a={x:b,y:d};if(c||(c===0)){a.z=c}return a},is3D:function(a){return(a.z||(a.z===0))},isEqual:function(c,b){var a=(c.x===b.x)&&(c.y===b.y);var d=Kekule.ObjUtils;if(a&&(d.notUnset(c.z)||d.notUnset(b.z))){a=(c.z===b.z)}return a},isZero:function(c,b){var a=Kekule.ObjUtils.notUnset(b)?b:0;return(Math.abs(c.x||0)<=a)&&(Math.abs(c.y||0)<=a)&&(Math.abs(c.z||0)<=a)},absValue:function(b){if(b){var a={};if(!Kekule.ObjUtils.isUnset(b.x)){a.x=Math.abs(b.x)}if(!Kekule.ObjUtils.isUnset(b.y)){a.y=Math.abs(b.y)}if(!Kekule.ObjUtils.isUnset(b.z)){a.z=Math.abs(b.z)}return a}},add:function(c,b){var a={};if(!(Kekule.ObjUtils.isUnset(c.x)&&(Kekule.ObjUtils.isUnset(b.x)))){a.x=(c.x||0)+(b.x||0)}if(!(Kekule.ObjUtils.isUnset(c.y)&&(Kekule.ObjUtils.isUnset(b.y)))){a.y=(c.y||0)+(b.y||0)}if(!(Kekule.ObjUtils.isUnset(c.z)&&(Kekule.ObjUtils.isUnset(b.z)))){a.z=(c.z||0)+(b.z||0)}return a},substract:function(c,b){var a={};if(!(Kekule.ObjUtils.isUnset(c.x)&&(Kekule.ObjUtils.isUnset(b.x)))){a.x=(c.x||0)-(b.x||0)}if(!(Kekule.ObjUtils.isUnset(c.y)&&(Kekule.ObjUtils.isUnset(b.y)))){a.y=(c.y||0)-(b.y||0)}if(!(Kekule.ObjUtils.isUnset(c.z)&&(Kekule.ObjUtils.isUnset(b.z)))){a.z=(c.z||0)-(b.z||0)}return a},multiply:function(c,b){var a={};if(!Kekule.ObjUtils.isUnset(c.x)){a.x=c.x*b}if(!Kekule.ObjUtils.isUnset(c.y)){a.y=c.y*b}if(!Kekule.ObjUtils.isUnset(c.z)){a.z=c.z*b}return a},divide:function(b,a){return Kekule.CoordUtils.multiply(b,1/a)},standardize:function(b){var a=Math.sqrt(Math.sqr(b.x||0)+Math.sqr(b.y||0)+Math.sqr(b.z||0));return Kekule.CoordUtils.divide(b,a)},toArray:function(b){var a=[];a.push(b.x,b.y);if(Kekule.CoordUtils.is3D(b)){a.push(b.z)}},transform2D:function(d,c){var b=Kekule.CoordUtils.calcTransform2DMatrix(c);var a=Kekule.CoordUtils.transform2DByMatrix(d,b);return a},inverseTransform2D:function(d,c){var b=Kekule.CoordUtils.calcInverseTransform2DMatrix(c);var a=Kekule.CoordUtils.transform2DByMatrix(d,b);return a},transform2DByMatrix:function(d,b){var c=Kekule.MatrixUtils;var a=c.create(3,1,[d.x||0,d.y||0,1]);a=c.multiply(b,a);return{x:a[0][0],y:a[1][0]}},calcTransform2DMatrix:function(c,d){var i=Kekule.MatrixUtils;var j=c||{};var p=j.center;if(p){var q=i.create(3,3,[1,0,-(p.x||0),0,1,-(p.y||0),0,0,1]);var h=i.create(3,3,[1,0,(p.x||0),0,1,(p.y||0),0,0,1])}if(j.rotateAngle){var r=j.rotateAngle;var o=Math.cos(r);var f=Math.sin(r);var b=i.create(3,3,[o,-f,0,f,o,0,0,0,1])}var t=j.scale;var n=j.scaleX;var m=j.scaleY;var l=t||1;if(t||n||m){var e=i.create(3,3);i.setValue(e,1,1,n||l);i.setValue(e,2,2,m||l);i.setValue(e,3,3,1)}var u=j.translateX;var s=j.translateY;if(u||s){var k=i.create(3,3);i.setValue(k,1,1,1);i.setValue(k,2,2,1);i.setValue(k,3,3,1);i.setValue(k,1,3,(u||0));i.setValue(k,2,3,(s||0))}var g=i.create(3,3,[1,0,0,0,1,0,0,0,1]);if(!d){if(q){g=i.multiply(q,g)}if(b){g=i.multiply(b,g)}if(e){g=i.multiply(e,g)}if(k){g=i.multiply(k,g)}if(h){g=i.multiply(h,g)}}else{if(q){g=i.multiply(q,g)}if(k){g=i.multiply(k,g)}if(e){g=i.multiply(e,g)}if(b){g=i.multiply(b,g)}if(h){g=i.multiply(h,g)}}return g},calcInverseTransform2DMatrix:function(a){var b=Object.create(a);if(a.center){b.center={x:a.center.x,y:a.center.y}}if(b.scale){b.scale=1/b.scale}if(b.scaleX){b.scaleX=1/b.scaleX}if(b.scaleY){b.scaleY=1/b.scaleY}if(b.translateX){b.translateX=-b.translateX}if(b.translateY){b.translateY=-b.translateY}if(b.rotateAngle){b.rotateAngle=-b.rotateAngle}return Kekule.CoordUtils.calcTransform2DMatrix(b,true)},transform3D:function(c,b){var a=Kekule.CoordUtils.calcTransform3DMatrix(b);return Kekule.CoordUtils.transform3DByMatrix(c,a)},transform3DByMatrix:function(d,b){var c=Kekule.MatrixUtils;var a=c.create(4,1,[d.x||0,d.y||0,d.z||0,1]);a=c.multiply(b,a);return{x:a[0][0],y:a[1][0],z:a[2][0]}},_calcRotateXYZ3DMatrixCore:function(b){var m=Kekule.MatrixUtils;var o=m.create(4,4,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);var q=[];if(b.rotateAngle&&b.rotateAxisVector){var n=Kekule.CoordUtils.standardize(b.rotateAxisVector);q.push({vector:[n.x,n.y,n.z],angle:-b.rotateAngle})}else{var f=b.rotateX;var e=b.rotateY;var d=b.rotateZ;if(f){q.push({vector:[1,0,0],angle:-f})}if(e){q.push({vector:[0,1,0],angle:-e})}if(d){q.push({vector:[0,0,1],angle:-d})}}for(var u=0,r=q.length;u<r;++u){var a=m.create(4,4);var w=q[u].angle;var g=q[u].vector;var x=Math.cos(w);var c=Math.sin(w);var p;for(var u=1;u<=4;++u){for(var t=1;t<=4;++t){if((u<4)&&(t<4)){for(var s=1;s<=3;++s){if((s!==u)&&(s!==t)){break}}var h=g[u-1]*g[t-1];p=(u<t)?h*(1-x)-Math.pow(-1,u+t)*g[s-1]*c:(u>t)?h*(1-x)+Math.pow(-1,u+t)*g[s-1]*c:h+(1-h)*x}else{if(u===t){p=1}else{p=0}}m.setValue(a,u,t,p)}}o=m.multiply(a,o)}return o},calcRotate3DMatrix:function(d){var g=Kekule.MatrixUtils;var f=Object.extend({},d||{});var e;if(f.rotateMatrix){e=f.rotateMatrix}else{var a=f.center;if(a){var b=g.create(4,4,[1,0,0,-(a.x||0),0,1,0,-(a.y||0),0,0,1,-(a.z||0),0,0,0,1]);var c=g.create(4,4,[1,0,0,(a.x||0),0,1,0,(a.y||0),0,0,1,(a.z||0),0,0,0,1])}var e=Kekule.CoordUtils._calcRotateXYZ3DMatrixCore(d);if(b){e=g.multiply(b,e)}if(c){e=g.multiply(c,e)}}return e},calcTransform3DMatrix:function(b){var g=Kekule.MatrixUtils;var h=b||{};var o=h.center;if(o){var p=g.create(4,4,[1,0,0,-(o.x||0),0,1,0,-(o.y||0),0,0,1,-(o.z||0),0,0,0,1]);var e=g.create(4,4,[1,0,0,(o.x||0),0,1,0,(o.y||0),0,0,1,(o.z||0),0,0,0,1])}var f=["rotateX","rotateY","rotateZ","rotateAngle","rotateAxisVector","rotateMatrix"];var k=Object.copyValues({},h,f);var a=Kekule.CoordUtils.calcRotate3DMatrix(k);var r=h.scale;var n=h.scaleX;var m=h.scaleY;var l=h.scaleZ;if(r||n||m||l){var j=r||1;var c=g.create(4,4);g.setValue(c,1,1,n||j);g.setValue(c,2,2,m||j);g.setValue(c,3,3,l||j);g.setValue(c,4,4,1)}var t=h.translateX;var s=h.translateY;var q=h.translateZ;if(t||s||q){var i=g.create(4,4);g.setValue(i,1,1,1);g.setValue(i,2,2,1);g.setValue(i,3,3,1);g.setValue(i,4,4,1);g.setValue(i,1,4,t||0);g.setValue(i,2,4,s||0);g.setValue(i,3,4,q||0)}var d=g.create(4,4,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);if(p){d=g.multiply(p,d)}if(a){d=g.multiply(a,d)}if(c){d=g.multiply(c,d)}if(i){d=g.multiply(i,d)}if(e){d=g.multiply(e,d)}return d},calcInverseTransform3DMatrix:function(a){var b=Object.create(a);if(a.center){b.center={x:a.center.x,y:a.center.y,z:a.center.z}}if(b.scale){b.scale=1/b.scale}if(b.scaleX){b.scaleX=1/b.scaleX}if(b.scaleY){b.scaleY=1/b.scaleY}if(b.scaleZ){b.scaleZ=1/b.scaleZ}if(b.translateX){b.translateX=-b.translateX}if(b.translateY){b.translateY=-b.translateY}if(b.translateZ){b.translateZ=-b.translateZ}if(b.rotateAngle){b.rotateAngle=-b.rotateAngle}if(b.rotateX){b.rotateX=-b.rotateX}if(b.rotateX){b.rotateY=-b.rotateY}if(b.rotateZ){b.rotateZ=-b.rotateZ}return Kekule.CoordUtils.calcTransform3DMatrix(b,true)},calcCoordGroup2DTransformParams:function(e,c,l,k){var m=Kekule.CoordUtils;var d=m.getDistance(e,c);var i=m.substract(c,e);var g=Math.atan2(i.y,i.x);var f=m.getDistance(l,k);var b=m.substract(k,l);var h=Math.atan2(b.y,b.x);var a=m.substract(l,e);var j={translateX:a.x,translateY:a.y,scale:f/d,rotateAngle:h-g,center:e};return j},getDistance:function(c,b){if(!b){b={x:0,y:0,z:0}}var a=Math.sqr(b.x-c.x)+Math.sqr(b.y-c.y);if(Kekule.ObjUtils.notUnset(c.z)&&Kekule.ObjUtils.notUnset(b.z)){a+=Math.sqr(b.z-c.z)}return Math.sqrt(a)},getCenter:function(d){var c=d.length;if(c<=0){return null}var b=Object.extend(d[0]);for(var a=1;a<c;++a){b=Kekule.CoordUtils.add(b,d[a])}return Kekule.CoordUtils.divide(b,c)},insideRect:function(c,a,b){return((c.x-a.x)*(c.x-b.x)<=0)&&((c.y-a.y)*(c.y-b.y)<=0)},isInsideBox:function(e,d){var c=d;var a=(Math.sign(e.x-c.x1)*Math.sign(e.x-c.x2)<=0)&&(Math.sign(e.y-c.y1)*Math.sign(e.y-c.y2)<=0);if(Kekule.ObjUtils.notUnset(e.z)){a=a&&(Math.sign(e.z-c.z1)*Math.sign(e.z-c.z2)<=0)}return a},getContainerBox:function(d){var f={};var a={};var b=d.length;if(b>0){f=Object.extend({},d[0]);a=Object.extend({},d[0])}else{return null}for(var c=1;c<b;++c){var e=d[c];f.x=Math.min(f.x,e.x);f.y=Math.min(f.y,e.y);a.x=Math.max(a.x,e.x);a.y=Math.max(a.y,e.y);if(Kekule.ObjUtils.notUnset(f.z)){f.z=Math.min(f.z,e.z);a.z=Math.max(a.z,e.z)}}return Kekule.BoxUtils.createBox(f,a)}};Kekule.GeometryUtils={getVectorScalarProduct:function(c,b){var a=(c.x||0)*(b.x||0)+(c.y||0)*(b.y||0)+(c.z||0)*(b.z||0);return a},getVectorCrossProduct:function(c,b){var a={x:(c.y||0)*(b.z||0)-(c.z||0)*(b.y||0),y:(c.z||0)*(b.x||0)-(c.x||0)*(b.z||0),z:(c.x||0)*(b.y||0)-(c.y||0)*(b.x||0)};return a},getVectorIncludedAngle:function(e,d){var c=Kekule.CoordUtils;var h=Kekule.GeometryUtils.getVectorCrossProduct(e,d);var g={x:0,y:0,z:0};var b=(c.getDistance(e,g)*c.getDistance(d,g));var f=c.getDistance(h,g)/b;var a=Math.asin(f);return a},getDihedralAngleOfVectors:function(j,i,g){var m=Kekule.CoordUtils;var b=Kekule.GeometryUtils;var k=b.getVectorCrossProduct(j,i);var a=b.getVectorCrossProduct(i,g);var e=m.getDistance(i)/100000;if(m.isZero(k,e)||m.isZero(a,e)){return -1}var c=m.standardize(i);var f=b.getVectorScalarProduct(b.getVectorCrossProduct(k,a),c);var h=b.getVectorScalarProduct(k,a);var l=Math.atan2(f,h);if(l<0){l+=Math.PI*2}return l},getDihedralAngleOfPoints:function(e,d,b,a){var c=Kekule.CoordUtils;var h=c.substract(d,e);var g=c.substract(b,d);var f=c.substract(a,b);return Kekule.GeometryUtils.getDihedralAngleOfVectors(h,g,f)}};Kekule.BoxUtils={createBox:function(g,f){var a={};var c=g.x||0;var e=g.y||0;var b=f.x||0;var d=f.y||0;(c<=b)?(a.x1=c,a.x2=b):(a.x1=b,a.x2=c);(e<=d)?(a.y1=e,a.y2=d):(a.y1=d,a.y2=e);if(Kekule.ObjUtils.notUnset(g.z)&&Kekule.ObjUtils.notUnset(f.z)){(g.z<=f.z)?(a.z1=g.z,a.z2=f.z):(a.z1=f.z,a.z2=g.z)}return a},convertToRect:function(c){var a=Kekule.BoxUtils.normalize(c);return Kekule.RectUtils.createRect(a.x1,a.y1,a.x2-a.x1,a.y2-a.y1)},normalize:function(b){var a={x1:Math.min(b.x1,b.x2),y1:Math.min(b.y1,b.y2),x2:Math.max(b.x1,b.x2),y2:Math.max(b.y1,b.y2)};if(Kekule.ObjUtils.notUnset(b.z1)&&Kekule.ObjUtils.notUnset(b.z2)){a.z1=Math.min(b.z1,b.z2);a.z2=Math.max(b.z1,b.z2)}return a},shiftBox:function(d,c,b,a){var j=c||0;var h=b||0;var g=a||0;var f={x:d.x1+j,y:d.y1+h};var e={x:d.x2+j,y:d.y2+h};if(Kekule.ObjUtils.notUnset(d.z1)&&Kekule.ObjUtils.notUnset(d.z2)){f.z=d.z1+g;e.z=d.z2+g}var i=Kekule.BoxUtils.createBox(f,e);return i},inflateBox:function(c,e,d,b){if(Kekule.ObjUtils.isUnset(d)){d=e}if(Kekule.ObjUtils.isUnset(b)){b=e}var a=Kekule.BoxUtils.normalize(c);var a={x1:a.x1-e,y1:a.y1-d,x2:a.x2+e,y2:a.y2+d};if(Kekule.ObjUtils.notUnset(a.z1)&&Kekule.ObjUtils.notUnset(a.z2)){a.z1=a.z1-b;a.z2=a.z2+b}return a},getContainerBox:function(d,b){if(!d){return Object.extend({},b)}else{if(!b){return Object.extend({},d)}}var e=Kekule.BoxUtils.normalize(d);var c=Kekule.BoxUtils.normalize(b);var a={x1:Math.min(e.x1,c.x1),y1:Math.min(e.y1,c.y1),x2:Math.max(e.x2,c.x2),y2:Math.max(e.y2,c.y2)};if(Kekule.ObjUtils.notUnset(e.z1)&&Kekule.ObjUtils.notUnset(e.z2)&&Kekule.ObjUtils.notUnset(c.z1)&&Kekule.ObjUtils.notUnset(c.z2)){a.z1=Math.min(e.z1,c.z1);a.z2=Math.max(e.z2,c.z2)}return a},getIntersection:function(c,a){var d=Kekule.BoxUtils.normalize(c);var b=Kekule.BoxUtils.normalize(a);var e={x1:Math.max(d.x1,b.x1),y1:Math.max(d.y1,b.y1),x2:Math.min(d.x2,b.x2),y2:Math.max(d.y2,b.y2)};if((e.x1>=e.x2)||(e.y1>=e.y2)){return null}if(Kekule.ObjUtils.notUnset(d.z1)&&Kekule.ObjUtils.notUnset(d.z2)&&Kekule.ObjUtils.notUnset(b.z1)&&Kekule.ObjUtils.notUnset(b.z2)){e.z1=Math.max(d.z1,b.z1);e.z2=Math.min(d.z2,b.z2);if(e.z1>=e.z2){return null}}return e},hasIntersection:function(b,a){return !!Kekule.BoxUtils.getIntersection(b,a)},isEqual:function(b,a){return(Math.min(b.x1,b.x2)===Math.min(a.x1,a.x2))&&(Math.max(b.x1,b.x2)===Math.max(a.x1,a.x2))&&(Math.min(b.y1,b.y2)===Math.min(a.y1,a.y2))&&(Math.max(b.y1,b.y2)===Math.max(a.y1,a.y2))},isInside:function(a,c){var d=a;var b=c;return(Math.min(d.x1,d.x2)>=Math.min(b.x1,b.x2))&&(Math.max(d.x1,d.x2)<=Math.max(b.x1,b.x2))&&(Math.min(d.y1,d.y2)>=Math.min(b.y1,b.y2))&&(Math.max(d.y1,d.y2)<=Math.max(b.y1,b.y2))},getCenterCoord:function(b){var a={x:(b.x1||0+b.x2||0)/2,y:(b.y1||0+b.y2||0)/2};if(Kekule.ObjUtils.notUnset(b.z1)||Kekule.ObjUtils.notUnset(b.z2)){a.z=(b.z1||0+b.z2||0)/2}return a},getMinMaxCoords:function(d){var c=Kekule.BoxUtils.normalize(d);var a={min:{x:c.x1,y:c.y1},max:{x:c.x2,y:c.y2}};if(Kekule.ObjUtils.notUnset(c.z1)){a.min.z=c.z1;a.max.z=c.z2}return a},getCornerCoords:function(c){var a=Kekule.BoxUtils.normalize(c);if(Kekule.ObjUtils.isUnset(a.z1)){return[{x:a.x1,y:a.y1},{x:a.x1,y:a.y2},{x:a.x2,y:a.y1},{x:a.x2,y:a.y2}]}else{return[{x:a.x1,y:a.y1,z:a.z1},{x:a.x1,y:a.y2,z:a.z1},{x:a.x2,y:a.y1,z:a.z1},{x:a.x2,y:a.y2,z:a.z1},{x:a.x1,y:a.y1,z:a.z2},{x:a.x1,y:a.y2,z:a.z2},{x:a.x2,y:a.y1,z:a.z2},{x:a.x2,y:a.y2,z:a.z2}]}},transform2D:function(e,b){var f=Kekule.BoxUtils.getCornerCoords(e);var d=[];for(var c=0,a=f.length;c<a;++c){d.push(Kekule.CoordUtils.transform2D(f[c],b))}return Kekule.CoordUtils.getContainerBox(d)},transform3D:function(e,b){var f=Kekule.BoxUtils.getCornerCoords(e);var d=[];for(var c=0,a=f.length;c<a;++c){d.push(Kekule.CoordUtils.transform3D(f[c],b))}return Kekule.CoordUtils.getContainerBox(d)}};Kekule.RectUtils={createRect:function(e,d,c,b){var a={left:e,top:d,width:c,height:b};return a},isZero:function(a){return(a.width===0)&&(a.height===0)},convertToBox:function(b){var c=Kekule.CoordUtils.create(b.left,b.top);var a=Kekule.CoordUtils.create(b.left+b.width,b.top+b.height);return Kekule.BoxUtils.createBox(c,a)},inflateRect:function(d,c,b){if(Kekule.ObjUtils.isUnset(b)){b=c}var a=Kekule.RectUtils.createRect(d.left,d.top,d.width+c,d.height+b);return a},shiftRect:function(f,d,b){var e=d||0;var c=b||0;var a=Kekule.RectUtils.createRect(f.left+e,f.top+c,f.width,f.height);return a},getContainerRect:function(d,b){var e=Kekule.RectUtils.convertToBox(d);var c=Kekule.RectUtils.convertToBox(b);var a=Kekule.BoxUtils.getContainerBox(e,c);return Kekule.BoxUtils.convertToRect(a)},getIntersection:function(d,b){var e=Kekule.RectUtils.convertToBox(d);var c=Kekule.RectUtils.convertToBox(b);var a=Kekule.BoxUtils.getIntersection(e,c);return a?Kekule.BoxUtils.convertToRect(a):null},hasIntersection:function(b,a){return !!Kekule.RectUtils.getIntersection(b,a)}};Kekule.ZoomUtils={PREDEFINED_ZOOM_RATIOS:[0.1,0.3,0.5,0.66,0.8,0.9,1,1.1,1.25,1.5,1.75,2,2.5,3,4,5,7,10,15,20],getNextZoomInRatio:function(b,e){if(!e){e=1}var c=Kekule.ZoomUtils.PREDEFINED_ZOOM_RATIOS;var a=c.length;if(b<c[a-1]){for(var d=0;d<a;++d){if(c[d]>b){return c[Math.min(d+e,a)-1]}}}return b},getNextZoomOutRatio:function(b,e){if(!e){e=1}var c=Kekule.ZoomUtils.PREDEFINED_ZOOM_RATIOS;var a=c.length;if(b>c[0]){for(var d=a-1;d>=0;--d){if(c[d]<b){return c[Math.max(d-e+1,0)]}}}return b}};